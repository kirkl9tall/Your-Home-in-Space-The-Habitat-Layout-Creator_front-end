import{j as i,r as g,R as Ke,w as _h,S as zr,C as ze,P as Ur,W as Br,a as Hr,A as $r,D as Vs,G as Ai,b as Nh,c as wt,M as ke,B as ge,T as pl,d as Vr,e as Lt,f as xt,g as fs,h as ct,i as qt,k as wn,V as ve,O as Li,l as $,m as gl,n as xl,E as Ch,L as Oi,o as Di,p as Is,q as vr,s as yl,t as Qo,u as Ii,v as wr,x as Fi,y as ot,z as zi,F as Ui,H as Eh,I as Rh,J as Zo,K as bl,N as Th,Q as Sn,U as vl,X as Dt,Y as Tn,Z as jh,_ as Ph,$ as Se,a0 as wl,a1 as ys,a2 as kh,a3 as Sl,a4 as Mh,a5 as Ah,a6 as Lh,a7 as Oh,a8 as Dh,a9 as _l,aa as Jo,ab as Ih,ac as mo,ad as Fh,ae as zh,af as Uh,ag as Bh,ah as Hh,ai as At,aj as $h,ak as Vh,al as Wh,am as Gh,an as Nl,ao as Kh,ap as Ca,aq as Ea,ar as Ra,as as Ta,at as ja,au as qh,av as Yh,aw as Bi,ax as Wr,ay as Gr,az as Hi,aA as Xh,aB as Qh,aC as zn,aD as Zh,aE as Kr,aF as Jh,aG as ef,aH as Fs,aI as Os,aJ as Cl,aK as tf,aL as sf}from"./three-vendor-DTrxKhmf.js";import{a as nf,g as rf}from"./react-vendor-D3F3s8fL.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();const zs=new WeakMap,pr=new WeakMap,Sr={current:[]};let po=!1,_n=0;const gn=new Set,Un=new Map;function El(t){const e=Array.from(t).sort((s,n)=>s instanceof Us&&s.options.deps.includes(n)?1:n instanceof Us&&n.options.deps.includes(s)?-1:0);for(const s of e){if(Sr.current.includes(s))continue;Sr.current.push(s),s.recompute();const n=pr.get(s);if(n)for(const r of n){const o=zs.get(r);o&&El(o)}}}function of(t){const e={prevVal:t.prevState,currentVal:t.state};for(const s of t.listeners)s(e)}function af(t){const e={prevVal:t.prevState,currentVal:t.state};for(const s of t.listeners)s(e)}function Rl(t){if(_n>0&&!Un.has(t)&&Un.set(t,t.prevState),gn.add(t),!(_n>0)&&!po)try{for(po=!0;gn.size>0;){const e=Array.from(gn);gn.clear();for(const s of e){const n=Un.get(s)??s.prevState;s.prevState=n,of(s)}for(const s of e){const n=zs.get(s);n&&(Sr.current.push(s),El(n))}for(const s of e){const n=zs.get(s);if(n)for(const r of n)af(r)}}}finally{po=!1,Sr.current=[],Un.clear()}}function Nn(t){_n++;try{t()}finally{if(_n--,_n===0){const e=gn.values().next().value;e&&Rl(e)}}}function cf(t){return typeof t=="function"}class ei{constructor(e,s){this.listeners=new Set,this.subscribe=n=>{var r,o;this.listeners.add(n);const a=(o=(r=this.options)==null?void 0:r.onSubscribe)==null?void 0:o.call(r,n,this);return()=>{this.listeners.delete(n),a?.()}},this.prevState=e,this.state=e,this.options=s}setState(e){var s,n,r;this.prevState=this.state,(s=this.options)!=null&&s.updateFn?this.state=this.options.updateFn(this.prevState)(e):cf(e)?this.state=e(this.prevState):this.state=e,(r=(n=this.options)==null?void 0:n.onUpdate)==null||r.call(n),Rl(this)}}class Us{constructor(e){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const s=this.options.deps.length,n=new Array(s),r=new Array(s);for(let o=0;o<s;o++){const a=this.options.deps[o];n[o]=a.prevState,r[o]=a.state}return this.lastSeenDepValues=r,{prevDepVals:n,currDepVals:r,prevVal:this.prevState??void 0}},this.recompute=()=>{var s,n;this.prevState=this.state;const r=this.getDepVals();this.state=this.options.fn(r),(n=(s=this.options).onUpdate)==null||n.call(s)},this.checkIfRecalculationNeededDeeply=()=>{for(const o of this.options.deps)o instanceof Us&&o.checkIfRecalculationNeededDeeply();let s=!1;const n=this.lastSeenDepValues,{currDepVals:r}=this.getDepVals();for(let o=0;o<r.length;o++)if(r[o]!==n[o]){s=!0;break}s&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const s of this._subscriptions)s()}),this.subscribe=s=>{var n,r;this.listeners.add(s);const o=(r=(n=this.options).onSubscribe)==null?void 0:r.call(n,s,this);return()=>{this.listeners.delete(s),o?.()}},this.options=e,this.state=e.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(e=this.options.deps){for(const s of e)if(s instanceof Us)s.registerOnGraph(),this.registerOnGraph(s.options.deps);else if(s instanceof ei){let n=zs.get(s);n||(n=new Set,zs.set(s,n)),n.add(this);let r=pr.get(this);r||(r=new Set,pr.set(this,r)),r.add(s)}}unregisterFromGraph(e=this.options.deps){for(const s of e)if(s instanceof Us)this.unregisterFromGraph(s.options.deps);else if(s instanceof ei){const n=zs.get(s);n&&n.delete(this);const r=pr.get(this);r&&r.delete(s)}}}const Xt="__TSR_index",Pa="popstate",ka="beforeunload";function lf(t){let e=t.getLocation();const s=new Set,n=a=>{e=t.getLocation(),s.forEach(c=>c({location:e,action:a}))},r=a=>{t.notifyOnIndexChange??!0?n(a):e=t.getLocation()},o=async({task:a,navigateOpts:c,...l})=>{if(c?.ignoreBlocker??!1){a();return}const h=t.getBlockers?.()??[],u=l.type==="PUSH"||l.type==="REPLACE";if(typeof document<"u"&&h.length&&u)for(const f of h){const m=_r(l.path,l.state);if(await f.blockerFn({currentLocation:e,nextLocation:m,action:l.type})){t.onBlocked?.();return}}a()};return{get location(){return e},get length(){return t.getLength()},subscribers:s,subscribe:a=>(s.add(a),()=>{s.delete(a)}),push:(a,c,l)=>{const d=e.state[Xt];c=Ma(d+1,c),o({task:()=>{t.pushState(a,c),n({type:"PUSH"})},navigateOpts:l,type:"PUSH",path:a,state:c})},replace:(a,c,l)=>{const d=e.state[Xt];c=Ma(d,c),o({task:()=>{t.replaceState(a,c),n({type:"REPLACE"})},navigateOpts:l,type:"REPLACE",path:a,state:c})},go:(a,c)=>{o({task:()=>{t.go(a),r({type:"GO",index:a})},navigateOpts:c,type:"GO"})},back:a=>{o({task:()=>{t.back(a?.ignoreBlocker??!1),r({type:"BACK"})},navigateOpts:a,type:"BACK"})},forward:a=>{o({task:()=>{t.forward(a?.ignoreBlocker??!1),r({type:"FORWARD"})},navigateOpts:a,type:"FORWARD"})},canGoBack:()=>e.state[Xt]!==0,createHref:a=>t.createHref(a),block:a=>{if(!t.setBlockers)return()=>{};const c=t.getBlockers?.()??[];return t.setBlockers([...c,a]),()=>{const l=t.getBlockers?.()??[];t.setBlockers?.(l.filter(d=>d!==a))}},flush:()=>t.flush?.(),destroy:()=>t.destroy?.(),notify:n}}function Ma(t,e){e||(e={});const s=$i();return{...e,key:s,__TSR_key:s,[Xt]:t}}function df(t){const e=typeof document<"u"?window:void 0,s=e.history.pushState,n=e.history.replaceState;let r=[];const o=()=>r,a=N=>r=N,c=(N=>N),l=(()=>_r(`${e.location.pathname}${e.location.search}${e.location.hash}`,e.history.state));if(!e.history.state?.__TSR_key&&!e.history.state?.key){const N=$i();e.history.replaceState({[Xt]:0,key:N,__TSR_key:N},"")}let d=l(),h,u=!1,f=!1,m=!1,p=!1;const x=()=>d;let b,S;const y=()=>{b&&(_._ignoreSubscribers=!0,(b.isPush?e.history.pushState:e.history.replaceState)(b.state,"",b.href),_._ignoreSubscribers=!1,b=void 0,S=void 0,h=void 0)},w=(N,j,F)=>{const E=c(j);S||(h=d),d=_r(j,F),b={href:E,state:F,isPush:b?.isPush||N==="push"},S||(S=Promise.resolve().then(()=>y()))},v=N=>{d=l(),_.notify({type:N})},C=async()=>{if(f){f=!1;return}const N=l(),j=N.state[Xt]-d.state[Xt],F=j===1,E=j===-1,P=!F&&!E||u;u=!1;const B=P?"GO":E?"BACK":"FORWARD",k=P?{type:"GO",index:j}:{type:E?"BACK":"FORWARD"};if(m)m=!1;else{const D=o();if(typeof document<"u"&&D.length){for(const U of D)if(await U.blockerFn({currentLocation:d,nextLocation:N,action:B})){f=!0,e.history.go(1),_.notify(k);return}}}d=l(),_.notify(k)},T=N=>{if(p){p=!1;return}let j=!1;const F=o();if(typeof document<"u"&&F.length)for(const E of F){const P=E.enableBeforeUnload??!0;if(P===!0){j=!0;break}if(typeof P=="function"&&P()===!0){j=!0;break}}if(j)return N.preventDefault(),N.returnValue=""},_=lf({getLocation:x,getLength:()=>e.history.length,pushState:(N,j)=>w("push",N,j),replaceState:(N,j)=>w("replace",N,j),back:N=>(N&&(m=!0),p=!0,e.history.back()),forward:N=>{N&&(m=!0),p=!0,e.history.forward()},go:N=>{u=!0,e.history.go(N)},createHref:N=>c(N),flush:y,destroy:()=>{e.history.pushState=s,e.history.replaceState=n,e.removeEventListener(ka,T,{capture:!0}),e.removeEventListener(Pa,C)},onBlocked:()=>{h&&d!==h&&(d=h)},getBlockers:o,setBlockers:a,notifyOnIndexChange:!1});return e.addEventListener(ka,T,{capture:!0}),e.addEventListener(Pa,C),e.history.pushState=function(...N){const j=s.apply(e.history,N);return _._ignoreSubscribers||v("PUSH"),j},e.history.replaceState=function(...N){const j=n.apply(e.history,N);return _._ignoreSubscribers||v("REPLACE"),j},_}function _r(t,e){const s=t.indexOf("#"),n=t.indexOf("?"),r=$i();return{href:t,pathname:t.substring(0,s>0?n>0?Math.min(s,n):s:n>0?n:t.length),hash:s>-1?t.substring(s):"",search:n>-1?t.slice(n,s===-1?void 0:s):"",state:e||{[Xt]:0,key:r,__TSR_key:r}}}function $i(){return(Math.random()+1).toString(36).substring(7)}function ti(t){return t[t.length-1]}function uf(t){return typeof t=="function"}function ms(t,e){return uf(t)?t(e):t}const hf=Object.prototype.hasOwnProperty;function nt(t,e){if(t===e)return t;const s=e,n=Oa(t)&&Oa(s);if(!n&&!(Nr(t)&&Nr(s)))return s;const r=n?t:Aa(t);if(!r)return s;const o=n?s:Aa(s);if(!o)return s;const a=r.length,c=o.length,l=n?new Array(c):{};let d=0;for(let h=0;h<c;h++){const u=n?h:o[h],f=t[u],m=s[u];if(f===m){l[u]=f,(n?h<a:hf.call(t,u))&&d++;continue}if(f===null||m===null||typeof f!="object"||typeof m!="object"){l[u]=m;continue}const p=nt(f,m);l[u]=p,p===f&&d++}return a===c&&d===a?t:l}function Aa(t){const e=[],s=Object.getOwnPropertyNames(t);for(const r of s){if(!Object.prototype.propertyIsEnumerable.call(t,r))return!1;e.push(r)}const n=Object.getOwnPropertySymbols(t);for(const r of n){if(!Object.prototype.propertyIsEnumerable.call(t,r))return!1;e.push(r)}return e}function Nr(t){if(!La(t))return!1;const e=t.constructor;if(typeof e>"u")return!0;const s=e.prototype;return!(!La(s)||!s.hasOwnProperty("isPrototypeOf"))}function La(t){return Object.prototype.toString.call(t)==="[object Object]"}function Oa(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function ps(t,e,s){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(!ps(t[n],e[n],s))return!1;return!0}if(Nr(t)&&Nr(e)){const n=s?.ignoreUndefined??!0;if(s?.partial){for(const a in e)if((!n||e[a]!==void 0)&&!ps(t[a],e[a],s))return!1;return!0}let r=0;if(!n)r=Object.keys(t).length;else for(const a in t)t[a]!==void 0&&r++;let o=0;for(const a in e)if((!n||e[a]!==void 0)&&(o++,o>r||!ps(t[a],e[a],s)))return!1;return r===o}return!1}function Ws(t){let e,s;const n=new Promise((r,o)=>{e=r,s=o});return n.status="pending",n.resolve=r=>{n.status="resolved",n.value=r,e(r),t?.(r)},n.reject=r=>{n.status="rejected",s(r)},n}function Qt(t){return!!(t&&typeof t=="object"&&typeof t.then=="function")}var ff="Invariant failed";function It(t,e){if(!t)throw new Error(ff)}const St=0,bs=1,Gs=2,Ks=3;function Ot(t){return Vi(t.filter(e=>e!==void 0).join("/"))}function Vi(t){return t.replace(/\/{2,}/g,"/")}function Wi(t){return t==="/"?t:t.replace(/^\/{1,}/,"")}function Zt(t){return t==="/"?t:t.replace(/\/{1,}$/,"")}function si(t){return Zt(Wi(t))}function Cr(t,e){return t?.endsWith("/")&&t!=="/"&&t!==`${e}/`?t.slice(0,-1):t}function mf(t,e,s){return Cr(t,s)===Cr(e,s)}function pf(t){const{type:e,value:s}=t;if(e===St)return s;const{prefixSegment:n,suffixSegment:r}=t;if(e===bs){const o=s.substring(1);if(n&&r)return`${n}{$${o}}${r}`;if(n)return`${n}{$${o}}`;if(r)return`{$${o}}${r}`}if(e===Ks){const o=s.substring(1);return n&&r?`${n}{-$${o}}${r}`:n?`${n}{-$${o}}`:r?`{-$${o}}${r}`:`{-$${o}}`}if(e===Gs){if(n&&r)return`${n}{$}${r}`;if(n)return`${n}{$}`;if(r)return`{$}${r}`}return s}function gf({base:t,to:e,trailingSlash:s="never",parseCache:n}){let r=Tl(t,n).slice();const o=qr(e,n);r.length>1&&ti(r)?.value==="/"&&r.pop();for(let l=0,d=o.length;l<d;l++){const h=o[l],u=h.value;u==="/"?l?l===d-1&&r.push(h):r=[h]:u===".."?r.pop():u==="."||r.push(h)}r.length>1&&(ti(r).value==="/"?s==="never"&&r.pop():s==="always"&&r.push({type:St,value:"/"}));const a=r.map(pf);return Ot(a)}const Tl=(t,e)=>jl(t,e,!0),qr=(t,e)=>jl(t,e,!1),jl=(t,e,s)=>{if(!t)return[];const n=e?.get(t);if(n)return n;const r=Sf(t,s);return e?.set(t,r),r},xf=/^\$.{1,}$/,yf=/^(.*?)\{(\$[a-zA-Z_$][a-zA-Z0-9_$]*)\}(.*)$/,bf=/^(.*?)\{-(\$[a-zA-Z_$][a-zA-Z0-9_$]*)\}(.*)$/,vf=/^\$$/,wf=/^(.*?)\{\$\}(.*)$/;function Sf(t,e){t=Vi(t);const s=[];if(t.slice(0,1)==="/"&&(t=t.substring(1),s.push({type:St,value:"/"})),!t)return s;const n=t.split("/").filter(Boolean);return s.push(...n.map(r=>{const o=!e&&r.slice(-1)==="_"?r.slice(0,-1):r,a=o.match(wf);if(a){const d=a[1],h=a[2];return{type:Gs,value:"$",prefixSegment:d||void 0,suffixSegment:h||void 0}}const c=o.match(bf);if(c){const d=c[1],h=c[2],u=c[3];return{type:Ks,value:h,prefixSegment:d||void 0,suffixSegment:u||void 0}}const l=o.match(yf);if(l){const d=l[1],h=l[2],u=l[3];return{type:bs,value:""+h,prefixSegment:d||void 0,suffixSegment:u||void 0}}if(xf.test(o)){const d=o.substring(1);return{type:bs,value:"$"+d,prefixSegment:void 0,suffixSegment:void 0}}return vf.test(o)?{type:Gs,value:"$",prefixSegment:void 0,suffixSegment:void 0}:{type:St,value:o.includes("%25")?o.split("%25").map(d=>decodeURI(d)).join("%25"):decodeURI(o)}})),t.slice(-1)==="/"&&(t=t.substring(1),s.push({type:St,value:"/"})),s}function Bn({path:t,params:e,leaveWildcards:s,leaveParams:n,decodeCharMap:r,parseCache:o}){const a=qr(t,o);function c(u){const f=e[u],m=typeof f=="string";return u==="*"||u==="_splat"?m?encodeURI(f):f:m?_f(f,r):f}let l=!1;const d={},h=Ot(a.map(u=>{if(u.type===St)return u.value;if(u.type===Gs){d._splat=e._splat,d["*"]=e._splat;const f=u.prefixSegment||"",m=u.suffixSegment||"";if(!("_splat"in e))return l=!0,s?`${f}${u.value}${m}`:f||m?`${f}${m}`:void 0;const p=c("_splat");return s?`${f}${u.value}${p??""}${m}`:`${f}${p}${m}`}if(u.type===bs){const f=u.value.substring(1);!l&&!(f in e)&&(l=!0),d[f]=e[f];const m=u.prefixSegment||"",p=u.suffixSegment||"";if(n){const x=c(u.value);return`${m}${u.value}${x??""}${p}`}return`${m}${c(f)??"undefined"}${p}`}if(u.type===Ks){const f=u.value.substring(1),m=u.prefixSegment||"",p=u.suffixSegment||"";if(!(f in e)||e[f]==null)return s?`${m}${f}${p}`:m||p?`${m}${p}`:void 0;if(d[f]=e[f],n){const x=c(u.value);return`${m}${u.value}${x??""}${p}`}return s?`${m}${f}${c(f)??""}${p}`:`${m}${c(f)??""}${p}`}return u.value}));return{usedParams:d,interpolatedPath:h,isMissingParams:l}}function _f(t,e){let s=encodeURIComponent(t);if(e)for(const[n,r]of e)s=s.replaceAll(n,r);return s}function ni(t,e,s){const n=Nf(t,e,s);if(!(e.to&&!n))return n??{}}function Nf(t,{to:e,fuzzy:s,caseSensitive:n},r){const o=e,a=Tl(t.startsWith("/")?t:`/${t}`,r),c=qr(o.startsWith("/")?o:`/${o}`,r),l={};return Cf(a,c,l,s,n)?l:void 0}function Cf(t,e,s,n,r){let o=0,a=0;for(;o<t.length||a<e.length;){const c=t[o],l=e[a];if(l){if(l.type===Gs){const d=t.slice(o);let h;if(l.prefixSegment||l.suffixSegment){if(!c)return!1;const u=l.prefixSegment||"",f=l.suffixSegment||"",m=c.value;if("prefixSegment"in l&&!m.startsWith(u)||"suffixSegment"in l&&!t[t.length-1]?.value.endsWith(f))return!1;let p=decodeURI(Ot(d.map(x=>x.value)));u&&p.startsWith(u)&&(p=p.slice(u.length)),f&&p.endsWith(f)&&(p=p.slice(0,p.length-f.length)),h=p}else h=decodeURI(Ot(d.map(u=>u.value)));return s["*"]=h,s._splat=h,!0}if(l.type===St){if(l.value==="/"&&!c?.value){a++;continue}if(c){if(r){if(l.value!==c.value)return!1}else if(l.value.toLowerCase()!==c.value.toLowerCase())return!1;o++,a++;continue}else return!1}if(l.type===bs){if(!c||c.value==="/")return!1;let d="",h=!1;if(l.prefixSegment||l.suffixSegment){const u=l.prefixSegment||"",f=l.suffixSegment||"",m=c.value;if(u&&!m.startsWith(u)||f&&!m.endsWith(f))return!1;let p=m;u&&p.startsWith(u)&&(p=p.slice(u.length)),f&&p.endsWith(f)&&(p=p.slice(0,p.length-f.length)),d=decodeURIComponent(p),h=!0}else d=decodeURIComponent(c.value),h=!0;h&&(s[l.value.substring(1)]=d,o++),a++;continue}if(l.type===Ks){if(!c){a++;continue}if(c.value==="/"){a++;continue}let d="",h=!1;if(l.prefixSegment||l.suffixSegment){const u=l.prefixSegment||"",f=l.suffixSegment||"",m=c.value;if((!u||m.startsWith(u))&&(!f||m.endsWith(f))){let p=m;u&&p.startsWith(u)&&(p=p.slice(u.length)),f&&p.endsWith(f)&&(p=p.slice(0,p.length-f.length)),d=decodeURIComponent(p),h=!0}}else{let u=!0;for(let f=a+1;f<e.length;f++){const m=e[f];if(m?.type===St&&m.value===c.value){u=!1;break}if(m?.type===bs||m?.type===Gs){t.length<e.length&&(u=!1);break}}u&&(d=decodeURIComponent(c.value),h=!0)}h&&(s[l.value.substring(1)]=d,o++),a++;continue}}if(o<t.length&&a>=e.length)return s["**"]=Ot(t.slice(o).map(d=>d.value)),!!n&&e[e.length-1]?.value!=="/";if(a<e.length&&o>=t.length){for(let d=a;d<e.length;d++)if(e[d]?.type!==Ks)return!1;break}break}return!0}const Ef=.75,Rf=1,Tf=.5,jf=.4,Pf=.25,kf=.2,Mf=.05,Af=.02,Lf=.01,Da=2e-4,Ia=1e-4;function Fa(t,e){return t.prefixSegment&&t.suffixSegment?e+Mf+Da*t.prefixSegment.length+Ia*t.suffixSegment.length:t.prefixSegment?e+Af+Da*t.prefixSegment.length:t.suffixSegment?e+Lf+Ia*t.suffixSegment.length:e}function Of(t){const e=[];return t.forEach((n,r)=>{if(n.isRoot||!n.path)return;const o=Wi(n.fullPath);let a=qr(o),c=0;for(;a.length>c+1&&a[c]?.value==="/";)c++;c>0&&(a=a.slice(c));let l=0,d=!1;const h=a.map((u,f)=>{if(u.value==="/")return Ef;if(u.type===St)return Rf;let m;u.type===bs?m=Tf:u.type===Ks?(m=jf,l++):m=Pf;for(let p=f+1;p<a.length;p++){const x=a[p];if(x.type===St&&x.value!=="/")return d=!0,Fa(u,m+kf)}return Fa(u,m)});e.push({child:n,trimmed:o,parsed:a,index:r,scores:h,optionalParamCount:l,hasStaticAfter:d})}),e.sort((n,r)=>{const o=Math.min(n.scores.length,r.scores.length);for(let a=0;a<o;a++)if(n.scores[a]!==r.scores[a])return r.scores[a]-n.scores[a];if(n.scores.length!==r.scores.length){if(n.optionalParamCount!==r.optionalParamCount){if(n.hasStaticAfter===r.hasStaticAfter)return n.optionalParamCount-r.optionalParamCount;if(n.hasStaticAfter&&!r.hasStaticAfter)return-1;if(!n.hasStaticAfter&&r.hasStaticAfter)return 1}return r.scores.length-n.scores.length}for(let a=0;a<o;a++)if(n.parsed[a].value!==r.parsed[a].value)return n.parsed[a].value>r.parsed[a].value?1:-1;return n.index-r.index}).map((n,r)=>(n.child.rank=r,n.child))}function Df({routeTree:t,initRoute:e}){const s={},n={},r=a=>{a.forEach((c,l)=>{e?.(c,l);const d=s[c.id];if(It(!d,`Duplicate routes found with id: ${String(c.id)}`),s[c.id]=c,!c.isRoot&&c.path){const u=Zt(c.fullPath);(!n[u]||c.fullPath.endsWith("/"))&&(n[u]=c)}const h=c.children;h?.length&&r(h)})};r([t]);const o=Of(Object.values(s));return{routesById:s,routesByPath:n,flatRoutes:o}}function Nt(t){return!!t?.isNotFound}function If(){try{if(typeof window<"u"&&typeof window.sessionStorage=="object")return window.sessionStorage}catch{}}const Er="tsr-scroll-restoration-v1_3",Ff=(t,e)=>{let s;return(...n)=>{s||(s=setTimeout(()=>{t(...n),s=null},e))}};function zf(){const t=If();if(!t)return null;const e=t.getItem(Er);let s=e?JSON.parse(e):{};return{state:s,set:n=>(s=ms(n,s)||s,t.setItem(Er,JSON.stringify(s)))}}const Hn=zf(),ri=t=>t.state.__TSR_key||t.href;function Uf(t){const e=[];let s;for(;s=t.parentNode;)e.push(`${t.tagName}:nth-child(${Array.prototype.indexOf.call(s.children,t)+1})`),t=s;return`${e.reverse().join(" > ")}`.toLowerCase()}let Rr=!1;function Pl({storageKey:t,key:e,behavior:s,shouldScrollRestoration:n,scrollToTopSelectors:r,location:o}){let a;try{a=JSON.parse(sessionStorage.getItem(t)||"{}")}catch(d){console.error(d);return}const c=e||window.history.state?.__TSR_key,l=a[c];Rr=!0;e:{if(n&&l&&Object.keys(l).length>0){for(const u in l){const f=l[u];if(u==="window")window.scrollTo({top:f.scrollY,left:f.scrollX,behavior:s});else if(u){const m=document.querySelector(u);m&&(m.scrollLeft=f.scrollX,m.scrollTop=f.scrollY)}}break e}const d=(o??window.location).hash.split("#",2)[1];if(d){const u=window.history.state?.__hashScrollIntoViewOptions??!0;if(u){const f=document.getElementById(d);f&&f.scrollIntoView(u)}break e}const h={top:0,left:0,behavior:s};if(window.scrollTo(h),r)for(const u of r){if(u==="window")continue;const f=typeof u=="function"?u():document.querySelector(u);f&&f.scrollTo(h)}}Rr=!1}function Bf(t,e){if(!Hn&&!t.isServer||((t.options.scrollRestoration??!1)&&(t.isScrollRestoring=!0),t.isServer||t.isScrollRestorationSetup||!Hn))return;t.isScrollRestorationSetup=!0,Rr=!1;const n=t.options.getScrollRestorationKey||ri;window.history.scrollRestoration="manual";const r=o=>{if(Rr||!t.isScrollRestoring)return;let a="";if(o.target===document||o.target===window)a="window";else{const l=o.target.getAttribute("data-scroll-restoration-id");l?a=`[data-scroll-restoration-id="${l}"]`:a=Uf(o.target)}const c=n(t.state.location);Hn.set(l=>{const d=l[c]||={},h=d[a]||={};if(a==="window")h.scrollX=window.scrollX||0,h.scrollY=window.scrollY||0;else if(a){const u=document.querySelector(a);u&&(h.scrollX=u.scrollLeft||0,h.scrollY=u.scrollTop||0)}return l})};typeof document<"u"&&document.addEventListener("scroll",Ff(r,100),!0),t.subscribe("onRendered",o=>{const a=n(o.toLocation);if(!t.resetNextScroll){t.resetNextScroll=!0;return}typeof t.options.scrollRestoration=="function"&&!t.options.scrollRestoration({location:t.latestLocation})||(Pl({storageKey:Er,key:a,behavior:t.options.scrollRestorationBehavior,shouldScrollRestoration:t.isScrollRestoring,scrollToTopSelectors:t.options.scrollToTopSelectors,location:t.history.location}),t.isScrollRestoring&&Hn.set(c=>(c[a]||={},c)))})}function Hf(t){if(typeof document<"u"&&document.querySelector){const e=t.state.location.state.__hashScrollIntoViewOptions??!0;if(e&&t.state.location.hash!==""){const s=document.getElementById(t.state.location.hash);s&&s.scrollIntoView(e)}}}function $f(t,e=String){const s=new URLSearchParams;for(const n in t){const r=t[n];r!==void 0&&s.set(n,e(r))}return s.toString()}function go(t){return t?t==="false"?!1:t==="true"?!0:+t*0===0&&+t+""===t?+t:t:""}function Vf(t){const e=new URLSearchParams(t),s={};for(const[n,r]of e.entries()){const o=s[n];o==null?s[n]=go(r):Array.isArray(o)?o.push(go(r)):s[n]=[o,go(r)]}return s}const Wf=Kf(JSON.parse),Gf=qf(JSON.stringify,JSON.parse);function Kf(t){return e=>{e[0]==="?"&&(e=e.substring(1));const s=Vf(e);for(const n in s){const r=s[n];if(typeof r=="string")try{s[n]=t(r)}catch{}}return s}}function qf(t,e){const s=typeof e=="function";function n(r){if(typeof r=="object"&&r!==null)try{return t(r)}catch{}else if(s&&typeof r=="string")try{return e(r),t(r)}catch{}return r}return r=>{const o=$f(r,n);return o?`?${o}`:""}}const it="__root__";function Yf(t){if(t.statusCode=t.statusCode||t.code||307,!t.reloadDocument&&typeof t.href=="string")try{new URL(t.href),t.reloadDocument=!0}catch{}const e=new Headers(t.headers);t.href&&e.get("Location")===null&&e.set("Location",t.href);const s=new Response(null,{status:t.statusCode,headers:e});if(s.options=t,t.throw)throw s;return s}function bt(t){return t instanceof Response&&!!t.options}function Xf(t){const e=new Map;let s,n;const r=o=>{o.next&&(o.prev?(o.prev.next=o.next,o.next.prev=o.prev,o.next=void 0,n&&(n.next=o,o.prev=n)):(o.next.prev=void 0,s=o.next,o.next=void 0,n&&(o.prev=n,n.next=o)),n=o)};return{get(o){const a=e.get(o);if(a)return r(a),a.value},set(o,a){if(e.size>=t&&s){const l=s;e.delete(l.key),l.next&&(s=l.next,l.next.prev=void 0),l===n&&(n=void 0)}const c=e.get(o);if(c)c.value=a,r(c);else{const l={key:o,value:a,prev:n};n&&(n.next=l),n=l,s||(s=l),e.set(o,l)}}}}const gr=t=>{if(!t.rendered)return t.rendered=!0,t.onReady?.()},Yr=(t,e)=>!!(t.preload&&!t.router.state.matches.some(s=>s.id===e)),kl=(t,e)=>{const s=t.router.routesById[e.routeId??""]??t.router.routeTree;!s.options.notFoundComponent&&t.router.options?.defaultNotFoundComponent&&(s.options.notFoundComponent=t.router.options.defaultNotFoundComponent),It(s.options.notFoundComponent);const n=t.matches.find(r=>r.routeId===s.id);It(n,"Could not find match for route: "+s.id),t.updateMatch(n.id,r=>({...r,status:"notFound",error:e,isFetching:!1})),e.routerCode==="BEFORE_LOAD"&&s.parentRoute&&(e.routeId=s.parentRoute.id,kl(t,e))},Yt=(t,e,s)=>{if(!(!bt(s)&&!Nt(s))){if(bt(s)&&s.redirectHandled&&!s.options.reloadDocument)throw s;if(e){e._nonReactive.beforeLoadPromise?.resolve(),e._nonReactive.loaderPromise?.resolve(),e._nonReactive.beforeLoadPromise=void 0,e._nonReactive.loaderPromise=void 0;const n=bt(s)?"redirected":"notFound";t.updateMatch(e.id,r=>({...r,status:n,isFetching:!1,error:s})),Nt(s)&&!s.routeId&&(s.routeId=e.routeId),e._nonReactive.loadPromise?.resolve()}throw bt(s)?(t.rendered=!0,s.options._fromLocation=t.location,s.redirectHandled=!0,s=t.router.resolveRedirect(s),s):(kl(t,s),s)}},Ml=(t,e)=>{const s=t.router.getMatch(e);return!!(!t.router.isServer&&s._nonReactive.dehydrated||t.router.isServer&&s.ssr===!1)},sn=(t,e,s,n)=>{const{id:r,routeId:o}=t.matches[e],a=t.router.looseRoutesById[o];if(s instanceof Promise)throw s;s.routerCode=n,t.firstBadMatchIndex??=e,Yt(t,t.router.getMatch(r),s);try{a.options.onError?.(s)}catch(c){s=c,Yt(t,t.router.getMatch(r),s)}t.updateMatch(r,c=>(c._nonReactive.beforeLoadPromise?.resolve(),c._nonReactive.beforeLoadPromise=void 0,c._nonReactive.loadPromise?.resolve(),{...c,error:s,status:"error",isFetching:!1,updatedAt:Date.now(),abortController:new AbortController}))},Qf=(t,e,s,n)=>{const r=t.router.getMatch(e),o=t.matches[s-1]?.id,a=o?t.router.getMatch(o):void 0;if(t.router.isShell()){r.ssr=e===it;return}if(a?.ssr===!1){r.ssr=!1;return}const c=m=>m===!0&&a?.ssr==="data-only"?"data-only":m,l=t.router.options.defaultSsr??!0;if(n.options.ssr===void 0){r.ssr=c(l);return}if(typeof n.options.ssr!="function"){r.ssr=c(n.options.ssr);return}const{search:d,params:h}=r,u={search:$n(d,r.searchError),params:$n(h,r.paramsError),location:t.location,matches:t.matches.map(m=>({index:m.index,pathname:m.pathname,fullPath:m.fullPath,staticData:m.staticData,id:m.id,routeId:m.routeId,search:$n(m.search,m.searchError),params:$n(m.params,m.paramsError),ssr:m.ssr}))},f=n.options.ssr(u);if(Qt(f))return f.then(m=>{r.ssr=c(m??l)});r.ssr=c(f??l)},Al=(t,e,s,n)=>{if(n._nonReactive.pendingTimeout!==void 0)return;const r=s.options.pendingMs??t.router.options.defaultPendingMs;if(!!(t.onReady&&!t.router.isServer&&!Yr(t,e)&&(s.options.loader||s.options.beforeLoad||Dl(s))&&typeof r=="number"&&r!==1/0&&(s.options.pendingComponent??t.router.options?.defaultPendingComponent))){const a=setTimeout(()=>{gr(t)},r);n._nonReactive.pendingTimeout=a}},Zf=(t,e,s)=>{const n=t.router.getMatch(e);if(!n._nonReactive.beforeLoadPromise&&!n._nonReactive.loaderPromise)return;Al(t,e,s,n);const r=()=>{const o=t.router.getMatch(e);o.preload&&(o.status==="redirected"||o.status==="notFound")&&Yt(t,o,o.error)};return n._nonReactive.beforeLoadPromise?n._nonReactive.beforeLoadPromise.then(r):r()},Jf=(t,e,s,n)=>{const r=t.router.getMatch(e),o=r._nonReactive.loadPromise;r._nonReactive.loadPromise=Ws(()=>{o?.resolve()});const{paramsError:a,searchError:c}=r;a&&sn(t,s,a,"PARSE_PARAMS"),c&&sn(t,s,c,"VALIDATE_SEARCH"),Al(t,e,n,r);const l=new AbortController,d=t.matches[s-1]?.id,f={...(d?t.router.getMatch(d):void 0)?.context??t.router.options.context??void 0,...r.__routeContext};let m=!1;const p=()=>{m||(m=!0,t.updateMatch(e,_=>({..._,isFetching:"beforeLoad",fetchCount:_.fetchCount+1,abortController:l,context:f})))},x=()=>{r._nonReactive.beforeLoadPromise?.resolve(),r._nonReactive.beforeLoadPromise=void 0,t.updateMatch(e,_=>({..._,isFetching:!1}))};if(!n.options.beforeLoad){Nn(()=>{p(),x()});return}r._nonReactive.beforeLoadPromise=Ws();const{search:b,params:S,cause:y}=r,w=Yr(t,e),v={search:b,abortController:l,params:S,preload:w,context:f,location:t.location,navigate:_=>t.router.navigate({..._,_fromLocation:t.location}),buildLocation:t.router.buildLocation,cause:w?"preload":y,matches:t.matches,...t.router.options.additionalContext},C=_=>{if(_===void 0){Nn(()=>{p(),x()});return}(bt(_)||Nt(_))&&(p(),sn(t,s,_,"BEFORE_LOAD")),Nn(()=>{p(),t.updateMatch(e,N=>({...N,__beforeLoadContext:_,context:{...N.context,..._}})),x()})};let T;try{if(T=n.options.beforeLoad(v),Qt(T))return p(),T.catch(_=>{sn(t,s,_,"BEFORE_LOAD")}).then(C)}catch(_){p(),sn(t,s,_,"BEFORE_LOAD")}C(T)},em=(t,e)=>{const{id:s,routeId:n}=t.matches[e],r=t.router.looseRoutesById[n],o=()=>{if(t.router.isServer){const l=Qf(t,s,e,r);if(Qt(l))return l.then(c)}return c()},a=()=>Jf(t,s,e,r),c=()=>{if(Ml(t,s))return;const l=Zf(t,s,r);return Qt(l)?l.then(a):a()};return o()},Cn=(t,e,s)=>{const n=t.router.getMatch(e);if(!n||!s.options.head&&!s.options.scripts&&!s.options.headers)return;const r={matches:t.matches,match:n,params:n.params,loaderData:n.loaderData};return Promise.all([s.options.head?.(r),s.options.scripts?.(r),s.options.headers?.(r)]).then(([o,a,c])=>{const l=o?.meta,d=o?.links,h=o?.scripts,u=o?.styles;return{meta:l,links:d,headScripts:h,headers:c,scripts:a,styles:u}})},Ll=(t,e,s,n)=>{const r=t.matchPromises[s-1],{params:o,loaderDeps:a,abortController:c,context:l,cause:d}=t.router.getMatch(e),h=Yr(t,e);return{params:o,deps:a,preload:!!h,parentMatchPromise:r,abortController:c,context:l,location:t.location,navigate:u=>t.router.navigate({...u,_fromLocation:t.location}),cause:h?"preload":d,route:n,...t.router.options.additionalContext}},za=async(t,e,s,n)=>{try{const r=t.router.getMatch(e);try{(!t.router.isServer||r.ssr===!0)&&Ol(n);const o=n.options.loader?.(Ll(t,e,s,n)),a=n.options.loader&&Qt(o);if(!!(a||n._lazyPromise||n._componentsPromise||n.options.head||n.options.scripts||n.options.headers||r._nonReactive.minPendingPromise)&&t.updateMatch(e,u=>({...u,isFetching:"loader"})),n.options.loader){const u=a?await o:o;Yt(t,t.router.getMatch(e),u),u!==void 0&&t.updateMatch(e,f=>({...f,loaderData:u}))}n._lazyPromise&&await n._lazyPromise;const l=Cn(t,e,n),d=l?await l:void 0,h=r._nonReactive.minPendingPromise;h&&await h,n._componentsPromise&&await n._componentsPromise,t.updateMatch(e,u=>({...u,error:void 0,status:"success",isFetching:!1,updatedAt:Date.now(),...d}))}catch(o){let a=o;const c=r._nonReactive.minPendingPromise;c&&await c,Yt(t,t.router.getMatch(e),o);try{n.options.onError?.(o)}catch(h){a=h,Yt(t,t.router.getMatch(e),h)}const l=Cn(t,e,n),d=l?await l:void 0;t.updateMatch(e,h=>({...h,error:a,status:"error",isFetching:!1,...d}))}}catch(r){const o=t.router.getMatch(e);if(o){const a=Cn(t,e,n);if(a){const c=await a;t.updateMatch(e,l=>({...l,...c}))}o._nonReactive.loaderPromise=void 0}Yt(t,o,r)}},tm=async(t,e)=>{const{id:s,routeId:n}=t.matches[e];let r=!1,o=!1;const a=t.router.looseRoutesById[n];if(Ml(t,s)){if(t.router.isServer){const d=Cn(t,s,a);if(d){const h=await d;t.updateMatch(s,u=>({...u,...h}))}return t.router.getMatch(s)}}else{const d=t.router.getMatch(s);if(d._nonReactive.loaderPromise){if(d.status==="success"&&!t.sync&&!d.preload)return d;await d._nonReactive.loaderPromise;const h=t.router.getMatch(s);h.error&&Yt(t,h,h.error)}else{const h=Date.now()-d.updatedAt,u=Yr(t,s),f=u?a.options.preloadStaleTime??t.router.options.defaultPreloadStaleTime??3e4:a.options.staleTime??t.router.options.defaultStaleTime??0,m=a.options.shouldReload,p=typeof m=="function"?m(Ll(t,s,e,a)):m,x=!!u&&!t.router.state.matches.some(w=>w.id===s),b=t.router.getMatch(s);b._nonReactive.loaderPromise=Ws(),x!==b.preload&&t.updateMatch(s,w=>({...w,preload:x}));const{status:S,invalid:y}=b;if(r=S==="success"&&(y||(p??h>f)),!(u&&a.options.preload===!1))if(r&&!t.sync)o=!0,(async()=>{try{await za(t,s,e,a);const w=t.router.getMatch(s);w._nonReactive.loaderPromise?.resolve(),w._nonReactive.loadPromise?.resolve(),w._nonReactive.loaderPromise=void 0}catch(w){bt(w)&&await t.router.navigate(w.options)}})();else if(S!=="success"||r&&t.sync)await za(t,s,e,a);else{const w=Cn(t,s,a);if(w){const v=await w;t.updateMatch(s,C=>({...C,...v}))}}}}const c=t.router.getMatch(s);o||(c._nonReactive.loaderPromise?.resolve(),c._nonReactive.loadPromise?.resolve()),clearTimeout(c._nonReactive.pendingTimeout),c._nonReactive.pendingTimeout=void 0,o||(c._nonReactive.loaderPromise=void 0),c._nonReactive.dehydrated=void 0;const l=o?c.isFetching:!1;return l!==c.isFetching||c.invalid!==!1?(t.updateMatch(s,d=>({...d,isFetching:l,invalid:!1})),t.router.getMatch(s)):c};async function Ua(t){const e=Object.assign(t,{matchPromises:[]});!e.router.isServer&&e.router.state.matches.some(s=>s._forcePending)&&gr(e);try{for(let r=0;r<e.matches.length;r++){const o=em(e,r);Qt(o)&&await o}const s=e.firstBadMatchIndex??e.matches.length;for(let r=0;r<s;r++)e.matchPromises.push(tm(e,r));await Promise.all(e.matchPromises);const n=gr(e);Qt(n)&&await n}catch(s){if(Nt(s)&&!e.preload){const n=gr(e);throw Qt(n)&&await n,s}if(bt(s))throw s}return e.matches}async function Ol(t){if(!t._lazyLoaded&&t._lazyPromise===void 0&&(t.lazyFn?t._lazyPromise=t.lazyFn().then(e=>{const{id:s,...n}=e.options;Object.assign(t.options,n),t._lazyLoaded=!0,t._lazyPromise=void 0}):t._lazyLoaded=!0),!t._componentsLoaded&&t._componentsPromise===void 0){const e=()=>{const s=[];for(const n of Il){const r=t.options[n]?.preload;r&&s.push(r())}if(s.length)return Promise.all(s).then(()=>{t._componentsLoaded=!0,t._componentsPromise=void 0});t._componentsLoaded=!0,t._componentsPromise=void 0};t._componentsPromise=t._lazyPromise?t._lazyPromise.then(e):e()}return t._componentsPromise}function $n(t,e){return e?{status:"error",error:e}:{status:"success",value:t}}function Dl(t){for(const e of Il)if(t.options[e]?.preload)return!0;return!1}const Il=["component","errorComponent","pendingComponent","notFoundComponent"];function sm(t){return{input:({url:e})=>{for(const s of t)e=Fl(s,e);return e},output:({url:e})=>{for(let s=t.length-1;s>=0;s--)e=zl(t[s],e);return e}}}function nm(t){const e=si(t.basepath),s=new RegExp(`^/${e}/`,t.caseSensitive?"":"i");return{input:({url:n})=>(n.pathname=n.pathname.replace(s,"/"),n),output:({url:n})=>(n.pathname=Ot(["/",e,n.pathname]),n)}}function Fl(t,e){const s=t?.input?.({url:e});if(s){if(typeof s=="string")return new URL(s);if(s instanceof URL)return s}return e}function zl(t,e){const s=t?.output?.({url:e});if(s){if(typeof s=="string")return new URL(s);if(s instanceof URL)return s}return e}function gs(t){const e=t.resolvedLocation,s=t.location,n=e?.pathname!==s.pathname,r=e?.href!==s.href,o=e?.hash!==s.hash;return{fromLocation:e,toLocation:s,pathChanged:n,hrefChanged:r,hashChanged:o}}class rm{constructor(e){this.tempLocationKey=`${Math.round(Math.random()*1e7)}`,this.resetNextScroll=!0,this.shouldViewTransition=void 0,this.isViewTransitionTypesSupported=void 0,this.subscribers=new Set,this.isScrollRestoring=!1,this.isScrollRestorationSetup=!1,this.startTransition=s=>s(),this.update=s=>{if(s.notFoundRoute&&console.warn("The notFoundRoute API is deprecated and will be removed in the next major version. See https://tanstack.com/router/v1/docs/framework/react/guide/not-found-errors#migrating-from-notfoundroute for more info."),this.options={...this.options,...s},this.isServer=this.options.isServer??typeof document>"u",this.pathParamsDecodeCharMap=this.options.pathParamsAllowedCharacters?new Map(this.options.pathParamsAllowedCharacters.map(n=>[encodeURIComponent(n),n])):void 0,(!this.history||this.options.history&&this.options.history!==this.history)&&(this.options.history?this.history=this.options.history:this.isServer||(this.history=df())),this.options.basepath){const n=nm({basepath:this.options.basepath});this.options.rewrite?this.rewrite=sm([n,this.options.rewrite]):this.rewrite=n}else this.rewrite=this.options.rewrite;this.origin=this.options.origin,this.origin||(this.isServer?this.origin="http://localhost":this.origin=window.origin),this.history&&this.updateLatestLocation(),this.options.routeTree!==this.routeTree&&(this.routeTree=this.options.routeTree,this.buildRouteTree()),!this.__store&&this.latestLocation&&(this.__store=new ei(im(this.latestLocation),{onUpdate:()=>{this.__store.state={...this.state,cachedMatches:this.state.cachedMatches.filter(n=>!["redirected"].includes(n.status))}}}),Bf(this)),typeof window<"u"&&"CSS"in window&&typeof window.CSS?.supports=="function"&&(this.isViewTransitionTypesSupported=window.CSS.supports("selector(:active-view-transition-type(a)"))},this.updateLatestLocation=()=>{this.latestLocation=this.parseLocation(this.history.location,this.latestLocation)},this.buildRouteTree=()=>{const{routesById:s,routesByPath:n,flatRoutes:r}=Df({routeTree:this.routeTree,initRoute:(a,c)=>{a.init({originalIndex:c})}});this.routesById=s,this.routesByPath=n,this.flatRoutes=r;const o=this.options.notFoundRoute;o&&(o.init({originalIndex:99999999999}),this.routesById[o.id]=o)},this.subscribe=(s,n)=>{const r={eventType:s,fn:n};return this.subscribers.add(r),()=>{this.subscribers.delete(r)}},this.emit=s=>{this.subscribers.forEach(n=>{n.eventType===s.type&&n.fn(s)})},this.parseLocation=(s,n)=>{const r=({href:l,state:d})=>{const h=new URL(l,this.origin),u=Fl(this.rewrite,h),f=this.options.parseSearch(u.search),m=this.options.stringifySearch(f);u.search=m;const p=u.href.replace(u.origin,""),{pathname:x,hash:b}=u;return{href:p,publicHref:l,url:u.href,pathname:x,searchStr:m,search:nt(n?.search,f),hash:b.split("#").reverse()[0]??"",state:nt(n?.state,d)}},o=r(s),{__tempLocation:a,__tempKey:c}=o.state;if(a&&(!c||c===this.tempLocationKey)){const l=r(a);return l.state.key=o.state.key,l.state.__TSR_key=o.state.__TSR_key,delete l.state.__tempLocation,{...l,maskedLocation:o}}return o},this.resolvePathWithBase=(s,n)=>gf({base:s,to:Vi(n),trailingSlash:this.options.trailingSlash,parseCache:this.parsePathnameCache}),this.matchRoutes=(s,n,r)=>typeof s=="string"?this.matchRoutesInternal({pathname:s,search:n},r):this.matchRoutesInternal(s,n),this.parsePathnameCache=Xf(1e3),this.getMatchedRoutes=(s,n)=>am({pathname:s,routePathname:n,caseSensitive:this.options.caseSensitive,routesByPath:this.routesByPath,routesById:this.routesById,flatRoutes:this.flatRoutes,parseCache:this.parsePathnameCache}),this.cancelMatch=s=>{const n=this.getMatch(s);n&&(n.abortController.abort(),clearTimeout(n._nonReactive.pendingTimeout),n._nonReactive.pendingTimeout=void 0)},this.cancelMatches=()=>{this.state.pendingMatches?.forEach(s=>{this.cancelMatch(s.id)})},this.buildLocation=s=>{const n=(o={})=>{const a=o._fromLocation||this.latestLocation,c=this.matchRoutes(a,{_buildLocation:!0}),l=ti(c);o.from;const d=o.unsafeRelative==="path"?a.pathname:o.from??l.fullPath,h=this.resolvePathWithBase(d,"."),u=l.search,f={...l.params},m=o.to?this.resolvePathWithBase(h,`${o.to}`):this.resolvePathWithBase(h,"."),p=o.params===!1||o.params===null?{}:(o.params??!0)===!0?f:Object.assign(f,ms(o.params,f)),x=Bn({path:m,params:p,parseCache:this.parsePathnameCache}).interpolatedPath,b=this.matchRoutes(x,void 0,{_buildLocation:!0}).map(F=>this.looseRoutesById[F.routeId]);if(Object.keys(p).length>0)for(const F of b){const E=F.options.params?.stringify??F.options.stringifyParams;E&&Object.assign(p,E(p))}const S=Bn({path:m,params:p,leaveWildcards:!1,leaveParams:s.leaveParams,decodeCharMap:this.pathParamsDecodeCharMap,parseCache:this.parsePathnameCache}).interpolatedPath;let y=u;if(s._includeValidateSearch&&this.options.search?.strict){const F={};b.forEach(E=>{if(E.options.validateSearch)try{Object.assign(F,oi(E.options.validateSearch,{...F,...y}))}catch{}}),y=F}y=cm({search:y,dest:o,destRoutes:b,_includeValidateSearch:s._includeValidateSearch}),y=nt(u,y);const w=this.options.stringifySearch(y),v=o.hash===!0?a.hash:o.hash?ms(o.hash,a.hash):void 0,C=v?`#${v}`:"";let T=o.state===!0?a.state:o.state?ms(o.state,a.state):{};T=nt(a.state,T);const _=`${S}${w}${C}`,N=new URL(_,this.origin),j=zl(this.rewrite,N);return{publicHref:j.pathname+j.search+j.hash,href:_,url:j.href,pathname:S,search:y,searchStr:w,state:T,hash:v??"",unmaskOnReload:o.unmaskOnReload}},r=(o={},a)=>{const c=n(o);let l=a?n(a):void 0;if(!l){let d={};const h=this.options.routeMasks?.find(u=>{const f=ni(c.pathname,{to:u.from,caseSensitive:!1,fuzzy:!1},this.parsePathnameCache);return f?(d=f,!0):!1});if(h){const{from:u,...f}=h;a={from:s.from,...f,params:d},l=n(a)}}return l&&(c.maskedLocation=l),c};return s.mask?r(s,{from:s.from,...s.mask}):r(s)},this.commitLocation=({viewTransition:s,ignoreBlocker:n,...r})=>{const o=()=>{const l=["key","__TSR_key","__TSR_index","__hashScrollIntoViewOptions"];l.forEach(h=>{r.state[h]=this.latestLocation.state[h]});const d=ps(r.state,this.latestLocation.state);return l.forEach(h=>{delete r.state[h]}),d},a=Zt(this.latestLocation.href)===Zt(r.href),c=this.commitLocationPromise;if(this.commitLocationPromise=Ws(()=>{c?.resolve()}),a&&o())this.load();else{let{maskedLocation:l,hashScrollIntoView:d,...h}=r;l&&(h={...l,state:{...l.state,__tempKey:void 0,__tempLocation:{...h,search:h.searchStr,state:{...h.state,__tempKey:void 0,__tempLocation:void 0,__TSR_key:void 0,key:void 0}}}},(h.unmaskOnReload??this.options.unmaskOnReload??!1)&&(h.state.__tempKey=this.tempLocationKey)),h.state.__hashScrollIntoViewOptions=d??this.options.defaultHashScrollIntoView??!0,this.shouldViewTransition=s,this.history[r.replace?"replace":"push"](h.publicHref,h.state,{ignoreBlocker:n})}return this.resetNextScroll=r.resetScroll??!0,this.history.subscribers.size||this.load(),this.commitLocationPromise},this.buildAndCommitLocation=({replace:s,resetScroll:n,hashScrollIntoView:r,viewTransition:o,ignoreBlocker:a,href:c,...l}={})=>{if(c){const h=this.history.location.state.__TSR_index,u=_r(c,{__TSR_index:s?h:h+1});l.to=u.pathname,l.search=this.options.parseSearch(u.search),l.hash=u.hash.slice(1)}const d=this.buildLocation({...l,_includeValidateSearch:!0});return this.commitLocation({...d,viewTransition:o,replace:s,resetScroll:n,hashScrollIntoView:r,ignoreBlocker:a})},this.navigate=({to:s,reloadDocument:n,href:r,...o})=>{if(!n&&r)try{new URL(`${r}`),n=!0}catch{}return n?(r||(r=this.buildLocation({to:s,...o}).href),o.replace?window.location.replace(r):window.location.href=r,Promise.resolve()):this.buildAndCommitLocation({...o,href:r,to:s,_isNavigate:!0})},this.beforeLoad=()=>{if(this.cancelMatches(),this.updateLatestLocation(),this.isServer){const n=this.buildLocation({to:this.latestLocation.pathname,search:!0,params:!0,hash:!0,state:!0,_includeValidateSearch:!0}),r=o=>{try{return encodeURI(decodeURI(o))}catch{return o}};if(si(r(this.latestLocation.href))!==si(r(n.href)))throw Yf({href:n.href})}const s=this.matchRoutes(this.latestLocation);this.__store.setState(n=>({...n,status:"pending",statusCode:200,isLoading:!0,location:this.latestLocation,pendingMatches:s,cachedMatches:n.cachedMatches.filter(r=>!s.some(o=>o.id===r.id))}))},this.load=async s=>{let n,r,o;for(o=new Promise(a=>{this.startTransition(async()=>{try{this.beforeLoad();const c=this.latestLocation,l=this.state.resolvedLocation;this.state.redirect||this.emit({type:"onBeforeNavigate",...gs({resolvedLocation:l,location:c})}),this.emit({type:"onBeforeLoad",...gs({resolvedLocation:l,location:c})}),await Ua({router:this,sync:s?.sync,matches:this.state.pendingMatches,location:c,updateMatch:this.updateMatch,onReady:async()=>{this.startViewTransition(async()=>{let d,h,u;Nn(()=>{this.__store.setState(f=>{const m=f.matches,p=f.pendingMatches||f.matches;return d=m.filter(x=>!p.some(b=>b.id===x.id)),h=p.filter(x=>!m.some(b=>b.id===x.id)),u=m.filter(x=>p.some(b=>b.id===x.id)),{...f,isLoading:!1,loadedAt:Date.now(),matches:p,pendingMatches:void 0,cachedMatches:[...f.cachedMatches,...d.filter(x=>x.status!=="error")]}}),this.clearExpiredCache()}),[[d,"onLeave"],[h,"onEnter"],[u,"onStay"]].forEach(([f,m])=>{f.forEach(p=>{this.looseRoutesById[p.routeId].options[m]?.(p)})})})}})}catch(c){bt(c)?(n=c,this.isServer||this.navigate({...n.options,replace:!0,ignoreBlocker:!0})):Nt(c)&&(r=c),this.__store.setState(l=>({...l,statusCode:n?n.status:r?404:l.matches.some(d=>d.status==="error")?500:200,redirect:n}))}this.latestLoadPromise===o&&(this.commitLocationPromise?.resolve(),this.latestLoadPromise=void 0,this.commitLocationPromise=void 0),a()})}),this.latestLoadPromise=o,await o;this.latestLoadPromise&&o!==this.latestLoadPromise;)await this.latestLoadPromise;this.hasNotFoundMatch()&&this.__store.setState(a=>({...a,statusCode:404}))},this.startViewTransition=s=>{const n=this.shouldViewTransition??this.options.defaultViewTransition;if(delete this.shouldViewTransition,n&&typeof document<"u"&&"startViewTransition"in document&&typeof document.startViewTransition=="function"){let r;if(typeof n=="object"&&this.isViewTransitionTypesSupported){const o=this.latestLocation,a=this.state.resolvedLocation,c=typeof n.types=="function"?n.types(gs({resolvedLocation:a,location:o})):n.types;r={update:s,types:c}}else r=s;document.startViewTransition(r)}else s()},this.updateMatch=(s,n)=>{const r=this.state.pendingMatches?.some(o=>o.id===s)?"pendingMatches":this.state.matches.some(o=>o.id===s)?"matches":this.state.cachedMatches.some(o=>o.id===s)?"cachedMatches":"";r&&this.__store.setState(o=>({...o,[r]:o[r]?.map(a=>a.id===s?n(a):a)}))},this.getMatch=s=>{const n=r=>r.id===s;return this.state.cachedMatches.find(n)??this.state.pendingMatches?.find(n)??this.state.matches.find(n)},this.invalidate=s=>{const n=r=>s?.filter?.(r)??!0?{...r,invalid:!0,...s?.forcePending||r.status==="error"?{status:"pending",error:void 0}:void 0}:r;return this.__store.setState(r=>({...r,matches:r.matches.map(n),cachedMatches:r.cachedMatches.map(n),pendingMatches:r.pendingMatches?.map(n)})),this.shouldViewTransition=!1,this.load({sync:s?.sync})},this.resolveRedirect=s=>(s.options.href||(s.options.href=this.buildLocation(s.options).href,s.headers.set("Location",s.options.href)),s.headers.get("Location")||s.headers.set("Location",s.options.href),s),this.clearCache=s=>{const n=s?.filter;n!==void 0?this.__store.setState(r=>({...r,cachedMatches:r.cachedMatches.filter(o=>!n(o))})):this.__store.setState(r=>({...r,cachedMatches:[]}))},this.clearExpiredCache=()=>{const s=n=>{const r=this.looseRoutesById[n.routeId];if(!r.options.loader)return!0;const o=(n.preload?r.options.preloadGcTime??this.options.defaultPreloadGcTime:r.options.gcTime??this.options.defaultGcTime)??300*1e3;return n.status==="error"?!0:Date.now()-n.updatedAt>=o};this.clearCache({filter:s})},this.loadRouteChunk=Ol,this.preloadRoute=async s=>{const n=this.buildLocation(s);let r=this.matchRoutes(n,{throwOnError:!0,preload:!0,dest:s});const o=new Set([...this.state.matches,...this.state.pendingMatches??[]].map(c=>c.id)),a=new Set([...o,...this.state.cachedMatches.map(c=>c.id)]);Nn(()=>{r.forEach(c=>{a.has(c.id)||this.__store.setState(l=>({...l,cachedMatches:[...l.cachedMatches,c]}))})});try{return r=await Ua({router:this,matches:r,location:n,preload:!0,updateMatch:(c,l)=>{o.has(c)?r=r.map(d=>d.id===c?l(d):d):this.updateMatch(c,l)}}),r}catch(c){if(bt(c))return c.options.reloadDocument?void 0:await this.preloadRoute({...c.options,_fromLocation:n});Nt(c)||console.error(c);return}},this.matchRoute=(s,n)=>{const r={...s,to:s.to?this.resolvePathWithBase(s.from||"",s.to):void 0,params:s.params||{},leaveParams:!0},o=this.buildLocation(r);if(n?.pending&&this.state.status!=="pending")return!1;const c=(n?.pending===void 0?!this.state.isLoading:n.pending)?this.latestLocation:this.state.resolvedLocation||this.state.location,l=ni(c.pathname,{...n,to:o.pathname},this.parsePathnameCache);return!l||s.params&&!ps(l,s.params,{partial:!0})?!1:l&&(n?.includeSearch??!0)?ps(c.search,o.search,{partial:!0})?l:!1:l},this.hasNotFoundMatch=()=>this.__store.state.matches.some(s=>s.status==="notFound"||s.globalNotFound),this.update({defaultPreloadDelay:50,defaultPendingMs:1e3,defaultPendingMinMs:500,context:void 0,...e,caseSensitive:e.caseSensitive??!1,notFoundMode:e.notFoundMode??"fuzzy",stringifySearch:e.stringifySearch??Gf,parseSearch:e.parseSearch??Wf}),typeof document<"u"&&(self.__TSR_ROUTER__=this)}isShell(){return!!this.options.isShell}isPrerendering(){return!!this.options.isPrerendering}get state(){return this.__store.state}get looseRoutesById(){return this.routesById}matchRoutesInternal(e,s){const{foundRoute:n,matchedRoutes:r,routeParams:o}=this.getMatchedRoutes(e.pathname,s?.dest?.to);let a=!1;(n?n.path!=="/"&&o["**"]:Zt(e.pathname))&&(this.options.notFoundRoute?r.push(this.options.notFoundRoute):a=!0);const c=(()=>{if(a){if(this.options.notFoundMode!=="root")for(let h=r.length-1;h>=0;h--){const u=r[h];if(u.children)return u.id}return it}})(),l=[],d=h=>h?.id?h.context??this.options.context??void 0:this.options.context??void 0;return r.forEach((h,u)=>{const f=l[u-1],[m,p,x]=(()=>{const P=f?.search??e.search,B=f?._strictSearch??void 0;try{const k=oi(h.options.validateSearch,{...P})??void 0;return[{...P,...k},{...B,...k},void 0]}catch(k){let D=k;if(k instanceof Tr||(D=new Tr(k.message,{cause:k})),s?.throwOnError)throw D;return[P,{},D]}})(),b=h.options.loaderDeps?.({search:m})??"",S=b?JSON.stringify(b):"",{interpolatedPath:y,usedParams:w}=Bn({path:h.fullPath,params:o,decodeCharMap:this.pathParamsDecodeCharMap}),v=Bn({path:h.id,params:o,leaveWildcards:!0,decodeCharMap:this.pathParamsDecodeCharMap,parseCache:this.parsePathnameCache}).interpolatedPath+S,C=this.getMatch(v),T=this.state.matches.find(P=>P.routeId===h.id),_=C?._strictParams??w;let N;if(!C){const P=h.options.params?.parse??h.options.parseParams;if(P)try{Object.assign(_,P(_))}catch(B){if(N=new om(B.message,{cause:B}),s?.throwOnError)throw N}}Object.assign(o,_);const j=T?"stay":"enter";let F;if(C)F={...C,cause:j,params:T?nt(T.params,o):o,_strictParams:_,search:nt(T?T.search:C.search,m),_strictSearch:p};else{const P=h.options.loader||h.options.beforeLoad||h.lazyFn||Dl(h)?"pending":"success";F={id:v,index:u,routeId:h.id,params:T?nt(T.params,o):o,_strictParams:_,pathname:y,updatedAt:Date.now(),search:T?nt(T.search,m):m,_strictSearch:p,searchError:void 0,status:P,isFetching:!1,error:void 0,paramsError:N,__routeContext:void 0,_nonReactive:{loadPromise:Ws()},__beforeLoadContext:void 0,context:{},abortController:new AbortController,fetchCount:0,cause:j,loaderDeps:T?nt(T.loaderDeps,b):b,invalid:!1,preload:!1,links:void 0,scripts:void 0,headScripts:void 0,meta:void 0,staticData:h.options.staticData||{},fullPath:h.fullPath}}s?.preload||(F.globalNotFound=c===h.id),F.searchError=x;const E=d(f);F.context={...E,...F.__routeContext,...F.__beforeLoadContext},l.push(F)}),l.forEach((h,u)=>{const f=this.looseRoutesById[h.routeId];if(!this.getMatch(h.id)&&s?._buildLocation!==!0){const p=l[u-1],x=d(p);if(f.options.context){const b={deps:h.loaderDeps,params:h.params,context:x??{},location:e,navigate:S=>this.navigate({...S,_fromLocation:e}),buildLocation:this.buildLocation,cause:h.cause,abortController:h.abortController,preload:!!h.preload,matches:l};h.__routeContext=f.options.context(b)??void 0}h.context={...x,...h.__routeContext,...h.__beforeLoadContext}}}),l}}class Tr extends Error{}class om extends Error{}function im(t){return{loadedAt:0,isLoading:!1,isTransitioning:!1,status:"idle",resolvedLocation:void 0,location:t,matches:[],pendingMatches:[],cachedMatches:[],statusCode:200}}function oi(t,e){if(t==null)return{};if("~standard"in t){const s=t["~standard"].validate(e);if(s instanceof Promise)throw new Tr("Async validation not supported");if(s.issues)throw new Tr(JSON.stringify(s.issues,void 0,2),{cause:s});return s.value}return"parse"in t?t.parse(e):typeof t=="function"?t(e):{}}function am({pathname:t,routePathname:e,caseSensitive:s,routesByPath:n,routesById:r,flatRoutes:o,parseCache:a}){let c={};const l=Zt(t),d=m=>ni(l,{to:m.fullPath,caseSensitive:m.options?.caseSensitive??s,fuzzy:!0},a);let h=e!==void 0?n[e]:void 0;if(h)c=d(h);else{let m;for(const p of o){const x=d(p);if(x)if(p.path!=="/"&&x["**"])m||(m={foundRoute:p,routeParams:x});else{h=p,c=x;break}}!h&&m&&(h=m.foundRoute,c=m.routeParams)}let u=h||r[it];const f=[u];for(;u.parentRoute;)u=u.parentRoute,f.push(u);return f.reverse(),{matchedRoutes:f,routeParams:c,foundRoute:h}}function cm({search:t,dest:e,destRoutes:s,_includeValidateSearch:n}){const r=s.reduce((c,l)=>{const d=[];if("search"in l.options)l.options.search?.middlewares&&d.push(...l.options.search.middlewares);else if(l.options.preSearchFilters||l.options.postSearchFilters){const h=({search:u,next:f})=>{let m=u;"preSearchFilters"in l.options&&l.options.preSearchFilters&&(m=l.options.preSearchFilters.reduce((x,b)=>b(x),u));const p=f(m);return"postSearchFilters"in l.options&&l.options.postSearchFilters?l.options.postSearchFilters.reduce((x,b)=>b(x),p):p};d.push(h)}if(n&&l.options.validateSearch){const h=({search:u,next:f})=>{const m=f(u);try{return{...m,...oi(l.options.validateSearch,m)??void 0}}catch{return m}};d.push(h)}return c.concat(d)},[])??[],o=({search:c})=>e.search?e.search===!0?c:ms(e.search,c):{};r.push(o);const a=(c,l)=>{if(c>=r.length)return l;const d=r[c];return d({search:l,next:u=>a(c+1,u)})};return a(0,t)}const lm="Error preloading route! ";class Ul{constructor(e){if(this.init=s=>{this.originalIndex=s.originalIndex;const n=this.options,r=!n?.path&&!n?.id;this.parentRoute=this.options.getParentRoute?.(),r?this._path=it:this.parentRoute||It(!1);let o=r?it:n?.path;o&&o!=="/"&&(o=Wi(o));const a=n?.id||o;let c=r?it:Ot([this.parentRoute.id===it?"":this.parentRoute.id,a]);o===it&&(o="/"),c!==it&&(c=Ot(["/",c]));const l=c===it?"/":Ot([this.parentRoute.fullPath,o]);this._path=o,this._id=c,this._fullPath=l,this._to=l},this.clone=s=>{this._path=s._path,this._id=s._id,this._fullPath=s._fullPath,this._to=s._to,this.options.getParentRoute=s.options.getParentRoute,this.children=s.children},this.addChildren=s=>this._addFileChildren(s),this._addFileChildren=s=>(Array.isArray(s)&&(this.children=s),typeof s=="object"&&s!==null&&(this.children=Object.values(s)),this),this._addFileTypes=()=>this,this.updateLoader=s=>(Object.assign(this.options,s),this),this.update=s=>(Object.assign(this.options,s),this),this.lazy=s=>(this.lazyFn=s,this),this.options=e||{},this.isRoot=!e?.getParentRoute,e?.id&&e?.path)throw new Error("Route cannot have both an 'id' and a 'path' option.")}get to(){return this._to}get id(){return this._id}get path(){return this._path}get fullPath(){return this._fullPath}}class dm extends Ul{constructor(e){super(e)}}function Gi(t){const e=t.errorComponent??Xr;return i.jsx(um,{getResetKey:t.getResetKey,onCatch:t.onCatch,children:({error:s,reset:n})=>s?g.createElement(e,{error:s,reset:n}):t.children})}class um extends g.Component{constructor(){super(...arguments),this.state={error:null}}static getDerivedStateFromProps(e){return{resetKey:e.getResetKey()}}static getDerivedStateFromError(e){return{error:e}}reset(){this.setState({error:null})}componentDidUpdate(e,s){s.error&&s.resetKey!==this.state.resetKey&&this.reset()}componentDidCatch(e,s){this.props.onCatch&&this.props.onCatch(e,s)}render(){return this.props.children({error:this.state.resetKey!==this.props.getResetKey()?null:this.state.error,reset:()=>{this.reset()}})}}function Xr({error:t}){const[e,s]=g.useState(!1);return i.jsxs("div",{style:{padding:".5rem",maxWidth:"100%"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:".5rem"},children:[i.jsx("strong",{style:{fontSize:"1rem"},children:"Something went wrong!"}),i.jsx("button",{style:{appearance:"none",fontSize:".6em",border:"1px solid currentColor",padding:".1rem .2rem",fontWeight:"bold",borderRadius:".25rem"},onClick:()=>s(n=>!n),children:e?"Hide Error":"Show Error"})]}),i.jsx("div",{style:{height:".25rem"}}),e?i.jsx("div",{children:i.jsx("pre",{style:{fontSize:".7em",border:"1px solid red",borderRadius:".25rem",padding:".3rem",color:"red",overflow:"auto"},children:t.message?i.jsx("code",{children:t.message}):null})}):null]})}function hm({children:t,fallback:e=null}){return fm()?i.jsx(Ke.Fragment,{children:t}):i.jsx(Ke.Fragment,{children:e})}function fm(){return Ke.useSyncExternalStore(mm,()=>!0,()=>!1)}function mm(){return()=>{}}function pm(t,e=s=>s){return _h.useSyncExternalStoreWithSelector(t.subscribe,()=>t.state,()=>t.state,e,gm)}function gm(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[n,r]of t)if(!e.has(n)||!Object.is(r,e.get(n)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();const s=Ba(t);if(s.length!==Ba(e).length)return!1;for(let n=0;n<s.length;n++)if(!Object.prototype.hasOwnProperty.call(e,s[n])||!Object.is(t[s[n]],e[s[n]]))return!1;return!0}function Ba(t){return Object.keys(t).concat(Object.getOwnPropertySymbols(t))}const xo=g.createContext(null);function Bl(){return typeof document>"u"?xo:window.__TSR_ROUTER_CONTEXT__?window.__TSR_ROUTER_CONTEXT__:(window.__TSR_ROUTER_CONTEXT__=xo,xo)}function et(t){const e=g.useContext(Bl());return t?.warn,e}function Ue(t){const e=et({warn:t?.router===void 0}),s=t?.router||e,n=g.useRef(void 0);return pm(s.__store,r=>{if(t?.select){if(t.structuralSharing??s.options.defaultStructuralSharing){const o=nt(n.current,t.select(r));return n.current=o,o}return t.select(r)}return r})}const Qr=g.createContext(void 0),xm=g.createContext(void 0);function Ct(t){const e=g.useContext(t.from?xm:Qr);return Ue({select:n=>{const r=n.matches.find(o=>t.from?t.from===o.routeId:o.id===e);if(It(!((t.shouldThrow??!0)&&!r),`Could not find ${t.from?`an active match from "${t.from}"`:"a nearest match!"}`),r!==void 0)return t.select?t.select(r):r},structuralSharing:t.structuralSharing})}function Ki(t){return Ct({from:t.from,strict:t.strict,structuralSharing:t.structuralSharing,select:e=>t.select?t.select(e.loaderData):e.loaderData})}function qi(t){const{select:e,...s}=t;return Ct({...s,select:n=>e?e(n.loaderDeps):n.loaderDeps})}function Yi(t){return Ct({from:t.from,shouldThrow:t.shouldThrow,structuralSharing:t.structuralSharing,strict:t.strict,select:e=>{const s=t.strict===!1?e.params:e._strictParams;return t.select?t.select(s):s}})}function Xi(t){return Ct({from:t.from,strict:t.strict,shouldThrow:t.shouldThrow,structuralSharing:t.structuralSharing,select:e=>t.select?t.select(e.search):e.search})}function Qi(t){const e=et();return g.useCallback(s=>e.navigate({...s,from:s.from??t?.from}),[t?.from,e])}var Xs=nf();const ym=rf(Xs),Vn=typeof window<"u"?g.useLayoutEffect:g.useEffect;function yo(t){const e=g.useRef({value:t,prev:null}),s=e.current.value;return t!==s&&(e.current={value:t,prev:s}),e.current.prev}function bm(t,e,s={},n={}){g.useEffect(()=>{if(!t.current||n.disabled||typeof IntersectionObserver!="function")return;const r=new IntersectionObserver(([o])=>{e(o)},s);return r.observe(t.current),()=>{r.disconnect()}},[e,s,n.disabled,t])}function vm(t){const e=g.useRef(null);return g.useImperativeHandle(t,()=>e.current,[]),e}function wm(t,e){const s=et(),[n,r]=g.useState(!1),o=g.useRef(!1),a=vm(e),{activeProps:c,inactiveProps:l,activeOptions:d,to:h,preload:u,preloadDelay:f,hashScrollIntoView:m,replace:p,startTransition:x,resetScroll:b,viewTransition:S,children:y,target:w,disabled:v,style:C,className:T,onClick:_,onFocus:N,onMouseEnter:j,onMouseLeave:F,onTouchStart:E,ignoreBlocker:P,params:B,search:k,hash:D,state:U,mask:Y,reloadDocument:O,unsafeRelative:G,from:ce,_fromLocation:X,...ye}=t,ne=Ue({select:de=>de.location.search,structuralSharing:!0}),ue=t.from,pe=g.useMemo(()=>({...t,from:ue}),[s,ne,ue,t._fromLocation,t.hash,t.to,t.search,t.params,t.state,t.mask,t.unsafeRelative]),fe=g.useMemo(()=>s.buildLocation({...pe}),[s,pe]),R=g.useMemo(()=>{if(v)return;let de=fe.maskedLocation?fe.maskedLocation.url:fe.url,be=!1;return s.origin&&(de.startsWith(s.origin)?de=de.replace(s.origin,"")||"/":be=!0),{href:de,external:be}},[v,fe.maskedLocation,fe.url,s.origin]),A=g.useMemo(()=>{if(R?.external)return R.href;try{return new URL(h),h}catch{}},[h,R]),L=t.reloadDocument||A?!1:u??s.options.defaultPreload,M=f??s.options.defaultPreloadDelay??0,V=Ue({select:de=>{if(A)return!1;if(d?.exact){if(!mf(de.location.pathname,fe.pathname,s.basepath))return!1}else{const be=Cr(de.location.pathname,s.basepath),Me=Cr(fe.pathname,s.basepath);if(!(be.startsWith(Me)&&(be.length===Me.length||be[Me.length]==="/")))return!1}return(d?.includeSearch??!0)&&!ps(de.location.search,fe.search,{partial:!d?.exact,ignoreUndefined:!d?.explicitUndefined})?!1:d?.includeHash?de.location.hash===fe.hash:!0}}),se=g.useCallback(()=>{s.preloadRoute({...pe}).catch(de=>{console.warn(de),console.warn(lm)})},[s,pe]),ee=g.useCallback(de=>{de?.isIntersecting&&se()},[se]);bm(a,ee,Em,{disabled:!!v||L!=="viewport"}),g.useEffect(()=>{o.current||!v&&L==="render"&&(se(),o.current=!0)},[v,se,L]);const J=de=>{const be=de.currentTarget.target,Me=w!==void 0?w:be;if(!v&&!Rm(de)&&!de.defaultPrevented&&(!Me||Me==="_self")&&de.button===0){de.preventDefault(),Xs.flushSync(()=>{r(!0)});const tt=s.subscribe("onResolved",()=>{tt(),r(!1)});s.navigate({...pe,replace:p,resetScroll:b,hashScrollIntoView:m,startTransition:x,viewTransition:S,ignoreBlocker:P})}};if(A)return{...ye,ref:a,href:A,...y&&{children:y},...w&&{target:w},...v&&{disabled:v},...C&&{style:C},...T&&{className:T},..._&&{onClick:_},...N&&{onFocus:N},...j&&{onMouseEnter:j},...F&&{onMouseLeave:F},...E&&{onTouchStart:E}};const he=de=>{v||L&&se()},me=he,_e=de=>{if(!(v||!L))if(!M)se();else{const be=de.target;if(nn.has(be))return;const Me=setTimeout(()=>{nn.delete(be),se()},M);nn.set(be,Me)}},Le=de=>{if(v||!L||!M)return;const be=de.target,Me=nn.get(be);Me&&(clearTimeout(Me),nn.delete(be))},Ee=V?ms(c,{})??Sm:bo,mt=V?bo:ms(l,{})??bo,De=[T,Ee.className,mt.className].filter(Boolean).join(" "),Be=(C||Ee.style||mt.style)&&{...C,...Ee.style,...mt.style};return{...ye,...Ee,...mt,href:R?.href,ref:a,onClick:rn([_,J]),onFocus:rn([N,he]),onMouseEnter:rn([j,_e]),onMouseLeave:rn([F,Le]),onTouchStart:rn([E,me]),disabled:!!v,target:w,...Be&&{style:Be},...De&&{className:De},...v&&_m,...V&&Nm,...n&&Cm}}const bo={},Sm={className:"active"},_m={role:"link","aria-disabled":!0},Nm={"data-status":"active","aria-current":"page"},Cm={"data-transitioning":"transitioning"},nn=new WeakMap,Em={rootMargin:"100px"},rn=t=>e=>{for(const s of t)if(s){if(e.defaultPrevented)return;s(e)}},jr=g.forwardRef((t,e)=>{const{_asChild:s,...n}=t,{type:r,ref:o,...a}=wm(n,e),c=typeof n.children=="function"?n.children({isActive:a["data-status"]==="active"}):n.children;return s===void 0&&delete a.disabled,g.createElement(s||"a",{...a,ref:o},c)});function Rm(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}class Tm extends Ul{constructor(e){super(e),this.useMatch=s=>Ct({select:s?.select,from:this.id,structuralSharing:s?.structuralSharing}),this.useRouteContext=s=>Ct({...s,from:this.id,select:n=>s?.select?s.select(n.context):n.context}),this.useSearch=s=>Xi({select:s?.select,structuralSharing:s?.structuralSharing,from:this.id}),this.useParams=s=>Yi({select:s?.select,structuralSharing:s?.structuralSharing,from:this.id}),this.useLoaderDeps=s=>qi({...s,from:this.id}),this.useLoaderData=s=>Ki({...s,from:this.id}),this.useNavigate=()=>Qi({from:this.fullPath}),this.Link=Ke.forwardRef((s,n)=>i.jsx(jr,{ref:n,from:this.fullPath,...s})),this.$$typeof=Symbol.for("react.memo")}}function ns(t){return new Tm(t)}class jm extends dm{constructor(e){super(e),this.useMatch=s=>Ct({select:s?.select,from:this.id,structuralSharing:s?.structuralSharing}),this.useRouteContext=s=>Ct({...s,from:this.id,select:n=>s?.select?s.select(n.context):n.context}),this.useSearch=s=>Xi({select:s?.select,structuralSharing:s?.structuralSharing,from:this.id}),this.useParams=s=>Yi({select:s?.select,structuralSharing:s?.structuralSharing,from:this.id}),this.useLoaderDeps=s=>qi({...s,from:this.id}),this.useLoaderData=s=>Ki({...s,from:this.id}),this.useNavigate=()=>Qi({from:this.fullPath}),this.Link=Ke.forwardRef((s,n)=>i.jsx(jr,{ref:n,from:this.fullPath,...s})),this.$$typeof=Symbol.for("react.memo")}}function Pm(t){return new jm(t)}function Ha(t){return typeof t=="object"?new $a(t,{silent:!0}).createRoute(t):new $a(t,{silent:!0}).createRoute}class $a{constructor(e,s){this.path=e,this.createRoute=n=>{this.silent;const r=ns(n);return r.isRoot=!1,r},this.silent=s?.silent}}class Va{constructor(e){this.useMatch=s=>Ct({select:s?.select,from:this.options.id,structuralSharing:s?.structuralSharing}),this.useRouteContext=s=>Ct({from:this.options.id,select:n=>s?.select?s.select(n.context):n.context}),this.useSearch=s=>Xi({select:s?.select,structuralSharing:s?.structuralSharing,from:this.options.id}),this.useParams=s=>Yi({select:s?.select,structuralSharing:s?.structuralSharing,from:this.options.id}),this.useLoaderDeps=s=>qi({...s,from:this.options.id}),this.useLoaderData=s=>Ki({...s,from:this.options.id}),this.useNavigate=()=>{const s=et();return Qi({from:s.routesById[this.options.id].fullPath})},this.options=e,this.$$typeof=Symbol.for("react.memo")}}function Wa(t){return typeof t=="object"?new Va(t):e=>new Va({id:t,...e})}function km(){const t=et(),e=g.useRef({router:t,mounted:!1}),[s,n]=g.useState(!1),{hasPendingMatches:r,isLoading:o}=Ue({select:u=>({isLoading:u.isLoading,hasPendingMatches:u.matches.some(f=>f.status==="pending")}),structuralSharing:!0}),a=yo(o),c=o||s||r,l=yo(c),d=o||r,h=yo(d);return t.startTransition=u=>{n(!0),g.startTransition(()=>{u(),n(!1)})},g.useEffect(()=>{const u=t.history.subscribe(t.load),f=t.buildLocation({to:t.latestLocation.pathname,search:!0,params:!0,hash:!0,state:!0,_includeValidateSearch:!0});return Zt(t.latestLocation.href)!==Zt(f.href)&&t.commitLocation({...f,replace:!0}),()=>{u()}},[t,t.history]),Vn(()=>{if(typeof window<"u"&&t.ssr||e.current.router===t&&e.current.mounted)return;e.current={router:t,mounted:!0},(async()=>{try{await t.load()}catch(f){console.error(f)}})()},[t]),Vn(()=>{a&&!o&&t.emit({type:"onLoad",...gs(t.state)})},[a,t,o]),Vn(()=>{h&&!d&&t.emit({type:"onBeforeRouteMount",...gs(t.state)})},[d,h,t]),Vn(()=>{l&&!c&&(t.emit({type:"onResolved",...gs(t.state)}),t.__store.setState(u=>({...u,status:"idle",resolvedLocation:u.location})),Hf(t))},[c,l,t]),null}function Mm(t){const e=Ue({select:s=>`not-found-${s.location.pathname}-${s.status}`});return i.jsx(Gi,{getResetKey:()=>e,onCatch:(s,n)=>{if(Nt(s))t.onCatch?.(s,n);else throw s},errorComponent:({error:s})=>{if(Nt(s))return t.fallback?.(s);throw s},children:t.children})}function Am(){return i.jsx("p",{children:"Not Found"})}function Ls(t){return i.jsx(i.Fragment,{children:t.children})}function Hl(t,e,s){return e.options.notFoundComponent?i.jsx(e.options.notFoundComponent,{data:s}):t.options.defaultNotFoundComponent?i.jsx(t.options.defaultNotFoundComponent,{data:s}):i.jsx(Am,{})}function Lm({children:t}){const e=et();return e.isServer?i.jsx("script",{nonce:e.options.ssr?.nonce,className:"$tsr",dangerouslySetInnerHTML:{__html:[t].filter(Boolean).join(`
`)+";$_TSR.c()"}}):null}function Om(){const t=et();if(!t.isScrollRestoring||!t.isServer||typeof t.options.scrollRestoration=="function"&&!t.options.scrollRestoration({location:t.latestLocation}))return null;const s=(t.options.getScrollRestorationKey||ri)(t.latestLocation),n=s!==ri(t.latestLocation)?s:void 0,r={storageKey:Er,shouldScrollRestoration:!0};return n&&(r.key=n),i.jsx(Lm,{children:`(${Pl.toString()})(${JSON.stringify(r)})`})}const $l=g.memo(function({matchId:e}){const s=et(),n=Ue({select:S=>{const y=S.matches.find(w=>w.id===e);return It(y),{routeId:y.routeId,ssr:y.ssr,_displayPending:y._displayPending}},structuralSharing:!0}),r=s.routesById[n.routeId],o=r.options.pendingComponent??s.options.defaultPendingComponent,a=o?i.jsx(o,{}):null,c=r.options.errorComponent??s.options.defaultErrorComponent,l=r.options.onCatch??s.options.defaultOnCatch,d=r.isRoot?r.options.notFoundComponent??s.options.notFoundRoute?.options.component:r.options.notFoundComponent,h=n.ssr===!1||n.ssr==="data-only",u=(!r.isRoot||r.options.wrapInSuspense||h)&&(r.options.wrapInSuspense??o??(r.options.errorComponent?.preload||h))?g.Suspense:Ls,f=c?Gi:Ls,m=d?Mm:Ls,p=Ue({select:S=>S.loadedAt}),x=Ue({select:S=>{const y=S.matches.findIndex(w=>w.id===e);return S.matches[y-1]?.routeId}}),b=r.isRoot?r.options.shellComponent??Ls:Ls;return i.jsxs(b,{children:[i.jsx(Qr.Provider,{value:e,children:i.jsx(u,{fallback:a,children:i.jsx(f,{getResetKey:()=>p,errorComponent:c||Xr,onCatch:(S,y)=>{if(Nt(S))throw S;l?.(S,y)},children:i.jsx(m,{fallback:S=>{if(!d||S.routeId&&S.routeId!==n.routeId||!S.routeId&&!r.isRoot)throw S;return g.createElement(d,S)},children:h||n._displayPending?i.jsx(hm,{fallback:a,children:i.jsx(Ga,{matchId:e})}):i.jsx(Ga,{matchId:e})})})})}),x===it&&s.options.scrollRestoration?i.jsxs(i.Fragment,{children:[i.jsx(Dm,{}),i.jsx(Om,{})]}):null]})});function Dm(){const t=et(),e=g.useRef(void 0);return i.jsx("script",{suppressHydrationWarning:!0,ref:s=>{s&&(e.current===void 0||e.current.href!==t.latestLocation.href)&&(t.emit({type:"onRendered",...gs(t.state)}),e.current=t.latestLocation)}},t.latestLocation.state.__TSR_key)}const Ga=g.memo(function({matchId:e}){const s=et(),{match:n,key:r,routeId:o}=Ue({select:l=>{const d=l.matches.find(p=>p.id===e),h=d.routeId,f=(s.routesById[h].options.remountDeps??s.options.defaultRemountDeps)?.({routeId:h,loaderDeps:d.loaderDeps,params:d._strictParams,search:d._strictSearch});return{key:f?JSON.stringify(f):void 0,routeId:h,match:{id:d.id,status:d.status,error:d.error,_forcePending:d._forcePending,_displayPending:d._displayPending}}},structuralSharing:!0}),a=s.routesById[o],c=g.useMemo(()=>{const l=a.options.component??s.options.defaultComponent;return l?i.jsx(l,{},r):i.jsx(Vl,{})},[r,a.options.component,s.options.defaultComponent]);if(n._displayPending)throw s.getMatch(n.id)?._nonReactive.displayPendingPromise;if(n._forcePending)throw s.getMatch(n.id)?._nonReactive.minPendingPromise;if(n.status==="pending"){const l=a.options.pendingMinMs??s.options.defaultPendingMinMs;if(l){const d=s.getMatch(n.id);if(d&&!d._nonReactive.minPendingPromise&&!s.isServer){const h=Ws();d._nonReactive.minPendingPromise=h,setTimeout(()=>{h.resolve(),d._nonReactive.minPendingPromise=void 0},l)}}throw s.getMatch(n.id)?._nonReactive.loadPromise}if(n.status==="notFound")return It(Nt(n.error)),Hl(s,a,n.error);if(n.status==="redirected")throw It(bt(n.error)),s.getMatch(n.id)?._nonReactive.loadPromise;if(n.status==="error"){if(s.isServer){const l=(a.options.errorComponent??s.options.defaultErrorComponent)||Xr;return i.jsx(l,{error:n.error,reset:void 0,info:{componentStack:""}})}throw n.error}return c}),Vl=g.memo(function(){const e=et(),s=g.useContext(Qr),n=Ue({select:d=>d.matches.find(h=>h.id===s)?.routeId}),r=e.routesById[n],o=Ue({select:d=>{const u=d.matches.find(f=>f.id===s);return It(u),u.globalNotFound}}),a=Ue({select:d=>{const h=d.matches,u=h.findIndex(f=>f.id===s);return h[u+1]?.id}}),c=e.options.defaultPendingComponent?i.jsx(e.options.defaultPendingComponent,{}):null;if(o)return Hl(e,r,void 0);if(!a)return null;const l=i.jsx($l,{matchId:a});return s===it?i.jsx(g.Suspense,{fallback:c,children:l}):l});function Im(){const t=et(),e=t.options.defaultPendingComponent?i.jsx(t.options.defaultPendingComponent,{}):null,s=t.isServer||typeof document<"u"&&t.ssr?Ls:g.Suspense,n=i.jsxs(s,{fallback:e,children:[!t.isServer&&i.jsx(km,{}),i.jsx(Fm,{})]});return t.options.InnerWrap?i.jsx(t.options.InnerWrap,{children:n}):n}function Fm(){const t=et(),e=Ue({select:r=>r.matches[0]?.id}),s=Ue({select:r=>r.loadedAt}),n=e?i.jsx($l,{matchId:e}):null;return i.jsx(Qr.Provider,{value:e,children:t.options.disableGlobalCatchBoundary?n:i.jsx(Gi,{getResetKey:()=>s,errorComponent:Xr,onCatch:r=>{r.message||r.toString()},children:n})})}const zm=t=>new Um(t);class Um extends rm{constructor(e){super(e)}}typeof globalThis<"u"?(globalThis.createFileRoute=Ha,globalThis.createLazyFileRoute=Wa):typeof window<"u"&&(window.createFileRoute=Ha,window.createLazyFileRoute=Wa);function Bm({router:t,children:e,...s}){Object.keys(s).length>0&&t.update({...t.options,...s,context:{...t.options.context,...s.context}});const n=Bl(),r=i.jsx(n.Provider,{value:t,children:e});return t.options.Wrap?i.jsx(t.options.Wrap,{children:r}):r}function Hm({router:t,...e}){return i.jsx(Bm,{router:t,...e,children:i.jsx(Im,{})})}function $m(t){return Ue({select:e=>e.location})}var Zr=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Vm={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Wm=class{#e=Vm;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},ii=new Wm;function Gm(t){setTimeout(t,0)}var Jr=typeof window>"u"||"Deno"in globalThis;function dt(){}function Km(t,e){return typeof t=="function"?t(e):t}function qm(t){return typeof t=="number"&&t>=0&&t!==1/0}function Ym(t,e){return Math.max(t+(e||0)-Date.now(),0)}function ai(t,e){return typeof t=="function"?t(e):t}function Xm(t,e){return typeof t=="function"?t(e):t}function Ka(t,e){const{type:s="all",exact:n,fetchStatus:r,predicate:o,queryKey:a,stale:c}=t;if(a){if(n){if(e.queryHash!==Zi(a,e.options))return!1}else if(!Pn(e.queryKey,a))return!1}if(s!=="all"){const l=e.isActive();if(s==="active"&&!l||s==="inactive"&&l)return!1}return!(typeof c=="boolean"&&e.isStale()!==c||r&&r!==e.state.fetchStatus||o&&!o(e))}function qa(t,e){const{exact:s,status:n,predicate:r,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(s){if(jn(e.options.mutationKey)!==jn(o))return!1}else if(!Pn(e.options.mutationKey,o))return!1}return!(n&&e.state.status!==n||r&&!r(e))}function Zi(t,e){return(e?.queryKeyHashFn||jn)(t)}function jn(t){return JSON.stringify(t,(e,s)=>ci(s)?Object.keys(s).sort().reduce((n,r)=>(n[r]=s[r],n),{}):s)}function Pn(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(s=>Pn(t[s],e[s])):!1}var Qm=Object.prototype.hasOwnProperty;function Wl(t,e){if(t===e)return t;const s=Ya(t)&&Ya(e);if(!s&&!(ci(t)&&ci(e)))return e;const r=(s?t:Object.keys(t)).length,o=s?e:Object.keys(e),a=o.length,c=s?new Array(a):{};let l=0;for(let d=0;d<a;d++){const h=s?d:o[d],u=t[h],f=e[h];if(u===f){c[h]=u,(s?d<r:Qm.call(t,h))&&l++;continue}if(u===null||f===null||typeof u!="object"||typeof f!="object"){c[h]=f;continue}const m=Wl(u,f);c[h]=m,m===u&&l++}return r===a&&l===r?t:c}function Ya(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function ci(t){if(!Xa(t))return!1;const e=t.constructor;if(e===void 0)return!0;const s=e.prototype;return!(!Xa(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Xa(t){return Object.prototype.toString.call(t)==="[object Object]"}function Zm(t){return new Promise(e=>{ii.setTimeout(e,t)})}function Jm(t,e,s){return typeof s.structuralSharing=="function"?s.structuralSharing(t,e):s.structuralSharing!==!1?Wl(t,e):e}function ep(t,e,s=0){const n=[...t,e];return s&&n.length>s?n.slice(1):n}function tp(t,e,s=0){const n=[e,...t];return s&&n.length>s?n.slice(0,-1):n}var Ji=Symbol();function Gl(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===Ji?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var sp=class extends Zr{#e;#t;#s;constructor(){super(),this.#s=t=>{if(!Jr&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#s=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Kl=new sp;function np(){let t,e;const s=new Promise((r,o)=>{t=r,e=o});s.status="pending",s.catch(()=>{});function n(r){Object.assign(s,r),delete s.resolve,delete s.reject}return s.resolve=r=>{n({status:"fulfilled",value:r}),t(r)},s.reject=r=>{n({status:"rejected",reason:r}),e(r)},s}var rp=Gm;function op(){let t=[],e=0,s=c=>{c()},n=c=>{c()},r=rp;const o=c=>{e?t.push(c):r(()=>{s(c)})},a=()=>{const c=t;t=[],c.length&&r(()=>{n(()=>{c.forEach(l=>{s(l)})})})};return{batch:c=>{let l;e++;try{l=c()}finally{e--,e||a()}return l},batchCalls:c=>(...l)=>{o(()=>{c(...l)})},schedule:o,setNotifyFunction:c=>{s=c},setBatchNotifyFunction:c=>{n=c},setScheduler:c=>{r=c}}}var Ie=op(),ip=class extends Zr{#e=!0;#t;#s;constructor(){super(),this.#s=t=>{if(!Jr&&window.addEventListener){const e=()=>t(!0),s=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#s=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(s=>{s(t)}))}isOnline(){return this.#e}},Pr=new ip;function ap(t){return Math.min(1e3*2**t,3e4)}function ql(t){return(t??"online")==="online"?Pr.isOnline():!0}var li=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function Yl(t){let e=!1,s=0,n;const r=np(),o=()=>r.status!=="pending",a=x=>{if(!o()){const b=new li(x);f(b),t.onCancel?.(b)}},c=()=>{e=!0},l=()=>{e=!1},d=()=>Kl.isFocused()&&(t.networkMode==="always"||Pr.isOnline())&&t.canRun(),h=()=>ql(t.networkMode)&&t.canRun(),u=x=>{o()||(n?.(),r.resolve(x))},f=x=>{o()||(n?.(),r.reject(x))},m=()=>new Promise(x=>{n=b=>{(o()||d())&&x(b)},t.onPause?.()}).then(()=>{n=void 0,o()||t.onContinue?.()}),p=()=>{if(o())return;let x;const b=s===0?t.initialPromise:void 0;try{x=b??t.fn()}catch(S){x=Promise.reject(S)}Promise.resolve(x).then(u).catch(S=>{if(o())return;const y=t.retry??(Jr?0:3),w=t.retryDelay??ap,v=typeof w=="function"?w(s,S):w,C=y===!0||typeof y=="number"&&s<y||typeof y=="function"&&y(s,S);if(e||!C){f(S);return}s++,t.onFail?.(s,S),Zm(v).then(()=>d()?void 0:m()).then(()=>{e?f(S):p()})})};return{promise:r,status:()=>r.status,cancel:a,continue:()=>(n?.(),r),cancelRetry:c,continueRetry:l,canStart:h,start:()=>(h()?p():m().then(p),r)}}var Xl=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),qm(this.gcTime)&&(this.#e=ii.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Jr?1/0:300*1e3))}clearGcTimeout(){this.#e&&(ii.clearTimeout(this.#e),this.#e=void 0)}},cp=class extends Xl{#e;#t;#s;#r;#n;#i;#a;constructor(t){super(),this.#a=!1,this.#i=t.defaultOptions,this.setOptions(t.options),this.observers=[],this.#r=t.client,this.#s=this.#r.getQueryCache(),this.queryKey=t.queryKey,this.queryHash=t.queryHash,this.#e=Qa(this.options),this.state=t.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(t){if(this.options={...this.#i,...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=Qa(this.options);e.data!==void 0&&(this.setData(e.data,{updatedAt:e.dataUpdatedAt,manual:!0}),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#s.remove(this)}setData(t,e){const s=Jm(this.state.data,t,this.options);return this.#o({data:s,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),s}setState(t,e){this.#o({type:"setState",state:t,setStateOptions:e})}cancel(t){const e=this.#n?.promise;return this.#n?.cancel(t),e?e.then(dt).catch(dt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(t=>Xm(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Ji||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>ai(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!Ym(this.state.dataUpdatedAt,t)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(this.#n&&(this.#a?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#s.notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#o({type:"invalidate"})}async fetch(t,e){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(t&&this.setOptions(t),!this.options.queryFn){const c=this.observers.find(l=>l.options.queryFn);c&&this.setOptions(c.options)}const s=new AbortController,n=c=>{Object.defineProperty(c,"signal",{enumerable:!0,get:()=>(this.#a=!0,s.signal)})},r=()=>{const c=Gl(this.options,e),d=(()=>{const h={client:this.#r,queryKey:this.queryKey,meta:this.meta};return n(h),h})();return this.#a=!1,this.options.persister?this.options.persister(c,d,this):c(d)},a=(()=>{const c={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:r};return n(c),c})();this.options.behavior?.onFetch(a,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==a.fetchOptions?.meta)&&this.#o({type:"fetch",meta:a.fetchOptions?.meta}),this.#n=Yl({initialPromise:e?.initialPromise,fn:a.fetchFn,onCancel:c=>{c instanceof li&&c.revert&&this.setState({...this.#t,fetchStatus:"idle"}),s.abort()},onFail:(c,l)=>{this.#o({type:"failed",failureCount:c,error:l})},onPause:()=>{this.#o({type:"pause"})},onContinue:()=>{this.#o({type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0});try{const c=await this.#n.start();if(c===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(c),this.#s.config.onSuccess?.(c,this),this.#s.config.onSettled?.(c,this.state.error,this),c}catch(c){if(c instanceof li){if(c.silent)return this.#n.promise;if(c.revert){if(this.state.data===void 0)throw c;return this.state.data}}throw this.#o({type:"error",error:c}),this.#s.config.onError?.(c,this),this.#s.config.onSettled?.(this.state.data,c,this),c}finally{this.scheduleGc()}}#o(t){const e=s=>{switch(t.type){case"failed":return{...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...lp(s.data,this.options),fetchMeta:t.meta??null};case"success":const n={...s,data:t.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=t.manual?n:void 0,n;case"error":const r=t.error;return{...s,error:r,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...t.state}}};this.state=e(this.state),Ie.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),this.#s.notify({query:this,type:"updated",action:t})})}};function lp(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:ql(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Qa(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,s=e!==void 0,n=s?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:s?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}function Za(t){return{onFetch:(e,s)=>{const n=e.options,r=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],a=e.state.data?.pageParams||[];let c={pages:[],pageParams:[]},l=0;const d=async()=>{let h=!1;const u=p=>{Object.defineProperty(p,"signal",{enumerable:!0,get:()=>(e.signal.aborted?h=!0:e.signal.addEventListener("abort",()=>{h=!0}),e.signal)})},f=Gl(e.options,e.fetchOptions),m=async(p,x,b)=>{if(h)return Promise.reject();if(x==null&&p.pages.length)return Promise.resolve(p);const y=(()=>{const T={client:e.client,queryKey:e.queryKey,pageParam:x,direction:b?"backward":"forward",meta:e.options.meta};return u(T),T})(),w=await f(y),{maxPages:v}=e.options,C=b?tp:ep;return{pages:C(p.pages,w,v),pageParams:C(p.pageParams,x,v)}};if(r&&o.length){const p=r==="backward",x=p?dp:Ja,b={pages:o,pageParams:a},S=x(n,b);c=await m(b,S,p)}else{const p=t??o.length;do{const x=l===0?a[0]??n.initialPageParam:Ja(n,c);if(l>0&&x==null)break;c=await m(c,x),l++}while(l<p)}return c};e.options.persister?e.fetchFn=()=>e.options.persister?.(d,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},s):e.fetchFn=d}}}function Ja(t,{pages:e,pageParams:s}){const n=e.length-1;return e.length>0?t.getNextPageParam(e[n],e,s[n],s):void 0}function dp(t,{pages:e,pageParams:s}){return e.length>0?t.getPreviousPageParam?.(e[0],e,s[0],s):void 0}var up=class extends Xl{#e;#t;#s;#r;constructor(t){super(),this.#e=t.client,this.mutationId=t.mutationId,this.#s=t.mutationCache,this.#t=[],this.state=t.state||hp(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#t.includes(t)||(this.#t.push(t),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#t=this.#t.filter(e=>e!==t),this.scheduleGc(),this.#s.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#s.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(t){const e=()=>{this.#n({type:"continue"})},s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=Yl({fn:()=>this.options.mutationFn?this.options.mutationFn(t,s):Promise.reject(new Error("No mutationFn found")),onFail:(o,a)=>{this.#n({type:"failed",failureCount:o,error:a})},onPause:()=>{this.#n({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#s.canRun(this)});const n=this.state.status==="pending",r=!this.#r.canStart();try{if(n)e();else{this.#n({type:"pending",variables:t,isPaused:r}),await this.#s.config.onMutate?.(t,this,s);const a=await this.options.onMutate?.(t,s);a!==this.state.context&&this.#n({type:"pending",context:a,variables:t,isPaused:r})}const o=await this.#r.start();return await this.#s.config.onSuccess?.(o,t,this.state.context,this,s),await this.options.onSuccess?.(o,t,this.state.context,s),await this.#s.config.onSettled?.(o,null,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(o,null,t,this.state.context,s),this.#n({type:"success",data:o}),o}catch(o){try{throw await this.#s.config.onError?.(o,t,this.state.context,this,s),await this.options.onError?.(o,t,this.state.context,s),await this.#s.config.onSettled?.(void 0,o,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(void 0,o,t,this.state.context,s),o}finally{this.#n({type:"error",error:o})}}finally{this.#s.runNext(this)}}#n(t){const e=s=>{switch(t.type){case"failed":return{...s,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...s,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:t.error,failureCount:s.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=e(this.state),Ie.batch(()=>{this.#t.forEach(s=>{s.onMutationUpdate(t)}),this.#s.notify({mutation:this,type:"updated",action:t})})}};function hp(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var fp=class extends Zr{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#s=0}#e;#t;#s;build(t,e,s){const n=new up({client:t,mutationCache:this,mutationId:++this.#s,options:t.defaultMutationOptions(e),state:s});return this.add(n),n}add(t){this.#e.add(t);const e=Wn(t);if(typeof e=="string"){const s=this.#t.get(e);s?s.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Wn(t);if(typeof e=="string"){const s=this.#t.get(e);if(s)if(s.length>1){const n=s.indexOf(t);n!==-1&&s.splice(n,1)}else s[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Wn(t);if(typeof e=="string"){const n=this.#t.get(e)?.find(r=>r.state.status==="pending");return!n||n===t}else return!0}runNext(t){const e=Wn(t);return typeof e=="string"?this.#t.get(e)?.find(n=>n!==t&&n.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Ie.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(s=>qa(e,s))}findAll(t={}){return this.getAll().filter(e=>qa(t,e))}notify(t){Ie.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return Ie.batch(()=>Promise.all(t.map(e=>e.continue().catch(dt))))}};function Wn(t){return t.options.scope?.id}var mp=class extends Zr{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,s){const n=e.queryKey,r=e.queryHash??Zi(n,e);let o=this.get(r);return o||(o=new cp({client:t,queryKey:n,queryHash:r,options:t.defaultQueryOptions(e),state:s,defaultOptions:t.getQueryDefaults(n)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Ie.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(s=>Ka(e,s))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(s=>Ka(t,s)):e}notify(t){Ie.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){Ie.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Ie.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},pp=class{#e;#t;#s;#r;#n;#i;#a;#o;constructor(t={}){this.#e=t.queryCache||new mp,this.#t=t.mutationCache||new fp,this.#s=t.defaultOptions||{},this.#r=new Map,this.#n=new Map,this.#i=0}mount(){this.#i++,this.#i===1&&(this.#a=Kl.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#o=Pr.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#i--,this.#i===0&&(this.#a?.(),this.#a=void 0,this.#o?.(),this.#o=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),s=this.#e.build(this,e),n=s.state.data;return n===void 0?this.fetchQuery(t):(t.revalidateIfStale&&s.isStaleByTime(ai(e.staleTime,s))&&this.prefetchQuery(e),Promise.resolve(n))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:s})=>{const n=s.data;return[e,n]})}setQueryData(t,e,s){const n=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(n.queryHash)?.state.data,a=Km(e,o);if(a!==void 0)return this.#e.build(this,n).setData(a,{...s,manual:!0})}setQueriesData(t,e,s){return Ie.batch(()=>this.#e.findAll(t).map(({queryKey:n})=>[n,this.setQueryData(n,e,s)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;Ie.batch(()=>{e.findAll(t).forEach(s=>{e.remove(s)})})}resetQueries(t,e){const s=this.#e;return Ie.batch(()=>(s.findAll(t).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const s={revert:!0,...e},n=Ie.batch(()=>this.#e.findAll(t).map(r=>r.cancel(s)));return Promise.all(n).then(dt).catch(dt)}invalidateQueries(t,e={}){return Ie.batch(()=>(this.#e.findAll(t).forEach(s=>{s.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const s={...e,cancelRefetch:e.cancelRefetch??!0},n=Ie.batch(()=>this.#e.findAll(t).filter(r=>!r.isDisabled()&&!r.isStatic()).map(r=>{let o=r.fetch(void 0,s);return s.throwOnError||(o=o.catch(dt)),r.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(n).then(dt)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const s=this.#e.build(this,e);return s.isStaleByTime(ai(e.staleTime,s))?s.fetch(e):Promise.resolve(s.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(dt).catch(dt)}fetchInfiniteQuery(t){return t.behavior=Za(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(dt).catch(dt)}ensureInfiniteQueryData(t){return t.behavior=Za(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return Pr.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#s}setDefaultOptions(t){this.#s=t}setQueryDefaults(t,e){this.#r.set(jn(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#r.values()],s={};return e.forEach(n=>{Pn(t,n.queryKey)&&Object.assign(s,n.defaultOptions)}),s}setMutationDefaults(t,e){this.#n.set(jn(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#n.values()],s={};return e.forEach(n=>{Pn(t,n.mutationKey)&&Object.assign(s,n.defaultOptions)}),s}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#s.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Zi(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Ji&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#s.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},gp=g.createContext(void 0),xp=({client:t,children:e})=>(g.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),i.jsx(gp.Provider,{value:t,children:e}));function Ql(t){var e,s,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(s=Ql(t[e]))&&(n&&(n+=" "),n+=s)}else for(s in t)t[s]&&(n&&(n+=" "),n+=s);return n}function yp(){for(var t,e,s=0,n="",r=arguments.length;s<r;s++)(t=arguments[s])&&(e=Ql(t))&&(n&&(n+=" "),n+=e);return n}const ea="-",bp=t=>{const e=wp(t),{conflictingClassGroups:s,conflictingClassGroupModifiers:n}=t;return{getClassGroupId:a=>{const c=a.split(ea);return c[0]===""&&c.length!==1&&c.shift(),Zl(c,e)||vp(a)},getConflictingClassGroupIds:(a,c)=>{const l=s[a]||[];return c&&n[a]?[...l,...n[a]]:l}}},Zl=(t,e)=>{if(t.length===0)return e.classGroupId;const s=t[0],n=e.nextPart.get(s),r=n?Zl(t.slice(1),n):void 0;if(r)return r;if(e.validators.length===0)return;const o=t.join(ea);return e.validators.find(({validator:a})=>a(o))?.classGroupId},ec=/^\[(.+)\]$/,vp=t=>{if(ec.test(t)){const e=ec.exec(t)[1],s=e?.substring(0,e.indexOf(":"));if(s)return"arbitrary.."+s}},wp=t=>{const{theme:e,classGroups:s}=t,n={nextPart:new Map,validators:[]};for(const r in s)di(s[r],n,r,e);return n},di=(t,e,s,n)=>{t.forEach(r=>{if(typeof r=="string"){const o=r===""?e:tc(e,r);o.classGroupId=s;return}if(typeof r=="function"){if(Sp(r)){di(r(n),e,s,n);return}e.validators.push({validator:r,classGroupId:s});return}Object.entries(r).forEach(([o,a])=>{di(a,tc(e,o),s,n)})})},tc=(t,e)=>{let s=t;return e.split(ea).forEach(n=>{s.nextPart.has(n)||s.nextPart.set(n,{nextPart:new Map,validators:[]}),s=s.nextPart.get(n)}),s},Sp=t=>t.isThemeGetter,_p=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,s=new Map,n=new Map;const r=(o,a)=>{s.set(o,a),e++,e>t&&(e=0,n=s,s=new Map)};return{get(o){let a=s.get(o);if(a!==void 0)return a;if((a=n.get(o))!==void 0)return r(o,a),a},set(o,a){s.has(o)?s.set(o,a):r(o,a)}}},ui="!",hi=":",Np=hi.length,Cp=t=>{const{prefix:e,experimentalParseClassName:s}=t;let n=r=>{const o=[];let a=0,c=0,l=0,d;for(let p=0;p<r.length;p++){let x=r[p];if(a===0&&c===0){if(x===hi){o.push(r.slice(l,p)),l=p+Np;continue}if(x==="/"){d=p;continue}}x==="["?a++:x==="]"?a--:x==="("?c++:x===")"&&c--}const h=o.length===0?r:r.substring(l),u=Ep(h),f=u!==h,m=d&&d>l?d-l:void 0;return{modifiers:o,hasImportantModifier:f,baseClassName:u,maybePostfixModifierPosition:m}};if(e){const r=e+hi,o=n;n=a=>a.startsWith(r)?o(a.substring(r.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:a,maybePostfixModifierPosition:void 0}}if(s){const r=n;n=o=>s({className:o,parseClassName:r})}return n},Ep=t=>t.endsWith(ui)?t.substring(0,t.length-1):t.startsWith(ui)?t.substring(1):t,Rp=t=>{const e=Object.fromEntries(t.orderSensitiveModifiers.map(n=>[n,!0]));return n=>{if(n.length<=1)return n;const r=[];let o=[];return n.forEach(a=>{a[0]==="["||e[a]?(r.push(...o.sort(),a),o=[]):o.push(a)}),r.push(...o.sort()),r}},Tp=t=>({cache:_p(t.cacheSize),parseClassName:Cp(t),sortModifiers:Rp(t),...bp(t)}),jp=/\s+/,Pp=(t,e)=>{const{parseClassName:s,getClassGroupId:n,getConflictingClassGroupIds:r,sortModifiers:o}=e,a=[],c=t.trim().split(jp);let l="";for(let d=c.length-1;d>=0;d-=1){const h=c[d],{isExternal:u,modifiers:f,hasImportantModifier:m,baseClassName:p,maybePostfixModifierPosition:x}=s(h);if(u){l=h+(l.length>0?" "+l:l);continue}let b=!!x,S=n(b?p.substring(0,x):p);if(!S){if(!b){l=h+(l.length>0?" "+l:l);continue}if(S=n(p),!S){l=h+(l.length>0?" "+l:l);continue}b=!1}const y=o(f).join(":"),w=m?y+ui:y,v=w+S;if(a.includes(v))continue;a.push(v);const C=r(S,b);for(let T=0;T<C.length;++T){const _=C[T];a.push(w+_)}l=h+(l.length>0?" "+l:l)}return l};function kp(){let t=0,e,s,n="";for(;t<arguments.length;)(e=arguments[t++])&&(s=Jl(e))&&(n&&(n+=" "),n+=s);return n}const Jl=t=>{if(typeof t=="string")return t;let e,s="";for(let n=0;n<t.length;n++)t[n]&&(e=Jl(t[n]))&&(s&&(s+=" "),s+=e);return s};function Mp(t,...e){let s,n,r,o=a;function a(l){const d=e.reduce((h,u)=>u(h),t());return s=Tp(d),n=s.cache.get,r=s.cache.set,o=c,c(l)}function c(l){const d=n(l);if(d)return d;const h=Pp(l,s);return r(l,h),h}return function(){return o(kp.apply(null,arguments))}}const je=t=>{const e=s=>s[t]||[];return e.isThemeGetter=!0,e},ed=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,td=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Ap=/^\d+\/\d+$/,Lp=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Op=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Dp=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,Ip=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Fp=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Cs=t=>Ap.test(t),ae=t=>!!t&&!Number.isNaN(Number(t)),Bt=t=>!!t&&Number.isInteger(Number(t)),vo=t=>t.endsWith("%")&&ae(t.slice(0,-1)),jt=t=>Lp.test(t),zp=()=>!0,Up=t=>Op.test(t)&&!Dp.test(t),sd=()=>!1,Bp=t=>Ip.test(t),Hp=t=>Fp.test(t),$p=t=>!Q(t)&&!Z(t),Vp=t=>Qs(t,od,sd),Q=t=>ed.test(t),ls=t=>Qs(t,id,Up),wo=t=>Qs(t,Yp,ae),sc=t=>Qs(t,nd,sd),Wp=t=>Qs(t,rd,Hp),Gn=t=>Qs(t,ad,Bp),Z=t=>td.test(t),on=t=>Zs(t,id),Gp=t=>Zs(t,Xp),nc=t=>Zs(t,nd),Kp=t=>Zs(t,od),qp=t=>Zs(t,rd),Kn=t=>Zs(t,ad,!0),Qs=(t,e,s)=>{const n=ed.exec(t);return n?n[1]?e(n[1]):s(n[2]):!1},Zs=(t,e,s=!1)=>{const n=td.exec(t);return n?n[1]?e(n[1]):s:!1},nd=t=>t==="position"||t==="percentage",rd=t=>t==="image"||t==="url",od=t=>t==="length"||t==="size"||t==="bg-size",id=t=>t==="length",Yp=t=>t==="number",Xp=t=>t==="family-name",ad=t=>t==="shadow",Qp=()=>{const t=je("color"),e=je("font"),s=je("text"),n=je("font-weight"),r=je("tracking"),o=je("leading"),a=je("breakpoint"),c=je("container"),l=je("spacing"),d=je("radius"),h=je("shadow"),u=je("inset-shadow"),f=je("text-shadow"),m=je("drop-shadow"),p=je("blur"),x=je("perspective"),b=je("aspect"),S=je("ease"),y=je("animate"),w=()=>["auto","avoid","all","avoid-page","page","left","right","column"],v=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],C=()=>[...v(),Z,Q],T=()=>["auto","hidden","clip","visible","scroll"],_=()=>["auto","contain","none"],N=()=>[Z,Q,l],j=()=>[Cs,"full","auto",...N()],F=()=>[Bt,"none","subgrid",Z,Q],E=()=>["auto",{span:["full",Bt,Z,Q]},Bt,Z,Q],P=()=>[Bt,"auto",Z,Q],B=()=>["auto","min","max","fr",Z,Q],k=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],D=()=>["start","end","center","stretch","center-safe","end-safe"],U=()=>["auto",...N()],Y=()=>[Cs,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...N()],O=()=>[t,Z,Q],G=()=>[...v(),nc,sc,{position:[Z,Q]}],ce=()=>["no-repeat",{repeat:["","x","y","space","round"]}],X=()=>["auto","cover","contain",Kp,Vp,{size:[Z,Q]}],ye=()=>[vo,on,ls],ne=()=>["","none","full",d,Z,Q],ue=()=>["",ae,on,ls],pe=()=>["solid","dashed","dotted","double"],fe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],R=()=>[ae,vo,nc,sc],A=()=>["","none",p,Z,Q],L=()=>["none",ae,Z,Q],M=()=>["none",ae,Z,Q],V=()=>[ae,Z,Q],se=()=>[Cs,"full",...N()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[jt],breakpoint:[jt],color:[zp],container:[jt],"drop-shadow":[jt],ease:["in","out","in-out"],font:[$p],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[jt],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[jt],shadow:[jt],spacing:["px",ae],text:[jt],"text-shadow":[jt],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Cs,Q,Z,b]}],container:["container"],columns:[{columns:[ae,Q,Z,c]}],"break-after":[{"break-after":w()}],"break-before":[{"break-before":w()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:C()}],overflow:[{overflow:T()}],"overflow-x":[{"overflow-x":T()}],"overflow-y":[{"overflow-y":T()}],overscroll:[{overscroll:_()}],"overscroll-x":[{"overscroll-x":_()}],"overscroll-y":[{"overscroll-y":_()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:j()}],"inset-x":[{"inset-x":j()}],"inset-y":[{"inset-y":j()}],start:[{start:j()}],end:[{end:j()}],top:[{top:j()}],right:[{right:j()}],bottom:[{bottom:j()}],left:[{left:j()}],visibility:["visible","invisible","collapse"],z:[{z:[Bt,"auto",Z,Q]}],basis:[{basis:[Cs,"full","auto",c,...N()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[ae,Cs,"auto","initial","none",Q]}],grow:[{grow:["",ae,Z,Q]}],shrink:[{shrink:["",ae,Z,Q]}],order:[{order:[Bt,"first","last","none",Z,Q]}],"grid-cols":[{"grid-cols":F()}],"col-start-end":[{col:E()}],"col-start":[{"col-start":P()}],"col-end":[{"col-end":P()}],"grid-rows":[{"grid-rows":F()}],"row-start-end":[{row:E()}],"row-start":[{"row-start":P()}],"row-end":[{"row-end":P()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":B()}],"auto-rows":[{"auto-rows":B()}],gap:[{gap:N()}],"gap-x":[{"gap-x":N()}],"gap-y":[{"gap-y":N()}],"justify-content":[{justify:[...k(),"normal"]}],"justify-items":[{"justify-items":[...D(),"normal"]}],"justify-self":[{"justify-self":["auto",...D()]}],"align-content":[{content:["normal",...k()]}],"align-items":[{items:[...D(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...D(),{baseline:["","last"]}]}],"place-content":[{"place-content":k()}],"place-items":[{"place-items":[...D(),"baseline"]}],"place-self":[{"place-self":["auto",...D()]}],p:[{p:N()}],px:[{px:N()}],py:[{py:N()}],ps:[{ps:N()}],pe:[{pe:N()}],pt:[{pt:N()}],pr:[{pr:N()}],pb:[{pb:N()}],pl:[{pl:N()}],m:[{m:U()}],mx:[{mx:U()}],my:[{my:U()}],ms:[{ms:U()}],me:[{me:U()}],mt:[{mt:U()}],mr:[{mr:U()}],mb:[{mb:U()}],ml:[{ml:U()}],"space-x":[{"space-x":N()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":N()}],"space-y-reverse":["space-y-reverse"],size:[{size:Y()}],w:[{w:[c,"screen",...Y()]}],"min-w":[{"min-w":[c,"screen","none",...Y()]}],"max-w":[{"max-w":[c,"screen","none","prose",{screen:[a]},...Y()]}],h:[{h:["screen","lh",...Y()]}],"min-h":[{"min-h":["screen","lh","none",...Y()]}],"max-h":[{"max-h":["screen","lh",...Y()]}],"font-size":[{text:["base",s,on,ls]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,Z,wo]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",vo,Q]}],"font-family":[{font:[Gp,Q,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[r,Z,Q]}],"line-clamp":[{"line-clamp":[ae,"none",Z,wo]}],leading:[{leading:[o,...N()]}],"list-image":[{"list-image":["none",Z,Q]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Z,Q]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:O()}],"text-color":[{text:O()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...pe(),"wavy"]}],"text-decoration-thickness":[{decoration:[ae,"from-font","auto",Z,ls]}],"text-decoration-color":[{decoration:O()}],"underline-offset":[{"underline-offset":[ae,"auto",Z,Q]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:N()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Z,Q]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Z,Q]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:G()}],"bg-repeat":[{bg:ce()}],"bg-size":[{bg:X()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Bt,Z,Q],radial:["",Z,Q],conic:[Bt,Z,Q]},qp,Wp]}],"bg-color":[{bg:O()}],"gradient-from-pos":[{from:ye()}],"gradient-via-pos":[{via:ye()}],"gradient-to-pos":[{to:ye()}],"gradient-from":[{from:O()}],"gradient-via":[{via:O()}],"gradient-to":[{to:O()}],rounded:[{rounded:ne()}],"rounded-s":[{"rounded-s":ne()}],"rounded-e":[{"rounded-e":ne()}],"rounded-t":[{"rounded-t":ne()}],"rounded-r":[{"rounded-r":ne()}],"rounded-b":[{"rounded-b":ne()}],"rounded-l":[{"rounded-l":ne()}],"rounded-ss":[{"rounded-ss":ne()}],"rounded-se":[{"rounded-se":ne()}],"rounded-ee":[{"rounded-ee":ne()}],"rounded-es":[{"rounded-es":ne()}],"rounded-tl":[{"rounded-tl":ne()}],"rounded-tr":[{"rounded-tr":ne()}],"rounded-br":[{"rounded-br":ne()}],"rounded-bl":[{"rounded-bl":ne()}],"border-w":[{border:ue()}],"border-w-x":[{"border-x":ue()}],"border-w-y":[{"border-y":ue()}],"border-w-s":[{"border-s":ue()}],"border-w-e":[{"border-e":ue()}],"border-w-t":[{"border-t":ue()}],"border-w-r":[{"border-r":ue()}],"border-w-b":[{"border-b":ue()}],"border-w-l":[{"border-l":ue()}],"divide-x":[{"divide-x":ue()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ue()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...pe(),"hidden","none"]}],"divide-style":[{divide:[...pe(),"hidden","none"]}],"border-color":[{border:O()}],"border-color-x":[{"border-x":O()}],"border-color-y":[{"border-y":O()}],"border-color-s":[{"border-s":O()}],"border-color-e":[{"border-e":O()}],"border-color-t":[{"border-t":O()}],"border-color-r":[{"border-r":O()}],"border-color-b":[{"border-b":O()}],"border-color-l":[{"border-l":O()}],"divide-color":[{divide:O()}],"outline-style":[{outline:[...pe(),"none","hidden"]}],"outline-offset":[{"outline-offset":[ae,Z,Q]}],"outline-w":[{outline:["",ae,on,ls]}],"outline-color":[{outline:O()}],shadow:[{shadow:["","none",h,Kn,Gn]}],"shadow-color":[{shadow:O()}],"inset-shadow":[{"inset-shadow":["none",u,Kn,Gn]}],"inset-shadow-color":[{"inset-shadow":O()}],"ring-w":[{ring:ue()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:O()}],"ring-offset-w":[{"ring-offset":[ae,ls]}],"ring-offset-color":[{"ring-offset":O()}],"inset-ring-w":[{"inset-ring":ue()}],"inset-ring-color":[{"inset-ring":O()}],"text-shadow":[{"text-shadow":["none",f,Kn,Gn]}],"text-shadow-color":[{"text-shadow":O()}],opacity:[{opacity:[ae,Z,Q]}],"mix-blend":[{"mix-blend":[...fe(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":fe()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[ae]}],"mask-image-linear-from-pos":[{"mask-linear-from":R()}],"mask-image-linear-to-pos":[{"mask-linear-to":R()}],"mask-image-linear-from-color":[{"mask-linear-from":O()}],"mask-image-linear-to-color":[{"mask-linear-to":O()}],"mask-image-t-from-pos":[{"mask-t-from":R()}],"mask-image-t-to-pos":[{"mask-t-to":R()}],"mask-image-t-from-color":[{"mask-t-from":O()}],"mask-image-t-to-color":[{"mask-t-to":O()}],"mask-image-r-from-pos":[{"mask-r-from":R()}],"mask-image-r-to-pos":[{"mask-r-to":R()}],"mask-image-r-from-color":[{"mask-r-from":O()}],"mask-image-r-to-color":[{"mask-r-to":O()}],"mask-image-b-from-pos":[{"mask-b-from":R()}],"mask-image-b-to-pos":[{"mask-b-to":R()}],"mask-image-b-from-color":[{"mask-b-from":O()}],"mask-image-b-to-color":[{"mask-b-to":O()}],"mask-image-l-from-pos":[{"mask-l-from":R()}],"mask-image-l-to-pos":[{"mask-l-to":R()}],"mask-image-l-from-color":[{"mask-l-from":O()}],"mask-image-l-to-color":[{"mask-l-to":O()}],"mask-image-x-from-pos":[{"mask-x-from":R()}],"mask-image-x-to-pos":[{"mask-x-to":R()}],"mask-image-x-from-color":[{"mask-x-from":O()}],"mask-image-x-to-color":[{"mask-x-to":O()}],"mask-image-y-from-pos":[{"mask-y-from":R()}],"mask-image-y-to-pos":[{"mask-y-to":R()}],"mask-image-y-from-color":[{"mask-y-from":O()}],"mask-image-y-to-color":[{"mask-y-to":O()}],"mask-image-radial":[{"mask-radial":[Z,Q]}],"mask-image-radial-from-pos":[{"mask-radial-from":R()}],"mask-image-radial-to-pos":[{"mask-radial-to":R()}],"mask-image-radial-from-color":[{"mask-radial-from":O()}],"mask-image-radial-to-color":[{"mask-radial-to":O()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":v()}],"mask-image-conic-pos":[{"mask-conic":[ae]}],"mask-image-conic-from-pos":[{"mask-conic-from":R()}],"mask-image-conic-to-pos":[{"mask-conic-to":R()}],"mask-image-conic-from-color":[{"mask-conic-from":O()}],"mask-image-conic-to-color":[{"mask-conic-to":O()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:G()}],"mask-repeat":[{mask:ce()}],"mask-size":[{mask:X()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Z,Q]}],filter:[{filter:["","none",Z,Q]}],blur:[{blur:A()}],brightness:[{brightness:[ae,Z,Q]}],contrast:[{contrast:[ae,Z,Q]}],"drop-shadow":[{"drop-shadow":["","none",m,Kn,Gn]}],"drop-shadow-color":[{"drop-shadow":O()}],grayscale:[{grayscale:["",ae,Z,Q]}],"hue-rotate":[{"hue-rotate":[ae,Z,Q]}],invert:[{invert:["",ae,Z,Q]}],saturate:[{saturate:[ae,Z,Q]}],sepia:[{sepia:["",ae,Z,Q]}],"backdrop-filter":[{"backdrop-filter":["","none",Z,Q]}],"backdrop-blur":[{"backdrop-blur":A()}],"backdrop-brightness":[{"backdrop-brightness":[ae,Z,Q]}],"backdrop-contrast":[{"backdrop-contrast":[ae,Z,Q]}],"backdrop-grayscale":[{"backdrop-grayscale":["",ae,Z,Q]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[ae,Z,Q]}],"backdrop-invert":[{"backdrop-invert":["",ae,Z,Q]}],"backdrop-opacity":[{"backdrop-opacity":[ae,Z,Q]}],"backdrop-saturate":[{"backdrop-saturate":[ae,Z,Q]}],"backdrop-sepia":[{"backdrop-sepia":["",ae,Z,Q]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":N()}],"border-spacing-x":[{"border-spacing-x":N()}],"border-spacing-y":[{"border-spacing-y":N()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Z,Q]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[ae,"initial",Z,Q]}],ease:[{ease:["linear","initial",S,Z,Q]}],delay:[{delay:[ae,Z,Q]}],animate:[{animate:["none",y,Z,Q]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[x,Z,Q]}],"perspective-origin":[{"perspective-origin":C()}],rotate:[{rotate:L()}],"rotate-x":[{"rotate-x":L()}],"rotate-y":[{"rotate-y":L()}],"rotate-z":[{"rotate-z":L()}],scale:[{scale:M()}],"scale-x":[{"scale-x":M()}],"scale-y":[{"scale-y":M()}],"scale-z":[{"scale-z":M()}],"scale-3d":["scale-3d"],skew:[{skew:V()}],"skew-x":[{"skew-x":V()}],"skew-y":[{"skew-y":V()}],transform:[{transform:[Z,Q,"","none","gpu","cpu"]}],"transform-origin":[{origin:C()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:se()}],"translate-x":[{"translate-x":se()}],"translate-y":[{"translate-y":se()}],"translate-z":[{"translate-z":se()}],"translate-none":["translate-none"],accent:[{accent:O()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:O()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Z,Q]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":N()}],"scroll-mx":[{"scroll-mx":N()}],"scroll-my":[{"scroll-my":N()}],"scroll-ms":[{"scroll-ms":N()}],"scroll-me":[{"scroll-me":N()}],"scroll-mt":[{"scroll-mt":N()}],"scroll-mr":[{"scroll-mr":N()}],"scroll-mb":[{"scroll-mb":N()}],"scroll-ml":[{"scroll-ml":N()}],"scroll-p":[{"scroll-p":N()}],"scroll-px":[{"scroll-px":N()}],"scroll-py":[{"scroll-py":N()}],"scroll-ps":[{"scroll-ps":N()}],"scroll-pe":[{"scroll-pe":N()}],"scroll-pt":[{"scroll-pt":N()}],"scroll-pr":[{"scroll-pr":N()}],"scroll-pb":[{"scroll-pb":N()}],"scroll-pl":[{"scroll-pl":N()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Z,Q]}],fill:[{fill:["none",...O()]}],"stroke-w":[{stroke:[ae,on,ls,wo]}],stroke:[{stroke:["none",...O()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Zp=Mp(Qp);function Ne(...t){return Zp(yp(t))}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jp=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),eg=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,s,n)=>n?n.toUpperCase():s.toLowerCase()),rc=t=>{const e=eg(t);return e.charAt(0).toUpperCase()+e.slice(1)},cd=(...t)=>t.filter((e,s,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===s).join(" ").trim(),tg=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sg={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ng=g.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:s=2,absoluteStrokeWidth:n,className:r="",children:o,iconNode:a,...c},l)=>g.createElement("svg",{ref:l,...sg,width:e,height:e,stroke:t,strokeWidth:n?Number(s)*24/Number(e):s,className:cd("lucide",r),...!o&&!tg(c)&&{"aria-hidden":"true"},...c},[...a.map(([d,h])=>g.createElement(d,h)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=(t,e)=>{const s=g.forwardRef(({className:n,...r},o)=>g.createElement(ng,{ref:o,iconNode:e,className:cd(`lucide-${Jp(rc(t))}`,`lucide-${t}`,n),...r}));return s.displayName=rc(t),s};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rg=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],og=te("arrow-left",rg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],Jt=te("box",ig);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ag=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],cg=te("calendar",ag);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lg=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],oc=te("camera",lg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dg=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ug=te("chart-column",dg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hg=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],fg=te("check",hg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mg=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ta=te("chevron-down",mg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pg=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],gg=te("chevron-right",pg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xg=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ld=te("chevron-up",xg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yg=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],En=te("circle-check-big",yg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],vg=te("circle-check",bg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Sg=te("circle-x",wg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _g=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],xs=te("circle",_g);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ng=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],dd=te("clock",Ng);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cg=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],ic=te("copy",Cg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eg=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5v14a9 3 0 0 0 18 0V5",key:"aqi0yr"}]],ud=te("cylinder",Eg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rg=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],fi=te("download",Rg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tg=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],jg=te("eye-off",Tg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pg=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],sa=te("eye",Pg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kg=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Mg=te("file-text",kg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ag=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],mi=te("folder-open",Ag);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lg=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],pi=te("folder",Lg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Og=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Dg=te("globe",Og);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ig=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],na=te("grid-3x3",Ig);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],hd=te("info",Fg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zg=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],fd=te("layers",zg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ug=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Rn=te("lightbulb",Ug);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bg=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],Hg=te("list",Bg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $g=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],gi=te("loader-circle",$g);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vg=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],Wg=te("lock-open",Vg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gg=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Kg=te("lock",Gg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qg=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],md=te("map-pin",qg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yg=[["path",{d:"M5 12h14",key:"1ays0h"}]],Kt=te("minus",Yg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xg=[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]],Qg=te("mouse-pointer",Xg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zg=[["path",{d:"M5 3v16h16",key:"1mqmf9"}],["path",{d:"m5 19 6-6",key:"jh6hbb"}],["path",{d:"m2 6 3-3 3 3",key:"tkyvxa"}],["path",{d:"m18 16 3 3-3 3",key:"1d4glt"}]],pd=te("move-3d",Zg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jg=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],ex=te("palette",Jg);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tx=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]],sx=te("panel-left-close",tx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nx=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]],rx=te("panel-left",nx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ox=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],ac=te("play",ox);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ix=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ut=te("plus",ix);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ax=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ra=te("refresh-cw",ax);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cx=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],oa=te("rocket",cx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lx=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],gd=te("rotate-ccw",lx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dx=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],ux=te("rotate-cw",dx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hx=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],eo=te("save",hx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fx=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],mx=te("scale",fx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const px=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],xd=te("search",px);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gx=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],hs=te("settings",gx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xx=[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]],yx=te("shapes",xx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bx=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],vs=te("trash-2",bx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vx=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],cc=te("trending-up",vx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wx=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Sx=te("triangle-alert",wx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _x=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Nx=te("upload",_x);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cx=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],yd=te("users",Cx);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ex=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Rx=te("zap",Ex),re=g.forwardRef(({className:t,variant:e="default",size:s="default",...n},r)=>i.jsx("button",{className:Ne("inline-flex items-center justify-center whitespace-nowrap font-medium focus-ring transition-smooth","disabled:pointer-events-none disabled:opacity-50",{"bg-primary text-primary-foreground hover:bg-primary/90 active:bg-primary/80 shadow-md":e==="default"||e==="primary","bg-surface text-text border border-muted hover:bg-muted active:bg-muted/80":e==="surface","text-text hover:bg-muted active:bg-muted/80":e==="ghost","bg-danger text-primary-foreground hover:bg-danger/90 active:bg-danger/80 shadow-md":e==="danger"||e==="destructive","border border-primary text-primary hover:bg-primary hover:text-primary-foreground active:bg-primary/80":e==="outline","text-primary underline-offset-4 hover:underline":e==="link","bg-secondary text-secondary-foreground hover:bg-secondary/80":e==="secondary"},{"h-6 px-2 text-xs rounded-sm":s==="xs","h-8 px-3 text-sm rounded-sm":s==="sm","h-10 px-4 text-sm rounded-md":s==="default"||s==="md","h-12 px-6 text-base rounded-lg":s==="lg","h-10 w-10 rounded-md":s==="icon"},t),ref:r,...n}));re.displayName="Button";const bd=({className:t})=>{const[e,s]=g.useState(!1);g.useEffect(()=>{const r=localStorage.getItem("theme"),o=window.matchMedia("(prefers-color-scheme: dark)").matches,a=r==="dark"||r===null&&o;s(a),a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[]);const n=()=>{const r=!e;s(r),r?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))};return i.jsx(re,{variant:"ghost",size:"icon",onClick:n,className:Ne("focus-ring",t),"aria-label":e?"Switch to light mode":"Switch to dark mode",children:e?i.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):i.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})})},Tx=[{name:"Design",href:"/design",icon:oa},{name:"Mars Terrain",href:"/mars-design",icon:Dg},{name:"CAD Studio",href:"/cad",icon:hs},{name:"Analysis",href:"/analysis",icon:ug},{name:"Collections",href:"/collections",icon:mi}];function jx(){const t=$m();return i.jsxs("div",{className:"min-h-screen bg-background text-foreground space-gradient",children:[i.jsx("nav",{className:"nav-container shadow-lg",children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsxs("div",{className:"flex justify-between h-16",children:[i.jsx("div",{className:"flex items-center",children:i.jsxs(jr,{to:"/design",className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-primary to-blue-600 rounded-lg flex items-center justify-center",children:i.jsx(oa,{className:"w-5 h-5 text-white"})}),i.jsx("div",{children:i.jsx("h1",{className:"text-lg font-bold bg-gradient-to-r from-primary to-blue-400 bg-clip-text text-transparent",children:"NASA Habitat Designer"})})]})}),i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx("div",{className:"flex items-center space-x-8",children:Tx.map(e=>{const s=e.icon,n=t.pathname===e.href||e.href==="/design"&&t.pathname==="/";return i.jsxs(jr,{to:e.href,className:Ne("inline-flex items-center gap-2 px-1 pt-1 text-sm font-medium transition-colors",n?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:border-border"),children:[i.jsx(s,{className:"w-4 h-4"}),e.name]},e.name)})}),i.jsx(bd,{})]})]})})}),i.jsx("main",{className:"flex-1 bg-background",children:i.jsx(Vl,{})})]})}const Fe=g.forwardRef(({className:t,...e},s)=>i.jsx("div",{ref:s,className:Ne("rounded-lg border bg-card text-card-foreground shadow-sm",t),...e}));Fe.displayName="Card";const Qe=g.forwardRef(({className:t,...e},s)=>i.jsx("div",{ref:s,className:Ne("flex flex-col space-y-1.5 p-6",t),...e}));Qe.displayName="CardHeader";const Ze=g.forwardRef(({className:t,...e},s)=>i.jsx("h3",{ref:s,className:Ne("text-2xl font-semibold leading-none tracking-tight",t),...e}));Ze.displayName="CardTitle";const Px=g.forwardRef(({className:t,...e},s)=>i.jsx("p",{ref:s,className:Ne("text-sm text-muted-foreground",t),...e}));Px.displayName="CardDescription";const qe=g.forwardRef(({className:t,...e},s)=>i.jsx("div",{ref:s,className:Ne("p-6 pt-0",t),...e}));qe.displayName="CardContent";const kx=g.forwardRef(({className:t,...e},s)=>i.jsx("div",{ref:s,className:Ne("flex items-center p-6 pt-0",t),...e}));kx.displayName="CardFooter";const xi=g.forwardRef(({className:t,type:e,...s},n)=>i.jsx("input",{type:e,className:Ne("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...s}));xi.displayName="Input";const xn=g.forwardRef(({className:t,...e},s)=>i.jsx("label",{ref:s,className:Ne("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t),...e}));xn.displayName="Label";const So=[{name:"Falcon 9",inner_diameter_m:5.2,inner_height_m:13.1,shape:"OGIVE"},{name:"Falcon Heavy (5.2m)",inner_diameter_m:5.2,inner_height_m:13.1,shape:"OGIVE"},{name:"New Glenn",inner_diameter_m:7,inner_height_m:22,shape:"OGIVE"},{name:"SLS Blk-1",inner_diameter_m:8.4,inner_height_m:27,shape:"CYLINDRICAL"},{name:"Starship (cargo bay)",inner_diameter_m:8,inner_height_m:18,shape:"CYLINDRICAL"}],an=[{type:"CREW_SLEEP",label:"Crew Bunk",defaultSize:{w_m:2,l_m:2.2,h_m:2.1},icon:"bed"},{type:"HYGIENE",label:"Hygiene Bay",defaultSize:{w_m:2,l_m:2,h_m:2.2},icon:"shower"},{type:"WASTE",label:"Waste Compartment",defaultSize:{w_m:1.8,l_m:1.8,h_m:2.2},icon:"trash"},{type:"EXERCISE",label:"Exercise (ARED)",defaultSize:{w_m:3,l_m:4,h_m:2.5},icon:"dumbbell"},{type:"FOOD_PREP",label:"Galley",defaultSize:{w_m:3,l_m:3,h_m:2.2},icon:"utensils"},{type:"ECLSS",label:"ECLSS Pallets",defaultSize:{w_m:3,l_m:2.5,h_m:2.3},icon:"fan"},{type:"MEDICAL",label:"Med Bay",defaultSize:{w_m:2.5,l_m:2.5,h_m:2.3},icon:"first-aid"},{type:"MAINTENANCE",label:"Maint. Bench",defaultSize:{w_m:2.5,l_m:2.5,h_m:2.3},icon:"wrench"},{type:"STOWAGE",label:"Stowage Rack",defaultSize:{w_m:2.5,l_m:3.5,h_m:2.3},icon:"boxes"},{type:"RECREATION",label:"Recreation",defaultSize:{w_m:2,l_m:2,h_m:2.2},icon:"gamepad"},{type:"WORKSTATION",label:"Workstation",defaultSize:{w_m:2.2,l_m:2.2,h_m:2.2},icon:"monitor"},{type:"AIRLOCK",label:"Airlock",defaultSize:{w_m:2,l_m:2.2,h_m:2.3},icon:"door"},{type:"GLOVEBOX",label:"Glovebox",defaultSize:{w_m:1.4,l_m:1.8,h_m:2},icon:"flask"},{type:"TRASH_MGMT",label:"Trash Mgmt",defaultSize:{w_m:1.5,l_m:2,h_m:2},icon:"recycle"},{type:"COMMON_AREA",label:"Common Area",defaultSize:{w_m:3,l_m:3,h_m:2.2},icon:"users"},{type:"CUSTOM_CAD",label:"Custom CAD Module",defaultSize:{w_m:2,l_m:2,h_m:2},icon:"settings"}];function yi(t){if(typeof t=="string")try{const r=JSON.parse(t);return yi(r)}catch{const r=t.trim();if(r.startsWith("{")&&r.endsWith("}")||r.startsWith("[")&&r.endsWith("]"))try{return JSON.parse(r)}catch{}throw new Error("Analyzer returned an unexpected string; could not parse JSON.")}const e=t,s=Array.isArray(e?.results)?e.results:[],n=Array.isArray(e?.suggestions)?e.suggestions:[];return{results:s,suggestions:n}}async function vd(t){const e="http://localhost:3001/nasa-analysis",s="https://amine759--nasa-habitat-validator-api.modal.run/agent",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.";let r;try{if(console.log(" Trying proxy server..."),r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:typeof t=="string"?t:JSON.stringify(t)}),!r.ok)throw new Error(`Proxy server error: ${r.status}`);console.log(" Proxy server responded successfully")}catch(a){console.warn(" Proxy server failed, trying direct API...",a);try{if(r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":n},body:typeof t=="string"?t:JSON.stringify(t)}),!r.ok)throw new Error(`NASA API error: ${r.status}`);console.log(" Direct API responded successfully")}catch(c){return console.warn(" Direct API also failed, using mock data...",c),Promise.resolve({results:[{rule:"global_rules.nhv_per_crew_m3",valid:!0,explanation:"Mock: NHV per crew is above threshold."},{rule:"habitat_rules.fairing_fit",valid:!1,explanation:"Mock: Diameter exceeds fairing envelope."},{rule:"destination_rules.MARS_SURFACE",valid:!1,explanation:"Mock: Missing redundant modules for Mars mission."}],suggestions:["Reduce habitat diameter","Add redundant medical and exercise modules","Cluster HYGIENE/WASTE/EXERCISE together"]})}}const o=await r.text();try{return yi(JSON.parse(o))}catch{return yi(o)}}const Mx="habitat-designer-db",Ax=1,Et="designs",kr="customShapes";let at=null,cn=null;async function to(){return at?(console.log("Database already initialized"),Promise.resolve()):cn?(console.log("Database initialization in progress, waiting..."),cn):(console.log("Starting database initialization..."),cn=new Promise((t,e)=>{const s=indexedDB.open(Mx,Ax);s.onerror=()=>{console.error("Database initialization failed:",s.error),cn=null,e(s.error)},s.onsuccess=()=>{at=s.result,console.log("Database initialized successfully"),t()},s.onupgradeneeded=()=>{console.log("Database upgrade needed, creating stores...");const n=s.result;if(!n.objectStoreNames.contains(Et)){const r=n.createObjectStore(Et,{keyPath:"id"});r.createIndex("name","name",{unique:!1}),r.createIndex("createdAt","createdAt",{unique:!1}),r.createIndex("tags","tags",{unique:!1,multiEntry:!0}),console.log("Designs store created")}if(!n.objectStoreNames.contains(kr)){const r=n.createObjectStore(kr,{keyPath:"id"});r.createIndex("name","name",{unique:!1}),r.createIndex("category","category",{unique:!1}),console.log("Shapes store created")}}}),cn)}async function ia(t){if(!at)throw new Error("Database not initialized");const e=`design_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s=new Date,n={...t,id:e,createdAt:s,updatedAt:s};return new Promise((r,o)=>{const l=at.transaction([Et],"readwrite").objectStore(Et).add(n);l.onsuccess=()=>r(e),l.onerror=()=>o(l.error)})}async function Lx(t){if(!at)throw new Error("Database not initialized");return new Promise((e,s)=>{const o=at.transaction([Et],"readonly").objectStore(Et).get(t);o.onsuccess=()=>e(o.result||null),o.onerror=()=>s(o.error)})}async function wd(){if(!at)throw console.error("Database not initialized when trying to list designs"),new Error("Database not initialized");return new Promise((t,e)=>{try{const s=at.transaction([Et],"readonly"),r=s.objectStore(Et).getAll();r.onsuccess=()=>{const o=r.result||[];console.log(`Found ${o.length} designs in database`),o.sort((a,c)=>c.updatedAt.getTime()-a.updatedAt.getTime()),t(o)},r.onerror=()=>{console.error("Error reading designs from database:",r.error),e(r.error)},s.onerror=()=>{console.error("Transaction error when reading designs:",s.error),e(s.error)}}catch(s){console.error("Exception in listDesigns:",s),e(s)}})}async function Ox(t){if(!at)throw new Error("Database not initialized");return new Promise((e,s)=>{const o=at.transaction([Et],"readwrite").objectStore(Et).delete(t);o.onsuccess=()=>e(),o.onerror=()=>s(o.error)})}async function Sd(t){if(!at)throw new Error("Database not initialized");const e=`shape_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s={...t,id:e,createdAt:new Date};return new Promise((n,r)=>{const c=at.transaction([kr],"readwrite").objectStore(kr).add(s);c.onsuccess=()=>n(e),c.onerror=()=>r(c.error)})}async function Dx(t){const e=await Lx(t);if(!e)throw new Error("Design not found");return JSON.stringify(e,null,2)}async function Ix(t){try{const e=JSON.parse(t),{id:s,createdAt:n,updatedAt:r,...o}=e;return await ia({...o,name:`${e.name} (Imported)`})}catch{throw new Error("Invalid design file format")}}to().catch(console.error);function Fx({currentLayout:t,onLoadDesign:e,onSaveSuccess:s}){const[n,r]=g.useState([]),[o,a]=g.useState([]),[c,l]=g.useState(""),[d,h]=g.useState(""),[u,f]=g.useState("grid"),[m,p]=g.useState(!0),[x,b]=g.useState(!1),[S,y]=g.useState(!1),[w,v]=g.useState({name:"",description:"",tags:[],newTag:""});g.useEffect(()=>{C()},[]),g.useEffect(()=>{let k=n;c&&(k=k.filter(D=>D.name.toLowerCase().includes(c.toLowerCase())||D.description?.toLowerCase().includes(c.toLowerCase())||D.tags.some(U=>U.toLowerCase().includes(c.toLowerCase())))),d&&(k=k.filter(D=>D.tags.includes(d))),a(k)},[n,c,d]);const C=async()=>{p(!0);try{const k=await wd();r(k)}catch(k){console.error("Failed to load designs:",k)}finally{p(!1)}},T=()=>{const k=new Set;return n.forEach(D=>{D.tags.forEach(U=>k.add(U))}),Array.from(k).sort()},_=async()=>{if(!t||!w.name.trim()){alert("Please enter a design name");return}b(!0);try{const k=await ia({name:w.name,description:w.description,layout:t,tags:w.tags});await C(),y(!1),v({name:"",description:"",tags:[],newTag:""}),s&&s(k),alert("Design saved successfully!")}catch(k){console.error("Failed to save design:",k),alert("Failed to save design. Please try again.")}finally{b(!1)}},N=async k=>{if(confirm("Are you sure you want to delete this design?"))try{await Ox(k),await C()}catch(D){console.error("Failed to delete design:",D),alert("Failed to delete design. Please try again.")}},j=async k=>{try{const D=await Dx(k),U=n.find(ce=>ce.id===k),Y=new Blob([D],{type:"application/json"}),O=URL.createObjectURL(Y),G=document.createElement("a");G.href=O,G.download=`${U?.name||"habitat-design"}.json`,G.click(),URL.revokeObjectURL(O)}catch(D){console.error("Failed to export design:",D),alert("Failed to export design. Please try again.")}},F=k=>{const D=k.target.files?.[0];if(!D)return;const U=new FileReader;U.onload=async Y=>{try{const O=Y.target?.result;await Ix(O),await C(),alert("Design imported successfully!")}catch(O){console.error("Failed to import design:",O),alert("Failed to import design. Please check the file format.")}},U.readAsText(D)},E=()=>{w.newTag.trim()&&!w.tags.includes(w.newTag.trim())&&v(k=>({...k,tags:[...k.tags,k.newTag.trim()],newTag:""}))},P=k=>{v(D=>({...D,tags:D.tags.filter(U=>U!==k)}))},B=k=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(k));return i.jsxs("div",{className:"flex flex-col h-full bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white",children:[i.jsx("div",{className:"bg-black/20 border-b border-purple-500/20 p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:i.jsx(pi,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-purple-300 via-pink-300 to-purple-300 bg-clip-text text-transparent",children:"Design Collections"}),i.jsx("p",{className:"text-sm text-gray-300",children:"Manage your saved habitat designs"})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"file",accept:".json",onChange:F,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),i.jsxs(re,{className:"bg-green-600 hover:bg-green-700",children:[i.jsx(Nx,{className:"w-4 h-4 mr-2"}),"Import"]})]}),t&&i.jsxs(re,{onClick:()=>y(!0),className:"bg-blue-600 hover:bg-blue-700",children:[i.jsx(eo,{className:"w-4 h-4 mr-2"}),"Save Current"]})]})]})}),i.jsx("div",{className:"bg-black/10 border-b border-purple-500/20 p-4",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(xd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),i.jsx("input",{type:"text",placeholder:"Search designs...",value:c,onChange:k=>l(k.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white placeholder-gray-400"})]}),i.jsxs("select",{value:d,onChange:k=>h(k.target.value),className:"px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white",children:[i.jsx("option",{value:"",children:"All Tags"}),T().map(k=>i.jsx("option",{value:k,children:k},k))]}),i.jsxs("div",{className:"flex items-center gap-1 bg-gray-800/30 rounded-lg p-1",children:[i.jsx("button",{onClick:()=>f("grid"),className:`p-2 rounded ${u==="grid"?"bg-blue-600":"hover:bg-gray-700/50"}`,children:i.jsx(na,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>f("list"),className:`p-2 rounded ${u==="list"?"bg-blue-600":"hover:bg-gray-700/50"}`,children:i.jsx(Hg,{className:"w-4 h-4"})})]})]})}),i.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:m?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsx("div",{className:"text-gray-400",children:"Loading designs..."})}):o.length===0?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"text-center",children:[i.jsx(pi,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),i.jsx("div",{className:"text-gray-400 mb-2",children:"No designs found"}),i.jsx("p",{className:"text-sm text-gray-500",children:c||d?"Try adjusting your filters":"Create your first habitat design"})]})}):i.jsx("div",{className:u==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-2",children:o.map(k=>i.jsxs("div",{className:`bg-gray-800/30 border border-gray-700/30 rounded-lg p-4 hover:bg-gray-700/30 transition-all ${u==="list"?"flex items-center justify-between":""}`,children:[i.jsxs("div",{className:u==="list"?"flex-1":"",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsx("h3",{className:"font-semibold text-lg text-white truncate",children:k.name}),u==="grid"&&i.jsx("div",{className:"flex items-center gap-1",children:i.jsx(re,{size:"sm",variant:"outline",onClick:()=>e?.(k),children:i.jsx(sa,{className:"w-3 h-3"})})})]}),k.description&&i.jsx("p",{className:"text-sm text-gray-300 mb-3 line-clamp-2",children:k.description}),k.tags.length>0&&i.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:k.tags.map(D=>i.jsx("span",{className:"px-2 py-1 bg-purple-600/30 text-purple-200 text-xs rounded-full",children:D},D))}),i.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-400 mb-3",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(dd,{className:"w-3 h-3"}),B(k.updatedAt)]}),i.jsxs("div",{children:[k.layout.modules.length," modules"]})]}),u==="grid"&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(re,{size:"sm",onClick:()=>e?.(k),className:"flex-1 bg-blue-600 hover:bg-blue-700",children:"Load Design"}),i.jsx(re,{size:"sm",variant:"outline",onClick:()=>j(k.id),children:i.jsx(fi,{className:"w-3 h-3"})}),i.jsx(re,{size:"sm",variant:"outline",onClick:()=>N(k.id),className:"hover:bg-red-600/20",children:i.jsx(vs,{className:"w-3 h-3"})})]})]}),u==="list"&&i.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[i.jsx(re,{size:"sm",onClick:()=>e?.(k),children:"Load"}),i.jsx(re,{size:"sm",variant:"outline",onClick:()=>j(k.id),children:i.jsx(fi,{className:"w-3 h-3"})}),i.jsx(re,{size:"sm",variant:"outline",onClick:()=>N(k.id),className:"hover:bg-red-600/20",children:i.jsx(vs,{className:"w-3 h-3"})})]})]},k.id))})}),S&&i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-6 max-w-md w-full mx-4",children:[i.jsx("h3",{className:"text-xl font-bold mb-4",children:"Save Design"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Design Name"}),i.jsx("input",{type:"text",value:w.name,onChange:k=>v(D=>({...D,name:k.target.value})),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white",placeholder:"Enter design name"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Description"}),i.jsx("textarea",{value:w.description,onChange:k=>v(D=>({...D,description:k.target.value})),className:"w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white resize-none",rows:3,placeholder:"Describe your design"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tags"}),i.jsxs("div",{className:"flex gap-2 mb-2",children:[i.jsx("input",{type:"text",value:w.newTag,onChange:k=>v(D=>({...D,newTag:k.target.value})),onKeyPress:k=>k.key==="Enter"&&E(),className:"flex-1 px-3 py-1 bg-gray-800 border border-gray-600 rounded text-sm",placeholder:"Add tag"}),i.jsx(re,{size:"sm",onClick:E,children:i.jsx(ut,{className:"w-3 h-3"})})]}),i.jsx("div",{className:"flex flex-wrap gap-1",children:w.tags.map(k=>i.jsxs("span",{className:"px-2 py-1 bg-purple-600/30 text-purple-200 text-xs rounded-full flex items-center gap-1",children:[k,i.jsx("button",{onClick:()=>P(k),className:"hover:text-red-300",children:""})]},k))})]})]}),i.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[i.jsx(re,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),i.jsx(re,{onClick:_,disabled:x,children:x?"Saving...":"Save Design"})]})]})})]})}const ln=[{id:"rectangular_module",name:"Rectangular Module",type:"basic",icon:i.jsx(Jt,{className:"w-5 h-5"}),defaultParams:{width:3,height:2.5,depth:2,wireframe:!1,hasWalls:!1,materialType:"solid",transparency:.8},description:"Standard rectangular habitat module",category:"habitat"},{id:"wireframe_structure",name:"Wireframe Structure",type:"basic",icon:i.jsx(Jt,{className:"w-5 h-5"}),defaultParams:{width:4,height:3,depth:3,wireframe:!0,frameWidth:.1,frameSpacing:.5,materialType:"wireframe",transparency:1},description:"Structural wireframe for construction",category:"structural"},{id:"walled_room",name:"Room with Walls",type:"composite",icon:i.jsx(Jt,{className:"w-5 h-5"}),defaultParams:{width:4,height:2.8,depth:4,hasWalls:!0,wallThickness:.2,wallHeight:2.5,materialType:"solid",transparency:.9},description:"Enclosed room with separate walls",category:"habitat"},{id:"cylindrical_module",name:"Cylindrical Module",type:"basic",icon:i.jsx(ud,{className:"w-5 h-5"}),defaultParams:{width:2.5,height:3,depth:2.5,radius:1.25,segments:16,materialType:"solid",transparency:.8},description:"Pressurized cylindrical module",category:"habitat"},{id:"glass_dome",name:"Glass Dome",type:"basic",icon:i.jsx(xs,{className:"w-5 h-5"}),defaultParams:{width:4,height:2,depth:4,radius:2,segments:16,materialType:"glass",transparency:.3},description:"Transparent observation dome",category:"habitat"},{id:"metal_frame",name:"Metal Frame",type:"parametric",icon:i.jsx(xs,{className:"w-5 h-5"}),defaultParams:{width:3,height:3,depth:3,wireframe:!0,frameWidth:.15,materialType:"metal",transparency:1},description:"Heavy duty metal framework",category:"structural"},{id:"airlock_ring",name:"Airlock Ring",type:"parametric",icon:i.jsx(xs,{className:"w-5 h-5"}),defaultParams:{width:2,height:.5,depth:2,radius:1,tubularSegments:8,materialType:"metal",transparency:.8},description:"Ring-shaped airlock chamber",category:"structural"},{id:"composite_lab",name:"Multi-Level Lab",type:"composite",icon:i.jsx(fd,{className:"w-5 h-5"}),defaultParams:{width:4,height:3.5,depth:3,segments:8,hasWalls:!0,wallThickness:.15,materialType:"solid",transparency:.8},description:"Complex laboratory with multiple levels and walls",category:"habitat"}];function lc(){const[t,e]=g.useState(ln[0]),[s,n]=g.useState(ln[0].defaultParams),[r,o]=g.useState(""),[a,c]=g.useState(""),[l,d]=g.useState(!1),[h,u]=g.useState(null),f=g.useRef(null),m=g.useRef(null),p=g.useRef(null),x=g.useRef(null),b=g.useRef(null),S=g.useRef(null);g.useEffect(()=>{if(!f.current)return;const E=new zr;E.background=new ze(657946),m.current=E;const P=new Ur(75,400/300,.1,1e3);P.position.set(5,3,5),P.lookAt(0,0,0),x.current=P;const B=new Br({antialias:!0});B.setSize(400,300),B.shadowMap.enabled=!0,B.shadowMap.type=Hr,f.current.appendChild(B.domElement),p.current=B;const k=new $r(4210752,.6);E.add(k);const D=new Vs(16777215,.8);D.position.set(10,10,5),D.castShadow=!0,E.add(D);const U=new Ai(10,20,3355443,3355443);E.add(U);const Y=new Nh(2);return E.add(Y),()=>{S.current&&cancelAnimationFrame(S.current),f.current&&B.domElement&&f.current.removeChild(B.domElement),B.dispose()}},[]);const y=g.useCallback(()=>{if(!m.current||!p.current||!x.current)return;b.current&&(m.current.remove(b.current),b.current.geometry&&b.current.geometry.dispose(),Array.isArray(b.current.material)?b.current.material.forEach(U=>U.dispose()):b.current.material&&b.current.material.dispose());const E=new wt,P=w(),B=v("main"),k=new ke(P,B);k.position.y=s.height/2,E.add(k),s.hasWalls&&C().forEach(Y=>E.add(Y)),s.wireframe&&t.id.includes("frame")&&T().forEach(Y=>E.add(Y)),E.castShadow=!0,E.receiveShadow=!0,m.current.add(E),b.current=E;const D=()=>{b.current&&(b.current.rotation.y+=.005),p.current&&m.current&&x.current&&p.current.render(m.current,x.current),S.current=requestAnimationFrame(D)};S.current&&cancelAnimationFrame(S.current),D()},[t,s]),w=g.useCallback(()=>{const{width:E,height:P,depth:B,radius:k,segments:D}=s;switch(t.id){case"rectangular_module":case"wireframe_structure":case"walled_room":return new ge(E,P,B);case"cylindrical_module":return new Lt(k||E/2,k||E/2,P,D||16);case"glass_dome":return new Vr(k||E/2,D||16,(D||16)/2,0,Math.PI*2,0,Math.PI/2);case"metal_frame":return new ge(E,P,B);case"airlock_ring":return new pl(k||E/2,P/4,D||8,s.tubularSegments||16);case"composite_lab":return new ge(E,P*.7,B);default:return new ge(E,P,B)}},[t,s]),v=g.useCallback(E=>{const B={color:E==="wall"?8947848:E==="frame"?11184810:4886754,transparent:!0,opacity:s.transparency||.8};switch(s.materialType){case"wireframe":return new qt({...B,wireframe:!0,color:65280,opacity:1});case"glass":return new ct({...B,transmission:.9,roughness:.1,metalness:0,clearcoat:1,clearcoatRoughness:.1,color:8965375,opacity:s.transparency||.3});case"metal":return new fs({...B,metalness:.8,roughness:.2,color:10066329});default:return new xt(B)}},[s]),C=g.useCallback(()=>{const E=[],{width:P,depth:B,wallThickness:k=.2,wallHeight:D}=s,U=D||s.height,Y=v("wall"),O=new ge(P,U,k),G=new ke(O,Y);G.position.set(0,U/2,B/2),E.push(G);const ce=new ge(P,U,k),X=new ke(ce,Y);X.position.set(0,U/2,-B/2),E.push(X);const ye=new ge(k,U,B),ne=new ke(ye,Y);ne.position.set(-P/2,U/2,0),E.push(ne);const ue=new ge(k,U,B),pe=new ke(ue,Y);return pe.position.set(P/2,U/2,0),E.push(pe),E},[s,v]),T=g.useCallback(()=>{const E=[],{width:P,height:B,depth:k,frameWidth:D=.1,frameSpacing:U=.5}=s,Y=v("frame");for(let O=-P/2;O<=P/2;O+=U)for(let G=-k/2;G<=k/2;G+=U)if(Math.abs(O)===P/2||Math.abs(G)===k/2){const ce=new ge(D,B,D),X=new ke(ce,Y);X.position.set(O,B/2,G),E.push(X)}for(let O=-P/2;O<=P/2;O+=U){const G=new ge(D,D,k),ce=new ke(G,Y);ce.position.set(O,B,0),E.push(ce)}for(let O=-k/2;O<=k/2;O+=U){const G=new ge(P,D,D),ce=new ke(G,Y);ce.position.set(0,B,O),E.push(ce)}return E},[s,v]);g.useEffect(()=>{y()},[y]);const _=(E,P)=>{n(B=>({...B,[E]:P}))},N=E=>{e(E),n(E.defaultParams),o(E.name),c(E.description)},j=async()=>{if(r.trim()){d(!0),u(null);try{const E={name:r.trim(),description:a.trim()||"Custom shape created with Shape Builder",geometryType:t.id,parameters:s,category:"custom"};await Sd(E),u("Shape saved successfully! It's now available in your Collections."),setTimeout(()=>{u(null),o(""),c("")},3e3)}catch(E){console.error("Error saving custom shape:",E),u("Error saving shape. Please try again.")}finally{d(!1)}}},F=()=>{const E={name:r,preset:t.id,parameters:s,description:a,exportedAt:new Date().toISOString()},P=new Blob([JSON.stringify(E,null,2)],{type:"application/json"}),B=URL.createObjectURL(P),k=document.createElement("a");k.href=B,k.download=`${r||"custom-shape"}.json`,k.click(),URL.revokeObjectURL(B)};return i.jsxs("div",{className:"flex flex-col h-full bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white",children:[i.jsx("div",{className:"bg-black/20 border-b border-purple-500/20 p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center",children:i.jsx(pd,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-300 via-cyan-300 to-blue-300 bg-clip-text text-transparent",children:"Shape Builder"}),i.jsx("p",{className:"text-sm text-gray-300",children:"Create custom 3D habitat modules"})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("button",{onClick:F,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center gap-2 transition-colors",children:[i.jsx(fi,{className:"w-4 h-4"}),"Export"]}),i.jsxs("button",{onClick:j,disabled:l,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 transition-colors disabled:opacity-50",children:[i.jsx(eo,{className:"w-4 h-4"}),l?"Saving...":"Save Shape"]})]})]})}),i.jsxs("div",{className:"flex flex-1",children:[i.jsxs("div",{className:"w-80 bg-black/20 border-r border-purple-500/20 p-4 overflow-y-auto",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4 text-purple-200",children:"Shape Presets"}),i.jsx("div",{className:"space-y-2 mb-6",children:ln.map(E=>i.jsx("div",{onClick:()=>N(E),className:`p-3 rounded-lg cursor-pointer transition-all ${t.id===E.id?"bg-blue-600/30 border border-blue-500/50":"bg-gray-800/30 hover:bg-gray-700/30 border border-gray-700/30"}`,children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"text-blue-400",children:E.icon}),i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:E.name}),i.jsx("div",{className:"text-xs text-gray-400",children:E.description}),i.jsx("div",{className:"text-xs text-purple-400 capitalize",children:E.category})]})]})},E.id))}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2 text-purple-200",children:"Shape Name"}),i.jsx("input",{type:"text",value:r,onChange:E=>o(E.target.value),className:"w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white placeholder-gray-400",placeholder:"Enter shape name"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2 text-purple-200",children:"Description"}),i.jsx("textarea",{value:a,onChange:E=>c(E.target.value),className:"w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white placeholder-gray-400 resize-none",rows:3,placeholder:"Describe your custom shape"})]})]})]}),i.jsxs("div",{className:"flex-1 flex",children:[i.jsxs("div",{className:"w-80 bg-black/10 border-r border-purple-500/20 p-4 overflow-y-auto",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4 text-purple-200",children:"Parameters"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Width (meters)"}),i.jsx("input",{type:"range",min:"0.5",max:"10",step:"0.1",value:s.width,onChange:E=>_("width",parseFloat(E.target.value)),className:"w-full"}),i.jsxs("div",{className:"text-right text-sm text-gray-400",children:[s.width.toFixed(1),"m"]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Height (meters)"}),i.jsx("input",{type:"range",min:"0.5",max:"10",step:"0.1",value:s.height,onChange:E=>_("height",parseFloat(E.target.value)),className:"w-full"}),i.jsxs("div",{className:"text-right text-sm text-gray-400",children:[s.height.toFixed(1),"m"]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Depth (meters)"}),i.jsx("input",{type:"range",min:"0.5",max:"10",step:"0.1",value:s.depth,onChange:E=>_("depth",parseFloat(E.target.value)),className:"w-full"}),i.jsxs("div",{className:"text-right text-sm text-gray-400",children:[s.depth.toFixed(1),"m"]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Material Type"}),i.jsxs("select",{value:s.materialType||"solid",onChange:E=>_("materialType",E.target.value),className:"w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white",children:[i.jsx("option",{value:"solid",children:"Solid"}),i.jsx("option",{value:"wireframe",children:"Wireframe"}),i.jsx("option",{value:"glass",children:"Glass"}),i.jsx("option",{value:"metal",children:"Metal"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Transparency"}),i.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.1",value:s.transparency||.8,onChange:E=>_("transparency",parseFloat(E.target.value)),className:"w-full"}),i.jsxs("div",{className:"text-right text-sm text-gray-400",children:[((s.transparency||.8)*100).toFixed(0),"%"]})]}),i.jsxs("div",{className:"border-t border-gray-600 pt-4",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx("input",{type:"checkbox",id:"hasWalls",checked:s.hasWalls||!1,onChange:E=>_("hasWalls",E.target.checked),className:"rounded"}),i.jsx("label",{htmlFor:"hasWalls",className:"text-sm font-medium",children:"Add Walls"})]}),s.hasWalls&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Wall Thickness (meters)"}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.05",value:s.wallThickness||.2,onChange:E=>_("wallThickness",parseFloat(E.target.value)),className:"w-full"}),i.jsxs("div",{className:"text-right text-sm text-gray-400",children:[(s.wallThickness||.2).toFixed(2),"m"]})]}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Wall Height (meters)"}),i.jsx("input",{type:"range",min:"0.5",max:"5",step:"0.1",value:s.wallHeight||s.height,onChange:E=>_("wallHeight",parseFloat(E.target.value)),className:"w-full"}),i.jsxs("div",{className:"text-right text-sm text-gray-400",children:[(s.wallHeight||s.height).toFixed(1),"m"]})]})]})]}),(s.wireframe||t.id.includes("frame"))&&i.jsxs("div",{className:"border-t border-gray-600 pt-4",children:[i.jsx("h4",{className:"text-sm font-medium mb-3 text-purple-200",children:"Wireframe Settings"}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frame Width (meters)"}),i.jsx("input",{type:"range",min:"0.05",max:"0.3",step:"0.01",value:s.frameWidth||.1,onChange:E=>_("frameWidth",parseFloat(E.target.value)),className:"w-full"}),i.jsxs("div",{className:"text-right text-sm text-gray-400",children:[(s.frameWidth||.1).toFixed(2),"m"]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frame Spacing (meters)"}),i.jsx("input",{type:"range",min:"0.2",max:"2.0",step:"0.1",value:s.frameSpacing||.5,onChange:E=>_("frameSpacing",parseFloat(E.target.value)),className:"w-full"}),i.jsxs("div",{className:"text-right text-sm text-gray-400",children:[(s.frameSpacing||.5).toFixed(1),"m"]})]})]}),(t.id.includes("cylindrical")||t.id.includes("dome")||t.id.includes("ring"))&&i.jsx("div",{className:"border-t border-gray-600 pt-4",children:i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Radius (meters)"}),i.jsx("input",{type:"range",min:"0.2",max:"5",step:"0.1",value:s.radius||s.width/2,onChange:E=>_("radius",parseFloat(E.target.value)),className:"w-full"}),i.jsxs("div",{className:"text-right text-sm text-gray-400",children:[(s.radius||s.width/2).toFixed(1),"m"]})]})}),(t.id.includes("cylindrical")||t.id.includes("dome")||t.id.includes("cone"))&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Segments"}),i.jsx("input",{type:"range",min:"6",max:"32",step:"1",value:s.segments||16,onChange:E=>_("segments",parseInt(E.target.value)),className:"w-full"}),i.jsx("div",{className:"text-right text-sm text-gray-400",children:s.segments||16})]})]}),i.jsxs("div",{className:"mt-6 flex gap-3",children:[i.jsx("button",{onClick:j,disabled:!r.trim()||l,className:`flex-1 px-4 py-2 bg-gradient-to-r from-purple-500 to-blue-500 
                         text-white font-medium rounded-lg hover:from-purple-600 hover:to-blue-600 
                         transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed
                         shadow-lg hover:shadow-purple-500/25`,children:l?"Saving...":"Save Custom Shape"}),i.jsx("button",{onClick:()=>{e(ln[0]),n(ln[0].defaultParams),o(""),c("")},className:`px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg
                         transition-colors duration-200`,children:"Reset"})]}),h&&i.jsx("div",{className:`mt-3 p-3 rounded-lg text-sm ${h.includes("Error")?"bg-red-900/30 border border-red-700/30 text-red-200":"bg-green-900/30 border border-green-700/30 text-green-200"}`,children:h}),i.jsxs("div",{className:"mt-6 p-4 bg-gray-800/30 rounded-lg border border-gray-700/30",children:[i.jsx("h4",{className:"text-sm font-medium mb-2 text-purple-200",children:"Shape Statistics"}),i.jsxs("div",{className:"space-y-1 text-xs text-gray-400",children:[i.jsxs("div",{children:["Volume: ~",(s.width*s.height*s.depth).toFixed(1)," m"]}),i.jsxs("div",{children:["Type: ",t.type]}),i.jsxs("div",{children:["Category: ",t.category]}),i.jsxs("div",{children:["Material: ",s.materialType||"solid"]}),s.hasWalls&&i.jsxs("div",{children:["Walls: ",s.wallThickness?.toFixed(2),"m thick"]}),s.wireframe&&i.jsxs("div",{children:["Frame: ",s.frameWidth?.toFixed(2),"m beams"]})]})]})]}),i.jsxs("div",{className:"flex-1 flex flex-col",children:[i.jsxs("div",{className:"p-4 border-b border-purple-500/20",children:[i.jsx("h3",{className:"text-lg font-semibold text-purple-200",children:"3D Preview"}),i.jsx("p",{className:"text-sm text-gray-400",children:"Interactive preview of your custom shape"})]}),i.jsx("div",{className:"flex-1 flex items-center justify-center p-8",children:i.jsxs("div",{className:"bg-black/30 rounded-xl p-6 border border-purple-500/20",children:[i.jsx("div",{ref:f,className:"rounded-lg overflow-hidden border border-gray-600"}),i.jsxs("div",{className:"mt-4 flex justify-center gap-2",children:[i.jsxs("button",{onClick:()=>y(),className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded flex items-center gap-2 text-sm transition-colors",children:[i.jsx(ra,{className:"w-4 h-4"}),"Refresh"]}),i.jsxs("button",{className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded flex items-center gap-2 text-sm transition-colors",children:[i.jsx(gd,{className:"w-4 h-4"}),"Reset View"]})]})]})})]})]})]})]})}const _o=[{id:"box",name:"Cube",type:"box",icon:i.jsx(Jt,{className:"w-5 h-5"}),category:"basic",description:"Basic cubic shape",defaultParams:{width:2,height:2,depth:2,materialType:"solid",transparency:1}},{id:"cylinder",name:"Cylinder",type:"cylinder",icon:i.jsx(ud,{className:"w-5 h-5"}),category:"basic",description:"Cylindrical shape",defaultParams:{width:2,height:3,depth:2,radius:1,segments:16,materialType:"solid",transparency:1}},{id:"sphere",name:"Sphere",type:"sphere",icon:i.jsx(xs,{className:"w-5 h-5"}),category:"basic",description:"Spherical shape",defaultParams:{width:2,height:2,depth:2,radius:1,segments:16,materialType:"solid",transparency:1}},{id:"cone",name:"Cone",type:"cone",icon:i.jsx("div",{className:"w-5 h-5 triangle-up"}),category:"basic",description:"Conical shape",defaultParams:{width:2,height:3,depth:2,radius:1,segments:16,materialType:"solid",transparency:1}},{id:"torus",name:"Torus",type:"torus",icon:i.jsx(xs,{className:"w-5 h-5"}),category:"basic",description:"Ring/donut shape",defaultParams:{width:2,height:.5,depth:2,radius:1,segments:16,materialType:"solid",transparency:1}},{id:"plane",name:"Plane",type:"plane",icon:i.jsx(Kt,{className:"w-5 h-5"}),category:"basic",description:"Flat plane surface",defaultParams:{width:3,height:.1,depth:3,materialType:"solid",transparency:1}},{id:"structural-beam",name:"Support Beam",type:"box",icon:i.jsx(Kt,{className:"w-5 h-5 rotate-45"}),category:"structural",description:"Structural support beam",defaultParams:{width:.2,height:3,depth:.2,materialType:"metal",transparency:1}},{id:"connector-node",name:"Connector Node",type:"sphere",icon:i.jsx(xs,{className:"w-5 h-5"}),category:"connector",description:"Connection point between modules",defaultParams:{width:.5,height:.5,depth:.5,radius:.25,segments:8,materialType:"metal",transparency:1}},{id:"frame-structure",name:"Frame Structure",type:"wireframe",icon:i.jsx(na,{className:"w-5 h-5"}),category:"structural",description:"Wireframe structural element",defaultParams:{width:2,height:2,depth:2,frameWidth:.1,frameSpacing:.5,materialType:"wireframe",transparency:1}}],zx=[{id:"layer-1",name:"Main Structure",visible:!0,locked:!1,color:"#8B5CF6",shapes:[]},{id:"layer-2",name:"Support Elements",visible:!0,locked:!1,color:"#06B6D4",shapes:[]},{id:"layer-3",name:"Connectors",visible:!0,locked:!1,color:"#EF4444",shapes:[]}],Ux=({onBackToDesign:t,onSaveDesign:e})=>{const[s,n]=g.useState(new Map),[r,o]=g.useState(zx),[a,c]=g.useState(new Set),[l,d]=g.useState("layer-1"),[h,u]=g.useState("create"),[f,m]=g.useState(_o[0]),[p,x]=g.useState(_o[0].defaultParams),[b,S]=g.useState(!0),[y,w]=g.useState(!0),[v,C]=g.useState("shapes"),[T,_]=g.useState("Untitled Project"),[N,j]=g.useState(!1),[F,E]=g.useState(null),P=g.useRef(null),B=g.useRef(null),k=g.useRef(null),D=g.useRef(null),U=g.useRef(null),Y=g.useRef(null),O=g.useRef(new wn),G=g.useRef(new ve),ce=()=>`shape_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;g.useEffect(()=>{if(!P.current)return;const R=new zr;R.background=new ze(1710638),B.current=R;const A=30,L=P.current.clientWidth/P.current.clientHeight,M=new Li(-A*L/2,A*L/2,A/2,-A/2,.1,1e3);M.position.set(15,15,15),M.lookAt(0,0,0),D.current=M;const V=new Br({antialias:!0});V.setSize(P.current.clientWidth,P.current.clientHeight),V.shadowMap.enabled=!0,V.shadowMap.type=Hr,k.current=V,P.current.appendChild(V.domElement);const se=new $r(16777215,.8);R.add(se);const ee=new Vs(16777215,1);ee.position.set(10,10,5),ee.castShadow=!0,ee.shadow.mapSize.width=2048,ee.shadow.mapSize.height=2048,R.add(ee);const J=new Vs(16777215,.5);if(J.position.set(-10,10,-5),R.add(J),b){const H=new Ai(20,20,9133302,3355443);R.add(H)}const he=new ge(1,1,1),me=new fs({color:16711680}),_e=new ke(he,me);_e.position.set(0,.5,0),_e.castShadow=!0,_e.receiveShadow=!0,R.add(_e),console.log("Added test cube at origin");let Le=!1,Ee=0,mt=0,De=A;const Be=new wn;O.current=Be,G.current=new ve,Y.current={camera:M,scene:R,renderer:V,raycaster:O.current,mouse:G.current};let de=!1,be=new $,Me=new $,tt=!1,Oe=null;const On=H=>{if(h==="pan")Le=!0,Ee=H.clientX,mt=H.clientY;else if(h==="create"){const W=V.domElement.getBoundingClientRect();G.current.x=(H.clientX-W.left)/W.width*2-1,G.current.y=-((H.clientY-W.top)/W.height)*2+1,Be.setFromCamera(G.current,M);const K=new Is(new $(0,1,0),0),ie=new $;Be.ray.intersectPlane(K,ie),ie&&(tt=!0,be.copy(ie),Oe=X(f,{...p,width:.5,height:.5,depth:.5}),Oe.position.copy(ie),f.type==="plane"?Oe.position.y=.01:Oe.position.y=(p.height||1)/2,Oe.traverse(q=>{if(q instanceof ke&&q.material){const oe=q.material;oe.transparent=!0,oe.opacity=.5}}),R.add(Oe),console.log("Started creating shape at:",ie))}else if(h==="select"||h==="move"){const W=V.domElement.getBoundingClientRect();G.current.x=(H.clientX-W.left)/W.width*2-1,G.current.y=-((H.clientY-W.top)/W.height)*2+1,Be.setFromCamera(G.current,M);const K=Be.intersectObjects(R.children,!0);if(K.length>0){let q=K[0].object.parent;for(;q&&!q.userData.cadShapeId;)q=q.parent;if(q&&q.userData.cadShapeId){const oe=q.userData.cadShapeId,Re=s.get(oe);if(Re&&!Re.locked)if(H.ctrlKey||H.metaKey){const Ut=new Set(a);Ut.has(oe)?Ut.delete(oe):Ut.add(oe),c(Ut)}else c(new Set([oe])),h==="move"&&(de=!0,be.copy(K[0].point),Me.copy(q.position))}}else!H.ctrlKey&&!H.metaKey&&c(new Set)}},Dn=H=>{if(Le&&h==="pan"){const W=H.clientX-Ee,K=H.clientY-mt,ie=.05;M.position.x-=W*ie,M.position.z-=K*ie,M.lookAt(M.position.x-10,0,M.position.z-10),Ee=H.clientX,mt=H.clientY}else if(tt&&Oe&&h==="create"){const W=V.domElement.getBoundingClientRect();G.current.x=(H.clientX-W.left)/W.width*2-1,G.current.y=-((H.clientY-W.top)/W.height)*2+1,Be.setFromCamera(G.current,M);const K=new Is(new $(0,1,0),0),ie=new $;if(Be.ray.intersectPlane(K,ie),ie){const q=be.distanceTo(ie),oe=Math.max(.5,q*2);Oe.scale.set(oe/p.width,oe/p.height,oe/p.depth),console.log("Updating shape size:",oe)}}else if(de&&h==="move"&&a.size>0){const W=V.domElement.getBoundingClientRect();G.current.x=(H.clientX-W.left)/W.width*2-1,G.current.y=-((H.clientY-W.top)/W.height)*2+1,Be.setFromCamera(G.current,M);const K=new Is(new $(0,1,0),0),ie=new $;if(Be.ray.intersectPlane(K,ie),ie){const q=ie.sub(be);a.forEach(oe=>{const Re=s.get(oe);Re&&Re.mesh&&!Re.locked&&Re.mesh.position.copy(Me.clone().add(q))})}}},In=()=>{if(tt&&Oe){const H=Math.max(Oe.scale.x,.5),W={...p,width:p.width*H,height:p.height*H,depth:p.depth*H};R.remove(Oe);const K=ce(),ie=X(f,W);ie.position.copy(Oe.position);const q={id:K,name:`${f.name} ${s.size+1}`,type:f.type,geometry:ie.children[0]?ie.children[0].geometry:null,material:ie.children[0]?ie.children[0].material:null,position:ie.position.clone(),rotation:ie.rotation.clone(),scale:ie.scale.clone(),visible:!0,locked:!1,parameters:W,layer:l,mesh:ie};R.add(ie),ie.userData={cadShapeId:K},n(oe=>new Map(oe.set(K,q))),o(oe=>oe.map(Re=>Re.id===l?{...Re,shapes:[...Re.shapes,K]}:Re)),console.log("Shape created with final size:",H,"at position:",ie.position),tt=!1,Oe=null}Le=!1,de=!1},He=H=>{const W=H.deltaY>0?1.1:.9;De=Math.max(5,Math.min(50,De*W));const K=P.current?.clientWidth/P.current?.clientHeight;M.left=-De*K/2,M.right=De*K/2,M.top=De/2,M.bottom=-De/2,M.updateProjectionMatrix()};V.domElement.addEventListener("mousedown",On),V.domElement.addEventListener("mousemove",Dn),V.domElement.addEventListener("mouseup",In),V.domElement.addEventListener("wheel",He);const I=()=>{U.current=requestAnimationFrame(I),V.render(R,M)};I();const z=()=>{if(P.current){const H=P.current.clientWidth/P.current.clientHeight;M.left=-De*H/2,M.right=De*H/2,M.top=De/2,M.bottom=-De/2,M.updateProjectionMatrix(),V.setSize(P.current.clientWidth,P.current.clientHeight)}};return window.addEventListener("resize",z),()=>{U.current&&cancelAnimationFrame(U.current),P.current&&V.domElement&&P.current.removeChild(V.domElement),V.domElement.removeEventListener("mousedown",On),V.domElement.removeEventListener("mousemove",Dn),V.domElement.removeEventListener("mouseup",In),V.domElement.removeEventListener("wheel",He),window.removeEventListener("resize",z),V.dispose()}},[b,h]);const X=g.useCallback((R,A)=>{console.log("Creating shape with preset:",R.type,R.name,A);const L=new wt;let M;switch(R.type){case"box":console.log("Creating box geometry"),M=new ge(A.width,A.height,A.depth);break;case"cylinder":console.log("Creating cylinder geometry"),M=new Lt(A.radius||A.width/2,A.radius||A.width/2,A.height,A.segments||32);break;case"sphere":console.log("Creating sphere geometry"),M=new Vr(A.radius||A.width/2,A.segments||32,A.segments||16);break;case"cone":console.log("Creating cone geometry"),M=new xl(A.radius||A.width/2,A.height,A.segments||32);break;case"torus":console.log("Creating torus geometry"),M=new pl(A.radius||A.width/2,(A.radius||A.width/2)*.3,A.segments||16,(A.segments||16)*2);break;case"plane":console.log("Creating plane geometry"),M=new gl(A.width,A.depth),M.rotateX(-Math.PI/2);break;case"wireframe":console.log("Creating wireframe geometry"),M=new ge(A.width,A.height,A.depth);break;default:console.log("Creating default box geometry for type:",R.type),M=new ge(A.width,A.height,A.depth)}const se=(()=>{const J={transparent:(A.transparency||1)<1,opacity:A.transparency||1,wireframe:A.materialType==="wireframe"};switch(A.materialType){case"glass":return new ct({...J,color:8965375,transmission:.9,roughness:.1,metalness:0,clearcoat:1,clearcoatRoughness:.1});case"metal":return new fs({...J,color:10066329,metalness:.8,roughness:.2});case"wireframe":return new qt({color:9133302,wireframe:!0});default:return new fs({...J,color:R.type==="cylinder"?4906624:R.type==="sphere"?16096779:R.type==="cone"?15680580:R.type==="torus"?440020:R.type==="plane"?1096065:9133302,metalness:.1,roughness:.4})}})(),ee=new ke(M,se);if(ee.castShadow=!0,ee.receiveShadow=!0,console.log(`Creating shape: ${R.type}`,{geometry:M.type,bounds:M.boundingBox,material:se.type,params:A}),M.computeBoundingBox(),M.computeBoundingSphere(),L.add(ee),A.hasWalls&&A.wallThickness){const J=new ge(A.width+A.wallThickness*2,A.wallHeight||A.height,A.depth+A.wallThickness*2),he=new fs({color:6710886,transparent:!0,opacity:.7}),me=new ke(J,he);me.castShadow=!0,me.receiveShadow=!0,L.add(me)}if(R.type==="wireframe"){const J=new Ch(M),he=new Oi({color:9133302,linewidth:A.frameWidth||2}),me=new Di(J,he);L.add(me)}return L},[]),ye=()=>{B.current&&a.forEach(L=>{const M=s.get(L);M&&!M.locked&&M.mesh&&B.current.remove(M.mesh)});const R=new Map(s),A=Array.from(a).filter(L=>{const M=s.get(L);return M&&!M.locked});A.forEach(L=>R.delete(L)),n(R),o(L=>L.map(M=>({...M,shapes:M.shapes.filter(V=>!A.includes(V))}))),c(new Set)};g.useEffect(()=>{const R=A=>{switch(A.key==="Delete"||A.key==="Backspace"?a.size>0&&ye():A.key==="Escape"?(c(new Set),pe()):A.key==="a"&&(A.ctrlKey||A.metaKey)?(A.preventDefault(),c(new Set(s.keys())),pe()):A.key==="s"&&(A.ctrlKey||A.metaKey)&&(A.preventDefault(),ne()),A.key){case"c":u("create");break;case"v":u("select");break;case"m":u("move");break;case"r":u("rotate");break;case"s":!A.ctrlKey&&!A.metaKey&&u("scale");break;case"h":u("pan");break}};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[a,s]),g.useEffect(()=>{pe()},[a]);const ne=async()=>{if(T.trim()){j(!0),E(null);try{let R=1/0,A=-1/0,L=1/0,M=-1/0,V=1/0,se=-1/0;s.forEach(J=>{const he=J.position,me=J.parameters;R=Math.min(R,he.x-me.width/2),A=Math.max(A,he.x+me.width/2),L=Math.min(L,he.y-me.height/2),M=Math.max(M,he.y+me.height/2),V=Math.min(V,he.z-me.depth/2),se=Math.max(se,he.z+me.depth/2)});const ee={name:T.trim(),description:`CAD Assembly with ${s.size} components`,geometryType:"assembly",parameters:{width:A-R||5,height:M-L||5,depth:se-V||5,components:s.size},category:"custom"};if(await Sd(ee),E("Project saved successfully! Available in Collections for drag-and-drop."),e){const J=Array.from(s.values());e({name:T.trim(),shapes:J,bounds:{width:A-R||5,height:M-L||5,depth:se-V||5}})}setTimeout(()=>E(null),3e3)}catch(R){console.error("Error saving project:",R),E("Error saving project. Please try again.")}finally{j(!1)}}},ue=R=>{if(h!=="select"||!B.current||!D.current||!P.current)return;const A=P.current.getBoundingClientRect(),L=new ve((R.clientX-A.left)/A.width*2-1,-((R.clientY-A.top)/A.height)*2+1),M=new wn;M.setFromCamera(L,D.current);const V=M.intersectObjects(B.current.children,!0);if(V.length>0){let ee=V[0].object.parent;for(;ee&&!ee.userData.cadShapeId;)ee=ee.parent;if(ee&&ee.userData.cadShapeId){const J=ee.userData.cadShapeId,he=s.get(J);if(he&&!he.locked){if(R.ctrlKey||R.metaKey){const me=new Set(a);me.has(J)?me.delete(J):me.add(J),c(me)}else c(new Set([J]));pe()}}}else!R.ctrlKey&&!R.metaKey&&(c(new Set),pe())},pe=()=>{B.current&&s.forEach((R,A)=>{if(R.mesh){const L=a.has(A);R.mesh.children.forEach(M=>{M instanceof ke&&(L?(M.material=M.material.clone(),M.material.emissive=new ze(4473924)):M.material.emissive=new ze(0))})}})},fe=R=>{if(a.size<2){E("Select at least 2 shapes for boolean operations"),setTimeout(()=>E(null),2e3);return}E(`${R} operation would be performed on ${a.size} shapes`),setTimeout(()=>E(null),2e3)};return i.jsxs("div",{className:"flex flex-col h-screen bg-gradient-to-br from-gray-900 via-purple-900/20 to-black text-white",children:[i.jsxs("div",{className:"h-14 bg-black/20 border-b border-purple-500/30 flex items-center px-4 gap-4",children:[i.jsx("div",{className:"flex items-center gap-2 border-r border-gray-600 pr-4",children:i.jsxs("button",{onClick:t,className:"p-2 bg-gray-700 hover:bg-gray-600 rounded transition-colors flex items-center gap-2",title:"Back to Main Design",children:[i.jsx(og,{className:"w-4 h-4"}),i.jsx("span",{className:"text-sm",children:"Back to Design"})]})}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsx("input",{type:"text",value:T,onChange:R=>_(R.target.value),className:"bg-gray-800/50 border border-gray-600 rounded px-3 py-1 text-sm w-48",placeholder:"Project name..."})}),i.jsx("div",{className:"flex items-center gap-2 border-l border-gray-600 pl-4",children:[{tool:"create",icon:ut,label:"Create - Click & Drag on Canvas"},{tool:"select",icon:Qg,label:"Select"},{tool:"move",icon:pd,label:"Move"},{tool:"rotate",icon:ux,label:"Rotate"},{tool:"scale",icon:mx,label:"Scale"}].map(({tool:R,icon:A,label:L})=>i.jsx("button",{onClick:()=>u(R),className:`p-2 rounded transition-colors ${h===R?"bg-purple-500 text-white":"bg-gray-700 hover:bg-gray-600"}`,title:L,children:i.jsx(A,{className:"w-4 h-4"})},R))}),i.jsxs("div",{className:"flex items-center gap-2 border-l border-gray-600 pl-4",children:[i.jsx("button",{onClick:()=>fe("union"),className:"p-2 bg-gray-700 hover:bg-gray-600 rounded transition-colors",title:"Union",children:i.jsx(ut,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>fe("subtract"),className:"p-2 bg-gray-700 hover:bg-gray-600 rounded transition-colors",title:"Subtract",children:i.jsx(Kt,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>fe("intersect"),className:"p-2 bg-gray-700 hover:bg-gray-600 rounded transition-colors",title:"Intersect",children:i.jsx(xs,{className:"w-4 h-4"})})]}),i.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[i.jsx("button",{onClick:ye,disabled:a.size===0,className:"p-2 bg-red-600 hover:bg-red-700 rounded transition-colors disabled:opacity-50",title:"Delete Selected",children:i.jsx(vs,{className:"w-4 h-4"})}),i.jsx("button",{onClick:ne,disabled:N||s.size===0,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded transition-colors disabled:opacity-50",children:N?"Saving...":"Save Project"})]})]}),i.jsxs("div",{className:"flex flex-1",children:[i.jsxs("div",{className:"w-48 bg-black/10 border-r border-purple-500/20 flex flex-col",children:[i.jsx("div",{className:"flex border-b border-gray-600",children:[{mode:"shapes",icon:Jt,label:"Shapes"},{mode:"layers",icon:fd,label:"Layers"},{mode:"properties",icon:hs,label:"Properties"},{mode:"materials",icon:ex,label:"Materials"}].map(({mode:R,icon:A,label:L})=>i.jsxs("button",{onClick:()=>C(R),className:`flex-1 p-3 text-sm transition-colors ${v===R?"bg-purple-500/20 text-purple-200 border-b-2 border-purple-500":"hover:bg-gray-800/50"}`,children:[i.jsx(A,{className:"w-4 h-4 mx-auto mb-1"}),i.jsx("div",{children:L})]},R))}),i.jsxs("div",{className:"flex-1 p-4 overflow-y-auto",children:[v==="shapes"&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-4 text-purple-200",children:"Shape Library"}),Object.entries(_o.reduce((R,A)=>(R[A.category]||(R[A.category]=[]),R[A.category].push(A),R),{})).map(([R,A])=>i.jsxs("div",{className:"mb-6",children:[i.jsxs("h4",{className:"text-sm font-medium mb-3 text-gray-300 capitalize",children:[R," Shapes"]}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:A.map(L=>i.jsx("button",{onClick:()=>{console.log("Selected preset:",L.type,L.name),m(L),x(L.defaultParams)},className:`p-3 rounded-lg border transition-all ${f.id===L.id?"border-purple-500 bg-purple-500/20 text-purple-200":"border-gray-600 bg-gray-800/30 hover:border-purple-400 hover:bg-gray-700/50"}`,children:i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[L.icon,i.jsx("span",{className:"text-xs text-center",children:L.name})]})},L.id))})]},R)),f&&i.jsxs("div",{className:"border-t border-gray-600 pt-4 mt-4",children:[i.jsx("h4",{className:"text-sm font-medium mb-3 text-purple-200",children:"Shape Parameters"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium mb-1",children:"Width"}),i.jsx("input",{type:"range",min:"0.1",max:"10",step:"0.1",value:p.width,onChange:R=>x(A=>({...A,width:parseFloat(R.target.value)})),className:"w-full"}),i.jsxs("div",{className:"text-xs text-gray-400",children:[p.width.toFixed(1),"m"]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium mb-1",children:"Height"}),i.jsx("input",{type:"range",min:"0.1",max:"10",step:"0.1",value:p.height,onChange:R=>x(A=>({...A,height:parseFloat(R.target.value)})),className:"w-full"}),i.jsxs("div",{className:"text-xs text-gray-400",children:[p.height.toFixed(1),"m"]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium mb-1",children:"Depth"}),i.jsx("input",{type:"range",min:"0.1",max:"10",step:"0.1",value:p.depth,onChange:R=>x(A=>({...A,depth:parseFloat(R.target.value)})),className:"w-full"}),i.jsxs("div",{className:"text-xs text-gray-400",children:[p.depth.toFixed(1),"m"]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium mb-1",children:"Material"}),i.jsxs("select",{value:p.materialType||"solid",onChange:R=>x(A=>({...A,materialType:R.target.value})),className:"w-full px-2 py-1 bg-gray-800/50 border border-gray-600 rounded text-xs",children:[i.jsx("option",{value:"solid",children:"Solid"}),i.jsx("option",{value:"wireframe",children:"Wireframe"}),i.jsx("option",{value:"glass",children:"Glass"}),i.jsx("option",{value:"metal",children:"Metal"})]})]})]})]}),i.jsxs("div",{className:`w-full mt-4 p-3 bg-gradient-to-r from-green-600/20 to-blue-600/20 
                             border border-green-500/30 text-green-200 font-medium rounded-lg`,children:[i.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[i.jsx(ut,{className:"w-4 h-4"}),i.jsx("span",{children:"Interactive Creation Mode"})]}),i.jsx("div",{className:"text-xs text-center text-gray-300",children:"Switch to CREATE tool above, then click & drag on the canvas to place and size shapes"})]})]}),v==="layers"&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-4 text-purple-200",children:"Layers"}),r.map(R=>i.jsx("div",{className:`mb-2 p-3 rounded-lg border transition-colors cursor-pointer ${l===R.id?"border-purple-500 bg-purple-500/20":"border-gray-600 bg-gray-800/30 hover:bg-gray-700/50"}`,onClick:()=>d(R.id),children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:R.color}}),i.jsx("span",{className:"text-sm font-medium",children:R.name}),i.jsxs("span",{className:"text-xs text-gray-400",children:["(",R.shapes.length,")"]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onClick:A=>{A.stopPropagation(),o(L=>L.map(M=>M.id===R.id?{...M,visible:!M.visible}:M))},className:"p-1 hover:bg-gray-600 rounded",children:R.visible?i.jsx(sa,{className:"w-3 h-3"}):i.jsx(jg,{className:"w-3 h-3"})}),i.jsx("button",{onClick:A=>{A.stopPropagation(),o(L=>L.map(M=>M.id===R.id?{...M,locked:!M.locked}:M))},className:"p-1 hover:bg-gray-600 rounded",children:R.locked?i.jsx(Kg,{className:"w-3 h-3"}):i.jsx(Wg,{className:"w-3 h-3"})})]})]})},R.id))]}),v==="properties"&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-4 text-purple-200",children:"Properties"}),a.size>0?i.jsxs("div",{children:[i.jsxs("p",{className:"text-sm text-gray-400 mb-4",children:[a.size," shape(s) selected"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Position X"}),i.jsx("input",{type:"number",step:"0.1",className:"w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white",placeholder:"0.0"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Position Y"}),i.jsx("input",{type:"number",step:"0.1",className:"w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white",placeholder:"0.0"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Position Z"}),i.jsx("input",{type:"number",step:"0.1",className:"w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white",placeholder:"0.0"})]})]})]}):i.jsx("p",{className:"text-sm text-gray-400",children:"Select shapes to edit properties"})]}),v==="materials"&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-4 text-purple-200",children:"Material Editor"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Material Type"}),i.jsxs("select",{value:p.materialType||"solid",onChange:R=>x(A=>({...A,materialType:R.target.value})),className:"w-full px-3 py-2 bg-gray-800/50 border border-gray-600 rounded-lg text-white",children:[i.jsx("option",{value:"solid",children:"Solid"}),i.jsx("option",{value:"wireframe",children:"Wireframe"}),i.jsx("option",{value:"glass",children:"Glass"}),i.jsx("option",{value:"metal",children:"Metal"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Transparency"}),i.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.1",value:p.transparency||1,onChange:R=>x(A=>({...A,transparency:parseFloat(R.target.value)})),className:"w-full"}),i.jsxs("div",{className:"text-right text-sm text-gray-400",children:[((p.transparency||1)*100).toFixed(0),"%"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",id:"hasWalls",checked:p.hasWalls||!1,onChange:R=>x(A=>({...A,hasWalls:R.target.checked})),className:"rounded"}),i.jsx("label",{htmlFor:"hasWalls",className:"text-sm font-medium",children:"Add Walls"})]}),p.hasWalls&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"Wall Thickness"}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.05",value:p.wallThickness||.2,onChange:R=>x(A=>({...A,wallThickness:parseFloat(R.target.value)})),className:"w-full"}),i.jsxs("div",{className:"text-right text-sm text-gray-400",children:[(p.wallThickness||.2).toFixed(2),"m"]})]})]})]})]})]}),i.jsxs("div",{className:"flex-1 relative",children:[i.jsx("div",{ref:P,className:"w-full h-full cursor-crosshair",onClick:ue}),i.jsxs("div",{className:"absolute top-4 right-4 flex flex-col gap-2",children:[i.jsx("button",{onClick:()=>S(!b),className:`p-2 rounded transition-colors ${b?"bg-purple-500":"bg-gray-700 hover:bg-gray-600"}`,title:"Toggle Grid",children:i.jsx(na,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>w(!y),className:`p-2 rounded transition-colors ${y?"bg-purple-500":"bg-gray-700 hover:bg-gray-600"}`,title:"Snap to Grid",children:i.jsx(Rx,{className:"w-4 h-4"})})]}),i.jsx("div",{className:"absolute bottom-4 left-4 bg-black/50 backdrop-blur-sm rounded-lg p-3",children:i.jsxs("div",{className:"text-sm space-y-1",children:[i.jsxs("div",{children:["Shapes: ",s.size]}),i.jsxs("div",{children:["Selected: ",a.size]}),i.jsxs("div",{className:"text-purple-300",children:["Tool: ",h]}),i.jsxs("div",{children:["Layer: ",r.find(R=>R.id===l)?.name]}),i.jsxs("div",{className:"text-xs text-yellow-300 mt-2",children:[h==="create"&&"Click & drag on canvas to create shapes",h==="select"&&"Click shapes to select them",h==="move"&&"Drag selected shapes to move them",h==="pan"&&"Drag to orbit around the scene"]}),i.jsx("div",{className:"text-xs text-gray-400",children:"Isometric View  Wheel: Zoom  Pan: Drag to move view"}),i.jsx("div",{className:"text-xs text-gray-400",children:"Keys: C=Create, V=Select, M=Move, R=Rotate, S=Scale, H=Pan"})]})}),F&&i.jsx("div",{className:`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 
                          bg-black/80 backdrop-blur-sm rounded-lg p-4 max-w-md text-center`,children:i.jsx("div",{className:`text-sm ${F.includes("Error")?"text-red-200":"text-green-200"}`,children:F})})]})]})]})},we=g.forwardRef(({className:t,variant:e="default",...s},n)=>i.jsx("div",{className:Ne("inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset",{"bg-muted text-text ring-muted":e==="default"||e==="neutral","status-green ring-success/30":e==="success","status-amber ring-warning/30":e==="warning","status-red ring-danger/30":e==="danger"||e==="destructive","bg-secondary text-secondary-foreground ring-secondary":e==="secondary","border border-primary text-primary bg-transparent ring-primary/30":e==="outline"},t),ref:n,...s}));we.displayName="Badge";const qn=({label:t,value:e,unit:s,status:n,icon:r})=>i.jsx(Fe,{className:"glass",children:i.jsxs(qe,{className:"flex items-center gap-3 p-4",children:[r&&i.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-md bg-muted",children:r}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:t}),i.jsxs("div",{className:"flex items-baseline gap-2 mt-1",children:[i.jsx("p",{className:"text-2xl font-bold text-text",children:e}),s&&i.jsx("p",{className:"text-sm text-muted-foreground",children:s}),n&&i.jsxs(we,{variant:n,className:"ml-auto",children:[n==="success"&&"",n==="warning"&&"!",n==="danger"&&""]})]})]})]})}),_d=({nhv:t=0,pressurizedVolume:e=0,utilization:s=0,corridorStatus:n="success"})=>{const r=a=>a>85?"danger":a>70?"warning":"success",o=a=>a<50?"danger":a<100?"warning":"success";return i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[i.jsx(qn,{label:"Net Habitable Volume",value:t.toFixed(1),unit:"m",status:o(t),icon:i.jsx("div",{className:"text-primary",children:""})}),i.jsx(qn,{label:"Pressurized Volume",value:e.toFixed(1),unit:"m",icon:i.jsx("div",{className:"text-primary",children:""})}),i.jsx(qn,{label:"Utilization",value:s.toFixed(1),unit:"%",status:r(s),icon:i.jsx("div",{className:"text-primary",children:""})}),i.jsx(qn,{label:"Corridor Status",value:n==="success"?"OK":n==="warning"?"CHECK":"BLOCKED",status:n,icon:i.jsx("div",{className:"text-primary",children:""})})]})};function Bx({valid:t}){return t==="info"?i.jsxs(we,{variant:"outline",className:"gap-1",children:[i.jsx(hd,{className:"h-3.5 w-3.5"})," INFO"]}):t?i.jsxs(we,{className:"gap-1 bg-[var(--brand)] hover:bg-[var(--brand-2)]",children:[i.jsx(vg,{className:"h-3.5 w-3.5"})," PASS"]}):i.jsxs(we,{variant:"destructive",className:"gap-1",children:[i.jsx(Sg,{className:"h-3.5 w-3.5"})," FAIL"]})}const Nd=g.memo(function({data:e,results:s,onApply:n,isLoading:r=!1,showPayload:o=!1,payloadData:a}){const c=s||e;if(console.log(" AnalysisResults received data:",c),r)return i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mx-auto mb-4"}),i.jsx("p",{className:"text-gray-400",children:"Analyzing habitat with NASA..."})]})});if(!c)return i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsxs("div",{className:"text-center",children:[i.jsx(Sx,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-gray-300 mb-2",children:"No Analysis Data"}),i.jsx("p",{className:"text-gray-500",children:"Submit a payload to see NASA habitat validation results."})]})});let l=c.rawResults||c.results||[];const d=c.suggestions||[];c.issues&&!l.length&&(l=c.issues.map(m=>({rule:m.rule||m.id,valid:m.severity!=="error",explanation:m.message})));const h=l.filter(m=>m.valid).length,u=l.length,f=u>0?(h/u*100).toFixed(1):0;return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsxs("div",{className:"bg-[var(--surface-1)] border border-[var(--border-weak)] rounded-xl p-4 text-center backdrop-blur shadow-[var(--glow)]",children:[i.jsx("div",{className:"text-2xl font-bold text-green-400",children:h}),i.jsx("div",{className:"text-sm text-green-300/80",children:"Rules Passed"})]}),i.jsxs("div",{className:"bg-[var(--surface-1)] border border-[var(--border-weak)] rounded-xl p-4 text-center backdrop-blur shadow-[var(--glow)]",children:[i.jsx("div",{className:"text-2xl font-bold text-[var(--accent)]",children:u-h}),i.jsx("div",{className:"text-sm text-red-300/80",children:"Rules Failed"})]}),i.jsxs("div",{className:"bg-[var(--surface-1)] border border-[var(--border-weak)] rounded-xl p-4 text-center backdrop-blur shadow-[var(--glow)]",children:[i.jsxs("div",{className:"text-2xl font-bold text-[var(--brand-2)]",children:[f,"%"]}),i.jsx("div",{className:"text-sm text-blue-300/80",children:"Success Rate"})]})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(cc,{className:"w-5 h-5 text-[var(--brand-2)]"}),i.jsx("h3",{className:"text-lg font-semibold text-[var(--brand-2)]",children:"Validation Rules"}),i.jsxs(we,{variant:"outline",className:"text-[var(--brand)] border-[var(--brand)]/30 bg-[var(--brand)]/10",children:[u," Total"]})]}),i.jsxs("div",{className:"space-y-3",children:[l.length===0&&i.jsx("div",{className:"text-center py-8 text-gray-400",children:"No validation rules returned."}),l.map((m,p)=>i.jsx("div",{className:"p-4 rounded-xl border bg-[var(--surface-1)] border-[var(--border-weak)] backdrop-blur shadow-[var(--glow)]",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Bx,{valid:m.valid}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"flex items-center gap-2 mb-1",children:i.jsx("code",{className:"font-mono text-xs bg-black/20 px-2 py-1 rounded text-gray-300 border border-white/10",children:m.rule})}),i.jsx("p",{className:`text-sm ${m.valid?"text-green-200/90":"text-red-200/90"}`,children:m.explanation})]})]})},p))]})]}),d.length>0&&i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(Rn,{className:"w-5 h-5 text-amber-400"}),i.jsx("h3",{className:"text-lg font-semibold text-amber-200",children:"Improvement Suggestions"}),i.jsxs(we,{variant:"outline",className:"text-amber-400 border-amber-400/30 bg-amber-400/10",children:[d.length," Items"]})]}),i.jsx("div",{className:"space-y-2",children:d.map((m,p)=>i.jsx("div",{className:"bg-[var(--surface-1)] border border-[var(--border-weak)] rounded-xl p-3 backdrop-blur shadow-[var(--glow)]",children:i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx(Rn,{className:"w-4 h-4 text-amber-400 flex-shrink-0 mt-1"}),i.jsx("div",{className:"flex-1",children:i.jsx("p",{className:"text-amber-100/90 text-sm",children:m})}),n&&i.jsx(re,{size:"sm",variant:"outline",onClick:()=>n(m),className:"border-[var(--brand)]/30 text-[var(--brand)] hover:bg-[var(--brand)]/10",children:"Apply"})]})},p))})]}),o&&a&&i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(cc,{className:"w-5 h-5 text-purple-400"}),i.jsx("h3",{className:"text-lg font-semibold text-purple-200",children:"NASA Layout Payload"}),i.jsx(we,{variant:"outline",className:"text-purple-400 border-purple-400",children:"JSON Schema"})]}),i.jsx("div",{className:"bg-gray-900/60 border border-purple-500/30 rounded-lg p-4 backdrop-blur-sm",children:i.jsx("pre",{className:"text-xs text-gray-300 overflow-x-auto max-h-64",children:JSON.stringify(a,null,2)})})]})]})}),yn={CREW_SLEEP:{color:"#3b82f6",icon:"",size:{width:2,height:2.1,depth:2.2},geometry:"sleep_pod"},HYGIENE:{color:"#10b981",icon:"",size:{width:2,height:2.2,depth:2},geometry:"cylinder"},WASTE:{color:"#f59e0b",icon:"",size:{width:1.8,height:2.2,depth:1.8},geometry:"rounded_box"},EXERCISE:{color:"#ef4444",icon:"",size:{width:3,height:2.5,depth:4},geometry:"gym_module"},FOOD_PREP:{color:"#8b5cf6",icon:"",size:{width:3,height:2.2,depth:3},geometry:"kitchen_module"},ECLSS:{color:"#22c55e",icon:"",size:{width:3,height:2.3,depth:2.5},geometry:"technical_rack"},MEDICAL:{color:"#ec4899",icon:"",size:{width:2.5,height:2.3,depth:2.5},geometry:"medical_bay"},MAINTENANCE:{color:"#06b6d4",icon:"",size:{width:2.5,height:2.3,depth:2.5},geometry:"workshop"},CUSTOM_CAD:{color:"#8b5cf6",icon:"",size:{width:2,height:2,depth:2},geometry:"custom"},STOWAGE:{color:"#f97316",icon:"",size:{width:2.5,height:2.3,depth:3.5},geometry:"storage_rack"},RECREATION:{color:"#84cc16",icon:"",size:{width:2,height:2.2,depth:2},geometry:"lounge_pod"},WORKSTATION:{color:"#64748b",icon:"",size:{width:2.2,height:2.2,depth:2.2},geometry:"workstation"},AIRLOCK:{color:"#0ea5e9",icon:"",size:{width:2,height:2.3,depth:2.2},geometry:"airlock_chamber"},GLOVEBOX:{color:"#8b5cf6",icon:"",size:{width:1.4,height:2,depth:1.8},geometry:"science_station"},TRASH_MGMT:{color:"#6b7280",icon:"",size:{width:1.5,height:2,depth:2},geometry:"compactor"},COMMON_AREA:{color:"#f59e0b",icon:"",size:{width:3,height:2.2,depth:3},geometry:"community_space"}};function Mr(t,e=.5){return Math.round(t/e)*e}function Hx(t,e){const{w_m:s,h_m:n,l_m:r}=e;switch(t){case"sleep_pod":const o=new Eh(Math.min(s,r)/2.2,n-Math.min(s,r)/1.1,4,8);return o.rotateZ(Math.PI/2),o;case"cylinder":return new Lt(s/2,s/2,n,16);case"rounded_box":return new ge(s,n,r);case"gym_module":new wt;const c=new ge(s,n*.8,r);return new ge(s*.8,n*.2,r*.6),c;case"kitchen_module":return new ge(s,n,r);case"technical_rack":return new ge(s,n*1.2,r*.8);case"medical_bay":return new ge(s,n,r);case"workshop":return new ge(s,n,r);case"storage_rack":return new ge(s,n*1.1,r);case"lounge_pod":return new Vr(s/2,16,12);case"workstation":return new ge(s,n,r);case"airlock_chamber":const f=new Lt(s/2,s/2,n,8);return f.rotateZ(Math.PI/2),f;case"science_station":return new ge(s,n*1.1,r);case"compactor":return new Lt(s/2.2,s/2,n,12);case"community_space":return new Lt(s/2,s/2,n,8);default:return new ge(s,n,r)}}function $x(t,e){const s=e?16776960:t.color;return[new xt({color:s,transparent:!0,opacity:.8}),new xt({color:s,transparent:!0,opacity:.8}),new xt({color:s,transparent:!0,opacity:.9}),new xt({color:s,transparent:!0,opacity:.7}),new xt({color:s,transparent:!0,opacity:.8}),new xt({color:s,transparent:!0,opacity:.8})]}function Vx(t,e=42,s=8e3,n=800){const r=new Float32Array(s*3),o=new Float32Array(s*3),a=u=>{let f=Math.sin(u++)*1e4;return f-Math.floor(f)};let c=e;for(let u=0;u<s;u++){const f=n*.8+a(c++)*n*.2,m=a(c++)*Math.PI*2,p=Math.acos(2*a(c++)-1);r[u*3]=f*Math.sin(p)*Math.cos(m),r[u*3+1]=f*Math.sin(p)*Math.sin(m),r[u*3+2]=f*Math.cos(p);const x=.3+a(c++)*.7,b=a(c++);b>.8?(o[u*3]=x*.8,o[u*3+1]=x*.9,o[u*3+2]=x):b>.6?(o[u*3]=x,o[u*3+1]=x,o[u*3+2]=x):b>.3?(o[u*3]=x,o[u*3+1]=x*.9,o[u*3+2]=x*.7):(o[u*3]=x,o[u*3+1]=x*.6,o[u*3+2]=x*.4)}const l=new Fi;l.setAttribute("position",new ot(r,3)),l.setAttribute("color",new ot(o,3));const d=new zi({size:2,sizeAttenuation:!1,vertexColors:!0,transparent:!0,opacity:.8}),h=new Ui(l,d);return t.add(h),h}function Wx({objects:t,setObjects:e,selectedId:s,setSelectedId:n,scenario:r,hoverPointRef:o,isInitialized:a,setIsInitialized:c,sceneRefs:l,onContextMenu:d}){const h=_=>{switch(_){case"MARS_SURFACE":return{background:9127187,ground:13468991,grid:9127187,ambientLight:16757606,directionalLight:16767673,groundTexture:"/textures/ground/mars_surface.webp",skyTexture:"/textures/skybox/sky.webp"};case"LUNAR":case"LUNAR_SURFACE":return{background:1118481,ground:6908265,grid:5592405,ambientLight:13421772,directionalLight:16777215,groundTexture:"/textures/ground/moon-surface-seamless-texture-background-closeup-moon-surface-texture-188679621.webp",skyTexture:"/textures/skybox/sky.webp"};case"LEO":case"SPACE_STATION":return{background:17,ground:3100495,grid:4620980,ambientLight:15135743,directionalLight:16777215,groundTexture:"/textures/ground/space-station-floor.jpg",skyTexture:"/textures/skybox/sky.webp"};case"MARS_TRANSIT":return{background:1644912,ground:3092271,grid:4286945,ambientLight:14739199,directionalLight:15792383,groundTexture:"/textures/ground/ship-deck.jpg",skyTexture:"/textures/skybox/sky.webp"};case"DEEP_SPACE":return{background:0,ground:1842204,grid:6697881,ambientLight:15132410,directionalLight:16777215,groundTexture:"/textures/ground/deep-space-deck.jpg",skyTexture:"/textures/skybox/sky.webp"};default:return{background:2956137,ground:13458524,grid:9127187,ambientLight:16777215,directionalLight:16777215,groundTexture:"/textures/ground/default-surface.jpg",skyTexture:"/textures/skybox/sky.webp"}}},u=g.useRef(null),f=g.useRef(),m=g.useRef(),p=g.useRef(),x=g.useRef(new Map),b=g.useRef(new wn),S=g.useRef(new ve),y=g.useRef(new Is(new $(0,1,0),0)),w=g.useRef(!1),v=g.useRef(new $),C=g.useRef(),T=g.useRef({isRotating:!1,isPanning:!1,isSpacePressed:!1,previousMouse:{x:0,y:0},spherical:new vr(25,Math.PI/4,0),target:new $(0,0,0),panSpeed:.02,rotateSpeed:.005});return g.useEffect(()=>{if(console.log("Initializing Three.js scene..."),!u.current){console.log("Mount ref not ready");return}try{let _=function(L){L.preventDefault();const M=T.current;if(M.isSpacePressed&&L.button===0){M.isPanning=!0,M.previousMouse={x:L.clientX,y:L.clientY},X.domElement.style.cursor="grabbing";return}if(L.button===0){const V=X.domElement.getBoundingClientRect(),se=(L.clientX-V.left)/V.width*2-1,ee=-((L.clientY-V.top)/V.height)*2+1;S.current.set(se,ee),b.current.setFromCamera(S.current,G);const J=Array.from(x.current.values()),he=b.current.intersectObjects(J);if(he.length>0){const me=he[0].object.userData.id;n(me),w.current=!0;const _e=he[0].object,Le=he[0].point;v.current.copy(_e.position).sub(Le)}else n(null),M.isRotating=!0,M.previousMouse={x:L.clientX,y:L.clientY}}else L.button===2&&(M.isPanning=!0,M.previousMouse={x:L.clientX,y:L.clientY})},N=function(L){const M=X.domElement.getBoundingClientRect(),V=(L.clientX-M.left)/M.width*2-1,se=-((L.clientY-M.top)/M.height)*2+1;S.current.set(V,se),b.current.setFromCamera(S.current,G);const ee=new $;if(b.current.ray.intersectPlane(y.current,ee),o&&(o.current=ee.clone()),w.current&&s){const _e=x.current.get(s);if(_e){const Le=new $;b.current.ray.intersectPlane(y.current,Le);const Ee=Le.add(v.current);Ee.x=Mr(Ee.x),Ee.z=Mr(Ee.z),Ee.y=Math.max(1,Ee.y),_e.position.copy(Ee)}return}const J=T.current,he=L.clientX-J.previousMouse.x,me=L.clientY-J.previousMouse.y;if(J.isRotating)J.spherical.theta-=he*J.rotateSpeed,J.spherical.phi+=me*J.rotateSpeed,J.spherical.phi=Math.max(.1,Math.min(Math.PI-.1,J.spherical.phi)),G.position.setFromSpherical(J.spherical).add(J.target),G.lookAt(J.target),J.previousMouse={x:L.clientX,y:L.clientY};else if(J.isPanning){const _e=new $,Le=new $().crossVectors(G.up,new $().subVectors(J.target,G.position).normalize()),Ee=new $().crossVectors(Le,new $().subVectors(J.target,G.position).normalize());_e.addScaledVector(Le,-he*J.panSpeed),_e.addScaledVector(Ee,me*J.panSpeed),J.target.add(_e),G.position.add(_e),J.previousMouse={x:L.clientX,y:L.clientY}}},j=function(){if(w.current&&s){const M=x.current.get(s);if(M){const V=M.position;e(se=>se.map(ee=>ee.id===s?{...ee,position:[V.x,V.y,V.z]}:ee))}w.current=!1}const L=T.current;L.isRotating=!1,L.isPanning=!1,L.isSpacePressed?X.domElement.style.cursor="move":X.domElement.style.cursor="default"},F=function(L){L.preventDefault();const M=T.current,V=L.deltaY>0?1.1:.9;M.spherical.radius=Math.max(5,Math.min(100,M.spherical.radius*V)),G.position.setFromSpherical(M.spherical).add(M.target),G.lookAt(M.target)},E=function(L){L.code==="Space"&&(L.preventDefault(),T.current.isSpacePressed=!0,X.domElement.style.cursor="move")},P=function(L){L.code==="Space"&&(L.preventDefault(),T.current.isSpacePressed=!1,T.current.isPanning=!1,T.current.isRotating=!1,X.domElement.style.cursor="default")},B=function(L){L.preventDefault();const M=X.domElement.getBoundingClientRect(),V=new ve((L.clientX-M.left)/M.width*2-1,-((L.clientY-M.top)/M.height)*2+1);b.current.setFromCamera(V,G);const se=b.current.intersectObjects(Y.children,!0);let ee=null;for(const J of se)if(J.object.userData.id){ee=J.object.userData.id;break}d(L.clientX,L.clientY,ee)},k=function(){if(C.current=requestAnimationFrame(k),O){const L=O.material;L.opacity=.6+.2*Math.sin(Date.now()*.001)}X.render(Y,G)},D=function(){if(!u.current)return;const L=u.current.clientWidth,M=u.current.clientHeight;G.aspect=L/M,G.updateProjectionMatrix(),X.setSize(L,M)};const U=h(r.destination),Y=new zr;Y.background=new ze(17),f.current=Y;const O=Vx(Y,42,6e3,600),G=new Ur(75,u.current.clientWidth/u.current.clientHeight,.1,1e3);p.current=G,l.current.camera=G;const ce=T.current;G.position.setFromSpherical(ce.spherical).add(ce.target),G.lookAt(ce.target);const X=new Br({antialias:!0,alpha:!1});X.setSize(u.current.clientWidth,u.current.clientHeight),X.shadowMap.enabled=!0,X.shadowMap.type=Hr,X.setClearColor(2956137),m.current=X,l.current.renderer=X,l.current.raycaster=b.current,l.current.plane=y.current,u.current.appendChild(X.domElement);const ye=new $r(U.ambientLight,.4);Y.add(ye);const ne=new Vs(U.directionalLight,.8);ne.position.set(10,10,5),ne.castShadow=!0,ne.shadow.mapSize.width=2048,ne.shadow.mapSize.height=2048,Y.add(ne);const ue=new gl(100,100),pe=new yl;let fe;try{console.log(`Loading ground texture: ${U.groundTexture}`);const L=pe.load(U.groundTexture,M=>{console.log("Ground texture loaded successfully"),M.wrapS=Qo,M.wrapT=Qo,M.repeat.set(1,1),M.minFilter=Ii,M.magFilter=wr,M.generateMipmaps=!0,fe.map=M,fe.needsUpdate=!0},M=>{console.log("Loading ground texture progress:",M)},M=>{console.warn("Failed to load ground texture, using fallback color:",M)});fe=new xt({color:U.ground,map:L})}catch(L){console.warn("Error creating texture loader, using fallback color:",L),fe=new xt({color:U.ground})}const R=new ke(ue,fe);R.rotation.x=-Math.PI/2,R.receiveShadow=!0,Y.add(R),Y.background=new ze(0);const A=new Ai(50,50,U.grid,U.grid);return A.material.transparent=!0,A.material.opacity=.3,Y.add(A),X.domElement.addEventListener("mousedown",_),X.domElement.addEventListener("mousemove",N),X.domElement.addEventListener("mouseup",j),X.domElement.addEventListener("wheel",F),X.domElement.addEventListener("contextmenu",B),window.addEventListener("keydown",E),window.addEventListener("keyup",P),k(),window.addEventListener("resize",D),c(!0),console.log("Three.js scene initialized successfully"),()=>{console.log("Cleaning up Three.js scene"),window.removeEventListener("resize",D),C.current&&cancelAnimationFrame(C.current),X.domElement&&(X.domElement.removeEventListener("mousedown",_),X.domElement.removeEventListener("mousemove",N),X.domElement.removeEventListener("mouseup",j),X.domElement.removeEventListener("wheel",F),X.domElement.removeEventListener("contextmenu",B)),window.removeEventListener("keydown",E),window.removeEventListener("keyup",P),u.current&&X.domElement&&u.current.removeChild(X.domElement),X.dispose()}}catch(_){console.error("Error initializing Three.js:",_)}},[s,n,e,o,c,r.destination]),g.useEffect(()=>{!f.current||!a||(console.log("Updating objects in scene, count:",t.length),x.current.forEach(_=>{f.current.remove(_),_.geometry.dispose(),Array.isArray(_.material)?_.material.forEach(N=>N.dispose()):_.material.dispose()}),x.current.clear(),t.forEach(_=>{const N=yn[_.type];if(!N)return;const j=s===_.id,F=Hx(N.geometry,_.size),E=$x(N,j),P=new ke(F,E);P.position.set(..._.position),P.rotation.set(..._.rotation||[0,0,0]),P.scale.set(..._.scale||[1,1,1]),P.castShadow=!0,P.receiveShadow=!0,P.userData={id:_.id,type:_.type},f.current.add(P),x.current.set(_.id,P)}))},[t,s,a]),i.jsx("div",{ref:u,className:"w-full h-full bg-background",children:!a&&i.jsx("div",{className:"flex items-center justify-center h-full",children:i.jsxs("div",{className:"text-white text-center",children:[i.jsx(gi,{className:"w-8 h-8 animate-spin mx-auto mb-2"}),i.jsx("p",{children:"Loading 3D Scene..."})]})})})}const Es=(t,e)=>{try{const s=localStorage.getItem(t);return s?JSON.parse(s):e}catch(s){return console.warn(`Failed to load ${t} from storage:`,s),e}},Rs=(t,e)=>{try{localStorage.setItem(t,JSON.stringify(e))}catch(s){console.warn(`Failed to save ${t} to storage:`,s)}};function Cd(){const t={SCENARIO:"nasa-habitat-scenario",OBJECTS:"nasa-habitat-objects",SELECTED_ID:"nasa-habitat-selected-id",CAD_DESIGNS:"nasa-habitat-cad-designs",VALIDATION_RESULTS:"nasa-habitat-validation-results",ACTIVE_TAB:"nasa-habitat-active-tab"},[e,s]=g.useState(()=>Es(t.SCENARIO,{crew_size:4,mission_duration_days:900,destination:"MARS_TRANSIT",fairing:So[2]})),[n,r]=g.useState({shape:"CYLINDER",levels:2,dimensions:{diameter_m:6.5,height_m:12},pressurized_volume_m3:400,net_habitable_volume_m3:300}),[o,a]=g.useState(()=>Es(t.OBJECTS,[])),[c,l]=g.useState(()=>Es(t.SELECTED_ID,null)),[d,h]=g.useState(()=>Es(t.VALIDATION_RESULTS,null)),[u,f]=g.useState({validation:!1}),[m,p]=g.useState(!1),[x,b]=g.useState(1),[S,y]=g.useState(!1),[w,v]=g.useState(!0),[C,T]=g.useState(!0),[_,N]=g.useState(!0),[j,F]=g.useState(!0),[E,P]=g.useState(!0),[B,k]=g.useState(!0),[D,U]=g.useState(()=>Es(t.ACTIVE_TAB,"design")),[Y,O]=g.useState(!1),[G,ce]=g.useState(!1),[X,ye]=g.useState({visible:!1,x:0,y:0,objectId:null}),[ne,ue]=g.useState(null),[pe,fe]=g.useState(!0),[R,A]=g.useState(null),[L,M]=g.useState(()=>Es(t.CAD_DESIGNS,[])),V=g.useRef(null);g.useEffect(()=>{to().catch(console.error)},[]),g.useEffect(()=>{const I=setTimeout(()=>{window.dispatchEvent(new Event("resize"))},100);return()=>clearTimeout(I)},[B]),g.useEffect(()=>{Rs(t.OBJECTS,o)},[o]),g.useEffect(()=>{Rs(t.SCENARIO,e)},[e]),g.useEffect(()=>{Rs(t.SELECTED_ID,c)},[c]),g.useEffect(()=>{Rs(t.ACTIVE_TAB,D)},[D]),g.useEffect(()=>{Rs(t.CAD_DESIGNS,L)},[L]),g.useEffect(()=>{const I=z=>{z.target};return document.addEventListener("mousedown",I),()=>{document.removeEventListener("mousedown",I)}},[]),g.useEffect(()=>{const I=z=>{if(!c||z.target instanceof HTMLInputElement||z.target instanceof HTMLTextAreaElement)return;["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(z.code)&&z.preventDefault();const H=z.shiftKey?1:.5,W=z.shiftKey?Math.PI/4:Math.PI/8;let K="";a(ie=>ie.map(q=>{if(q.id!==c)return q;const oe={...q};switch(z.code){case"ArrowLeft":oe.position=[q.position[0]-H,q.position[1],q.position[2]],K=`Moving Left (${H}m)`;break;case"ArrowRight":oe.position=[q.position[0]+H,q.position[1],q.position[2]],K=`Moving Right (${H}m)`;break;case"ArrowUp":z.ctrlKey?(oe.position=[q.position[0],q.position[1]+H,q.position[2]],K=`Moving Up (${H}m)`):(oe.position=[q.position[0],q.position[1],q.position[2]-H],K=`Moving Forward (${H}m)`);break;case"ArrowDown":z.ctrlKey?(oe.position=[q.position[0],q.position[1]-H,q.position[2]],K=`Moving Down (${H}m)`):(oe.position=[q.position[0],q.position[1],q.position[2]+H],K=`Moving Backward (${H}m)`);break;case"KeyQ":const Re=q.rotation?.[1]||0;oe.rotation=[q.rotation?.[0]||0,Re-W,q.rotation?.[2]||0],K=`Rotating Left (${Math.round(W*180/Math.PI)})`;break;case"KeyE":const Ut=q.rotation?.[1]||0;oe.rotation=[q.rotation?.[0]||0,Ut+W,q.rotation?.[2]||0],K=`Rotating Right (${Math.round(W*180/Math.PI)})`;break;case"KeyR":const Fn=q.rotation?.[0]||0;oe.rotation=[Fn+W,q.rotation?.[1]||0,q.rotation?.[2]||0],K=`Pitch Up (${Math.round(W*180/Math.PI)})`;break;case"KeyF":const Na=q.rotation?.[0]||0;oe.rotation=[Na-W,q.rotation?.[1]||0,q.rotation?.[2]||0],K=`Pitch Down (${Math.round(W*180/Math.PI)})`;break;case"KeyW":oe.position=[q.position[0],q.position[1]+H,q.position[2]],K=`Moving Up (${H}m)`;break;case"KeyS":oe.position=[q.position[0],q.position[1]-H,q.position[2]],K=`Moving Down (${H}m)`;break;case"KeyT":const wh=q.rotation?.[2]||0;oe.rotation=[q.rotation?.[0]||0,q.rotation?.[1]||0,wh-W],K=`Roll Left (${Math.round(W*180/Math.PI)})`;break;case"KeyG":const Sh=q.rotation?.[2]||0;oe.rotation=[q.rotation?.[0]||0,q.rotation?.[1]||0,Sh+W],K=`Roll Right (${Math.round(W*180/Math.PI)})`;break;case"Equal":case"NumpadAdd":if(z.ctrlKey){const as=q.scale||[1,1,1],cs=.1;oe.scale=[Math.min(as[0]+cs,3),Math.min(as[1]+cs,3),Math.min(as[2]+cs,3)],K=`Scaling Up (${Math.round(oe.scale[0]*100)}%)`}break;case"Minus":case"NumpadSubtract":if(z.ctrlKey){const as=q.scale||[1,1,1],cs=.1;oe.scale=[Math.max(as[0]-cs,.2),Math.max(as[1]-cs,.2),Math.max(as[2]-cs,.2)],K=`Scaling Down (${Math.round(oe.scale[0]*100)}%)`}break;case"KeyX":z.ctrlKey&&(oe.rotation=[0,0,0],K="Reset Rotation");break;case"KeyC":z.ctrlKey&&(oe.scale=[1,1,1],K="Reset Scale");break}return oe})),K&&(A(K),setTimeout(()=>A(null),1500))};return document.addEventListener("keydown",I),()=>{document.removeEventListener("keydown",I)}},[c]),g.useEffect(()=>{Rs(t.CAD_DESIGNS,L)},[L]);const se=g.useCallback(I=>{const z=I.layout;s(W=>({...W,crew_size:z.scenario.crew_size,mission_duration_days:z.scenario.mission_duration_days,destination:z.scenario.destination}));const H=z.modules.map(W=>({id:W.id,type:W.type,position:[...W.position,0],rotation:[0,0,0],scale:[1,1,1],size:W.size}));a(H),U("design"),h(null),alert(`Loaded design: ${I.name}`)},[]),ee=g.useCallback(I=>{const z=`${I.toLowerCase().replace("_","-")}-${x}`;return b(H=>H+1),z},[x]),J=g.useCallback(()=>{const I={crew_size:e?.crew_size||4,mission_duration_days:e?.mission_duration_days||365,destination:e?.destination||"MARS_SURFACE",fairing:{name:e?.fairing?.name||"Falcon 9",inner_diameter_m:e?.fairing?.inner_diameter_m||5.2,inner_height_m:e?.fairing?.inner_height_m||13.1,shape:e?.fairing?.shape==="CYLINDRICAL"?"CYLINDER":"CONE"}},z={shape:n?.shape||"CYLINDER",levels:n?.levels||1,dimensions:n?.dimensions||{diameter_m:6.5,height_m:12},pressurized_volume_m3:n?.pressurized_volume_m3||400,net_habitable_volume_m3:n?.net_habitable_volume_m3||300},H=o.map((W,K)=>({id:W.id||`module-${K}`,type:W.type||"CREW_SLEEP",level:0,position:[W.position?.[0]||0,W.position?.[2]||0],size:{w_m:W.size?.w_m||W.size?.width||2,l_m:W.size?.l_m||W.size?.depth||2,h_m:W.size?.h_m||W.size?.height||2.1},rotation_deg:W.rotation?.y?W.rotation.y*180/Math.PI:0,crew_capacity:W.type==="CREW_SLEEP"?1:void 0,equipment:[]}));return{scenario:I,habitat:z,modules:H,version:"1.0.0"}},[e,n,o]),he=g.useCallback(async()=>{const I=J(),z=new Date().toLocaleString();O(!0);try{const H=await ia({name:`Habitat Design ${z}`,description:`Design with ${o.length} modules for ${e.destination} mission`,layout:I,tags:["nasa",e.destination.toLowerCase(),`crew-${e.crew_size}`]});alert(`Design saved successfully! ID: ${H}`)}catch(H){console.error("Failed to save design:",H),alert("Failed to save design. Please try again.")}finally{O(!1)}},[o,e,J]),me=g.useCallback(async()=>{if(o.length===0){alert("No modules to save. Add some modules first.");return}await he()},[o,he]),_e=g.useRef({camera:null,renderer:null,raycaster:null,plane:null}),Le=g.useCallback((I,z)=>{const{camera:H,renderer:W,raycaster:K,plane:ie}=_e.current;if(!H||!W||!K||!ie)return console.log("Scene not ready for drop calculation"),null;const q=W.domElement.getBoundingClientRect(),oe=(I-q.left)/q.width*2-1,Re=-((z-q.top)/q.height)*2+1,Ut=new ve(oe,Re);K.setFromCamera(Ut,H);const Fn=new $;return K.ray.intersectPlane(ie,Fn)?Fn:null},[]);function Ee(I){I.preventDefault();const z=I.dataTransfer.getData("module");if(!z)return;const H=Le(I.clientX,I.clientY);if(!H){console.log("Could not calculate drop position");return}const W=ee(z),K=yn[z],ie=an.find(Re=>Re.type===z);if(!K||!ie)return;const q=[Mr(H.x),K.size.height/2,Mr(H.z)],oe={id:W,type:z,position:q,rotation:[0,0,0],scale:[1,1,1],size:ie.defaultSize};console.log("Adding NASA module at:",q,"from drop at:",{x:I.clientX,y:I.clientY}),a(Re=>[...Re,oe]),l(W)}function mt(I){I.preventDefault();const z=Le(I.clientX,I.clientY);z&&V.current&&V.current.copy(z)}const De=async()=>{f(I=>({...I,validation:!0}));try{const I=J();console.log(" Sending to NASA API via postAnalyzeRaw:",I);const z=await vd(I);console.log(" NASA Analysis Result from postAnalyzeRaw:",z),h(z)}catch(I){console.error("NASA validation failed:",I),h({results:[{rule:"system.api_connection",valid:!1,explanation:`NASA API connection failed: ${I.message}`}],suggestions:["Check your internet connection","The NASA API might be temporarily unavailable","Try refreshing the page and running validation again"]})}f(I=>({...I,validation:!1}))},Be=()=>{a([]),h(null),l(null)},de=g.useCallback(I=>{a(z=>z.filter(H=>H.id!==I)),c===I&&l(null),ye({visible:!1,x:0,y:0,objectId:null})},[c]),be=g.useCallback(I=>{const z=o.find(K=>K.id===I);if(!z)return;const H=ee(z.type),W={...z,id:H,position:[z.position[0]+2,z.position[1],z.position[2]+2]};a(K=>[...K,W]),l(H),ye({visible:!1,x:0,y:0,objectId:null})},[o,ee]),Me=g.useCallback(I=>{const z=o.find(H=>H.id===I);z&&ue(z),ye({visible:!1,x:0,y:0,objectId:null})},[o]),tt=g.useCallback(()=>{if(!ne)return;const I=ee(ne.type),z={...ne,id:I,position:[ne.position[0]+2,ne.position[1],ne.position[2]+2]};a(H=>[...H,z]),l(I),ye({visible:!1,x:0,y:0,objectId:null})},[ne,ee]),Oe=g.useCallback((I,z)=>{a(H=>H.map(W=>{if(W.id===I){const K=W.scale||[1,1,1];return{...W,scale:[K[0]*z,K[1]*z,K[2]*z]}}return W})),ye({visible:!1,x:0,y:0,objectId:null})},[]);g.useEffect(()=>{const I=z=>{z.key==="Delete"&&c?de(c):z.ctrlKey&&z.key==="c"&&c?Me(c):z.ctrlKey&&z.key==="v"&&ne?tt():z.ctrlKey&&z.key==="d"&&c&&(z.preventDefault(),be(c))};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[c,ne,de,Me,tt,be]),g.useEffect(()=>{const I=()=>{X.visible&&ye({visible:!1,x:0,y:0,objectId:null})};return document.addEventListener("click",I),()=>document.removeEventListener("click",I)},[X.visible]),g.useCallback(()=>{M([{id:"cad-1",name:"Custom Storage Module",shapes:[{type:"box",width:2,height:2,depth:1,position:[0,0,0]},{type:"cylinder",radius:.5,height:2,position:[1,0,0]}],bounds:{width:3,height:2,depth:1}},{id:"cad-2",name:"Curved Living Space",shapes:[{type:"torus",radius:1.5,height:.3,position:[0,0,0]},{type:"sphere",radius:1,position:[0,1,0]}],bounds:{width:3,height:2,depth:3}}]),alert("CAD designs imported! Check the module library for custom modules.")},[]),g.useCallback(()=>{if(o.length===0){alert("No modules to export to CAD. Add some modules first.");return}const I={name:`Habitat Export ${new Date().toISOString().split("T")[0]}`,objects:o.map(K=>({id:K.id,type:K.type,position:K.position,rotation:K.rotation||[0,0,0],scale:K.scale||[1,1,1],size:K.size})),bounds:{width:Math.max(...o.map(K=>K.position[0]+K.size.w_m))-Math.min(...o.map(K=>K.position[0])),height:Math.max(...o.map(K=>K.size.h_m)),depth:Math.max(...o.map(K=>K.position[2]+K.size.l_m))-Math.min(...o.map(K=>K.position[2]))}},z=new Blob([JSON.stringify(I,null,2)],{type:"application/json"}),H=URL.createObjectURL(z),W=document.createElement("a");W.href=H,W.download="habitat-for-cad.json",W.click(),URL.revokeObjectURL(H),alert("Habitat exported to CAD format!")},[o]);const On=g.useCallback(I=>{const z=ee("CUSTOM_CAD"),H={id:z,type:"CUSTOM_CAD",position:[0,I.bounds.height/2,0],rotation:[0,0,0],scale:[1,1,1],size:{w_m:I.bounds.width,h_m:I.bounds.height,l_m:I.bounds.depth}};a(W=>[...W,H]),l(z),alert(`Added custom CAD module: ${I.name}`)},[ee]),Dn=()=>{a([]),l(null),s({crew_size:4,mission_duration_days:365,destination:"mars",fairing:"falcon_heavy"});const I=ee("CREW_SLEEP"),z=an.find(H=>H.type==="CREW_SLEEP");if(z){const H={id:I,type:"CREW_SLEEP",position:[0,1.5,0],rotation:[0,0,0],scale:[1,1,1],size:z.defaultSize};a([H]),l(I)}U("design"),alert("New design created! Added a crew sleep module to get you started.")},In=()=>{["CREW_SLEEP","HYGIENE","FOOD_PREP","EXERCISE"].forEach((z,H)=>{const W=ee(z),K=an.find(q=>q.type===z);if(!K)return;const ie={id:W,type:z,position:[H*3-4.5,1.5,0],rotation:[0,0,0],scale:[1,1,1],size:K.defaultSize};a(q=>[...q,ie])})},He=o.find(I=>I.id===c);return i.jsxs("div",{className:"w-full h-screen bg-background text-foreground space-gradient flex flex-col",children:[i.jsx("header",{className:"nav-container shadow-2xl",children:i.jsxs("div",{className:"flex items-center justify-between p-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-primary to-blue-600 rounded-xl flex items-center justify-center shadow-lg",children:i.jsx(oc,{className:"w-6 h-6 text-white drop-shadow-lg"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-primary to-blue-400 bg-clip-text text-transparent",children:"NASA Habitat Designer"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Professional space habitat layout tool"})]})]}),i.jsxs("nav",{className:"flex items-center gap-1",children:[i.jsxs(re,{onClick:()=>U("design"),className:`px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 ${D==="design"?"bg-primary text-primary-foreground border-primary/50 shadow-lg":"bg-card text-card-foreground border-border hover:bg-accent hover:text-accent-foreground"} border`,children:[i.jsx(sa,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:"Design Area"})]}),i.jsxs(re,{onClick:()=>U("cad"),className:`px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 ${D==="cad"?"bg-primary text-primary-foreground border-primary/50 shadow-lg":"bg-card text-card-foreground border-border hover:bg-accent hover:text-accent-foreground"} border`,children:[i.jsx(hs,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:"Laboratory CAD"})]}),i.jsxs(re,{onClick:()=>U("collections"),className:`px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 ${D==="collections"?"bg-primary text-primary-foreground border-primary/50 shadow-lg":"bg-card text-card-foreground border-border hover:bg-accent hover:text-accent-foreground"} border`,children:[i.jsx(pi,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:"Collections"})]}),i.jsxs(re,{onClick:()=>U("analyses"),className:`px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 ${D==="analyses"?"bg-primary text-primary-foreground border-primary/50 shadow-lg":"bg-card text-card-foreground border-border hover:bg-accent hover:text-accent-foreground"} border`,children:[i.jsx(Rn,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:"Analyses"})]}),i.jsx("div",{className:"w-px h-8 bg-border mx-2"}),i.jsxs(re,{onClick:me,className:"px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 bg-green-600/80 hover:bg-green-600 text-white border border-green-500/50 shadow-lg",disabled:Y,children:[Y?i.jsx(gi,{className:"w-4 h-4 animate-spin"}):i.jsx(eo,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:"Save Project"})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(re,{onClick:Dn,className:"btn-space px-3 py-2",children:[i.jsx(ut,{className:"w-4 h-4 mr-1"}),"New"]}),i.jsxs(re,{onClick:Be,className:"btn-mars px-3 py-2",children:[i.jsx(vs,{className:"w-4 h-4 mr-1"}),"Clear"]})]})]})}),i.jsx("div",{className:"flex-1 flex",children:D==="design"?i.jsxs("div",{className:"flex flex-1 relative",children:[B&&i.jsxs("aside",{className:"w-80 nav-container shadow-2xl border-r border-border flex flex-col overflow-y-auto",children:[i.jsx("div",{className:"p-3 border-b border-border bg-card/20",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-primary to-blue-600 rounded-md flex items-center justify-center",children:i.jsx(hs,{className:"w-3 h-3 text-white"})}),i.jsx("span",{className:"font-semibold text-foreground",children:"Mission Control"})]}),i.jsx(re,{onClick:()=>k(!1),className:"w-8 h-8 p-0 rounded-lg hover:bg-accent",title:"Hide Sidebar",variant:"ghost",size:"sm",children:i.jsx(sx,{className:"w-4 h-4"})})]})}),i.jsxs("div",{className:"p-3 border-b border-border",children:[i.jsxs("h3",{className:"font-semibold text-foreground mb-2 flex items-center gap-2 cursor-pointer hover:text-primary transition-colors",onClick:()=>N(!_),children:[_?i.jsx(Kt,{className:"w-4 h-4"}):i.jsx(ut,{className:"w-4 h-4"}),"NASA Mission Scenario"]}),_&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{children:[i.jsx(xn,{className:"text-muted-foreground text-xs",children:"Crew"}),i.jsx(xi,{type:"number",value:e.crew_size,onChange:I=>s(z=>({...z,crew_size:parseInt(I.target.value)||0})),className:"bg-background border-border text-foreground text-xs h-7 hover:bg-accent/50 transition-colors"})]}),i.jsxs("div",{children:[i.jsx(xn,{className:"text-muted-foreground text-xs",children:"Days"}),i.jsx(xi,{type:"number",value:e.mission_duration_days,onChange:I=>s(z=>({...z,mission_duration_days:parseInt(I.target.value)||0})),className:"bg-background border-border text-foreground text-xs h-7 hover:bg-accent/50 transition-colors"})]})]}),i.jsxs("div",{children:[i.jsx(xn,{className:"text-muted-foreground text-xs",children:"Destination"}),i.jsxs("select",{value:e.destination,onChange:I=>s(z=>({...z,destination:I.target.value})),className:"w-full bg-background border border-border text-foreground text-xs h-7 rounded-md px-2 hover:bg-accent/50 transition-colors focus:ring-1 focus:ring-primary/50",children:[i.jsx("option",{value:"LEO",children:"Low Earth Orbit"}),i.jsx("option",{value:"LUNAR",children:"Lunar Surface"}),i.jsx("option",{value:"MARS_TRANSIT",children:"Mars Transit"}),i.jsx("option",{value:"MARS_SURFACE",children:"Mars Surface"}),i.jsx("option",{value:"DEEP_SPACE",children:"Deep Space"})]})]}),i.jsxs("div",{children:[i.jsx(xn,{className:"text-muted-foreground text-xs",children:"Launch Vehicle"}),i.jsx("select",{value:e.fairing.name,onChange:I=>{const z=So.find(H=>H.name===I.target.value);z&&s(H=>({...H,fairing:z}))},className:"w-full bg-background border border-border text-foreground text-xs h-7 rounded-md px-2 hover:bg-accent/50 transition-colors focus:ring-1 focus:ring-primary/50",children:So.map(I=>i.jsx("option",{value:I.name,children:I.name},I.name))})]})]})]}),i.jsxs("div",{className:"p-3 border-b border-border",children:[i.jsxs("h3",{className:"font-semibold text-foreground mb-2 flex items-center gap-2 cursor-pointer hover:text-primary transition-colors",onClick:()=>v(!w),children:[w?i.jsx(Kt,{className:"w-4 h-4"}):i.jsx(ut,{className:"w-4 h-4"}),"NASA Functional Areas"]}),w&&i.jsxs("div",{className:"max-h-64 overflow-y-auto scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent",children:[i.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(yn).map(([I,z])=>{const H=an.find(W=>W.type===I);return i.jsxs("div",{draggable:!0,onDragStart:W=>W.dataTransfer.setData("module",I),className:"group flex flex-col items-center gap-2 p-2 bg-card/40 hover:bg-primary/20 border border-border hover:border-primary/60 rounded-lg cursor-grab active:cursor-grabbing transition-all duration-200 backdrop-blur-sm hover:shadow-lg",children:[i.jsx("div",{className:"w-8 h-8 rounded flex items-center justify-center text-white text-sm shadow-lg flex-shrink-0",style:{backgroundColor:z.color},children:z.icon}),i.jsxs("div",{className:"text-center min-w-0 w-full",children:[i.jsx("div",{className:"font-medium text-foreground text-xs truncate",children:H?.label||I}),i.jsxs("div",{className:"text-[10px] text-muted-foreground",children:[H?.defaultSize.w_m||z.size.width,"",H?.defaultSize.h_m||z.size.height,"",H?.defaultSize.l_m||z.size.depth,"m"]})]})]},I)})}),i.jsxs("div",{className:"text-xs text-muted-foreground text-center mt-2",children:["Scroll to see all ",Object.keys(yn).length," functional areas"]})]})]}),L.length>0&&i.jsxs("div",{className:"p-3 border-b border-border",children:[i.jsxs("h3",{className:"font-semibold text-foreground mb-2 flex items-center gap-2 cursor-pointer hover:text-primary transition-colors",onClick:()=>T(!C),children:[C?i.jsx(Kt,{className:"w-4 h-4"}):i.jsx(ut,{className:"w-4 h-4"}),"Custom CAD Modules"]}),C&&i.jsx("div",{className:"max-h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-border scrollbar-track-transparent",children:i.jsx("div",{className:"grid grid-cols-3 gap-2",children:L.map(I=>i.jsxs("div",{className:"group flex flex-col items-center gap-2 p-2 bg-card/40 hover:bg-orange-500/20 border border-border hover:border-orange-500/60 rounded-lg cursor-pointer transition-all duration-200 backdrop-blur-sm hover:shadow-lg",onClick:()=>On(I),children:[i.jsx("div",{className:"w-8 h-8 bg-orange-600 rounded flex items-center justify-center text-white text-sm shadow-lg flex-shrink-0",children:i.jsx(hs,{className:"w-4 h-4"})}),i.jsxs("div",{className:"text-center min-w-0 w-full",children:[i.jsx("div",{className:"font-medium text-foreground text-xs truncate",children:I.name}),i.jsxs("div",{className:"text-[10px] text-muted-foreground",children:[I.bounds.width.toFixed(1),"",I.bounds.height.toFixed(1),"",I.bounds.depth.toFixed(1),"m"]})]})]},I.id))})})]}),i.jsxs("div",{className:"p-3 border-b border-border",children:[i.jsxs("h3",{className:"font-semibold text-foreground mb-2 flex items-center gap-2 cursor-pointer hover:text-primary transition-colors",onClick:()=>F(!j),children:[j?i.jsx(Kt,{className:"w-4 h-4"}):i.jsx(ut,{className:"w-4 h-4"}),"Quick Actions"]}),j&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs(re,{onClick:In,className:"w-full btn-space text-xs py-2 h-8",size:"sm",children:[i.jsx(ut,{className:"w-3 h-3 mr-1"}),"Add Sample Module"]}),i.jsxs(re,{onClick:()=>U("shapes"),className:"w-full btn-space text-xs py-2 h-8",size:"sm",children:[i.jsx(yx,{className:"w-3 h-3 mr-1"}),"Custom Shape Builder"]}),i.jsxs(re,{onClick:()=>U("cad"),className:"w-full btn-space text-xs py-2 h-8",size:"sm",children:[i.jsx(hs,{className:"w-3 h-3 mr-1"}),"CAD Laboratory"]})]})]}),He&&i.jsxs("div",{className:"p-4 border-b border-border",children:[i.jsxs("h3",{className:"font-semibold text-foreground mb-3 flex items-center gap-2 cursor-pointer hover:text-primary transition-colors",onClick:()=>P(!E),children:[E?i.jsx(Kt,{className:"w-4 h-4"}):i.jsx(ut,{className:"w-4 h-4"}),"Module Inspector"]}),E&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"p-3 bg-card/40 border border-border rounded-lg",children:[i.jsxs("div",{className:"font-medium text-foreground capitalize flex items-center gap-2",children:[i.jsx("span",{className:"text-lg",children:yn[He.type]?.icon}),an.find(I=>I.type===He.type)?.label]}),i.jsxs("div",{className:"text-xs text-muted-foreground mt-1 space-y-1",children:[i.jsxs("div",{children:["Position: (",He.position[0].toFixed(1),"m, ",He.position[1].toFixed(1),"m, ",He.position[2].toFixed(1),"m)"]}),i.jsxs("div",{children:["Volume: ",(He.size.w_m*He.size.l_m*He.size.h_m).toFixed(1),"m"]}),i.jsxs("div",{children:["Area: ",(He.size.w_m*He.size.l_m).toFixed(1),"m"]})]})]}),i.jsxs("button",{onClick:()=>{a(I=>I.filter(z=>z.id!==c)),l(null)},className:"w-full flex items-center justify-center gap-2 p-2 text-destructive hover:text-destructive/80 hover:bg-destructive/10 border border-destructive/30 rounded-lg transition-all",children:[i.jsx(vs,{className:"w-4 h-4"}),"Remove Module"]})]})]}),i.jsxs("div",{className:"p-4 border-b border-purple-500/20",children:[i.jsx("h3",{className:"font-semibold text-purple-300 mb-3",children:"Mission Status"}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"text-sm text-gray-300",children:["Modules: ",i.jsx("span",{className:"font-medium text-purple-300",children:o.length})]}),i.jsxs("div",{className:"text-sm text-gray-300",children:["Total Volume: ",i.jsxs("span",{className:"font-medium text-purple-300",children:[o.reduce((I,z)=>I+z.size.w_m*z.size.l_m*z.size.h_m,0).toFixed(1),"m"]})]}),i.jsxs("div",{className:"text-sm text-gray-300",children:["3D Engine: ",i.jsx("span",{className:"font-medium text-green-300",children:S?"Active":"Loading..."})]})]})]})]}),!B&&i.jsx(re,{onClick:()=>k(!0),className:"absolute top-4 left-4 z-50 w-8 h-8 p-0 rounded-lg bg-card border border-border hover:bg-accent shadow-lg",title:"Show Sidebar",variant:"ghost",children:i.jsx(rx,{className:"w-4 h-4"})}),i.jsxs("main",{className:"flex-1 relative",onDrop:Ee,onDragOver:mt,children:[i.jsx(Wx,{objects:o,setObjects:a,selectedId:c,setSelectedId:l,scenario:e,hoverPointRef:V,isInitialized:S,setIsInitialized:y,sceneRefs:_e,onContextMenu:(I,z,H)=>{ye({visible:!0,x:I,y:z,objectId:H})}}),i.jsx("div",{className:"absolute top-6 right-6 glass-morphism rounded-xl p-4 shadow-2xl border border-blue-500/30 glow-blue",children:i.jsxs("div",{className:"text-sm space-y-2",children:[i.jsxs("div",{className:"font-medium text-blue-300 flex items-center gap-2 text-shadow",children:[i.jsx(hs,{className:"w-4 h-4"}),e.destination.replace("_"," ")]}),i.jsxs("div",{className:"text-xs text-gray-300 space-y-1 text-shadow-sm",children:[i.jsxs("div",{children:["Crew: ",e.crew_size," members"]}),i.jsxs("div",{children:["Duration: ",e.mission_duration_days," days"]}),i.jsxs("div",{children:["Vehicle: ",e.fairing.name]}),i.jsxs("div",{children:["Modules: ",o.length]})]})]})}),pe&&i.jsx("div",{className:"absolute bottom-6 right-6 glass-morphism rounded-xl p-3 shadow-2xl border border-purple-500/30 glow-purple max-w-[220px]",children:i.jsxs("div",{className:"text-xs space-y-2",children:[i.jsxs("div",{className:"font-medium text-purple-300 flex items-center justify-between text-shadow",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(oc,{className:"w-3 h-3"}),"Controls"]}),i.jsx("button",{onClick:()=>fe(!1),className:"text-gray-400 hover:text-white transition-colors text-xs",children:""})]}),i.jsxs("div",{className:"text-gray-300 text-shadow-sm space-y-1",children:[i.jsx("div",{className:"text-[10px] font-medium text-purple-200",children:"Camera:"}),i.jsxs("div",{className:"text-[10px]",children:[" ",i.jsx("kbd",{className:"bg-gray-800/50 px-1 rounded text-[9px]",children:"Space"})," + Drag: Pan"]}),i.jsx("div",{className:"text-[10px]",children:" Mouse wheel: Zoom"})]}),i.jsxs("div",{className:"text-gray-300 text-shadow-sm space-y-1",children:[i.jsx("div",{className:"text-[10px] font-medium text-yellow-200",children:"Objects (when selected):"}),i.jsx("div",{className:"text-[10px]",children:" Arrow keys: Move X/Z  W/S: Height"}),i.jsx("div",{className:"text-[10px]",children:" Q/E: Rotate  R/F/T/G: Pitch/Roll"}),i.jsx("div",{className:"text-[10px]",children:" Hold Shift: Faster movement"})]})]})}),c&&i.jsxs("div",{className:"absolute top-6 left-6 glass-morphism rounded-xl p-3 shadow-2xl border border-yellow-500/40 glow-orange max-w-[280px]",children:[i.jsxs("div",{className:"flex items-center gap-2 text-yellow-300 font-medium mb-2 text-shadow text-xs",children:[i.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse shadow-lg"}),"Module Selected - Keyboard Controls"]}),i.jsxs("div",{className:"text-[10px] text-gray-300 space-y-1 text-shadow-sm",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[i.jsxs("div",{children:[i.jsx("kbd",{className:"bg-gray-700/80 px-1 py-0.5 rounded text-[8px]",children:""})," Move X"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"bg-gray-700/80 px-1 py-0.5 rounded text-[8px]",children:""})," Move Z"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"bg-gray-700/80 px-1 py-0.5 rounded text-[8px]",children:"W/S"})," Height"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"bg-gray-700/80 px-1 py-0.5 rounded text-[8px]",children:"Q/E"})," Rotate Y"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"bg-gray-700/80 px-1 py-0.5 rounded text-[8px]",children:"R/F"})," Pitch"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"bg-gray-700/80 px-1 py-0.5 rounded text-[8px]",children:"T/G"})," Roll"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"bg-gray-700/80 px-1 py-0.5 rounded text-[8px]",children:"Ctrl+"})," Scale"]}),i.jsxs("div",{children:[i.jsx("kbd",{className:"bg-gray-700/80 px-1 py-0.5 rounded text-[8px]",children:"Shift"})," Fast"]})]}),i.jsx("div",{className:"text-[9px] text-gray-400 mt-2 border-t border-gray-600/50 pt-1",children:"Ctrl+X: Reset rotation  Ctrl+C: Reset scale"})]})]}),R&&i.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 bg-black/80 backdrop-blur-sm border border-green-500/50 rounded-lg px-4 py-2 shadow-2xl animate-pulse",children:i.jsxs("div",{className:"flex items-center gap-2 text-green-300 font-medium text-sm",children:[i.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),R]})})]})]}):D==="collections"?i.jsx(Fx,{currentLayout:J(),onLoadDesign:se,onSaveSuccess:()=>U("design")}):D==="shapes"?i.jsx(lc,{}):D==="cad"?i.jsx(Ux,{onBackToDesign:()=>U("design"),onSaveDesign:I=>{M(z=>[...z,{id:Date.now().toString(),name:I.name,shapes:I.shapes,bounds:I.bounds}]),alert(`CAD design "${I.name}" is now available as a custom module!`)}}):D==="analyses"?i.jsx("div",{className:"flex-1 bg-gradient-to-br from-purple-950/20 via-transparent to-pink-950/20 p-6",children:i.jsxs("div",{className:"max-w-6xl mx-auto",children:[i.jsxs("div",{className:"mb-6",children:[i.jsxs("h2",{className:"text-3xl font-bold text-purple-200 mb-2 flex items-center gap-3",children:[i.jsx(Rn,{className:"w-8 h-8 text-purple-400"}),"Habitat Analysis Center"]}),i.jsx("p",{className:"text-gray-400",children:"Comprehensive analysis and validation tools for your habitat design"})]}),i.jsx(_d,{nhv:n.net_habitable_volume_m3,pressurizedVolume:n.pressurized_volume_m3,utilization:Math.min(100,o.reduce((I,z)=>I+z.size.w_m*z.size.l_m*z.size.h_m,0)/n.net_habitable_volume_m3*100),corridorStatus:o.length>0?"success":"danger"}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[i.jsxs(Fe,{className:"glass-morphism border-purple-500/30 shadow-xl glow-purple",children:[i.jsx(Qe,{children:i.jsxs(Ze,{className:"flex items-center gap-2 text-purple-200",children:[i.jsx(En,{className:"w-5 h-5 text-green-400"}),"NASA Standards Validation"]})}),i.jsxs(qe,{className:"space-y-4",children:[i.jsx("p",{className:"text-gray-300 text-sm",children:"Validate your habitat design against NASA standards and requirements."}),i.jsx(re,{onClick:De,disabled:u.validation,className:"w-full btn-nasa",children:u.validation?i.jsxs(i.Fragment,{children:[i.jsx(gi,{className:"w-4 h-4 animate-spin mr-2"}),"Validating Design..."]}):i.jsxs(i.Fragment,{children:[i.jsx(En,{className:"w-4 h-4 mr-2"}),"Run NASA Validation"]})})]})]}),i.jsxs(Fe,{className:"glass-morphism border-orange-500/30 shadow-xl glow-orange",children:[i.jsx(Qe,{children:i.jsxs(Ze,{className:"flex items-center gap-2 text-orange-200",children:[i.jsx(Rn,{className:"w-5 h-5 text-orange-400"}),"Quick Analysis"]})}),i.jsx(qe,{className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{className:"bg-gray-800/40 p-3 rounded-lg",children:[i.jsx("div",{className:"text-gray-400",children:"Total Modules"}),i.jsx("div",{className:"text-2xl font-bold text-orange-300",children:o.length})]}),i.jsxs("div",{className:"bg-gray-800/40 p-3 rounded-lg",children:[i.jsx("div",{className:"text-gray-400",children:"Total Volume"}),i.jsxs("div",{className:"text-2xl font-bold text-orange-300",children:[o.reduce((I,z)=>I+z.size.w_m*z.size.l_m*z.size.h_m,0).toFixed(1),"m"]})]})]})})]})]}),d&&i.jsx("div",{className:"mt-6",children:i.jsx(Nd,{data:d,isLoading:u.validation})})]})}):i.jsx(lc,{})}),X.visible&&i.jsx("div",{className:"fixed bg-gray-900 border border-gray-600 rounded-lg shadow-xl z-50 py-2 min-w-[160px]",style:{left:X.x,top:X.y,transform:"translate(-50%, 0)"},onClick:I=>I.stopPropagation(),children:X.objectId?i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"w-full px-4 py-2 text-left hover:bg-gray-800 text-sm text-gray-200 flex items-center gap-2",onClick:()=>Oe(X.objectId,1.2),children:" Zoom In (120%)"}),i.jsx("button",{className:"w-full px-4 py-2 text-left hover:bg-gray-800 text-sm text-gray-200 flex items-center gap-2",onClick:()=>Oe(X.objectId,.8),children:" Zoom Out (80%)"}),i.jsx("hr",{className:"border-gray-700 my-1"}),i.jsx("button",{className:"w-full px-4 py-2 text-left hover:bg-gray-800 text-sm text-gray-200 flex items-center gap-2",onClick:()=>be(X.objectId),children:" Duplicate"}),i.jsx("button",{className:"w-full px-4 py-2 text-left hover:bg-gray-800 text-sm text-gray-200 flex items-center gap-2",onClick:()=>Me(X.objectId),children:" Copy"}),ne&&i.jsx("button",{className:"w-full px-4 py-2 text-left hover:bg-gray-800 text-sm text-gray-200 flex items-center gap-2",onClick:()=>tt(),children:" Paste"}),i.jsx("hr",{className:"border-gray-700 my-1"}),i.jsx("button",{className:"w-full px-4 py-2 text-left hover:bg-red-800 text-sm text-red-300 flex items-center gap-2",onClick:()=>de(X.objectId),children:" Delete"})]}):ne&&i.jsx("button",{className:"w-full px-4 py-2 text-left hover:bg-gray-800 text-sm text-gray-200 flex items-center gap-2",onClick:()=>tt(),children:" Paste"})})]})}const Gx=[{id:"sleep",label:"Sleep",icon:"",color:"zone-sleep"},{id:"hygiene",label:"Hygiene",icon:"",color:"zone-hygiene"},{id:"food",label:"Food",icon:"",color:"zone-food"},{id:"exercise",label:"Exercise",icon:"",color:"zone-exercise"},{id:"medical",label:"Medical",icon:"",color:"zone-medical"},{id:"stowage",label:"Storage",icon:"",color:"zone-stowage"},{id:"work",label:"Work",icon:"",color:"zone-work"},{id:"common",label:"Common",icon:"",color:"zone-common"},{id:"airlock",label:"Airlock",icon:"",color:"zone-airlock"}],Kx=({enabled:t,onToggle:e,className:s})=>i.jsxs("div",{className:Ne("space-y-4",s),children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs(re,{variant:t?"primary":"surface",size:"md",onClick:()=>e(!t),className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:t?"":""}),"Zoning Overlay"]}),t&&i.jsx("div",{className:"text-sm text-muted-foreground",children:"Showing functional area zones and adjacency rules"})]}),t&&i.jsxs("div",{className:"glass p-4 rounded-lg animate-fade-in",children:[i.jsx("h4",{className:"text-sm font-medium text-text mb-3",children:"Functional Zones"}),i.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 lg:grid-cols-9 gap-2",children:Gx.map(n=>i.jsxs("div",{className:Ne("flex flex-col items-center gap-1 p-2 rounded-md text-xs",n.color),children:[i.jsx("div",{className:"text-base",children:n.icon}),i.jsx("span",{className:"text-center leading-tight",children:n.label})]},n.id))}),i.jsx("div",{className:"mt-4 pt-3 border-t border-muted text-xs text-muted-foreground",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-0 border-t-2 border-dashed border-success"}),i.jsx("span",{children:"Preferred Adjacent"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-4 h-0 border-t-2 border-dotted border-danger"}),i.jsx("span",{children:"Must Separate"})]})]})})]})]});function qx(){const[t,e]=Ke.useState(!1);return i.jsx("div",{className:"min-h-screen bg-bg text-text p-6",children:i.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-4xl font-bold text-text mb-2",children:" NASA-Tech Design System"}),i.jsx("p",{className:"text-muted-foreground",children:"Professional space habitat design components"})]}),i.jsx(bd,{})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Mission Metrics"}),i.jsx(_d,{nhv:245.8,pressurizedVolume:320.5,utilization:78.2,corridorStatus:"success"})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Functional Zoning"}),i.jsx(Kx,{enabled:t,onToggle:e})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Button Variants"}),i.jsxs("div",{className:"flex flex-wrap gap-4",children:[i.jsx(re,{variant:"primary",children:"Primary Action"}),i.jsx(re,{variant:"surface",children:"Surface Button"}),i.jsx(re,{variant:"ghost",children:"Ghost Button"}),i.jsx(re,{variant:"danger",children:"Danger Action"}),i.jsx(re,{variant:"outline",children:"Outline Button"}),i.jsx(re,{variant:"link",children:"Link Button"})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Status Badges"}),i.jsxs("div",{className:"flex flex-wrap gap-4",children:[i.jsx(we,{variant:"neutral",children:"Neutral Status"}),i.jsx(we,{variant:"success",children:" Success"}),i.jsx(we,{variant:"warning",children:"! Warning"}),i.jsx(we,{variant:"danger",children:" Danger"})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Glass Surfaces"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs(Fe,{className:"glass",children:[i.jsx(Qe,{children:i.jsx(Ze,{className:"flex items-center gap-2",children:" Lunar Module"})}),i.jsxs(qe,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Habitat module designed for lunar surface operations with enhanced radiation shielding."}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(we,{variant:"success",children:"Active"}),i.jsx(we,{variant:"neutral",children:"4 Crew"})]})]})]}),i.jsxs(Fe,{className:"glass",children:[i.jsx(Qe,{children:i.jsx(Ze,{className:"flex items-center gap-2",children:" Mars Module"})}),i.jsxs(qe,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Long-duration habitat for Mars surface missions with advanced life support systems."}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(we,{variant:"warning",children:"Standby"}),i.jsx(we,{variant:"neutral",children:"6 Crew"})]})]})]}),i.jsxs(Fe,{className:"glass",children:[i.jsx(Qe,{children:i.jsx(Ze,{className:"flex items-center gap-2",children:" Deep Space"})}),i.jsxs(qe,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Multi-year transit habitat with rotating sections for artificial gravity generation."}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(we,{variant:"danger",children:"Offline"}),i.jsx(we,{variant:"neutral",children:"8 Crew"})]})]})]})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-text",children:"Functional Zone Classes"}),i.jsxs("div",{className:"grid grid-cols-3 md:grid-cols-5 lg:grid-cols-9 gap-4",children:[i.jsxs("div",{className:"zone-sleep p-4 rounded-lg text-center",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"text-xs",children:"Sleep"})]}),i.jsxs("div",{className:"zone-hygiene p-4 rounded-lg text-center",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"text-xs",children:"Hygiene"})]}),i.jsxs("div",{className:"zone-food p-4 rounded-lg text-center",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"text-xs",children:"Food"})]}),i.jsxs("div",{className:"zone-exercise p-4 rounded-lg text-center",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"text-xs",children:"Exercise"})]}),i.jsxs("div",{className:"zone-medical p-4 rounded-lg text-center",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"text-xs",children:"Medical"})]}),i.jsxs("div",{className:"zone-stowage p-4 rounded-lg text-center",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"text-xs",children:"Storage"})]}),i.jsxs("div",{className:"zone-work p-4 rounded-lg text-center",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"text-xs",children:"Work"})]}),i.jsxs("div",{className:"zone-common p-4 rounded-lg text-center",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"text-xs",children:"Common"})]}),i.jsxs("div",{className:"zone-airlock p-4 rounded-lg text-center",children:[i.jsx("div",{className:"text-2xl mb-2",children:""}),i.jsx("div",{className:"text-xs",children:"Airlock"})]})]})]})]})})}function Yx({scale:t=60,onChange:e}){const[s,n]=g.useState([]),[r,o]=g.useState([]),[a,c]=g.useState(null),l=(m,p)=>[Math.round(m/.1)*.1,Math.round(p/.1)*.1],d=(m,p)=>{const x=l(m,p);if(a!==null){const b=[...r];b[a]=[...b[a]||[],x],o(b),e?.({outer:s,holes:b})}else{const b=[...s,x];n(b),e?.({outer:b,holes:r})}},h=()=>{o([...r,[]]),c(r.length)},u=()=>c(null),f=g.useMemo(()=>`0 0 ${5*t} ${5*t}`,[t]);return i.jsxs("div",{className:"border rounded-md overflow-hidden",children:[i.jsxs("div",{className:"flex items-center gap-2 p-2 text-xs",children:[i.jsx("button",{className:"px-2 py-1 border rounded",onClick:h,children:"New hole"}),i.jsx("button",{className:"px-2 py-1 border rounded",onClick:u,children:"End loop"}),i.jsx("span",{className:"opacity-60",children:"Click to add points. Grid 0.1 m."})]}),i.jsxs("svg",{viewBox:f,width:"100%",height:400,onClick:m=>{const x=m.target.closest("svg").getBoundingClientRect(),b=(m.clientX-x.left)/t,S=(m.clientY-x.top)/t;d(b,S)},children:[i.jsx("defs",{children:i.jsx("pattern",{id:"g",width:t*.5,height:t*.5,patternUnits:"userSpaceOnUse",children:i.jsx("path",{d:`M ${t*.5} 0 L 0 0 0 ${t*.5}`,stroke:"hsl(220 10% 20%)",strokeWidth:"1"})})}),i.jsx("rect",{x:0,y:0,width:5*t,height:5*t,fill:"url(#g)"}),s.length>=2&&i.jsx("polyline",{points:s.map(([m,p])=>`${m*t},${p*t}`).join(" "),fill:"none",stroke:"hsl(200 80% 60%)",strokeWidth:2,vectorEffect:"non-scaling-stroke"}),r.map((m,p)=>m.length>=2&&i.jsx("polyline",{points:m.map(([x,b])=>`${x*t},${b*t}`).join(" "),fill:"none",stroke:"hsl(350 80% 60%)",strokeWidth:2,vectorEffect:"non-scaling-stroke"},p)),[...s,...r.flat()].map((m,p)=>i.jsx("circle",{cx:m[0]*t,cy:m[1]*t,r:3,fill:"white",stroke:"black"},p))]})]})}let dn=null;const bi=new Map;function Xx(){return dn||(dn=new Worker(new URL("/assets/cadWorker-73BXrTju.js",import.meta.url),{type:"module"}),dn.onmessage=t=>{const{id:e}=t.data||{},s=bi.get(e);s&&s(t.data)},dn)}async function dc(t,e={}){const s=Xx(),n=crypto.randomUUID(),r=new Promise(a=>bi.set(n,a));s.postMessage({id:n,...t});const o=await Promise.race([r,new Promise((a,c)=>setTimeout(()=>c(new Error("Worker timeout")),e.timeoutMs??6e3))]);if(bi.delete(n),!o?.ok)throw new Error(o?.error||"Kernel error");return o.result}function Qx({onSaveModule:t}){const[e,s]=g.useState({outer:[]}),[n,r]=g.useState(2.2),[o,a]=g.useState(220),[c,l]=g.useState("CAD Shape"),[d,h]=g.useState(null),u=(e.outer?.length??0)>=3,f=async()=>{if(!u)return;const p=await dc({type:"PAD_PREVIEW",profile:e,height:n,tess:{chord:.02,angle:30}});h(p),dc({type:"TESSELLATE_REFINE",shape:p,tess:{chord:.003,angle:15}}).then(h).catch(()=>{})},m=()=>{if(!u)return;const p=e.outer.map(j=>j[0]),x=e.outer.map(j=>j[1]),b=Math.min(...p),S=Math.min(...x),y=Math.max(...p),w=Math.max(...x),v=y-b,C=w-S,T=([j,F])=>[j-b,F-S],_=e.outer.map(T),N=(e.holes||[]).map(j=>j.map(T));t({id:`cad-${crypto.randomUUID()}`,type:"WORKSTATION",level:0,position:[b,S],size:{w_m:v,l_m:C,h_m:n},rotation_deg:0,metadata:{visual:{shape2D:"POLYGON",polygon:_,holes:N,extrude_h_m:n,hue:o,label:c}}})};return i.jsxs("div",{className:"grid grid-cols-[320px_1fr_320px] gap-2 h-full",children:[i.jsxs("div",{className:"border rounded-md p-3 space-y-3",children:[i.jsx("h3",{className:"font-medium",children:"Tools"}),i.jsx("button",{className:"border rounded px-3 py-2 w-full",onClick:f,disabled:!u,children:"Preview Extrude"}),i.jsx("div",{className:"text-xs opacity-60",children:"Draw an outer loop (and holes). Grid 0.1 m."})]}),i.jsx("div",{className:"border rounded-md",children:i.jsx(Yx,{onChange:s})}),i.jsxs("div",{className:"border rounded-md p-3 space-y-3",children:[i.jsx("h3",{className:"font-medium",children:"Inspector"}),i.jsx("label",{className:"text-sm",children:"Height (m)"}),i.jsx("input",{type:"number",step:.1,value:n,onChange:p=>r(parseFloat(p.target.value)||0),className:"w-full border rounded px-2 py-1"}),i.jsx("label",{className:"text-sm",children:"Hue"}),i.jsx("input",{type:"range",min:0,max:360,value:o,onChange:p=>a(parseFloat(p.target.value)||0),className:"w-full"}),i.jsx("label",{className:"text-sm",children:"Label"}),i.jsx("input",{value:c,onChange:p=>l(p.target.value),className:"w-full border rounded px-2 py-1"}),i.jsx("button",{className:"border rounded px-3 py-2 w-full",onClick:m,disabled:!u,children:"Save to Layout"}),i.jsx("div",{className:"text-xs opacity-60",children:"Worker preview  refine. Saves to metadata.visual."})]})]})}function Zx({onDesignSelected:t}){const[e,s]=g.useState([]),[n,r]=g.useState([]),[o,a]=g.useState(""),[c,l]=g.useState(""),[d,h]=g.useState(!1),[u,f]=g.useState(null);g.useEffect(()=>{m()},[]),g.useEffect(()=>{let y=e;o&&(y=y.filter(w=>w.name.toLowerCase().includes(o.toLowerCase())||w.description?.toLowerCase().includes(o.toLowerCase())||w.tags.some(v=>v.toLowerCase().includes(o.toLowerCase())))),c&&(y=y.filter(w=>w.tags.includes(c))),r(y)},[e,o,c]);const m=async()=>{h(!0);try{await to();const y=await wd();console.log("Loaded designs:",y),s(y)}catch(y){console.error("Failed to load designs:",y)}finally{h(!1)}},p=()=>{const y=new Set;return e.forEach(w=>{w.tags.forEach(v=>y.add(v))}),Array.from(y).sort()},x=y=>{const w={scenario:{crew_size:4,mission_duration_days:365,destination:"MARS_SURFACE",fairing:{name:"Falcon 9",inner_diameter_m:5.2,inner_height_m:13.1,shape:"CONE"}},habitat:{shape:y.habitat?.shape||"CYLINDER",levels:y.habitat?.levels||1,dimensions:y.habitat?.dimensions||{diameter_m:6.5,height_m:12},pressurized_volume_m3:y.habitat?.pressurized_volume_m3||400,net_habitable_volume_m3:y.habitat?.net_habitable_volume_m3||300},modules:y.modules.map(v=>({id:v.id,type:v.type,level:v.level||0,position:v.position||[0,0],size:v.size||{w_m:2,l_m:2,h_m:2.2},rotation_deg:v.rotation_deg||0,crew_capacity:v.crew_capacity||0,equipment:v.equipment||[]}))};return{payload:JSON.stringify(w,null,2),designData:w}},b=y=>{f(y);const{payload:w,designData:v}=x(y.layout);t(w,v)},S=y=>new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(y));return i.jsxs(Fe,{className:"glass-morphism border-[var(--nasa-blue)]/30 shadow-2xl",children:[i.jsx(Qe,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs(Ze,{className:"text-white flex items-center gap-2",children:[i.jsx(mi,{className:"w-5 h-5 text-[var(--nasa-accent)]"}),"Collection Analysis"]}),i.jsx("p",{className:"text-[var(--brand-2)]",children:"Select a saved design from your collections to analyze"})]}),i.jsx(re,{variant:"outline",size:"sm",onClick:m,disabled:d,className:"border-[var(--nasa-blue)]/40 text-white hover:bg-[var(--nasa-blue)]/20",children:i.jsx(ra,{className:`w-4 h-4 ${d?"animate-spin":""}`})})]})}),i.jsxs(qe,{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(xd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),i.jsx("input",{type:"text",placeholder:"Search collections...",value:o,onChange:y=>a(y.target.value),className:"w-full pl-10 pr-4 py-2 bg-black/20 border border-[var(--nasa-blue)]/30 rounded-lg text-white placeholder-gray-400 focus:border-[var(--nasa-accent)]/50 focus:ring-1 focus:ring-[var(--nasa-accent)]/50"})]}),p().length>0&&i.jsxs("select",{value:c,onChange:y=>l(y.target.value),className:"px-3 py-2 bg-black/20 border border-[var(--nasa-blue)]/30 rounded-lg text-white focus:border-[var(--nasa-accent)]/50",children:[i.jsx("option",{value:"",children:"All Categories"}),p().map(y=>i.jsx("option",{value:y,children:y},y))]})]}),d?i.jsx("div",{className:"flex items-center justify-center h-32",children:i.jsx("div",{className:"text-gray-400",children:"Loading collections..."})}):n.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(mi,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-gray-300 mb-2",children:e.length===0?"No Saved Designs":"No Matching Designs"}),i.jsx("p",{className:"text-gray-400 mb-4",children:e.length===0?"Create and save designs first to analyze them here.":"Try adjusting your search or filter criteria."}),e.length===0&&i.jsxs(re,{onClick:()=>window.location.href="/design",className:"bg-[var(--nasa-accent)] hover:bg-[var(--nasa-accent)]/80 text-white",children:[i.jsx(oa,{className:"w-4 h-4 mr-2"}),"Create Design"]})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto",children:n.map(y=>i.jsxs("div",{className:`group relative bg-black/20 border rounded-lg p-4 cursor-pointer transition-all hover:bg-black/30 hover:border-[var(--nasa-accent)]/50 ${u?.id===y.id?"border-[var(--nasa-accent)] bg-[var(--nasa-accent)]/10":"border-[var(--nasa-blue)]/30"}`,onClick:()=>b(y),children:[i.jsxs("div",{className:"flex items-start justify-between mb-3",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-semibold text-white truncate",children:y.name}),i.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 mt-1",children:[i.jsx(dd,{className:"w-3 h-3"}),S(y.updatedAt)]})]}),u?.id===y.id&&i.jsx("div",{className:"w-2 h-2 bg-[var(--nasa-accent)] rounded-full"})]}),i.jsxs("div",{className:"space-y-2 mb-3",children:[y.description&&i.jsx("p",{className:"text-sm text-gray-300 line-clamp-2",children:y.description}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-400",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(yd,{className:"w-3 h-3"}),y.layout.modules.length," modules"]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(md,{className:"w-3 h-3"}),y.layout.habitat?.levels||1," level",(y.layout.habitat?.levels||1)!==1?"s":""]})]})]}),y.tags.length>0&&i.jsxs("div",{className:"flex flex-wrap gap-1 mb-3",children:[y.tags.slice(0,3).map(w=>i.jsx(we,{variant:"outline",className:"text-xs px-2 py-0 bg-[var(--nasa-blue)]/20 border-[var(--nasa-blue)]/30 text-[var(--nasa-blue)]",children:w},w)),y.tags.length>3&&i.jsxs(we,{variant:"outline",className:"text-xs px-2 py-0 text-gray-400",children:["+",y.tags.length-3]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("div",{className:"text-xs text-gray-400",children:"Click to select for analysis"}),i.jsx(gg,{className:"w-4 h-4 text-gray-400 group-hover:text-[var(--nasa-accent)] transition-colors"})]}),u?.id===y.id&&i.jsx("div",{className:"absolute inset-0 border-2 border-[var(--nasa-accent)] rounded-lg pointer-events-none",children:i.jsx("div",{className:"absolute -top-2 -right-2 bg-[var(--nasa-accent)] text-white text-xs px-2 py-1 rounded-full",children:"Selected"})})]},y.id))}),u&&i.jsx("div",{className:"mt-4 p-4 bg-[var(--nasa-accent)]/10 border border-[var(--nasa-accent)]/30 rounded-lg",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsxs("h4",{className:"font-medium text-white",children:["Selected: ",u.name]}),i.jsx("p",{className:"text-sm text-[var(--brand-2)]",children:"Analysis payload has been loaded into the editor"})]}),i.jsx(we,{className:"bg-[var(--nasa-accent)] text-white",children:"Ready for Analysis"})]})})]})]})}const Jx=`{
  "scenario": {
    "crew_size": 4,
    "mission_duration_days": 365,
    "destination": "MARS_SURFACE",
    "fairing": {
      "name": "Falcon 9",
      "inner_diameter_m": 5.2,
      "inner_height_m": 13.1,
      "shape": "CONE"
    }
  },
  "habitat": {
    "shape": "CYLINDER",
    "levels": 2,
    "dimensions": {
      "diameter_m": 6.5,
      "height_m": 12
    },
    "pressurized_volume_m3": 400,
    "net_habitable_volume_m3": 300
  },
  "modules": [
    {
      "id": "crew-sleep-6",
      "type": "CREW_SLEEP",
      "level": 0,
      "position": [0, 0],
      "size": { "w_m": 2, "l_m": 2.2, "h_m": 2.1 },
      "rotation_deg": 0,
      "crew_capacity": 1,
      "equipment": []
    },
    {
      "id": "food-prep-1",
      "type": "FOOD_PREP",
      "level": 0,
      "position": [6, 7],
      "size": { "w_m": 3, "l_m": 3, "h_m": 2.2 },
      "rotation_deg": 0,
      "equipment": []
    },
    {
      "id": "food-prep-1",
      "type": "FOOD_PREP",
      "level": 0,
      "position": [6, 7],
      "size": { "w_m": 3, "l_m": 3, "h_m": 2.2 },
      "rotation_deg": 0,
      "equipment": []
    },
    {
      "id": "food-prep-1",
      "type": "FOOD_PREP",
      "level": 0,
      "position": [6, 7],
      "size": { "w_m": 3, "l_m": 3, "h_m": 2.2 },
      "rotation_deg": 0,
      "equipment": []
    },
    {
      "id": "hygiene-1",
      "type": "HYGIENE",
      "level": 0,
      "position": [2, -2],
      "size": { "w_m": 2, "l_m": 2, "h_m": 2.2 },
      "rotation_deg": 0,
      "equipment": []
    },
    {
      "id": "exercise-1",
      "type": "EXERCISE",
      "level": 0,
      "position": [-1, -3.5],
      "size": { "w_m": 3, "l_m": 4, "h_m": 2.5 },
      "rotation_deg": 0,
      "equipment": []
    },
    {
      "id": "medical-2",
      "type": "MEDICAL",
      "level": 0,
      "position": [-6.5, -5],
      "size": { "w_m": 2.5, "l_m": 2.5, "h_m": 2.3 },
      "rotation_deg": 0,
      "equipment": []
    },
    {
      "id": "maintenance-3",
      "type": "MAINTENANCE",
      "level": 0,
      "position": [4.5, -3.5],
      "size": { "w_m": 2.5, "l_m": 2.5, "h_m": 2.3 },
      "rotation_deg": 0,
      "equipment": []
    },
    {
      "id": "maintenance-1",
      "type": "MAINTENANCE",
      "level": 0,
      "position": [-9, -2.5],
      "size": { "w_m": 2.5, "l_m": 2.5, "h_m": 2.3 },
      "rotation_deg": 0,
      "equipment": []
    }
  ],
  "version": "1.0.0"
}`,uc=(t,e)=>{try{const s=localStorage.getItem(t);return s?JSON.parse(s):e}catch(s){return console.warn(`Failed to load from localStorage key "${t}":`,s),e}},hc={SCENARIO:"nasa-habitat-scenario",OBJECTS:"nasa-habitat-objects"},No=()=>{const t=uc(hc.SCENARIO,{crew_size:4,mission_duration_days:365,destination:"MARS_SURFACE",fairing:{name:"Falcon 9",inner_diameter_m:5.2,inner_height_m:13.1,shape:"CONE"}}),s=uc(hc.OBJECTS,[]).map((n,r)=>({id:n.id||`module-${r}`,type:n.type||"CREW_SLEEP",level:0,position:[n.position?.x||0,n.position?.z||0],size:{w_m:n.size?.width||2,l_m:n.size?.depth||2,h_m:n.size?.height||2.1},rotation_deg:n.rotation?.y?n.rotation.y*180/Math.PI:0,crew_capacity:n.type==="CREW_SLEEP"?1:void 0,equipment:[]}));return{scenario:{crew_size:t.crew_size||4,mission_duration_days:t.mission_duration_days||365,destination:t.destination||"MARS_SURFACE",fairing:{name:t.fairing?.name||"Falcon 9",inner_diameter_m:t.fairing?.inner_diameter_m||5.2,inner_height_m:t.fairing?.inner_height_m||13.1,shape:t.fairing?.shape||"CONE"}},habitat:{shape:"CYLINDER",levels:1,dimensions:{diameter_m:6.5,height_m:12},pressurized_volume_m3:400,net_habitable_volume_m3:300},modules:s,version:"1.0.0"}};function ey(){const[t,e]=g.useState(""),[s,n]=g.useState(!1),[r,o]=g.useState(null),[a,c]=g.useState(null),[l,d]=g.useState(!1),[h,u]=g.useState(!1),[f,m]=g.useState(null);g.useEffect(()=>{(async()=>{try{await to()}catch(C){console.error("Failed to initialize database:",C)}const v=No();m(v),e(JSON.stringify(v,null,2))})();const w=()=>{const v=No();m(v),e(JSON.stringify(v,null,2))};return window.addEventListener("storage",w),()=>window.removeEventListener("storage",w)},[]);const p=()=>{const y=No();m(y),e(JSON.stringify(y,null,2))},x=async()=>{n(!0),o(null),c(null);try{const y=await vd(t);c(y)}catch(y){o(y?.message??String(y))}finally{n(!1)}},b=()=>{a&&(navigator.clipboard.writeText(JSON.stringify(a,null,2)),u(!0),setTimeout(()=>u(!1),2e3))},S=()=>{navigator.clipboard.writeText(t),u(!0),setTimeout(()=>u(!1),2e3)};return i.jsx("div",{className:"min-h-screen p-6",children:i.jsxs("div",{className:"max-w-7xl mx-auto",children:[i.jsxs("div",{className:"mb-8",children:[i.jsx("h1",{className:"text-4xl font-bold text-white mb-2 tracking-wide",children:"NASA Habitat Analysis"}),i.jsx("p",{className:"text-[var(--brand-2)]",children:"Advanced mission validation and optimization system"}),i.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[i.jsx(we,{variant:"outline",className:"text-green-400 border-green-400/30 bg-green-400/10",children:"API Connected"}),i.jsx(we,{variant:"outline",className:"text-[var(--brand)] border-[var(--brand)]/30 bg-[var(--brand)]/10",children:"Real-time Analysis"})]})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsx(Zx,{onDesignSelected:(y,w)=>{e(y),m(w)}}),!f?.modules?.length&&i.jsx(Fe,{className:"glass-morphism border-yellow-500/30 shadow-2xl",children:i.jsx(qe,{className:"pt-6",children:i.jsxs("div",{className:"text-center",children:[i.jsx(Jt,{className:"w-12 h-12 text-yellow-400 mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-yellow-200 mb-2",children:"No Habitat Design Found"}),i.jsx("p",{className:"text-yellow-300 mb-4",children:"Create a habitat design first to analyze it with NASA standards."}),i.jsxs(re,{onClick:()=>window.location.href="/design",className:"bg-yellow-600 hover:bg-yellow-700 text-white",children:[i.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Go to Design Area"]})]})})}),f?.modules?.length>0&&i.jsxs(Fe,{className:"bg-[var(--surface-1)] border border-[var(--border-weak)] shadow-[var(--glow)] backdrop-blur rounded-xl",children:[i.jsx(Qe,{children:i.jsxs(Ze,{className:"text-[var(--brand-2)] flex items-center gap-2",children:[i.jsx(hd,{className:"w-5 h-5"}),"Current Habitat Design"]})}),i.jsxs(qe,{children:[i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"bg-[var(--surface-1)] border border-[var(--border-weak)] rounded-xl p-3 text-center backdrop-blur shadow-[var(--glow)]",children:[i.jsx(yd,{className:"w-6 h-6 text-[var(--brand)] mx-auto mb-2"}),i.jsx("div",{className:"text-lg font-bold text-[var(--brand-2)]",children:f.scenario?.crew_size||0}),i.jsx("div",{className:"text-xs text-[var(--brand)]/80",children:"Crew Size"})]}),i.jsxs("div",{className:"bg-[var(--surface-1)] border border-[var(--border-weak)] rounded-xl p-3 text-center backdrop-blur shadow-[var(--glow)]",children:[i.jsx(Jt,{className:"w-6 h-6 text-[var(--brand)] mx-auto mb-2"}),i.jsx("div",{className:"text-lg font-bold text-[var(--brand-2)]",children:f.modules?.length||0}),i.jsx("div",{className:"text-xs text-[var(--brand)]/80",children:"Modules"})]}),i.jsxs("div",{className:"bg-[var(--surface-1)] border border-[var(--border-weak)] rounded-xl p-3 text-center backdrop-blur shadow-[var(--glow)]",children:[i.jsx(cg,{className:"w-6 h-6 text-[var(--brand)] mx-auto mb-2"}),i.jsx("div",{className:"text-lg font-bold text-[var(--brand-2)]",children:f.scenario?.mission_duration_days||0}),i.jsx("div",{className:"text-xs text-[var(--brand)]/80",children:"Mission Days"})]}),i.jsxs("div",{className:"bg-[var(--surface-1)] border border-[var(--border-weak)] rounded-xl p-3 text-center backdrop-blur shadow-[var(--glow)]",children:[i.jsx(md,{className:"w-6 h-6 text-[var(--brand)] mx-auto mb-2"}),i.jsx("div",{className:"text-lg font-bold text-[var(--brand-2)]",children:f.scenario?.destination||"Unknown"}),i.jsx("div",{className:"text-xs text-[var(--brand)]/80",children:"Destination"})]})]}),f.modules?.length>0&&i.jsxs("div",{className:"mt-4",children:[i.jsx("h4",{className:"text-sm font-medium text-purple-200 mb-2",children:"Module Breakdown:"}),i.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(f.modules.reduce((y,w)=>(y[w.type]=(y[w.type]||0)+1,y),{})).map(([y,w])=>i.jsxs(we,{variant:"outline",className:"text-purple-300 border-purple-500/30",children:[y,": ",w]},y))})]})]})]}),i.jsxs(Fe,{className:"glass-morphism border-blue-500/30 shadow-2xl",children:[i.jsx(Qe,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(Ze,{className:"text-white flex items-center gap-2",children:[i.jsx(ac,{className:"w-5 h-5 text-[var(--nasa-accent)]"}),"Mission Analysis Control"]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(re,{variant:"outline",size:"sm",onClick:p,className:"border-emerald-400/30 text-emerald-300 hover:bg-emerald-400/10 hover:border-emerald-400/50",children:[i.jsx(ra,{className:"w-4 h-4 mr-2"}),"Load Current Design"]}),i.jsxs(re,{variant:"outline",size:"sm",onClick:()=>d(!l),className:"border-[var(--nasa-blue)]/40 text-white hover:bg-[var(--nasa-blue)]/20 hover:border-[var(--nasa-blue)]/60",children:[i.jsx(Mg,{className:"w-4 h-4 mr-2"}),l?"Hide":"Show"," Payload",l?i.jsx(ld,{className:"w-4 h-4 ml-2"}):i.jsx(ta,{className:"w-4 h-4 ml-2"})]}),i.jsxs(re,{onClick:x,disabled:s,className:"bg-[var(--nasa-accent)] hover:bg-[var(--nasa-accent)]/80 text-white border-[var(--nasa-accent)]/60 shadow-lg shadow-[var(--nasa-accent)]/20",children:[i.jsx(ac,{className:"w-4 h-4 mr-2"}),s?"Analyzing...":"Run Analysis"]})]})]})}),i.jsxs(qe,{children:[l&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h3",{className:"text-sm font-medium text-white",children:"JSON Payload Editor"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(re,{variant:"outline",size:"sm",onClick:S,className:"border-[var(--nasa-blue)]/40 text-white hover:bg-[var(--nasa-blue)]/20 hover:border-[var(--nasa-blue)]/60",children:h?i.jsx(En,{className:"w-4 h-4"}):i.jsx(ic,{className:"w-4 h-4"})}),i.jsxs(re,{variant:"outline",size:"sm",onClick:()=>e(Jx),disabled:s,className:"border-[var(--nasa-blue)]/40 text-white hover:bg-[var(--nasa-blue)]/20 hover:border-[var(--nasa-blue)]/60 disabled:opacity-50",children:[i.jsx(gd,{className:"w-4 h-4 mr-2"}),"Reset"]})]})]}),i.jsx("textarea",{className:"w-full h-64 font-mono text-xs p-4 bg-gray-900/50 border border-blue-500/30 rounded-lg resize-none text-green-400 focus:outline-none focus:ring-2 focus:ring-blue-500",value:t,onChange:y=>e(y.target.value),placeholder:"Paste or edit the analyzer JSON payload here"})]}),r&&i.jsx("div",{className:"mt-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:i.jsx("p",{className:"text-red-300 text-sm",children:r})})]})]}),i.jsxs(Fe,{className:"glass-morphism border-[var(--nasa-blue)]/30 shadow-2xl",children:[i.jsx(Qe,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(Ze,{className:"text-white flex items-center gap-2",children:[i.jsx(En,{className:"w-5 h-5 text-emerald-400"}),"Analysis Results"]}),a&&i.jsxs(re,{size:"sm",variant:"outline",onClick:b,className:"border-emerald-400/30 text-emerald-300 hover:bg-emerald-400/10 hover:border-emerald-400/50",children:[h?i.jsx(En,{className:"w-4 h-4 mr-2"}):i.jsx(ic,{className:"w-4 h-4 mr-2"}),"Copy Results"]})]})}),i.jsx(qe,{children:i.jsx(Nd,{data:a})})]})]})]})})}class ty{get unloadPriorityCallback(){return this._unloadPriorityCallback}set unloadPriorityCallback(e){e.length===1?(console.warn('LRUCache: "unloadPriorityCallback" function has been changed to take two arguments.'),this._unloadPriorityCallback=(s,n)=>{const r=e(s),o=e(n);return r<o?-1:r>o?1:0}):this._unloadPriorityCallback=e}constructor(){this.minSize=6e3,this.maxSize=8e3,this.minBytesSize=.3*1073741824,this.maxBytesSize=.4*1073741824,this.unloadPercent=.05,this.autoMarkUnused=!0,this.itemSet=new Map,this.itemList=[],this.usedSet=new Set,this.callbacks=new Map,this.unloadingHandle=-1,this.cachedBytes=0,this.bytesMap=new Map,this.loadedSet=new Set,this._unloadPriorityCallback=null;const e=this.itemSet;this.defaultPriorityCallback=s=>e.get(s)}isFull(){return this.itemSet.size>=this.maxSize||this.cachedBytes>=this.maxBytesSize}getMemoryUsage(e){return this.bytesMap.get(e)||0}setMemoryUsage(e,s){const{bytesMap:n,itemSet:r}=this;r.has(e)&&(this.cachedBytes-=n.get(e)||0,n.set(e,s),this.cachedBytes+=s)}add(e,s){const n=this.itemSet;if(n.has(e)||this.isFull())return!1;const r=this.usedSet,o=this.itemList,a=this.callbacks;return o.push(e),r.add(e),n.set(e,Date.now()),a.set(e,s),!0}has(e){return this.itemSet.has(e)}remove(e){const s=this.usedSet,n=this.itemSet,r=this.itemList,o=this.bytesMap,a=this.callbacks,c=this.loadedSet;if(n.has(e)){this.cachedBytes-=o.get(e)||0,o.delete(e),a.get(e)(e);const l=r.indexOf(e);return r.splice(l,1),s.delete(e),n.delete(e),a.delete(e),c.delete(e),!0}return!1}setLoaded(e,s){const{itemSet:n,loadedSet:r}=this;n.has(e)&&(s===!0?r.add(e):r.delete(e))}markUsed(e){const s=this.itemSet,n=this.usedSet;s.has(e)&&!n.has(e)&&(s.set(e,Date.now()),n.add(e))}markUnused(e){this.usedSet.delete(e)}markAllUnused(){this.usedSet.clear()}unloadUnusedContent(){const{unloadPercent:e,minSize:s,maxSize:n,itemList:r,itemSet:o,usedSet:a,loadedSet:c,callbacks:l,bytesMap:d,minBytesSize:h,maxBytesSize:u}=this,f=r.length-a.size,m=r.length-c.size,p=Math.max(Math.min(r.length-s,f),0),x=this.cachedBytes-h,b=this.unloadPriorityCallback||this.defaultPriorityCallback;let S=!1;const y=p>0&&f>0||m&&r.length>n;if(f&&this.cachedBytes>h||m&&this.cachedBytes>u||y){r.sort((j,F)=>{const E=a.has(j),P=a.has(F);if(E===P){const B=c.has(j),k=c.has(F);return B===k?-b(j,F):B?1:-1}else return E?1:-1});const w=Math.max(s*e,p*e),v=Math.ceil(Math.min(w,f,p)),C=Math.max(e*x,e*h),T=Math.min(C,x);let _=0,N=0;for(;this.cachedBytes-N>u||r.length-_>n;){const j=r[_],F=d.get(j)||0;if(a.has(j)&&c.has(j)||this.cachedBytes-N-F<u&&r.length-_<=n)break;N+=F,_++}for(;N<T||_<v;){const j=r[_],F=d.get(j)||0;if(a.has(j)||this.cachedBytes-N-F<h&&_>=v)break;N+=F,_++}r.splice(0,_).forEach(j=>{this.cachedBytes-=d.get(j)||0,l.get(j)(j),d.delete(j),o.delete(j),l.delete(j),c.delete(j),a.delete(j)}),S=_<p||N<x&&_<f,S=S&&_>0}S&&(this.unloadingHandle=requestAnimationFrame(()=>this.scheduleUnload()))}scheduleUnload(){cancelAnimationFrame(this.unloadingHandle),this.scheduled||(this.scheduled=!0,queueMicrotask(()=>{this.scheduled=!1,this.unloadUnusedContent()}))}}let Co=class{get running(){return this.items.length!==0||this.currJobs!==0}constructor(){this.maxJobs=6,this.items=[],this.callbacks=new Map,this.currJobs=0,this.scheduled=!1,this.autoUpdate=!0,this.priorityCallback=null,this.schedulingCallback=e=>{requestAnimationFrame(e)},this._runjobs=()=>{this.scheduled=!1,this.tryRunJobs()}}sort(){const e=this.priorityCallback,s=this.items;e!==null&&s.sort(e)}has(e){return this.callbacks.has(e)}add(e,s){const n={callback:s,reject:null,resolve:null,promise:null};return n.promise=new Promise((r,o)=>{const a=this.items,c=this.callbacks;n.resolve=r,n.reject=o,a.unshift(e),c.set(e,n),this.autoUpdate&&this.scheduleJobRun()}),n.promise}remove(e){const s=this.items,n=this.callbacks,r=s.indexOf(e);if(r!==-1){const o=n.get(e);o.promise.catch(()=>{}),o.reject(new Error("PriorityQueue: Item removed.")),s.splice(r,1),n.delete(e)}}removeByFilter(e){const{items:s}=this;for(let n=0;n<s.length;n++){const r=s[n];e(r)&&this.remove(r)}}tryRunJobs(){this.sort();const e=this.items,s=this.callbacks,n=this.maxJobs;let r=0;const o=()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()};for(;n>this.currJobs&&e.length>0&&r<n;){this.currJobs++,r++;const a=e.pop(),{callback:c,resolve:l,reject:d}=s.get(a);s.delete(a);let h;try{h=c(a)}catch(u){d(u),o()}h instanceof Promise?h.then(l).catch(d).finally(o):(l(h),o())}}scheduleJobRun(){this.scheduled||(this.schedulingCallback(this._runjobs),this.scheduled=!0)}};const Ds=-1,Ht=0,Yn=1,Eo=2,kn=3,fc=6378137,sy=6356752314245179e-9;function ny(t,e=null,s=null){const n=[];for(n.push(t),n.push(null),n.push(0);n.length>0;){const r=n.pop(),o=n.pop(),a=n.pop();if(e&&e(a,o,r)){s&&s(a,o,r);return}const c=a.children;if(c)for(let l=c.length-1;l>=0;l--)n.push(c[l]),n.push(a),n.push(r+1);s&&s(a,o,r)}}function qs(t){if(t===null||t.byteLength<4)return"";let e;if(t instanceof DataView?e=t:e=new DataView(t),String.fromCharCode(e.getUint8(0))==="{")return null;let s="";for(let n=0;n<4;n++)s+=String.fromCharCode(e.getUint8(n));return s}const ry=new TextDecoder;function Ed(t){return ry.decode(t)}function aa(t){return t.replace(/[\\/][^\\/]+$/,"")+"/"}let so=class{constructor(){this.fetchOptions={},this.workingPath=""}load(...e){return console.warn('Loader: "load" function has been deprecated in favor of "loadAsync".'),this.loadAsync(...e)}loadAsync(e){return fetch(e,this.fetchOptions).then(s=>{if(!s.ok)throw new Error(`Failed to load file "${e}" with status ${s.status} : ${s.statusText}`);return s.arrayBuffer()}).then(s=>(this.workingPath===""&&(this.workingPath=aa(e)),this.parse(s)))}resolveExternalURL(e){return new URL(e,this.workingPath).href}parse(e){throw new Error("LoaderBase: Parse not implemented.")}};function mc(t){if(!t)return null;let e=t.length;const s=t.indexOf("?"),n=t.indexOf("#");s!==-1&&(e=Math.min(e,s)),n!==-1&&(e=Math.min(e,n));const r=t.lastIndexOf(".",e),o=t.lastIndexOf("/",e),a=t.indexOf("://");return a!==-1&&a+2===o||r===-1||r<o?null:t.substring(r+1,e)||null}const Xn={inView:!1,error:1/0,distanceFromCamera:1/0},Rd=!0;function Td(t){return t===kn||t===Ds}function es(t,e){return t.__lastFrameVisited===e&&t.__used}function ca(t){return t.__childrenProcessed===t.children.length}function la(t,e){t.__lastFrameVisited!==e.frameCount&&(t.__lastFrameVisited=e.frameCount,t.__used=!1,t.__inFrustum=!1,t.__isLeaf=!1,t.__visible=!1,t.__active=!1,t.__error=1/0,t.__distanceFromCamera=1/0,t.__allChildrenLoaded=!1,e.calculateTileViewError(t,Xn),t.__inFrustum=Xn.inView,t.__error=Xn.error,t.__distanceFromCamera=Xn.distanceFromCamera)}function jd(t,e){if(e.ensureChildrenArePreprocessed(t),la(t,e),vi(t,e),t.__hasUnrenderableContent&&ca(t)){const s=t.children;for(let n=0,r=s.length;n<r;n++)jd(s[n],e)}}function Pd(t,e){if(e.ensureChildrenArePreprocessed(t),es(t,e.frameCount)&&(t.__hasContent&&e.queueTileForDownload(t),ca(t))){const s=t.children;for(let n=0,r=s.length;n<r;n++)Pd(s[n],e)}}function vi(t,e){t.__used||(t.__used=!0,e.markTileUsed(t),e.stats.used++,t.__inFrustum===!0&&e.stats.inFrustum++)}function oy(t,e){return!(t.__error<=e.errorTarget&&!t.__hasUnrenderableContent||e.maxDepth>0&&t.__depth+1>=e.maxDepth||!ca(t))}function kd(t,e){if(e.ensureChildrenArePreprocessed(t),la(t,e),!t.__inFrustum)return;if(!oy(t,e)){vi(t,e);return}let s=!1,n=!1;const r=t.children;for(let o=0,a=r.length;o<a;o++){const c=r[o];kd(c,e),s=s||es(c,e.frameCount),n=n||c.__inFrustum}if(vi(t,e),s&&t.refine==="REPLACE"&&(t.__depth!==0||Rd))for(let o=0,a=r.length;o<a;o++){const c=r[o];jd(c,e)}}function Md(t,e){const s=e.frameCount;if(!es(t,s))return;const n=t.children;let r=!1;for(let o=0,a=n.length;o<a;o++){const c=n[o];r=r||es(c,s)}if(!r)t.__isLeaf=!0;else{let o=!0;for(let a=0,c=n.length;a<c;a++){const l=n[a];if(Md(l,e),es(l,s)){const d=l.__allChildrenLoaded||!l.__hasContent||l.__hasRenderableContent&&Td(l.__loadingState)||l.__hasUnrenderableContent&&l.__loadingState===Ds;o=o&&d}}t.__allChildrenLoaded=o}}function Ad(t,e){const s=e.stats;if(!es(t,e.frameCount))return;if(t.__isLeaf){t.__loadingState===kn?(t.__inFrustum&&(t.__visible=!0,s.visible++),t.__active=!0,s.active++):t.__hasContent&&e.queueTileForDownload(t);return}const n=t.children,r=t.__hasContent,o=Td(t.__loadingState)&&r,a=(e.errorTarget+1)*e.errorThreshold,c=t.__error<=a,l=t.refine==="ADD",d=t.__allChildrenLoaded||t.__depth===0&&!Rd;if(r&&(c||l)&&e.queueTileForDownload(t),(c&&o&&!d||o&&l)&&(t.__inFrustum&&(t.__visible=!0,s.visible++),t.__active=!0,s.active++),!l&&c&&!d)for(let h=0,u=n.length;h<u;h++){const f=n[h];es(f,e.frameCount)&&Pd(f,e)}else for(let h=0,u=n.length;h<u;h++)Ad(n[h],e)}function Ld(t,e){const s=es(t,e.frameCount);if(s||t.__usedLastFrame){let n=!1,r=!1;s?(n=t.__active,e.displayActiveTiles?r=t.__active||t.__visible:r=t.__visible):la(t,e),t.__hasRenderableContent&&t.__loadingState===kn&&(t.__wasSetActive!==n&&e.invokeOnePlugin(a=>a.setTileActive&&a.setTileActive(t,n)),t.__wasSetVisible!==r&&e.invokeOnePlugin(a=>a.setTileVisible&&a.setTileVisible(t,r))),t.__wasSetActive=n,t.__wasSetVisible=r,t.__usedLastFrame=s;const o=t.children;for(let a=0,c=o.length;a<c;a++){const l=o[a];Ld(l,e)}}}function iy(t){let e=null;return()=>{e===null&&(e=requestAnimationFrame(()=>{e=null,t()}))}}const pc=Symbol("PLUGIN_REGISTERED"),gc=(t,e)=>{const s=t.priority||0,n=e.priority||0;return s!==n?s>n?1:-1:t.__used!==e.__used?t.__used?1:-1:t.__error!==e.__error?t.__error>e.__error?1:-1:t.__distanceFromCamera!==e.__distanceFromCamera?t.__distanceFromCamera>e.__distanceFromCamera?-1:1:t.__depthFromRenderedParent!==e.__depthFromRenderedParent?t.__depthFromRenderedParent>e.__depthFromRenderedParent?-1:1:0},ay=(t,e)=>{const s=t.priority||0,n=e.priority||0;return s!==n?s>n?1:-1:t.__lastFrameVisited!==e.__lastFrameVisited?t.__lastFrameVisited>e.__lastFrameVisited?-1:1:t.__depthFromRenderedParent!==e.__depthFromRenderedParent?t.__depthFromRenderedParent>e.__depthFromRenderedParent?1:-1:t.__loadingState!==e.__loadingState?t.__loadingState>e.__loadingState?-1:1:t.__hasUnrenderableContent!==e.__hasUnrenderableContent?t.__hasUnrenderableContent?-1:1:t.__error!==e.__error?t.__error>e.__error?-1:1:0};let cy=class{get root(){const e=this.rootTileSet;return e?e.root:null}get loadProgress(){const{stats:e,isLoading:s}=this,n=e.downloading+e.parsing,r=e.inCacheSinceLoad+(s?1:0);return r===0?1:1-n/r}get errorThreshold(){return this._errorThreshold}set errorThreshold(e){console.warn('TilesRenderer: The "errorThreshold" option has been deprecated.'),this._errorThreshold=e}constructor(e=null){this.rootLoadingState=Ht,this.rootTileSet=null,this.rootURL=e,this.fetchOptions={},this.plugins=[],this.queuedTiles=[],this.cachedSinceLoadComplete=new Set,this.isLoading=!1;const s=new ty;s.unloadPriorityCallback=ay;const n=new Co;n.maxJobs=25,n.priorityCallback=gc;const r=new Co;r.maxJobs=5,r.priorityCallback=gc;const o=new Co;o.maxJobs=25,this.processedTiles=new WeakSet,this.visibleTiles=new Set,this.activeTiles=new Set,this.usedSet=new Set,this.lruCache=s,this.downloadQueue=n,this.parseQueue=r,this.processNodeQueue=o,this.stats={inCacheSinceLoad:0,inCache:0,parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0,this._dispatchNeedsUpdateEvent=iy(()=>{this.dispatchEvent({type:"needs-update"})}),this.errorTarget=16,this._errorThreshold=1/0,this.displayActiveTiles=!1,this.maxDepth=1/0}registerPlugin(e){if(e[pc]===!0)throw new Error("TilesRendererBase: A plugin can only be registered to a single tile set");const s=this.plugins,n=e.priority||0;let r=s.length;for(let o=0;o<s.length;o++)if((s[o].priority||0)>n){r=o;break}s.splice(r,0,e),e[pc]=!0,e.init&&e.init(this)}unregisterPlugin(e){const s=this.plugins;if(typeof e=="string"&&(e=this.getPluginByName(name)),s.includes(e)){const n=s.indexOf(e);return s.splice(n,1),e.dispose&&e.dispose(),!0}return!1}getPluginByName(e){return this.plugins.find(s=>s.name===e)||null}traverse(e,s,n=!0){this.root&&ny(this.root,(r,...o)=>(n&&this.ensureChildrenArePreprocessed(r,!0),e?e(r,...o):!1),s)}queueTileForDownload(e){e.__loadingState!==Ht||this.lruCache.isFull()||this.queuedTiles.push(e)}markTileUsed(e){this.usedSet.add(e),this.lruCache.markUsed(e)}update(){const{lruCache:e,usedSet:s,stats:n,root:r,downloadQueue:o,parseQueue:a,processNodeQueue:c}=this;if(this.rootLoadingState===Ht&&(this.rootLoadingState=Yn,this.invokeOnePlugin(d=>d.loadRootTileSet&&d.loadRootTileSet()).then(d=>{let h=this.rootURL;h!==null&&this.invokeAllPlugins(u=>h=u.preprocessURL?u.preprocessURL(h,null):h),this.rootLoadingState=kn,this.rootTileSet=d,this.dispatchEvent({type:"needs-update"}),this.dispatchEvent({type:"load-content"}),this.dispatchEvent({type:"load-tile-set",tileSet:d,url:h})}).catch(d=>{this.rootLoadingState=Ds,console.error(d),this.rootTileSet=null,this.dispatchEvent({type:"load-error",tile:null,error:d,url:this.rootURL})})),!r)return;n.inFrustum=0,n.used=0,n.active=0,n.visible=0,this.frameCount++,s.forEach(d=>e.markUnused(d)),s.clear(),kd(r,this),Md(r,this),Ad(r,this),Ld(r,this);const l=this.queuedTiles;l.sort(e.unloadPriorityCallback);for(let d=0,h=l.length;d<h&&!e.isFull();d++)this.requestTileContents(l[d]);l.length=0,e.scheduleUnload(),(o.running||a.running||c.running)===!1&&this.isLoading===!0&&(this.cachedSinceLoadComplete.clear(),n.inCacheSinceLoad=0,this.dispatchEvent({type:"tiles-load-end"}),this.isLoading=!1)}resetFailedTiles(){this.rootLoadingState===Ds&&(this.rootLoadingState=Ht);const e=this.stats;e.failed!==0&&(this.traverse(s=>{s.__loadingState===Ds&&(s.__loadingState=Ht)},null,!1),e.failed=0)}dispose(){[...this.plugins].forEach(n=>{this.unregisterPlugin(n)});const e=this.lruCache,s=[];this.traverse(n=>(s.push(n),!1),null,!1);for(let n=0,r=s.length;n<r;n++)e.remove(s[n]);this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0}calculateBytesUsed(e,s){return 0}dispatchEvent(e){}fetchData(e,s){return fetch(e,s)}parseTile(e,s,n){return null}disposeTile(e){e.__visible&&(this.invokeOnePlugin(s=>s.setTileVisible&&s.setTileVisible(e,!1)),e.__visible=!1),e.__active&&(this.invokeOnePlugin(s=>s.setTileActive&&s.setTileActive(e,!1)),e.__active=!1)}preprocessNode(e,s,n=null){var r;if(this.processedTiles.add(e),e.content&&(!("uri"in e.content)&&"url"in e.content&&(e.content.uri=e.content.url,delete e.content.url),e.content.boundingVolume&&!("box"in e.content.boundingVolume||"sphere"in e.content.boundingVolume||"region"in e.content.boundingVolume)&&delete e.content.boundingVolume),e.parent=n,e.children=e.children||[],(r=e.content)!=null&&r.uri){const o=mc(e.content.uri);e.__hasContent=!0,e.__hasUnrenderableContent=!!(o&&/json$/.test(o)),e.__hasRenderableContent=!e.__hasUnrenderableContent}else e.__hasContent=!1,e.__hasUnrenderableContent=!1,e.__hasRenderableContent=!1;e.__childrenProcessed=0,n&&n.__childrenProcessed++,e.__distanceFromCamera=1/0,e.__error=1/0,e.__inFrustum=!1,e.__isLeaf=!1,e.__usedLastFrame=!1,e.__used=!1,e.__wasSetVisible=!1,e.__visible=!1,e.__allChildrenLoaded=!1,e.__wasSetActive=!1,e.__active=!1,e.__loadingState=Ht,n===null?(e.__depth=0,e.__depthFromRenderedParent=e.__hasRenderableContent?1:0,e.refine=e.refine||"REPLACE"):(e.__depth=n.__depth+1,e.__depthFromRenderedParent=n.__depthFromRenderedParent+(e.__hasRenderableContent?1:0),e.refine=e.refine||n.refine),e.__basePath=s,e.__lastFrameVisited=-1,this.invokeAllPlugins(o=>{o!==this&&o.preprocessNode&&o.preprocessNode(e,s,n)})}setTileActive(e,s){s?this.activeTiles.add(e):this.activeTiles.delete(e)}setTileVisible(e,s){s?this.visibleTiles.add(e):this.visibleTiles.delete(e)}calculateTileViewError(e,s){}ensureChildrenArePreprocessed(e,s=!1){const n=e.children;for(let r=0,o=n.length;r<o;r++){const a=n[r];if("__depth"in a)break;s?(this.processNodeQueue.remove(a),this.preprocessNode(a,e.__basePath,e)):this.processNodeQueue.has(a)||this.processNodeQueue.add(a,c=>{this.preprocessNode(c,e.__basePath,e),this._dispatchNeedsUpdateEvent()})}}getBytesUsed(e){let s=0;return this.invokeAllPlugins(n=>{n.calculateBytesUsed&&(s+=n.calculateBytesUsed(e,e.cached.scene)||0)}),s}recalculateBytesUsed(e=null){const{lruCache:s,processedTiles:n}=this;e===null?s.itemSet.forEach(r=>{n.has(r)&&s.setMemoryUsage(r,this.getBytesUsed(r))}):s.setMemoryUsage(e,this.getBytesUsed(e))}preprocessTileSet(e,s,n=null){const r=e.asset.version,[o,a]=r.split(".").map(l=>parseInt(l));console.assert(o<=1,"TilesRenderer: asset.version is expected to be a 1.x or a compatible version."),o===1&&a>0&&console.warn("TilesRenderer: tiles versions at 1.1 or higher have limited support. Some new extensions and features may not be supported.");let c=s.replace(/\/[^/]*$/,"");c=new URL(c,window.location.href).toString(),this.preprocessNode(e.root,c,n)}loadRootTileSet(){let e=this.rootURL;return this.invokeAllPlugins(s=>e=s.preprocessURL?s.preprocessURL(e,null):e),this.invokeOnePlugin(s=>s.fetchData&&s.fetchData(e,this.fetchOptions)).then(s=>{if(s instanceof Response){if(s.ok)return s.json();throw new Error(`TilesRenderer: Failed to load tileset "${e}" with status ${s.status} : ${s.statusText}`)}else return s}).then(s=>(this.preprocessTileSet(s,e),s))}requestTileContents(e){if(e.__loadingState!==Ht)return;let s=!1,n=null,r=new URL(e.content.uri,e.__basePath+"/").toString();this.invokeAllPlugins(f=>r=f.preprocessURL?f.preprocessURL(r,e):r);const o=this.stats,a=this.lruCache,c=this.downloadQueue,l=this.parseQueue,d=mc(r),h=new AbortController,u=h.signal;if(a.add(e,f=>{h.abort(),s?(f.children.length=0,f.__childrenProcessed=0):this.invokeAllPlugins(m=>{m.disposeTile&&m.disposeTile(f)}),o.inCache--,this.cachedSinceLoadComplete.has(e)&&(this.cachedSinceLoadComplete.delete(e),o.inCacheSinceLoad--),f.__loadingState===Yn?o.downloading--:f.__loadingState===Eo&&o.parsing--,f.__loadingState=Ht,l.remove(f),c.remove(f)}))return this.isLoading||(this.isLoading=!0,this.dispatchEvent({type:"tiles-load-start"})),a.setMemoryUsage(e,this.getBytesUsed(e)),this.cachedSinceLoadComplete.add(e),o.inCacheSinceLoad++,o.inCache++,o.downloading++,e.__loadingState=Yn,c.add(e,f=>{if(u.aborted)return Promise.resolve();const m=this.invokeOnePlugin(p=>p.fetchData&&p.fetchData(r,{...this.fetchOptions,signal:u}));return this.dispatchEvent({type:"tile-download-start",tile:e}),m}).then(f=>{if(!u.aborted)if(f instanceof Response){if(f.ok)return d==="json"?f.json():f.arrayBuffer();throw new Error(`Failed to load model with error code ${f.status}`)}else return f}).then(f=>{if(!u.aborted)return o.downloading--,o.parsing++,e.__loadingState=Eo,l.add(e,m=>u.aborted?Promise.resolve():d==="json"&&f.root?(this.preprocessTileSet(f,r,e),e.children.push(f.root),n=f,s=!0,Promise.resolve()):this.invokeOnePlugin(p=>p.parseTile&&p.parseTile(f,m,d,r,u)))}).then(()=>{if(u.aborted)return;o.parsing--,e.__loadingState=kn,a.setLoaded(e,!0);const f=this.getBytesUsed(e);if(a.getMemoryUsage(e)===0&&f>0&&a.isFull()){a.remove(e);return}a.setMemoryUsage(e,f),this.dispatchEvent({type:"needs-update"}),this.dispatchEvent({type:"load-content"}),s&&this.dispatchEvent({type:"load-tile-set",tileSet:n,url:r}),e.cached.scene&&this.dispatchEvent({type:"load-model",scene:e.cached.scene,tile:e})}).catch(f=>{u.aborted||(f.name!=="AbortError"?(l.remove(e),c.remove(e),e.__loadingState===Eo?o.parsing--:e.__loadingState===Yn&&o.downloading--,o.failed++,console.error(`TilesRenderer : Failed to load tile at url "${e.content.uri}".`),console.error(f),e.__loadingState=Ds,a.setLoaded(e,!0),this.dispatchEvent({type:"load-error",tile:e,error:f,url:r})):a.remove(e))})}getAttributions(e=[]){return this.invokeAllPlugins(s=>s!==this&&s.getAttributions&&s.getAttributions(e)),e}invokeOnePlugin(e){const s=[...this.plugins,this];for(let n=0;n<s.length;n++){const r=e(s[n]);if(r)return r}return null}invokeAllPlugins(e){const s=[...this.plugins,this],n=[];for(let r=0;r<s.length;r++){const o=e(s[r]);o&&n.push(o)}return n.length===0?null:Promise.all(n)}};function Od(t,e,s,n,r,o){let a;switch(n){case"SCALAR":a=1;break;case"VEC2":a=2;break;case"VEC3":a=3;break;case"VEC4":a=4;break;default:throw new Error(`FeatureTable : Feature type not provided for "${o}".`)}let c;const l=s*a;switch(r){case"BYTE":c=new Int8Array(t,e,l);break;case"UNSIGNED_BYTE":c=new Uint8Array(t,e,l);break;case"SHORT":c=new Int16Array(t,e,l);break;case"UNSIGNED_SHORT":c=new Uint16Array(t,e,l);break;case"INT":c=new Int32Array(t,e,l);break;case"UNSIGNED_INT":c=new Uint32Array(t,e,l);break;case"FLOAT":c=new Float32Array(t,e,l);break;case"DOUBLE":c=new Float64Array(t,e,l);break;default:throw new Error(`FeatureTable : Feature component type not provided for "${o}".`)}return c}class no{constructor(e,s,n,r){this.buffer=e,this.binOffset=s+n,this.binLength=r;let o=null;if(n!==0){const a=new Uint8Array(e,s,n);o=JSON.parse(Ed(a))}else o={};this.header=o}getKeys(){return Object.keys(this.header).filter(e=>e!=="extensions")}getData(e,s,n=null,r=null){const o=this.header;if(!(e in o))return null;const a=o[e];if(a instanceof Object){if(Array.isArray(a))return a;{const{buffer:c,binOffset:l,binLength:d}=this,h=a.byteOffset||0,u=a.type||r,f=a.componentType||n;if("type"in a&&r&&a.type!==r)throw new Error("FeatureTable: Specified type does not match expected type.");const m=l+h,p=Od(c,m,s,u,f,e);if(m+p.byteLength>l+d)throw new Error("FeatureTable: Feature data read outside binary body length.");return p}}else return a}getBuffer(e,s){const{buffer:n,binOffset:r}=this;return n.slice(r+e,r+e+s)}}let ly=class{constructor(e){this.batchTable=e;const s=e.header.extensions["3DTILES_batch_table_hierarchy"];this.classes=s.classes;for(const r of this.classes){const o=r.instances;for(const a in o)r.instances[a]=this._parseProperty(o[a],r.length,a)}if(this.instancesLength=s.instancesLength,this.classIds=this._parseProperty(s.classIds,this.instancesLength,"classIds"),s.parentCounts?this.parentCounts=this._parseProperty(s.parentCounts,this.instancesLength,"parentCounts"):this.parentCounts=new Array(this.instancesLength).fill(1),s.parentIds){const r=this.parentCounts.reduce((o,a)=>o+a,0);this.parentIds=this._parseProperty(s.parentIds,r,"parentIds")}else this.parentIds=null;this.instancesIds=[];const n={};for(const r of this.classIds)n[r]=n[r]??0,this.instancesIds.push(n[r]),n[r]++}_parseProperty(e,s,n){if(Array.isArray(e))return e;{const{buffer:r,binOffset:o}=this.batchTable,a=e.byteOffset,c=e.componentType||"UNSIGNED_SHORT",l=o+a;return Od(r,l,s,"SCALAR",c,n)}}getDataFromId(e,s={}){const n=this.parentCounts[e];if(this.parentIds&&n>0){let l=0;for(let d=0;d<e;d++)l+=this.parentCounts[d];for(let d=0;d<n;d++){const h=this.parentIds[l+d];h!==e&&this.getDataFromId(h,s)}}const r=this.classIds[e],o=this.classes[r].instances,a=this.classes[r].name,c=this.instancesIds[e];for(const l in o)s[a]=s[a]||{},s[a][l]=o[l][c];return s}};class da extends no{get batchSize(){return console.warn("BatchTable.batchSize has been deprecated and replaced with BatchTable.count."),this.count}constructor(e,s,n,r,o){super(e,n,r,o),this.count=s,this.extensions={};const a=this.header.extensions;a&&a["3DTILES_batch_table_hierarchy"]&&(this.extensions["3DTILES_batch_table_hierarchy"]=new ly(this))}getData(e,s=null,n=null){return console.warn("BatchTable: BatchTable.getData is deprecated. Use BatchTable.getDataFromId to get allproperties for an id or BatchTable.getPropertyArray for getting an array of value for a property."),super.getData(e,this.count,s,n)}getDataFromId(e,s={}){if(e<0||e>=this.count)throw new Error(`BatchTable: id value "${e}" out of bounds for "${this.count}" features number.`);for(const n of this.getKeys())s[n]=super.getData(n,this.count)[e];for(const n in this.extensions){const r=this.extensions[n];r.getDataFromId instanceof Function&&(s[n]=s[n]||{},r.getDataFromId(e,s[n]))}return s}getPropertyArray(e){return super.getData(e,this.count)}}let dy=class extends so{parse(e){const s=new DataView(e),n=qs(s);console.assert(n==="b3dm");const r=s.getUint32(4,!0);console.assert(r===1);const o=s.getUint32(8,!0);console.assert(o===e.byteLength);const a=s.getUint32(12,!0),c=s.getUint32(16,!0),l=s.getUint32(20,!0),d=s.getUint32(24,!0),h=28,u=e.slice(h,h+a+c),f=new no(u,0,a,c),m=h+a+c,p=e.slice(m,m+l+d),x=new da(p,f.getData("BATCH_LENGTH"),0,l,d),b=m+l+d,S=new Uint8Array(e,b,o-b);return{version:r,featureTable:f,batchTable:x,glbBytes:S}}},uy=class extends so{parse(e){const s=new DataView(e),n=qs(s);console.assert(n==="i3dm");const r=s.getUint32(4,!0);console.assert(r===1);const o=s.getUint32(8,!0);console.assert(o===e.byteLength);const a=s.getUint32(12,!0),c=s.getUint32(16,!0),l=s.getUint32(20,!0),d=s.getUint32(24,!0),h=s.getUint32(28,!0),u=32,f=e.slice(u,u+a+c),m=new no(f,0,a,c),p=u+a+c,x=e.slice(p,p+l+d),b=new da(x,m.getData("INSTANCES_LENGTH"),0,l,d),S=p+l+d,y=new Uint8Array(e,S,o-S);let w=null,v=null,C=null;if(h)w=y,v=Promise.resolve();else{const T=this.resolveExternalURL(Ed(y));C=aa(T),v=fetch(T,this.fetchOptions).then(_=>{if(!_.ok)throw new Error(`I3DMLoaderBase : Failed to load file "${T}" with status ${_.status} : ${_.statusText}`);return _.arrayBuffer()}).then(_=>{w=new Uint8Array(_)})}return v.then(()=>({version:r,featureTable:m,batchTable:b,glbBytes:w,gltfWorkingPath:C}))}};class hy extends so{parse(e){const s=new DataView(e),n=qs(s);console.assert(n==="pnts");const r=s.getUint32(4,!0);console.assert(r===1);const o=s.getUint32(8,!0);console.assert(o===e.byteLength);const a=s.getUint32(12,!0),c=s.getUint32(16,!0),l=s.getUint32(20,!0),d=s.getUint32(24,!0),h=28,u=e.slice(h,h+a+c),f=new no(u,0,a,c),m=h+a+c,p=e.slice(m,m+l+d),x=new da(p,f.getData("BATCH_LENGTH")||f.getData("POINTS_LENGTH"),0,l,d);return Promise.resolve({version:r,featureTable:f,batchTable:x})}}class fy extends so{parse(e){const s=new DataView(e),n=qs(s);console.assert(n==="cmpt",'CMPTLoader: The magic bytes equal "cmpt".');const r=s.getUint32(4,!0);console.assert(r===1,'CMPTLoader: The version listed in the header is "1".');const o=s.getUint32(8,!0);console.assert(o===e.byteLength,"CMPTLoader: The contents buffer length listed in the header matches the file.");const a=s.getUint32(12,!0),c=[];let l=16;for(let d=0;d<a;d++){const h=new DataView(e,l,12),u=qs(h),f=h.getUint32(4,!0),m=h.getUint32(8,!0),p=new Uint8Array(e,l,m);c.push({type:u,buffer:p,version:f}),l+=m}return{version:r,tiles:c}}}function my(t){let e=0;for(const n in t.attributes){const r=t.getAttribute(n);e+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const s=t.getIndex();return e+=s?s.count*s.itemSize*s.array.BYTES_PER_ELEMENT:0,e}function xc(t,e){if(e===Rh)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===Zo||e===bl){let s=t.getIndex();if(s===null){const a=[],c=t.getAttribute("position");if(c!==void 0){for(let l=0;l<c.count;l++)a.push(l);t.setIndex(a),s=t.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t}const n=s.count-2,r=[];if(e===Zo)for(let a=1;a<=n;a++)r.push(s.getX(0)),r.push(s.getX(a)),r.push(s.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(r.push(s.getX(a)),r.push(s.getX(a+1)),r.push(s.getX(a+2))):(r.push(s.getX(a+2)),r.push(s.getX(a+1)),r.push(s.getX(a)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=t.clone();return o.setIndex(r),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}class ua extends Th{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(s){return new by(s)}),this.register(function(s){return new vy(s)}),this.register(function(s){return new jy(s)}),this.register(function(s){return new Py(s)}),this.register(function(s){return new ky(s)}),this.register(function(s){return new Sy(s)}),this.register(function(s){return new _y(s)}),this.register(function(s){return new Ny(s)}),this.register(function(s){return new Cy(s)}),this.register(function(s){return new yy(s)}),this.register(function(s){return new Ey(s)}),this.register(function(s){return new wy(s)}),this.register(function(s){return new Ty(s)}),this.register(function(s){return new Ry(s)}),this.register(function(s){return new gy(s)}),this.register(function(s){return new My(s)}),this.register(function(s){return new Ay(s)})}load(e,s,n,r){const o=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const d=Sn.extractUrlBase(e);a=Sn.resolveURL(d,this.path)}else a=Sn.extractUrlBase(e);this.manager.itemStart(e);const c=function(d){r?r(d):console.error(d),o.manager.itemError(e),o.manager.itemEnd(e)},l=new vl(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(d){try{o.parse(d,a,function(h){s(h),o.manager.itemEnd(e)},c)}catch(h){c(h)}},n,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,s,n,r){let o;const a={},c={},l=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===Dd){try{a[le.KHR_BINARY_GLTF]=new Ly(e)}catch(u){r&&r(u);return}o=JSON.parse(a[le.KHR_BINARY_GLTF].content)}else o=JSON.parse(l.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const d=new Ky(o,{path:s||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](d);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),c[u.name]=u,a[u.name]=!0}if(o.extensionsUsed)for(let h=0;h<o.extensionsUsed.length;++h){const u=o.extensionsUsed[h],f=o.extensionsRequired||[];switch(u){case le.KHR_MATERIALS_UNLIT:a[u]=new xy;break;case le.KHR_DRACO_MESH_COMPRESSION:a[u]=new Oy(o,this.dracoLoader);break;case le.KHR_TEXTURE_TRANSFORM:a[u]=new Dy;break;case le.KHR_MESH_QUANTIZATION:a[u]=new Iy;break;default:f.indexOf(u)>=0&&c[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}d.setExtensions(a),d.setPlugins(c),d.parse(n,r)}parseAsync(e,s){const n=this;return new Promise(function(r,o){n.parse(e,s,r,o)})}}function py(){let t={};return{get:function(e){return t[e]},add:function(e,s){t[e]=s},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const le={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class gy{constructor(e){this.parser=e,this.name=le.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,s=this.parser.json.nodes||[];for(let n=0,r=s.length;n<r;n++){const o=s[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const s=this.parser,n="light:"+e;let r=s.cache.get(n);if(r)return r;const o=s.json,l=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let d;const h=new ze(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],Dt);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":d=new Vs(h),d.target.position.set(0,0,-1),d.add(d.target);break;case"point":d=new Ph(h),d.distance=u;break;case"spot":d=new jh(h),d.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,d.angle=l.spot.outerConeAngle,d.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,d.target.position.set(0,0,-1),d.add(d.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return d.position.set(0,0,0),gt(d,l),l.intensity!==void 0&&(d.intensity=l.intensity),d.name=s.createUniqueName(l.name||"light_"+e),r=Promise.resolve(d),s.cache.add(n,r),r}getDependency(e,s){if(e==="light")return this._loadLight(s)}createNodeAttachment(e){const s=this,n=this.parser,o=n.json.nodes[e],c=(o.extensions&&o.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(l){return n._getNodeRef(s.cache,c,l)})}}class xy{constructor(){this.name=le.KHR_MATERIALS_UNLIT}getMaterialType(){return qt}extendParams(e,s,n){const r=[];e.color=new ze(1,1,1),e.opacity=1;const o=s.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const a=o.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],Dt),e.opacity=a[3]}o.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",o.baseColorTexture,Tn))}return Promise.all(r)}}class yy{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,s){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=r.extensions[this.name].emissiveStrength;return o!==void 0&&(s.emissiveIntensity=o),Promise.resolve()}}class by{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ct}extendMaterialParams(e,s){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];if(a.clearcoatFactor!==void 0&&(s.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&o.push(n.assignTexture(s,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(s.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(s,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(s,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const c=a.clearcoatNormalTexture.scale;s.clearcoatNormalScale=new ve(c,c)}return Promise.all(o)}}class vy{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ct}extendMaterialParams(e,s){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=r.extensions[this.name];return s.dispersion=o.dispersion!==void 0?o.dispersion:0,Promise.resolve()}}class wy{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ct}extendMaterialParams(e,s){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.iridescenceFactor!==void 0&&(s.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&o.push(n.assignTexture(s,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(s.iridescenceIOR=a.iridescenceIor),s.iridescenceThicknessRange===void 0&&(s.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(s.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(s.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(s,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(o)}}class Sy{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ct}extendMaterialParams(e,s){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[];s.sheenColor=new ze(0,0,0),s.sheenRoughness=0,s.sheen=1;const a=r.extensions[this.name];if(a.sheenColorFactor!==void 0){const c=a.sheenColorFactor;s.sheenColor.setRGB(c[0],c[1],c[2],Dt)}return a.sheenRoughnessFactor!==void 0&&(s.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&o.push(n.assignTexture(s,"sheenColorMap",a.sheenColorTexture,Tn)),a.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(s,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(o)}}class _y{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ct}extendMaterialParams(e,s){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.transmissionFactor!==void 0&&(s.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&o.push(n.assignTexture(s,"transmissionMap",a.transmissionTexture)),Promise.all(o)}}class Ny{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ct}extendMaterialParams(e,s){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];s.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&o.push(n.assignTexture(s,"thicknessMap",a.thicknessTexture)),s.attenuationDistance=a.attenuationDistance||1/0;const c=a.attenuationColor||[1,1,1];return s.attenuationColor=new ze().setRGB(c[0],c[1],c[2],Dt),Promise.all(o)}}class Cy{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ct}extendMaterialParams(e,s){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=r.extensions[this.name];return s.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class Ey{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ct}extendMaterialParams(e,s){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];s.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&o.push(n.assignTexture(s,"specularIntensityMap",a.specularTexture));const c=a.specularColorFactor||[1,1,1];return s.specularColor=new ze().setRGB(c[0],c[1],c[2],Dt),a.specularColorTexture!==void 0&&o.push(n.assignTexture(s,"specularColorMap",a.specularColorTexture,Tn)),Promise.all(o)}}class Ry{constructor(e){this.parser=e,this.name=le.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ct}extendMaterialParams(e,s){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return s.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&o.push(n.assignTexture(s,"bumpMap",a.bumpTexture)),Promise.all(o)}}class Ty{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ct}extendMaterialParams(e,s){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.anisotropyStrength!==void 0&&(s.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(s.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&o.push(n.assignTexture(s,"anisotropyMap",a.anisotropyTexture)),Promise.all(o)}}class jy{constructor(e){this.parser=e,this.name=le.KHR_TEXTURE_BASISU}loadTexture(e){const s=this.parser,n=s.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const o=r.extensions[this.name],a=s.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return s.loadTextureImage(e,o.source,a)}}class Py{constructor(e){this.parser=e,this.name=le.EXT_TEXTURE_WEBP}loadTexture(e){const s=this.name,n=this.parser,r=n.json,o=r.textures[e];if(!o.extensions||!o.extensions[s])return null;const a=o.extensions[s],c=r.images[a.source];let l=n.textureLoader;if(c.uri){const d=n.options.manager.getHandler(c.uri);d!==null&&(l=d)}return n.loadTextureImage(e,a.source,l)}}class ky{constructor(e){this.parser=e,this.name=le.EXT_TEXTURE_AVIF}loadTexture(e){const s=this.name,n=this.parser,r=n.json,o=r.textures[e];if(!o.extensions||!o.extensions[s])return null;const a=o.extensions[s],c=r.images[a.source];let l=n.textureLoader;if(c.uri){const d=n.options.manager.getHandler(c.uri);d!==null&&(l=d)}return n.loadTextureImage(e,a.source,l)}}class My{constructor(e){this.name=le.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const s=this.parser.json,n=s.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],o=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(c){const l=r.byteOffset||0,d=r.byteLength||0,h=r.count,u=r.byteStride,f=new Uint8Array(c,l,d);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(h,u,f,r.mode,r.filter).then(function(m){return m.buffer}):a.ready.then(function(){const m=new ArrayBuffer(h*u);return a.decodeGltfBuffer(new Uint8Array(m),h,u,f,r.mode,r.filter),m})})}else return null}}class Ay{constructor(e){this.name=le.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const s=this.parser.json,n=s.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=s.meshes[n.mesh];for(const d of r.primitives)if(d.mode!==rt.TRIANGLES&&d.mode!==rt.TRIANGLE_STRIP&&d.mode!==rt.TRIANGLE_FAN&&d.mode!==void 0)return null;const a=n.extensions[this.name].attributes,c=[],l={};for(const d in a)c.push(this.parser.getDependency("accessor",a[d]).then(h=>(l[d]=h,l[d])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(d=>{const h=d.pop(),u=h.isGroup?h.children:[h],f=d[0].count,m=[];for(const p of u){const x=new Se,b=new $,S=new ys,y=new $(1,1,1),w=new wl(p.geometry,p.material,f);for(let v=0;v<f;v++)l.TRANSLATION&&b.fromBufferAttribute(l.TRANSLATION,v),l.ROTATION&&S.fromBufferAttribute(l.ROTATION,v),l.SCALE&&y.fromBufferAttribute(l.SCALE,v),w.setMatrixAt(v,x.compose(b,S,y));for(const v in l)if(v==="_COLOR_0"){const C=l[v];w.instanceColor=new kh(C.array,C.itemSize,C.normalized)}else v!=="TRANSLATION"&&v!=="ROTATION"&&v!=="SCALE"&&p.geometry.setAttribute(v,l[v]);Sl.prototype.copy.call(w,p),this.parser.assignFinalMaterial(w),m.push(w)}return h.isGroup?(h.clear(),h.add(...m),h):m[0]}))}}const Dd="glTF",un=12,yc={JSON:1313821514,BIN:5130562};class Ly{constructor(e){this.name=le.KHR_BINARY_GLTF,this.content=null,this.body=null;const s=new DataView(e,0,un),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},this.header.magic!==Dd)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-un,o=new DataView(e,un);let a=0;for(;a<r;){const c=o.getUint32(a,!0);a+=4;const l=o.getUint32(a,!0);if(a+=4,l===yc.JSON){const d=new Uint8Array(e,un+a,c);this.content=n.decode(d)}else if(l===yc.BIN){const d=un+a;this.body=e.slice(d,d+c)}a+=c}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Oy{constructor(e,s){if(!s)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=le.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=s,this.dracoLoader.preload()}decodePrimitive(e,s){const n=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,c={},l={},d={};for(const h in a){const u=wi[h]||h.toLowerCase();c[u]=a[h]}for(const h in e.attributes){const u=wi[h]||h.toLowerCase();if(a[h]!==void 0){const f=n.accessors[e.attributes[h]],m=Bs[f.componentType];d[u]=m.name,l[u]=f.normalized===!0}}return s.getDependency("bufferView",o).then(function(h){return new Promise(function(u,f){r.decodeDracoFile(h,function(m){for(const p in m.attributes){const x=m.attributes[p],b=l[p];b!==void 0&&(x.normalized=b)}u(m)},c,d,Dt,f)})})}}class Dy{constructor(){this.name=le.KHR_TEXTURE_TRANSFORM}extendTexture(e,s){return(s.texCoord===void 0||s.texCoord===e.channel)&&s.offset===void 0&&s.rotation===void 0&&s.scale===void 0||(e=e.clone(),s.texCoord!==void 0&&(e.channel=s.texCoord),s.offset!==void 0&&e.offset.fromArray(s.offset),s.rotation!==void 0&&(e.rotation=s.rotation),s.scale!==void 0&&e.repeat.fromArray(s.scale),e.needsUpdate=!0),e}}class Iy{constructor(){this.name=le.KHR_MESH_QUANTIZATION}}class Id extends Yh{constructor(e,s,n,r){super(e,s,n,r)}copySampleValue_(e){const s=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=e*r*3+r;for(let a=0;a!==r;a++)s[a]=n[o+a];return s}interpolate_(e,s,n,r){const o=this.resultBuffer,a=this.sampleValues,c=this.valueSize,l=c*2,d=c*3,h=r-s,u=(n-s)/h,f=u*u,m=f*u,p=e*d,x=p-d,b=-2*m+3*f,S=m-f,y=1-b,w=S-f+u;for(let v=0;v!==c;v++){const C=a[x+v+c],T=a[x+v+l]*h,_=a[p+v+c],N=a[p+v]*h;o[v]=y*C+w*T+b*_+S*N}return o}}const Fy=new ys;class zy extends Id{interpolate_(e,s,n,r){const o=super.interpolate_(e,s,n,r);return Fy.fromArray(o).normalize().toArray(o),o}}const rt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Bs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bc={9728:_l,9729:wr,9984:Dh,9985:Oh,9986:Lh,9987:Ii},vc={33071:Qo,33648:Ih,10497:Jo},Ro={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},wi={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},$t={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Uy={CUBICSPLINE:void 0,LINEAR:Nl,STEP:Gh},To={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function By(t){return t.DefaultMaterial===void 0&&(t.DefaultMaterial=new fs({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:qh})),t.DefaultMaterial}function ds(t,e,s){for(const n in s.extensions)t[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=s.extensions[n])}function gt(t,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Hy(t,e,s){let n=!1,r=!1,o=!1;for(let d=0,h=e.length;d<h;d++){const u=e[d];if(u.POSITION!==void 0&&(n=!0),u.NORMAL!==void 0&&(r=!0),u.COLOR_0!==void 0&&(o=!0),n&&r&&o)break}if(!n&&!r&&!o)return Promise.resolve(t);const a=[],c=[],l=[];for(let d=0,h=e.length;d<h;d++){const u=e[d];if(n){const f=u.POSITION!==void 0?s.getDependency("accessor",u.POSITION):t.attributes.position;a.push(f)}if(r){const f=u.NORMAL!==void 0?s.getDependency("accessor",u.NORMAL):t.attributes.normal;c.push(f)}if(o){const f=u.COLOR_0!==void 0?s.getDependency("accessor",u.COLOR_0):t.attributes.color;l.push(f)}}return Promise.all([Promise.all(a),Promise.all(c),Promise.all(l)]).then(function(d){const h=d[0],u=d[1],f=d[2];return n&&(t.morphAttributes.position=h),r&&(t.morphAttributes.normal=u),o&&(t.morphAttributes.color=f),t.morphTargetsRelative=!0,t})}function $y(t,e){if(t.updateMorphTargets(),e.weights!==void 0)for(let s=0,n=e.weights.length;s<n;s++)t.morphTargetInfluences[s]=e.weights[s];if(e.extras&&Array.isArray(e.extras.targetNames)){const s=e.extras.targetNames;if(t.morphTargetInfluences.length===s.length){t.morphTargetDictionary={};for(let n=0,r=s.length;n<r;n++)t.morphTargetDictionary[s[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Vy(t){let e;const s=t.extensions&&t.extensions[le.KHR_DRACO_MESH_COMPRESSION];if(s?e="draco:"+s.bufferView+":"+s.indices+":"+jo(s.attributes):e=t.indices+":"+jo(t.attributes)+":"+t.mode,t.targets!==void 0)for(let n=0,r=t.targets.length;n<r;n++)e+=":"+jo(t.targets[n]);return e}function jo(t){let e="";const s=Object.keys(t).sort();for(let n=0,r=s.length;n<r;n++)e+=s[n]+":"+t[s[n]]+";";return e}function Si(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Wy(t){return t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0?"image/jpeg":t.search(/\.webp($|\?)/i)>0||t.search(/^data\:image\/webp/)===0?"image/webp":t.search(/\.ktx2($|\?)/i)>0||t.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Gy=new Se;class Ky{constructor(e={},s={}){this.json=e,this.extensions={},this.plugins={},this.options=s,this.cache=new py,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=-1,o=!1,a=-1;if(typeof navigator<"u"){const c=navigator.userAgent;n=/^((?!chrome|android).)*safari/i.test(c)===!0;const l=c.match(/Version\/(\d+)/);r=n&&l?parseInt(l[1],10):-1,o=c.indexOf("Firefox")>-1,a=o?c.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&r<17||o&&a<98?this.textureLoader=new yl(this.options.manager):this.textureLoader=new Mh(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new vl(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,s){const n=this,r=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const c={scene:a[0][r.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:r.asset,parser:n,userData:{}};return ds(o,c,r),gt(c,r),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(c)})).then(function(){for(const l of c.scenes)l.updateMatrixWorld();e(c)})}).catch(s)}_markDefs(){const e=this.json.nodes||[],s=this.json.skins||[],n=this.json.meshes||[];for(let r=0,o=s.length;r<o;r++){const a=s[r].joints;for(let c=0,l=a.length;c<l;c++)e[a[c]].isBone=!0}for(let r=0,o=e.length;r<o;r++){const a=e[r];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,s){s!==void 0&&(e.refs[s]===void 0&&(e.refs[s]=e.uses[s]=0),e.refs[s]++)}_getNodeRef(e,s,n){if(e.refs[s]<=1)return n;const r=n.clone(),o=(a,c)=>{const l=this.associations.get(a);l!=null&&this.associations.set(c,l);for(const[d,h]of a.children.entries())o(h,c.children[d])};return o(n,r),r.name+="_instance_"+e.uses[s]++,r}_invokeOne(e){const s=Object.values(this.plugins);s.push(this);for(let n=0;n<s.length;n++){const r=e(s[n]);if(r)return r}return null}_invokeAll(e){const s=Object.values(this.plugins);s.unshift(this);const n=[];for(let r=0;r<s.length;r++){const o=e(s[r]);o&&n.push(o)}return n}getDependency(e,s){const n=e+":"+s;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(s);break;case"node":r=this._invokeOne(function(o){return o.loadNode&&o.loadNode(s)});break;case"mesh":r=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(s)});break;case"accessor":r=this.loadAccessor(s);break;case"bufferView":r=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(s)});break;case"buffer":r=this.loadBuffer(s);break;case"material":r=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(s)});break;case"texture":r=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(s)});break;case"skin":r=this.loadSkin(s);break;case"animation":r=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(s)});break;case"camera":r=this.loadCamera(s);break;default:if(r=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,s)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(n,r)}return r}getDependencies(e){let s=this.cache.get(e);if(!s){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];s=Promise.all(r.map(function(o,a){return n.getDependency(e,a)})),this.cache.add(e,s)}return s}loadBuffer(e){const s=this.json.buffers[e],n=this.fileLoader;if(s.type&&s.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+s.type+" buffer type is not supported.");if(s.uri===void 0&&e===0)return Promise.resolve(this.extensions[le.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(o,a){n.load(Sn.resolveURL(s.uri,r.path),o,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+s.uri+'".'))})})}loadBufferView(e){const s=this.json.bufferViews[e];return this.getDependency("buffer",s.buffer).then(function(n){const r=s.byteLength||0,o=s.byteOffset||0;return n.slice(o,o+r)})}loadAccessor(e){const s=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const a=Ro[r.type],c=Bs[r.componentType],l=r.normalized===!0,d=new c(r.count*a);return Promise.resolve(new ot(d,a,l))}const o=[];return r.bufferView!==void 0?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),r.sparse!==void 0&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then(function(a){const c=a[0],l=Ro[r.type],d=Bs[r.componentType],h=d.BYTES_PER_ELEMENT,u=h*l,f=r.byteOffset||0,m=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,p=r.normalized===!0;let x,b;if(m&&m!==u){const S=Math.floor(f/m),y="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+S+":"+r.count;let w=s.cache.get(y);w||(x=new d(c,S*m,r.count*m/h),w=new Ah(x,m/h),s.cache.add(y,w)),b=new Kh(w,l,f%m/h,p)}else c===null?x=new d(r.count*l):x=new d(c,f,r.count*l),b=new ot(x,l,p);if(r.sparse!==void 0){const S=Ro.SCALAR,y=Bs[r.sparse.indices.componentType],w=r.sparse.indices.byteOffset||0,v=r.sparse.values.byteOffset||0,C=new y(a[1],w,r.sparse.count*S),T=new d(a[2],v,r.sparse.count*l);c!==null&&(b=new ot(b.array.slice(),b.itemSize,b.normalized)),b.normalized=!1;for(let _=0,N=C.length;_<N;_++){const j=C[_];if(b.setX(j,T[_*l]),l>=2&&b.setY(j,T[_*l+1]),l>=3&&b.setZ(j,T[_*l+2]),l>=4&&b.setW(j,T[_*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}b.normalized=p}return b})}loadTexture(e){const s=this.json,n=this.options,o=s.textures[e].source,a=s.images[o];let c=this.textureLoader;if(a.uri){const l=n.manager.getHandler(a.uri);l!==null&&(c=l)}return this.loadTextureImage(e,o,c)}loadTextureImage(e,s,n){const r=this,o=this.json,a=o.textures[e],c=o.images[s],l=(c.uri||c.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const d=this.loadImageSource(s,n).then(function(h){h.flipY=!1,h.name=a.name||c.name||"",h.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(h.name=c.uri);const f=(o.samplers||{})[a.sampler]||{};return h.magFilter=bc[f.magFilter]||wr,h.minFilter=bc[f.minFilter]||Ii,h.wrapS=vc[f.wrapS]||Jo,h.wrapT=vc[f.wrapT]||Jo,h.generateMipmaps=!h.isCompressedTexture&&h.minFilter!==_l&&h.minFilter!==wr,r.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=d,d}loadImageSource(e,s){const n=this,r=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const a=r.images[e],c=self.URL||self.webkitURL;let l=a.uri||"",d=!1;if(a.bufferView!==void 0)l=n.getDependency("bufferView",a.bufferView).then(function(u){d=!0;const f=new Blob([u],{type:a.mimeType});return l=c.createObjectURL(f),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(f,m){let p=f;s.isImageBitmapLoader===!0&&(p=function(x){const b=new Ca(x);b.needsUpdate=!0,f(b)}),s.load(Sn.resolveURL(u,o.path),p,void 0,m)})}).then(function(u){return d===!0&&c.revokeObjectURL(l),gt(u,a),u.userData.mimeType=a.mimeType||Wy(a.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[e]=h,h}assignTexture(e,s,n,r){const o=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),o.extensions[le.KHR_TEXTURE_TRANSFORM]){const c=n.extensions!==void 0?n.extensions[le.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const l=o.associations.get(a);a=o.extensions[le.KHR_TEXTURE_TRANSFORM].extendTexture(a,c),o.associations.set(a,l)}}return r!==void 0&&(a.colorSpace=r),e[s]=a,a})}assignFinalMaterial(e){const s=e.geometry;let n=e.material;const r=s.attributes.tangent===void 0,o=s.attributes.color!==void 0,a=s.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+n.uuid;let l=this.cache.get(c);l||(l=new zi,mo.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(c,l)),n=l}else if(e.isLine){const c="LineBasicMaterial:"+n.uuid;let l=this.cache.get(c);l||(l=new Oi,mo.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(c,l)),n=l}if(r||o||a){let c="ClonedMaterial:"+n.uuid+":";r&&(c+="derivative-tangents:"),o&&(c+="vertex-colors:"),a&&(c+="flat-shading:");let l=this.cache.get(c);l||(l=n.clone(),o&&(l.vertexColors=!0),a&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(c,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return fs}loadMaterial(e){const s=this,n=this.json,r=this.extensions,o=n.materials[e];let a;const c={},l=o.extensions||{},d=[];if(l[le.KHR_MATERIALS_UNLIT]){const u=r[le.KHR_MATERIALS_UNLIT];a=u.getMaterialType(),d.push(u.extendParams(c,o,s))}else{const u=o.pbrMetallicRoughness||{};if(c.color=new ze(1,1,1),c.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;c.color.setRGB(f[0],f[1],f[2],Dt),c.opacity=f[3]}u.baseColorTexture!==void 0&&d.push(s.assignTexture(c,"map",u.baseColorTexture,Tn)),c.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,c.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(d.push(s.assignTexture(c,"metalnessMap",u.metallicRoughnessTexture)),d.push(s.assignTexture(c,"roughnessMap",u.metallicRoughnessTexture))),a=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),d.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,c)})))}o.doubleSided===!0&&(c.side=Fh);const h=o.alphaMode||To.OPAQUE;if(h===To.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,h===To.MASK&&(c.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&a!==qt&&(d.push(s.assignTexture(c,"normalMap",o.normalTexture)),c.normalScale=new ve(1,1),o.normalTexture.scale!==void 0)){const u=o.normalTexture.scale;c.normalScale.set(u,u)}if(o.occlusionTexture!==void 0&&a!==qt&&(d.push(s.assignTexture(c,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&a!==qt){const u=o.emissiveFactor;c.emissive=new ze().setRGB(u[0],u[1],u[2],Dt)}return o.emissiveTexture!==void 0&&a!==qt&&d.push(s.assignTexture(c,"emissiveMap",o.emissiveTexture,Tn)),Promise.all(d).then(function(){const u=new a(c);return o.name&&(u.name=o.name),gt(u,o),s.associations.set(u,{materials:e}),o.extensions&&ds(r,u,o),u})}createUniqueName(e){const s=zh.sanitizeNodeName(e||"");return s in this.nodeNamesUsed?s+"_"+ ++this.nodeNamesUsed[s]:(this.nodeNamesUsed[s]=0,s)}loadGeometries(e){const s=this,n=this.extensions,r=this.primitiveCache;function o(c){return n[le.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,s).then(function(l){return wc(l,c,s)})}const a=[];for(let c=0,l=e.length;c<l;c++){const d=e[c],h=Vy(d),u=r[h];if(u)a.push(u.promise);else{let f;d.extensions&&d.extensions[le.KHR_DRACO_MESH_COMPRESSION]?f=o(d):f=wc(new Fi,d,s),r[h]={primitive:d,promise:f},a.push(f)}}return Promise.all(a)}loadMesh(e){const s=this,n=this.json,r=this.extensions,o=n.meshes[e],a=o.primitives,c=[];for(let l=0,d=a.length;l<d;l++){const h=a[l].material===void 0?By(this.cache):this.getDependency("material",a[l].material);c.push(h)}return c.push(s.loadGeometries(a)),Promise.all(c).then(function(l){const d=l.slice(0,l.length-1),h=l[l.length-1],u=[];for(let m=0,p=h.length;m<p;m++){const x=h[m],b=a[m];let S;const y=d[m];if(b.mode===rt.TRIANGLES||b.mode===rt.TRIANGLE_STRIP||b.mode===rt.TRIANGLE_FAN||b.mode===void 0)S=o.isSkinnedMesh===!0?new Uh(x,y):new ke(x,y),S.isSkinnedMesh===!0&&S.normalizeSkinWeights(),b.mode===rt.TRIANGLE_STRIP?S.geometry=xc(S.geometry,bl):b.mode===rt.TRIANGLE_FAN&&(S.geometry=xc(S.geometry,Zo));else if(b.mode===rt.LINES)S=new Di(x,y);else if(b.mode===rt.LINE_STRIP)S=new Bh(x,y);else if(b.mode===rt.LINE_LOOP)S=new Hh(x,y);else if(b.mode===rt.POINTS)S=new Ui(x,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(S.geometry.morphAttributes).length>0&&$y(S,o),S.name=s.createUniqueName(o.name||"mesh_"+e),gt(S,o),b.extensions&&ds(r,S,b),s.assignFinalMaterial(S),u.push(S)}for(let m=0,p=u.length;m<p;m++)s.associations.set(u[m],{meshes:e,primitives:m});if(u.length===1)return o.extensions&&ds(r,u[0],o),u[0];const f=new wt;o.extensions&&ds(r,f,o),s.associations.set(f,{meshes:e});for(let m=0,p=u.length;m<p;m++)f.add(u[m]);return f})}loadCamera(e){let s;const n=this.json.cameras[e],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?s=new Ur(At.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(s=new Li(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(s.name=this.createUniqueName(n.name)),gt(s,n),Promise.resolve(s)}loadSkin(e){const s=this.json.skins[e],n=[];for(let r=0,o=s.joints.length;r<o;r++)n.push(this._loadNodeShallow(s.joints[r]));return s.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",s.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const o=r.pop(),a=r,c=[],l=[];for(let d=0,h=a.length;d<h;d++){const u=a[d];if(u){c.push(u);const f=new Se;o!==null&&f.fromArray(o.array,d*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[d])}return new $h(c,l)})}loadAnimation(e){const s=this.json,n=this,r=s.animations[e],o=r.name?r.name:"animation_"+e,a=[],c=[],l=[],d=[],h=[];for(let u=0,f=r.channels.length;u<f;u++){const m=r.channels[u],p=r.samplers[m.sampler],x=m.target,b=x.node,S=r.parameters!==void 0?r.parameters[p.input]:p.input,y=r.parameters!==void 0?r.parameters[p.output]:p.output;x.node!==void 0&&(a.push(this.getDependency("node",b)),c.push(this.getDependency("accessor",S)),l.push(this.getDependency("accessor",y)),d.push(p),h.push(x))}return Promise.all([Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(d),Promise.all(h)]).then(function(u){const f=u[0],m=u[1],p=u[2],x=u[3],b=u[4],S=[];for(let w=0,v=f.length;w<v;w++){const C=f[w],T=m[w],_=p[w],N=x[w],j=b[w];if(C===void 0)continue;C.updateMatrix&&C.updateMatrix();const F=n._createAnimationTracks(C,T,_,N,j);if(F)for(let E=0;E<F.length;E++)S.push(F[E])}const y=new Vh(o,void 0,S);return gt(y,r),y})}createNodeMesh(e){const s=this.json,n=this,r=s.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(o){const a=n._getNodeRef(n.meshCache,r.mesh,o);return r.weights!==void 0&&a.traverse(function(c){if(c.isMesh)for(let l=0,d=r.weights.length;l<d;l++)c.morphTargetInfluences[l]=r.weights[l]}),a})}loadNode(e){const s=this.json,n=this,r=s.nodes[e],o=n._loadNodeShallow(e),a=[],c=r.children||[];for(let d=0,h=c.length;d<h;d++)a.push(n.getDependency("node",c[d]));const l=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([o,Promise.all(a),l]).then(function(d){const h=d[0],u=d[1],f=d[2];f!==null&&h.traverse(function(m){m.isSkinnedMesh&&m.bind(f,Gy)});for(let m=0,p=u.length;m<p;m++)h.add(u[m]);return h})}_loadNodeShallow(e){const s=this.json,n=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=s.nodes[e],a=o.name?r.createUniqueName(o.name):"",c=[],l=r._invokeOne(function(d){return d.createNodeMesh&&d.createNodeMesh(e)});return l&&c.push(l),o.camera!==void 0&&c.push(r.getDependency("camera",o.camera).then(function(d){return r._getNodeRef(r.cameraCache,o.camera,d)})),r._invokeAll(function(d){return d.createNodeAttachment&&d.createNodeAttachment(e)}).forEach(function(d){c.push(d)}),this.nodeCache[e]=Promise.all(c).then(function(d){let h;if(o.isBone===!0?h=new Wh:d.length>1?h=new wt:d.length===1?h=d[0]:h=new Sl,h!==d[0])for(let u=0,f=d.length;u<f;u++)h.add(d[u]);if(o.name&&(h.userData.name=o.name,h.name=a),gt(h,o),o.extensions&&ds(n,h,o),o.matrix!==void 0){const u=new Se;u.fromArray(o.matrix),h.applyMatrix4(u)}else o.translation!==void 0&&h.position.fromArray(o.translation),o.rotation!==void 0&&h.quaternion.fromArray(o.rotation),o.scale!==void 0&&h.scale.fromArray(o.scale);if(!r.associations.has(h))r.associations.set(h,{});else if(o.mesh!==void 0&&r.meshCache.refs[o.mesh]>1){const u=r.associations.get(h);r.associations.set(h,{...u})}return r.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const s=this.extensions,n=this.json.scenes[e],r=this,o=new wt;n.name&&(o.name=r.createUniqueName(n.name)),gt(o,n),n.extensions&&ds(s,o,n);const a=n.nodes||[],c=[];for(let l=0,d=a.length;l<d;l++)c.push(r.getDependency("node",a[l]));return Promise.all(c).then(function(l){for(let h=0,u=l.length;h<u;h++)o.add(l[h]);const d=h=>{const u=new Map;for(const[f,m]of r.associations)(f instanceof mo||f instanceof Ca)&&u.set(f,m);return h.traverse(f=>{const m=r.associations.get(f);m!=null&&u.set(f,m)}),u};return r.associations=d(o),o})}_createAnimationTracks(e,s,n,r,o){const a=[],c=e.name?e.name:e.uuid,l=[];$t[o.path]===$t.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(c);let d;switch($t[o.path]){case $t.weights:d=Ra;break;case $t.rotation:d=Ta;break;case $t.translation:case $t.scale:d=Ea;break;default:switch(n.itemSize){case 1:d=Ra;break;case 2:case 3:default:d=Ea;break}break}const h=r.interpolation!==void 0?Uy[r.interpolation]:Nl,u=this._getArrayFromAccessor(n);for(let f=0,m=l.length;f<m;f++){const p=new d(l[f]+"."+$t[o.path],s.array,u,h);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),a.push(p)}return a}_getArrayFromAccessor(e){let s=e.array;if(e.normalized){const n=Si(s.constructor),r=new Float32Array(s.length);for(let o=0,a=s.length;o<a;o++)r[o]=s[o]*n;s=r}return s}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const r=this instanceof Ta?zy:Id;return new r(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function qy(t,e,s){const n=e.attributes,r=new Bi;if(n.POSITION!==void 0){const c=s.json.accessors[n.POSITION],l=c.min,d=c.max;if(l!==void 0&&d!==void 0){if(r.set(new $(l[0],l[1],l[2]),new $(d[0],d[1],d[2])),c.normalized){const h=Si(Bs[c.componentType]);r.min.multiplyScalar(h),r.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const c=new $,l=new $;for(let d=0,h=o.length;d<h;d++){const u=o[d];if(u.POSITION!==void 0){const f=s.json.accessors[u.POSITION],m=f.min,p=f.max;if(m!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(m[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(m[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(m[2]),Math.abs(p[2]))),f.normalized){const x=Si(Bs[f.componentType]);l.multiplyScalar(x)}c.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(c)}t.boundingBox=r;const a=new Wr;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=a}function wc(t,e,s){const n=e.attributes,r=[];function o(a,c){return s.getDependency("accessor",a).then(function(l){t.setAttribute(c,l)})}for(const a in n){const c=wi[a]||a.toLowerCase();c in t.attributes||r.push(o(n[a],c))}if(e.indices!==void 0&&!t.index){const a=s.getDependency("accessor",e.indices).then(function(c){t.setIndex(c)});r.push(a)}return ja.workingColorSpace!==Dt&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ja.workingColorSpace}" not supported.`),gt(t,e),qy(t,e,s),Promise.all(r).then(function(){return e.targets!==void 0?Hy(t,e.targets,s):t})}new $;function Yy(t){const{x:e,y:s,z:n}=t;t.x=n,t.y=e,t.z=s}function Xy(t){return-t+Math.PI/2}const Sc=new vr,Vt=new $,$e=new $,Po=new $,st=new Se,pt=new Se,_c=new Se,ko=new Wr,Ve=new Hi,Nc=new $,Cc=new $,Ec=new $,us=new $,Qn=new Gr,Qy=1e-12,Zy=.1,Zn=0,Rc=1,Jn=2;let Fd=class{constructor(e=1,s=1,n=1){this.name="",this.radius=new $(e,s,n)}intersectRay(e,s){return st.makeScale(...this.radius).invert(),ko.center.set(0,0,0),ko.radius=1,Qn.copy(e).applyMatrix4(st),Qn.intersectSphere(ko,s)?(st.makeScale(...this.radius),s.applyMatrix4(st),s):null}getEastNorthUpFrame(e,s,n,r){return n.isMatrix4&&(r=n,n=0,console.warn('Ellipsoid: The signature for "getEastNorthUpFrame" has changed.')),this.getEastNorthUpAxes(e,s,Nc,Cc,Ec),this.getCartographicToPosition(e,s,n,us),r.makeBasis(Nc,Cc,Ec).setPosition(us)}getOrientedEastNorthUpFrame(e,s,n,r,o,a,c){return this.getObjectFrame(e,s,n,r,o,a,c,Zn)}getObjectFrame(e,s,n,r,o,a,c,l=Jn){return this.getEastNorthUpFrame(e,s,n,st),Ve.set(o,a,-r,"ZXY"),c.makeRotationFromEuler(Ve).premultiply(st),l===Rc?(Ve.set(Math.PI/2,0,0,"XYZ"),pt.makeRotationFromEuler(Ve),c.multiply(pt)):l===Jn&&(Ve.set(-Math.PI/2,0,Math.PI,"XYZ"),pt.makeRotationFromEuler(Ve),c.multiply(pt)),c}getCartographicFromObjectFrame(e,s,n=Jn){return n===Rc?(Ve.set(-Math.PI/2,0,0,"XYZ"),pt.makeRotationFromEuler(Ve).premultiply(e)):n===Jn?(Ve.set(-Math.PI/2,0,Math.PI,"XYZ"),pt.makeRotationFromEuler(Ve).premultiply(e)):pt.copy(e),us.setFromMatrixPosition(pt),this.getPositionToCartographic(us,s),this.getEastNorthUpFrame(s.lat,s.lon,0,st).invert(),pt.premultiply(st),Ve.setFromRotationMatrix(pt,"ZXY"),s.azimuth=-Ve.z,s.elevation=Ve.x,s.roll=Ve.y,s}getEastNorthUpAxes(e,s,n,r,o,a=us){this.getCartographicToPosition(e,s,0,a),this.getCartographicToNormal(e,s,o),n.set(-a.y,a.x,0).normalize(),r.crossVectors(o,n).normalize()}getAzElRollFromRotationMatrix(e,s,n,r,o=Zn){return console.warn('Ellipsoid: "getAzElRollFromRotationMatrix" is deprecated. Use "getCartographicFromObjectFrame", instead.'),this.getCartographicToPosition(e,s,0,us),_c.copy(n).setPosition(us),this.getCartographicFromObjectFrame(_c,r,o),delete r.height,delete r.lat,delete r.lon,r}getRotationMatrixFromAzElRoll(e,s,n,r,o,a,c=Zn){return console.warn('Ellipsoid: "getRotationMatrixFromAzElRoll" function has been deprecated. Use "getObjectFrame", instead.'),this.getObjectFrame(e,s,0,n,r,o,a,c),a.setPosition(0,0,0),a}getFrame(e,s,n,r,o,a,c,l=Zn){return console.warn('Ellipsoid: "getFrame" function has been deprecated. Use "getObjectFrame", instead.'),this.getObjectFrame(e,s,a,n,r,o,c,l)}getCartographicToPosition(e,s,n,r){this.getCartographicToNormal(e,s,Vt);const o=this.radius;$e.copy(Vt),$e.x*=o.x**2,$e.y*=o.y**2,$e.z*=o.z**2;const a=Math.sqrt(Vt.dot($e));return $e.divideScalar(a),r.copy($e).addScaledVector(Vt,n)}getPositionToCartographic(e,s){this.getPositionToSurfacePoint(e,$e),this.getPositionToNormal(e,Vt);const n=Po.subVectors(e,$e);return s.lon=Math.atan2(Vt.y,Vt.x),s.lat=Math.asin(Vt.z),s.height=Math.sign(n.dot(e))*n.length(),s}getCartographicToNormal(e,s,n){return Sc.set(1,Xy(e),s),n.setFromSpherical(Sc).normalize(),Yy(n),n}getPositionToNormal(e,s){const n=this.radius;return s.copy(e),s.x/=n.x**2,s.y/=n.y**2,s.z/=n.z**2,s.normalize(),s}getPositionToSurfacePoint(e,s){const n=this.radius,r=1/n.x**2,o=1/n.y**2,a=1/n.z**2,c=e.x*e.x*r,l=e.y*e.y*o,d=e.z*e.z*a,h=c+l+d,u=Math.sqrt(1/h),f=$e.copy(e).multiplyScalar(u);if(h<Zy)return isFinite(u)?s.copy(f):null;const m=Po.set(f.x*r*2,f.y*o*2,f.z*a*2);let p=(1-u)*e.length()/(.5*m.length()),x=0,b,S,y,w,v,C,T,_,N,j,F;do{p-=x,y=1/(1+p*r),w=1/(1+p*o),v=1/(1+p*a),C=y*y,T=w*w,_=v*v,N=C*y,j=T*w,F=_*v,b=c*C+l*T+d*_-1,S=c*N*r+l*j*o+d*F*a;const E=-2*S;x=b/E}while(Math.abs(b)>Qy);return s.set(e.x*y,e.y*w,e.z*v)}calculateHorizonDistance(e,s){const n=this.calculateEffectiveRadius(e);return Math.sqrt(2*n*s+s**2)}calculateEffectiveRadius(e){const s=this.radius.x,n=1-this.radius.z**2/s**2,r=e*At.DEG2RAD,o=Math.sin(r)**2;return s/Math.sqrt(1-n*o)}getPositionElevation(e){this.getPositionToSurfacePoint(e,$e);const s=Po.subVectors(e,$e);return Math.sign(s.dot(e))*s.length()}closestPointToRayEstimate(e,s){return this.intersectRay(e,s)?s:(st.makeScale(...this.radius).invert(),Qn.copy(e).applyMatrix4(st),$e.set(0,0,0),Qn.closestPointToPoint($e,s).normalize(),st.makeScale(...this.radius),s.applyMatrix4(st))}copy(e){return this.radius.copy(e.radius),this}clone(){return new this.constructor().copy(this)}};const ro=new Fd(fc,fc,sy);ro.name="WGS84 Earth";const er=new $,tr=new $,We=new $,sr=new Gr;let Tc=class{constructor(e=new Bi,s=new Se){this.box=e.clone(),this.transform=s.clone(),this.inverseTransform=new Se,this.points=new Array(8).fill().map(()=>new $),this.planes=new Array(6).fill().map(()=>new Is)}copy(e){return this.box.copy(e.box),this.transform.copy(e.transform),this.update(),this}clone(){return new this.constructor().copy(this)}clampPoint(e,s){return s.copy(e).applyMatrix4(this.inverseTransform).clamp(this.box.min,this.box.max).applyMatrix4(this.transform)}distanceToPoint(e){return this.clampPoint(e,We).distanceTo(e)}containsPoint(e){return We.copy(e).applyMatrix4(this.inverseTransform),this.box.containsPoint(We)}intersectsRay(e){return sr.copy(e).applyMatrix4(this.inverseTransform),sr.intersectsBox(this.box)}intersectRay(e,s){return sr.copy(e).applyMatrix4(this.inverseTransform),sr.intersectBox(this.box,s)?(s.applyMatrix4(this.transform),s):null}update(){const{points:e,inverseTransform:s,transform:n,box:r}=this;s.copy(n).invert();const{min:o,max:a}=r;let c=0;for(let l=-1;l<=1;l+=2)for(let d=-1;d<=1;d+=2)for(let h=-1;h<=1;h+=2)e[c].set(l<0?o.x:a.x,d<0?o.y:a.y,h<0?o.z:a.z).applyMatrix4(n),c++;this.updatePlanes()}updatePlanes(){er.copy(this.box.min).applyMatrix4(this.transform),tr.copy(this.box.max).applyMatrix4(this.transform),We.set(0,0,1).transformDirection(this.transform),this.planes[0].setFromNormalAndCoplanarPoint(We,er),this.planes[1].setFromNormalAndCoplanarPoint(We,tr).negate(),We.set(0,1,0).transformDirection(this.transform),this.planes[2].setFromNormalAndCoplanarPoint(We,er),this.planes[3].setFromNormalAndCoplanarPoint(We,tr).negate(),We.set(1,0,0).transformDirection(this.transform),this.planes[4].setFromNormalAndCoplanarPoint(We,er),this.planes[5].setFromNormalAndCoplanarPoint(We,tr).negate()}intersectsSphere(e){return this.clampPoint(e.center,We),We.distanceToSquared(e.center)<=e.radius*e.radius}intersectsFrustum(e){return this._intersectsPlaneShape(e.planes,e.points)}intersectsOBB(e){return this._intersectsPlaneShape(e.planes,e.points)}_intersectsPlaneShape(e,s){const n=this.points,r=this.planes;for(let o=0;o<6;o++){const a=e[o];let c=-1/0;for(let l=0;l<8;l++){const d=n[l],h=a.distanceToPoint(d);c=c<h?h:c}if(c<0)return!1}for(let o=0;o<6;o++){const a=r[o];let c=-1/0;for(let l=0;l<8;l++){const d=s[l],h=a.distanceToPoint(d);c=c<h?h:c}if(c<0)return!1}return!0}};const Wt=Math.PI,nr=Wt/2,hn=new $,Ts=new $,js=new $,jc=new Se;let bn=0;const Mo=[];function Jy(t=!1){return t?(Mo[bn]||(Mo[bn]=new $),bn++,Mo[bn-1]):new $}function Pc(){bn=0}let eb=class extends Fd{constructor(e,s,n,r=-nr,o=nr,a=0,c=2*Wt,l=0,d=0){super(e,s,n),this.latStart=r,this.latEnd=o,this.lonStart=a,this.lonEnd=c,this.heightStart=l,this.heightEnd=d}_getPoints(e=!1){const{latStart:s,latEnd:n,lonStart:r,lonEnd:o,heightStart:a,heightEnd:c}=this,l=At.mapLinear(.5,0,1,s,n),d=At.mapLinear(.5,0,1,r,o),h=Math.floor(r/nr)*nr,u=[[-Wt/2,0],[Wt/2,0],[0,h],[0,h+Wt/2],[0,h+Wt],[0,h+3*Wt/2],[s,o],[n,o],[s,r],[n,r],[0,r],[0,o],[l,d],[s,d],[n,d],[l,r],[l,o]],f=[],m=u.length;for(let p=0;p<=1;p++){const x=At.mapLinear(p,0,1,a,c);for(let b=0,S=m;b<S;b++){const[y,w]=u[b];if(y>=s&&y<=n&&w>=r&&w<=o){const v=Jy(e);f.push(v),this.getCartographicToPosition(y,w,x,v)}}}return f}getBoundingBox(e,s){Pc();const{latStart:n,latEnd:r,lonStart:o,lonEnd:a}=this;if(r-n<Wt/2){const l=At.mapLinear(.5,0,1,n,r),d=At.mapLinear(.5,0,1,o,a);this.getCartographicToNormal(l,d,js),Ts.set(0,0,1),hn.crossVectors(Ts,js),Ts.crossVectors(hn,js),s.makeBasis(hn,Ts,js)}else hn.set(1,0,0),Ts.set(0,1,0),js.set(0,0,1),s.makeBasis(hn,Ts,js);jc.copy(s).invert();const c=this._getPoints(!0);for(let l=0,d=c.length;l<d;l++)c[l].applyMatrix4(jc);e.makeEmpty(),e.setFromPoints(c)}getBoundingSphere(e,s){Pc();const n=this._getPoints(!0);e.makeEmpty(),e.setFromPoints(n,s)}};function tb(t){const{TextureUtils:e}=Xh;if(!e||!t)return 0;const{format:s,type:n,image:r}=t,{width:o,height:a}=r;let c=e.getByteLength(o,a,s,n);return c*=t.generateMipmaps?4/3:1,c}function sb(t){const e=new Set;let s=0;return t.traverse(n=>{if(n.geometry&&!e.has(n.geometry)&&(s+=my(n.geometry),e.add(n.geometry)),n.material){const r=n.material;for(const o in r){const a=r[o];a&&a.isTexture&&!e.has(a)&&(s+=tb(a),e.add(a))}}}),s}class zd extends dy{constructor(e=Kr){super(),this.manager=e,this.adjustmentTransform=new Se}parse(e){const s=super.parse(e),n=s.glbBytes.slice().buffer;return new Promise((r,o)=>{const a=this.manager,c=this.fetchOptions,l=a.getHandler("path.gltf")||new ua(a);c.credentials==="include"&&c.mode==="cors"&&l.setCrossOrigin("use-credentials"),"credentials"in c&&l.setWithCredentials(c.credentials==="include"),c.headers&&l.setRequestHeader(c.headers);let d=this.workingPath;!/[\\/]$/.test(d)&&d.length&&(d+="/");const h=this.adjustmentTransform;l.parse(n,d,u=>{const{batchTable:f,featureTable:m}=s,{scene:p}=u,x=m.getData("RTC_CENTER",1,"FLOAT","VEC3");x&&(p.position.x+=x[0],p.position.y+=x[1],p.position.z+=x[2]),u.scene.updateMatrix(),u.scene.matrix.multiply(h),u.scene.matrix.decompose(u.scene.position,u.scene.quaternion,u.scene.scale),u.batchTable=f,u.featureTable=m,p.batchTable=f,p.featureTable=m,r(u)},o)})}}function nb(t){const e=t>>11,s=t>>5&63,n=t&31,r=Math.round(e/31*255),o=Math.round(s/63*255),a=Math.round(n/31*255);return[r,o,a]}const fn=new ve;function rb(t,e,s=new $){fn.set(t,e).divideScalar(256).multiplyScalar(2).subScalar(1),s.set(fn.x,fn.y,1-Math.abs(fn.x)-Math.abs(fn.y));const n=At.clamp(-s.z,0,1);return s.x>=0?s.setX(s.x-n):s.setX(s.x+n),s.y>=0?s.setY(s.y-n):s.setY(s.y+n),s.normalize(),s}const kc={RGB:"color",POSITION:"position"};class Ud extends hy{constructor(e=Kr){super(),this.manager=e}parse(e){return super.parse(e).then(async s=>{const{featureTable:n,batchTable:r}=s,o=new zi,a=n.header.extensions,c=new $;let l;if(a&&a["3DTILES_draco_point_compression"]){const{byteOffset:u,byteLength:f,properties:m}=a["3DTILES_draco_point_compression"],p=this.manager.getHandler("draco.drc");if(p==null)throw new Error("PNTSLoader: dracoLoader not available.");const x={};for(const y in m)if(y in kc&&y in m){const w=kc[y];x[w]=m[y]}const b={attributeIDs:x,attributeTypes:{position:"Float32Array",color:"Uint8Array"},useUniqueIDs:!0},S=n.getBuffer(u,f);l=await p.decodeGeometry(S,b),l.attributes.color&&(o.vertexColors=!0)}else{const u=n.getData("POINTS_LENGTH"),f=n.getData("POSITION",u,"FLOAT","VEC3"),m=n.getData("NORMAL",u,"FLOAT","VEC3"),p=n.getData("NORMAL",u,"UNSIGNED_BYTE","VEC2"),x=n.getData("RGB",u,"UNSIGNED_BYTE","VEC3"),b=n.getData("RGBA",u,"UNSIGNED_BYTE","VEC4"),S=n.getData("RGB565",u,"UNSIGNED_SHORT","SCALAR"),y=n.getData("CONSTANT_RGBA",u,"UNSIGNED_BYTE","VEC4"),w=n.getData("POSITION_QUANTIZED",u,"UNSIGNED_SHORT","VEC3"),v=n.getData("QUANTIZED_VOLUME_SCALE",u,"FLOAT","VEC3"),C=n.getData("QUANTIZED_VOLUME_OFFSET",u,"FLOAT","VEC3");if(l=new Fi,w){const T=new Float32Array(u*3);for(let _=0;_<u;_++)for(let N=0;N<3;N++){const j=3*_+N;T[j]=w[j]/65535*v[N]}c.x=C[0],c.y=C[1],c.z=C[2],l.setAttribute("position",new ot(T,3,!1))}else l.setAttribute("position",new ot(f,3,!1));if(m!==null)l.setAttribute("normal",new ot(m,3,!1));else if(p!==null){const T=new Float32Array(u*3),_=new $;for(let N=0;N<u;N++){const j=p[N*2],F=p[N*2+1],E=rb(j,F,_);T[N*3]=E.x,T[N*3+1]=E.y,T[N*3+2]=E.z}l.setAttribute("normal",new ot(T,3,!1))}if(b!==null)l.setAttribute("color",new ot(b,4,!0)),o.vertexColors=!0,o.transparent=!0,o.depthWrite=!1;else if(x!==null)l.setAttribute("color",new ot(x,3,!0)),o.vertexColors=!0;else if(S!==null){const T=new Uint8Array(u*3);for(let _=0;_<u;_++){const N=nb(S[_]);for(let j=0;j<3;j++){const F=3*_+j;T[F]=N[j]}}l.setAttribute("color",new ot(T,3,!0)),o.vertexColors=!0}else if(y!==null){const T=new ze(y[0],y[1],y[2]);o.color=T;const _=y[3]/255;_<1&&(o.opacity=_,o.transparent=!0,o.depthWrite=!1)}}const d=new Ui(l,o);d.position.copy(c),s.scene=d,s.scene.featureTable=n,s.scene.batchTable=r;const h=n.getData("RTC_CENTER",1,"FLOAT","VEC3");return h&&(s.scene.position.x+=h[0],s.scene.position.y+=h[1],s.scene.position.z+=h[2]),s})}}const Mc=new $,Ao=new $,Lo=new $,Oo=new $,Do=new ys,rr=new $,or=new Se,Ac=new Se,Lc=new $,Oc=new Se,Io=new ys,Fo={};class Bd extends uy{constructor(e=Kr){super(),this.manager=e,this.adjustmentTransform=new Se,this.ellipsoid=ro.clone()}resolveExternalURL(e){return this.manager.resolveURL(super.resolveExternalURL(e))}parse(e){return super.parse(e).then(s=>{const{featureTable:n,batchTable:r}=s,o=s.glbBytes.slice().buffer;return new Promise((a,c)=>{const l=this.fetchOptions,d=this.manager,h=d.getHandler("path.gltf")||new ua(d);l.credentials==="include"&&l.mode==="cors"&&h.setCrossOrigin("use-credentials"),"credentials"in l&&h.setWithCredentials(l.credentials==="include"),l.headers&&h.setRequestHeader(l.headers);let u=s.gltfWorkingPath??this.workingPath;/[\\/]$/.test(u)||(u+="/");const f=this.adjustmentTransform;h.parse(o,u,m=>{const p=n.getData("INSTANCES_LENGTH");let x=n.getData("POSITION",p,"FLOAT","VEC3");const b=n.getData("POSITION_QUANTIZED",p,"UNSIGNED_SHORT","VEC3"),S=n.getData("QUANTIZED_VOLUME_OFFSET",1,"FLOAT","VEC3"),y=n.getData("QUANTIZED_VOLUME_SCALE",1,"FLOAT","VEC3"),w=n.getData("NORMAL_UP",p,"FLOAT","VEC3"),v=n.getData("NORMAL_RIGHT",p,"FLOAT","VEC3"),C=n.getData("SCALE_NON_UNIFORM",p,"FLOAT","VEC3"),T=n.getData("SCALE",p,"FLOAT","SCALAR"),_=n.getData("RTC_CENTER",1,"FLOAT","VEC3"),N=n.getData("EAST_NORTH_UP");if(["NORMAL_UP_OCT32P","NORMAL_RIGHT_OCT32P"].forEach(P=>{P in n.header&&console.warn(`I3DMLoader: Unsupported FeatureTable feature "${P}" detected.`)}),!x&&b){x=new Float32Array(p*3);for(let P=0;P<p;P++)x[P*3+0]=S[0]+b[P*3+0]/65535*y[0],x[P*3+1]=S[1]+b[P*3+1]/65535*y[1],x[P*3+2]=S[2]+b[P*3+2]/65535*y[2]}const j=new $;for(let P=0;P<p;P++)j.x+=x[P*3+0]/p,j.y+=x[P*3+1]/p,j.z+=x[P*3+2]/p;const F=[],E=[];m.scene.updateMatrixWorld(),m.scene.traverse(P=>{if(P.isMesh){E.push(P);const{geometry:B,material:k}=P,D=new wl(B,k,p);D.position.copy(j),_&&(D.position.x+=_[0],D.position.y+=_[1],D.position.z+=_[2]),F.push(D)}});for(let P=0;P<p;P++){Oo.set(x[P*3+0]-j.x,x[P*3+1]-j.y,x[P*3+2]-j.z),Do.identity(),w&&(Ao.set(w[P*3+0],w[P*3+1],w[P*3+2]),Lo.set(v[P*3+0],v[P*3+1],v[P*3+2]),Mc.crossVectors(Lo,Ao).normalize(),or.makeBasis(Lo,Ao,Mc),Do.setFromRotationMatrix(or)),rr.set(1,1,1),C&&rr.set(C[P*3+0],C[P*3+1],C[P*3+2]),T&&rr.multiplyScalar(T[P]);for(let B=0,k=F.length;B<k;B++){const D=F[B];Io.copy(Do),N&&(D.updateMatrixWorld(),Lc.copy(Oo).applyMatrix4(D.matrixWorld),this.ellipsoid.getPositionToCartographic(Lc,Fo),this.ellipsoid.getEastNorthUpFrame(Fo.lat,Fo.lon,Oc),Io.setFromRotationMatrix(Oc)),or.compose(Oo,Io,rr).multiply(f);const U=E[B];Ac.multiplyMatrices(or,U.matrixWorld),D.setMatrixAt(P,Ac)}}m.scene.clear(),m.scene.add(...F),m.batchTable=r,m.featureTable=n,m.scene.batchTable=r,m.scene.featureTable=n,a(m)},c)})})}}class ob extends fy{constructor(e=Kr){super(),this.manager=e,this.adjustmentTransform=new Se,this.ellipsoid=ro.clone()}parse(e){const s=super.parse(e),{manager:n,ellipsoid:r,adjustmentTransform:o}=this,a=[];for(const c in s.tiles){const{type:l,buffer:d}=s.tiles[c];switch(l){case"b3dm":{const h=d.slice(),u=new zd(n);u.workingPath=this.workingPath,u.fetchOptions=this.fetchOptions,u.adjustmentTransform.copy(o);const f=u.parse(h.buffer);a.push(f);break}case"pnts":{const h=d.slice(),u=new Ud(n);u.workingPath=this.workingPath,u.fetchOptions=this.fetchOptions;const f=u.parse(h.buffer);a.push(f);break}case"i3dm":{const h=d.slice(),u=new Bd(n);u.workingPath=this.workingPath,u.fetchOptions=this.fetchOptions,u.ellipsoid.copy(r),u.adjustmentTransform.copy(o);const f=u.parse(h.buffer);a.push(f);break}}}return Promise.all(a).then(c=>{const l=new wt;return c.forEach(d=>{l.add(d.scene)}),{tiles:c,scene:l}})}}const mn=new Se;class ib extends wt{constructor(e){super(),this.isTilesGroup=!0,this.name="TilesRenderer.TilesGroup",this.tilesRenderer=e,this.matrixWorldInverse=new Se}raycast(e,s){return this.tilesRenderer.optimizeRaycast?(this.tilesRenderer.raycast(e,s),!1):!0}updateMatrixWorld(e){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){this.parent===null?mn.copy(this.matrix):mn.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1;const s=mn.elements,n=this.matrixWorld.elements;let r=!1;for(let o=0;o<16;o++){const a=s[o],c=n[o];if(Math.abs(a-c)>Number.EPSILON){r=!0;break}}if(r){this.matrixWorld.copy(mn),this.matrixWorldInverse.copy(mn).invert();const o=this.children;for(let a=0,c=o.length;a<c;a++)o[a].updateMatrixWorld()}}}updateWorldMatrix(e,s){this.parent&&e&&this.parent.updateWorldMatrix(e,!1),this.updateMatrixWorld(!0)}}const Hd=new Gr,zo=new $,ir=[];function $d(t,e){return t.distance-e.distance}function Vd(t,e,s,n){const{scene:r}=t.cached;s.invokeOnePlugin(o=>o.raycastTile&&o.raycastTile(t,r,e,n))||e.intersectObject(r,!0,n)}function ab(t,e,s){Vd(t,e,s,ir),ir.sort($d);const n=ir[0]||null;return ir.length=0,n}function Wd(t){return"__used"in t}function Gd(t,e,s,n=null){const{group:r,activeTiles:o}=t;n===null&&(n=Hd,n.copy(s.ray).applyMatrix4(r.matrixWorldInverse));const a=[],c=e.children;for(let h=0,u=c.length;h<u;h++){const f=c[h];!Wd(f)||!f.__used||f.cached.boundingVolume.intersectRay(n,zo)!==null&&(zo.applyMatrix4(r.matrixWorld),a.push({distance:zo.distanceToSquared(s.ray.origin),tile:f}))}a.sort($d);let l=null,d=1/0;if(o.has(e)){const h=ab(e,s,t);h&&(l=h,d=h.distance*h.distance)}for(let h=0,u=a.length;h<u;h++){const f=a[h],m=f.distance,p=f.tile;if(m>d)break;const x=Gd(t,p,s,n);if(x){const b=x.distance*x.distance;b<d&&(l=x,d=b)}}return l}function Kd(t,e,s,n,r=null){if(!Wd(e))return;const{group:o,activeTiles:a}=t,{boundingVolume:c}=e.cached;if(r===null&&(r=Hd,r.copy(s.ray).applyMatrix4(o.matrixWorldInverse)),!e.__used||!c.intersectsRay(r))return;a.has(e)&&Vd(e,s,t,n);const l=e.children;for(let d=0,h=l.length;d<h;d++)Kd(t,l[d],s,n,r)}const Pt=new $,kt=new $,Mt=new $,Dc=new $,Ic=new $;class cb{constructor(){this.sphere=null,this.obb=null,this.region=null,this.regionObb=null}intersectsRay(e){const s=this.sphere,n=this.obb||this.regionObb;return!(s&&!e.intersectsSphere(s)||n&&!n.intersectsRay(e))}intersectRay(e,s=null){const n=this.sphere,r=this.obb||this.regionObb;let o=-1/0,a=-1/0;n&&e.intersectSphere(n,Dc)&&(o=n.containsPoint(e.origin)?0:e.origin.distanceToSquared(Dc)),r&&r.intersectRay(e,Ic)&&(a=r.containsPoint(e.origin)?0:e.origin.distanceToSquared(Ic));const c=Math.max(o,a);return c===-1/0?null:(e.at(Math.sqrt(c),s),s)}distanceToPoint(e){const s=this.sphere,n=this.obb||this.regionObb;let r=-1/0,o=-1/0;return s&&(r=Math.max(s.distanceToPoint(e),0)),n&&(o=n.distanceToPoint(e)),r>o?r:o}intersectsFrustum(e){const s=this.obb||this.regionObb,n=this.sphere;return n&&!e.intersectsSphere(n)||s&&!s.intersectsFrustum(e)?!1:!!(n||s)}intersectsSphere(e){const s=this.obb||this.regionObb,n=this.sphere;return n&&!n.intersectsSphere(e)||s&&!s.intersectsSphere(e)?!1:!!(n||s)}intersectsOBB(e){const s=this.obb||this.regionObb,n=this.sphere;return n&&!e.intersectsSphere(n)||s&&!s.intersectsOBB(e)?!1:!!(n||s)}getOBB(e,s){const n=this.obb||this.regionObb;n?(e.copy(n.box),s.copy(n.transform)):(this.getAABB(e),s.identity())}getAABB(e){if(this.sphere)this.sphere.getBoundingBox(e);else{const s=this.obb||this.regionObb;e.copy(s.box).applyMatrix4(s.transform)}}getSphere(e){if(this.sphere)e.copy(this.sphere);else if(this.region)this.region.getBoundingSphere(e);else{const s=this.obb||this.regionObb;s.box.getBoundingSphere(e),e.applyMatrix4(s.transform)}}setObbData(e,s){const n=new Tc;Pt.set(e[3],e[4],e[5]),kt.set(e[6],e[7],e[8]),Mt.set(e[9],e[10],e[11]);const r=Pt.length(),o=kt.length(),a=Mt.length();Pt.normalize(),kt.normalize(),Mt.normalize(),r===0&&Pt.crossVectors(kt,Mt),o===0&&kt.crossVectors(Pt,Mt),a===0&&Mt.crossVectors(Pt,kt),n.transform.set(Pt.x,kt.x,Mt.x,e[0],Pt.y,kt.y,Mt.y,e[1],Pt.z,kt.z,Mt.z,e[2],0,0,0,1).premultiply(s),n.box.min.set(-r,-o,-a),n.box.max.set(r,o,a),n.update(),this.obb=n}setSphereData(e,s,n,r,o){const a=new Wr;a.center.set(e,s,n),a.radius=r,a.applyMatrix4(o),this.sphere=a}setRegionData(e,s,n,r,o,a,c){const l=new eb(...e.radius,n,o,s,r,a,c),d=new Tc;l.getBoundingBox(d.box,d.transform),d.update(),this.region=l,this.regionObb=d}}const lb=new Jh;function db(t,e,s,n){const r=lb.set(t.normal.x,t.normal.y,t.normal.z,e.normal.x,e.normal.y,e.normal.z,s.normal.x,s.normal.y,s.normal.z);return n.set(-t.constant,-e.constant,-s.constant),n.applyMatrix3(r.invert()),n}class ub extends Zh{constructor(){super(),this.points=Array(8).fill().map(()=>new $)}setFromProjectionMatrix(e,s){return super.setFromProjectionMatrix(e,s),this.calculateFrustumPoints(),this}calculateFrustumPoints(){const{planes:e,points:s}=this;[[e[0],e[3],e[4]],[e[1],e[3],e[4]],[e[0],e[2],e[4]],[e[1],e[2],e[4]],[e[0],e[3],e[5]],[e[1],e[3],e[5]],[e[0],e[2],e[5]],[e[1],e[2],e[5]]].forEach((n,r)=>{db(n[0],n[1],n[2],s[r])})}}const Fc=new Se,zc=new Hi,qd=Symbol("INITIAL_FRUSTUM_CULLED"),ar=new Se,pn=new $,Uo=new ve,Ps={inView:!1,error:1/0},hb=new $(1,0,0),fb=new $(0,1,0);function Uc(t,e){t.traverse(s=>{s.frustumCulled=s[qd]&&e})}class mb extends cy{get autoDisableRendererCulling(){return this._autoDisableRendererCulling}set autoDisableRendererCulling(e){this._autoDisableRendererCulling!==e&&(super._autoDisableRendererCulling=e,this.forEachLoadedModel(s=>{Uc(s,!e)}))}get optimizeRaycast(){return this._optimizeRaycast}set optimizeRaycast(e){console.warn('TilesRenderer: The "optimizeRaycast" option has been deprecated.'),this._optimizeRaycast=e}constructor(...e){super(...e),this.group=new ib(this),this.ellipsoid=ro.clone(),this.cameras=[],this.cameraMap=new Map,this.cameraInfo=[],this._optimizeRaycast=!0,this._upRotationMatrix=new Se,this._bytesUsed=new WeakMap,this._autoDisableRendererCulling=!0,this.manager=new Qh,this._listeners={}}addEventListener(...e){zn.prototype.addEventListener.call(this,...e)}hasEventListener(...e){zn.prototype.hasEventListener.call(this,...e)}removeEventListener(...e){zn.prototype.removeEventListener.call(this,...e)}dispatchEvent(...e){zn.prototype.dispatchEvent.call(this,...e)}getBoundingBox(e){if(!this.root)return!1;const s=this.root.cached.boundingVolume;return s?(s.getAABB(e),!0):!1}getOrientedBoundingBox(e,s){if(!this.root)return!1;const n=this.root.cached.boundingVolume;return n?(n.getOBB(e,s),!0):!1}getBoundingSphere(e){if(!this.root)return!1;const s=this.root.cached.boundingVolume;return s?(s.getSphere(e),!0):!1}forEachLoadedModel(e){this.traverse(s=>{const n=s.cached&&s.cached.scene;n&&e(n,s)},null,!1)}raycast(e,s){if(this.root)if(e.firstHitOnly){const n=Gd(this,this.root,e);n&&s.push(n)}else Kd(this,this.root,e,s)}hasCamera(e){return this.cameraMap.has(e)}setCamera(e){const s=this.cameras,n=this.cameraMap;return n.has(e)?!1:(n.set(e,new ve),s.push(e),this.dispatchEvent({type:"add-camera",camera:e}),!0)}setResolution(e,s,n){const r=this.cameraMap;if(!r.has(e))return!1;const o=s.isVector2?s.x:s,a=s.isVector2?s.y:n,c=r.get(e);return(c.width!==o||c.height!==a)&&(c.set(o,a),this.dispatchEvent({type:"camera-resolution-change"})),!0}setResolutionFromRenderer(e,s){return s.getSize(Uo),this.setResolution(e,Uo.x,Uo.y)}deleteCamera(e){const s=this.cameras,n=this.cameraMap;if(n.has(e)){const r=s.indexOf(e);return s.splice(r,1),n.delete(e),this.dispatchEvent({type:"delete-camera",camera:e}),!0}return!1}loadRootTileSet(...e){return super.loadRootTileSet(...e).then(s=>{const{asset:n,extensions:r={}}=s;switch((n&&n.gltfUpAxis||"y").toLowerCase()){case"x":this._upRotationMatrix.makeRotationAxis(fb,-Math.PI/2);break;case"y":this._upRotationMatrix.makeRotationAxis(hb,Math.PI/2);break}if("3DTILES_ellipsoid"in r){const o=r["3DTILES_ellipsoid"],{ellipsoid:a}=this;a.name=o.body,o.radii?a.radius.set(...o.radii):a.radius.set(1,1,1)}return s})}update(){let e=null;if(this.invokeAllPlugins(a=>{if(a.doTilesNeedUpdate){const c=a.doTilesNeedUpdate();e===null?e=c:e=!!(e||c)}}),e===!1){this.dispatchEvent({type:"update-before"}),this.dispatchEvent({type:"update-after"});return}this.dispatchEvent({type:"update-before"});const s=this.group,n=this.cameras,r=this.cameraMap,o=this.cameraInfo;for(;o.length>n.length;)o.pop();for(;o.length<n.length;)o.push({frustum:new ub,isOrthographic:!1,sseDenominator:-1,position:new $,invScale:-1,pixelSize:0});pn.setFromMatrixScale(s.matrixWorldInverse),Math.abs(Math.max(pn.x-pn.y,pn.x-pn.z))>1e-6&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when calculating screen space error.");for(let a=0,c=o.length;a<c;a++){const l=n[a],d=o[a],h=d.frustum,u=d.position,f=r.get(l);(f.width===0||f.height===0)&&console.warn("TilesRenderer: resolution for camera error calculation is not set.");const m=l.projectionMatrix.elements;if(d.isOrthographic=m[15]===1,d.isOrthographic){const p=2/m[0],x=2/m[5];d.pixelSize=Math.max(x/f.height,p/f.width)}else d.sseDenominator=2/m[5]/f.height;ar.copy(s.matrixWorld),ar.premultiply(l.matrixWorldInverse),ar.premultiply(l.projectionMatrix),h.setFromProjectionMatrix(ar),u.set(0,0,0),u.applyMatrix4(l.matrixWorld),u.applyMatrix4(s.matrixWorldInverse)}if(super.update(),this.dispatchEvent({type:"update-after"}),n.length===0&&this.root){let a=!1;this.invokeAllPlugins(c=>a=a||!!(c!==this&&c.calculateTileViewError)),a===!1&&console.warn("TilesRenderer: no cameras defined. Cannot update 3d tiles.")}}preprocessNode(e,s,n=null){super.preprocessNode(e,s,n);const r=new Se;if(e.transform){const c=e.transform;for(let l=0;l<16;l++)r.elements[l]=c[l]}n&&r.premultiply(n.cached.transform);const o=new Se().copy(r).invert(),a=new cb;"sphere"in e.boundingVolume&&a.setSphereData(...e.boundingVolume.sphere,r),"box"in e.boundingVolume&&a.setObbData(e.boundingVolume.box,r),"region"in e.boundingVolume&&a.setRegionData(this.ellipsoid,...e.boundingVolume.region),e.cached={transform:r,transformInverse:o,active:!1,boundingVolume:a,metadata:null,scene:null,geometry:null,materials:null,textures:null}}async parseTile(e,s,n,r,o){const a=s.cached,c=aa(r),l=this.fetchOptions,d=this.manager;let h=null;const u=a.transform,f=this._upRotationMatrix,m=(qs(e)||n).toLowerCase();switch(m){case"b3dm":{const v=new zd(d);v.workingPath=c,v.fetchOptions=l,v.adjustmentTransform.copy(f),h=v.parse(e);break}case"pnts":{const v=new Ud(d);v.workingPath=c,v.fetchOptions=l,h=v.parse(e);break}case"i3dm":{const v=new Bd(d);v.workingPath=c,v.fetchOptions=l,v.adjustmentTransform.copy(f),v.ellipsoid.copy(this.ellipsoid),h=v.parse(e);break}case"cmpt":{const v=new ob(d);v.workingPath=c,v.fetchOptions=l,v.adjustmentTransform.copy(f),v.ellipsoid.copy(this.ellipsoid),h=v.parse(e).then(C=>C.scene);break}case"gltf":case"glb":{const v=d.getHandler("path.gltf")||d.getHandler("path.glb")||new ua(d);v.setWithCredentials(l.credentials==="include"),v.setRequestHeader(l.headers||{}),l.credentials==="include"&&l.mode==="cors"&&v.setCrossOrigin("use-credentials");let C=v.resourcePath||v.path||c;!/[\\/]$/.test(C)&&C.length&&(C+="/"),h=v.parseAsync(e,C).then(T=>{T.scene=T.scene||new wt;const{scene:_}=T;return _.updateMatrix(),_.matrix.multiply(f).decompose(_.position,_.quaternion,_.scale),T});break}default:{h=this.invokeOnePlugin(v=>v.parseToMesh&&v.parseToMesh(e,s,n,r,o));break}}const p=await h;if(p===null)throw new Error(`TilesRenderer: Content type "${m}" not supported.`);let x,b;p.isObject3D?(x=p,b=null):(x=p.scene,b=p),x.updateMatrix(),x.matrix.premultiply(u),x.matrix.decompose(x.position,x.quaternion,x.scale),await this.invokeAllPlugins(v=>v.processTileModel&&v.processTileModel(x,s)),x.traverse(v=>{v[qd]=v.frustumCulled}),Uc(x,!this.autoDisableRendererCulling);const S=[],y=[],w=[];if(x.traverse(v=>{if(v.geometry&&y.push(v.geometry),v.material){const C=v.material;S.push(v.material);for(const T in C){const _=C[T];_&&_.isTexture&&w.push(_)}}}),o.aborted){for(let v=0,C=w.length;v<C;v++){const T=w[v];T.image instanceof ImageBitmap&&T.image.close(),T.dispose()}return}a.materials=S,a.geometry=y,a.textures=w,a.scene=x,a.metadata=b}disposeTile(e){super.disposeTile(e);const s=e.cached;if(s.scene){const n=s.materials,r=s.geometry,o=s.textures,a=s.scene.parent;s.scene.traverse(c=>{c.userData.meshFeatures&&c.userData.meshFeatures.dispose(),c.userData.structuralMetadata&&c.userData.structuralMetadata.dispose()});for(let c=0,l=r.length;c<l;c++)r[c].dispose();for(let c=0,l=n.length;c<l;c++)n[c].dispose();for(let c=0,l=o.length;c<l;c++){const d=o[c];d.image instanceof ImageBitmap&&d.image.close(),d.dispose()}a&&a.remove(s.scene),this.dispatchEvent({type:"dispose-model",scene:s.scene,tile:e}),s.scene=null,s.materials=null,s.textures=null,s.geometry=null,s.metadata=null}}setTileVisible(e,s){const n=e.cached.scene,r=this.group;s?n&&(r.add(n),n.updateMatrixWorld(!0)):n&&r.remove(n),super.setTileVisible(e,s),this.dispatchEvent({type:"tile-visibility-change",scene:n,tile:e,visible:s})}calculateBytesUsed(e,s){const n=this._bytesUsed;return!n.has(e)&&s&&n.set(e,sb(s)),n.get(e)??null}calculateTileViewError(e,s){const n=e.cached,r=this.cameras,o=this.cameraInfo,a=n.boundingVolume;let c=!1,l=-1/0,d=1/0,h=-1/0,u=1/0;for(let f=0,m=r.length;f<m;f++){const p=o[f];let x,b;if(p.isOrthographic){const y=p.pixelSize;x=e.geometricError/y,b=1/0}else{const y=p.sseDenominator;b=a.distanceToPoint(p.position),x=b===0?1/0:e.geometricError/(b*y)}const S=o[f].frustum;a.intersectsFrustum(S)&&(c=!0,l=Math.max(l,x),d=Math.min(d,b)),h=Math.max(h,x),u=Math.min(u,b)}this.invokeAllPlugins(f=>{f!==this&&f.calculateTileViewError&&f.calculateTileViewError(e,Ps)&&(c=c&&Ps.inView,h=Math.max(h,Ps.error),Ps.inView&&(l=Math.max(l,Ps.error)))}),c?(s.inView=!0,s.error=l,s.distanceFromCamera=d):(s.inView=Ps.inView,s.error=h,s.distanceFromCamera=u)}setLatLonToYUp(e,s){console.warn("TilesRenderer: setLatLonToYUp is deprecated. Use the ReorientationPlugin, instead.");const{ellipsoid:n,group:r}=this;zc.set(Math.PI/2,Math.PI/2,0),Fc.makeRotationFromEuler(zc),n.getEastNorthUpFrame(e,s,0,r.matrix).multiply(Fc).invert().decompose(r.position,r.quaternion,r.scale),r.updateMatrixWorld(!0)}dispose(){super.dispose(),this.group.removeFromParent()}}new ve;new ve;new Se;new $;new $;new $;new Li;new $;new $;new $;const Bc={type:"change"},ha={type:"start"},Yd={type:"end"},cr=new Gr,Hc=new Is,pb=Math.cos(70*At.DEG2RAD),Pe=new $,Ge=2*Math.PI,xe={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Bo=1e-6;class gb extends ef{constructor(e,s=null){super(e,s),this.state=xe.NONE,this.target=new $,this.cursor=new $,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Fs.ROTATE,MIDDLE:Fs.DOLLY,RIGHT:Fs.PAN},this.touches={ONE:Os.ROTATE,TWO:Os.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new $,this._lastQuaternion=new ys,this._lastTargetPosition=new $,this._quat=new ys().setFromUnitVectors(e.up,new $(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new vr,this._sphericalDelta=new vr,this._scale=1,this._panOffset=new $,this._rotateStart=new ve,this._rotateEnd=new ve,this._rotateDelta=new ve,this._panStart=new ve,this._panEnd=new ve,this._panDelta=new ve,this._dollyStart=new ve,this._dollyEnd=new ve,this._dollyDelta=new ve,this._dollyDirection=new $,this._mouse=new ve,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=yb.bind(this),this._onPointerDown=xb.bind(this),this._onPointerUp=bb.bind(this),this._onContextMenu=Eb.bind(this),this._onMouseWheel=Sb.bind(this),this._onKeyDown=_b.bind(this),this._onTouchStart=Nb.bind(this),this._onTouchMove=Cb.bind(this),this._onMouseDown=vb.bind(this),this._onMouseMove=wb.bind(this),this._interceptControlDown=Rb.bind(this),this._interceptControlUp=Tb.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Bc),this.update(),this.state=xe.NONE}update(e=null){const s=this.object.position;Pe.copy(s).sub(this.target),Pe.applyQuaternion(this._quat),this._spherical.setFromVector3(Pe),this.autoRotate&&this.state===xe.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(n)&&isFinite(r)&&(n<-Math.PI?n+=Ge:n>Math.PI&&(n-=Ge),r<-Math.PI?r+=Ge:r>Math.PI&&(r-=Ge),n<=r?this._spherical.theta=Math.max(n,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+r)/2?Math.max(n,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const a=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=a!=this._spherical.radius}if(Pe.setFromSpherical(this._spherical),Pe.applyQuaternion(this._quatInverse),s.copy(this.target).add(Pe),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let a=null;if(this.object.isPerspectiveCamera){const c=Pe.length();a=this._clampDistance(c*this._scale);const l=c-a;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),o=!!l}else if(this.object.isOrthographicCamera){const c=new $(this._mouse.x,this._mouse.y,0);c.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=l!==this.object.zoom;const d=new $(this._mouse.x,this._mouse.y,0);d.unproject(this.object),this.object.position.sub(d).add(c),this.object.updateMatrixWorld(),a=Pe.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;a!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(a).add(this.object.position):(cr.origin.copy(this.object.position),cr.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(cr.direction))<pb?this.object.lookAt(this.target):(Hc.setFromNormalAndCoplanarPoint(this.object.up,this.target),cr.intersectPlane(Hc,this.target))))}else if(this.object.isOrthographicCamera){const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),a!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>Bo||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Bo||this._lastTargetPosition.distanceToSquared(this.target)>Bo?(this.dispatchEvent(Bc),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Ge/60*this.autoRotateSpeed*e:Ge/60/60*this.autoRotateSpeed}_getZoomScale(e){const s=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*s)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,s){Pe.setFromMatrixColumn(s,0),Pe.multiplyScalar(-e),this._panOffset.add(Pe)}_panUp(e,s){this.screenSpacePanning===!0?Pe.setFromMatrixColumn(s,1):(Pe.setFromMatrixColumn(s,0),Pe.crossVectors(this.object.up,Pe)),Pe.multiplyScalar(e),this._panOffset.add(Pe)}_pan(e,s){const n=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;Pe.copy(r).sub(this.target);let o=Pe.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*o/n.clientHeight,this.object.matrix),this._panUp(2*s*o/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(s*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,s){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),r=e-n.left,o=s-n.top,a=n.width,c=n.height;this._mouse.x=r/a*2-1,this._mouse.y=-(o/c)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const s=this.domElement;this._rotateLeft(Ge*this._rotateDelta.x/s.clientHeight),this._rotateUp(Ge*this._rotateDelta.y/s.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let s=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Ge*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),s=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Ge*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),s=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Ge*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),s=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Ge*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),s=!0;break}s&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),r=.5*(e.pageY+s.y);this._rotateStart.set(n,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),r=.5*(e.pageY+s.y);this._panStart.set(n,r)}}_handleTouchStartDolly(e){const s=this._getSecondPointerPosition(e),n=e.pageX-s.x,r=e.pageY-s.y,o=Math.sqrt(n*n+r*r);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),r=.5*(e.pageX+n.x),o=.5*(e.pageY+n.y);this._rotateEnd.set(r,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const s=this.domElement;this._rotateLeft(Ge*this._rotateDelta.x/s.clientHeight),this._rotateUp(Ge*this._rotateDelta.y/s.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),r=.5*(e.pageY+s.y);this._panEnd.set(n,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const s=this._getSecondPointerPosition(e),n=e.pageX-s.x,r=e.pageY-s.y,o=Math.sqrt(n*n+r*r);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=(e.pageX+s.x)*.5,c=(e.pageY+s.y)*.5;this._updateZoomParameters(a,c)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let s=0;s<this._pointers.length;s++)if(this._pointers[s]==e.pointerId){this._pointers.splice(s,1);return}}_isTrackingPointer(e){for(let s=0;s<this._pointers.length;s++)if(this._pointers[s]==e.pointerId)return!0;return!1}_trackPointer(e){let s=this._pointerPositions[e.pointerId];s===void 0&&(s=new ve,this._pointerPositions[e.pointerId]=s),s.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const s=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[s]}_customWheelEvent(e){const s=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(s){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function xb(t){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(t)&&(this._addPointer(t),t.pointerType==="touch"?this._onTouchStart(t):this._onMouseDown(t)))}function yb(t){this.enabled!==!1&&(t.pointerType==="touch"?this._onTouchMove(t):this._onMouseMove(t))}function bb(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Yd),this.state=xe.NONE;break;case 1:const e=this._pointers[0],s=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:s.x,pageY:s.y});break}}function vb(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Fs.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(t),this.state=xe.DOLLY;break;case Fs.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=xe.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=xe.ROTATE}break;case Fs.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=xe.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=xe.PAN}break;default:this.state=xe.NONE}this.state!==xe.NONE&&this.dispatchEvent(ha)}function wb(t){switch(this.state){case xe.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(t);break;case xe.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(t);break;case xe.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(t);break}}function Sb(t){this.enabled===!1||this.enableZoom===!1||this.state!==xe.NONE||(t.preventDefault(),this.dispatchEvent(ha),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(Yd))}function _b(t){this.enabled!==!1&&this._handleKeyDown(t)}function Nb(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case Os.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(t),this.state=xe.TOUCH_ROTATE;break;case Os.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(t),this.state=xe.TOUCH_PAN;break;default:this.state=xe.NONE}break;case 2:switch(this.touches.TWO){case Os.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(t),this.state=xe.TOUCH_DOLLY_PAN;break;case Os.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(t),this.state=xe.TOUCH_DOLLY_ROTATE;break;default:this.state=xe.NONE}break;default:this.state=xe.NONE}this.state!==xe.NONE&&this.dispatchEvent(ha)}function Cb(t){switch(this._trackPointer(t),this.state){case xe.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(t),this.update();break;case xe.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(t),this.update();break;case xe.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(t),this.update();break;case xe.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=xe.NONE}}function Eb(t){this.enabled!==!1&&t.preventDefault()}function Rb(t){t.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Tb(t){t.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const jb=({onTerrainLoad:t,onObjectDrop:e,className:s=""})=>{const n=g.useRef(null),[r,o]=g.useState(!0),[a,c]=g.useState(null),l=g.useRef();return g.useEffect(()=>{if(n.current)try{const d=new zr;d.background=new ze(1707787);const h=new Ur(75,n.current.clientWidth/n.current.clientHeight,.1,5e4),u=new Br({antialias:!0,logarithmicDepthBuffer:!0});u.setSize(n.current.clientWidth,n.current.clientHeight),u.setPixelRatio(window.devicePixelRatio),u.shadowMap.enabled=!0,u.shadowMap.type=Hr,n.current.appendChild(u.domElement);const f=new $r(4863784,.4);d.add(f);const m=new Vs(16753510,.8);m.position.set(100,100,50),m.castShadow=!0,m.shadow.mapSize.width=2048,m.shadow.mapSize.height=2048,m.shadow.camera.near=.5,m.shadow.camera.far=500,d.add(m);const p=new gb(h,u.domElement);p.enableDamping=!0,p.dampingFactor=.05,p.minDistance=1,p.maxDistance=1e3;const x="https://raw.githubusercontent.com/NASA-AMMOS/3DTilesSampleData/master/msl-dingo-gap/0528_0260184_to_s64o256_colorize/0528_0260184_to_s64o256_colorize/0528_0260184_to_s64o256_colorize_tileset.json",b=new mb(x);b.setCamera(h),b.setResolutionFromRenderer(h,u),b.lruCache.minSize=900,b.lruCache.maxSize=1300,b.errorTarget=6,b.addEventListener("load-tile-set",()=>{console.log("Mars tileset loaded successfully");const _=new Bi,N=new Wr;b.getBoundingSphere(N),b.getBoundingBox(_);const j=N.center;b.group.position.copy(j).multiplyScalar(-1);const F=N.radius*.8;h.position.set(j.x+F*.5,j.y+F*.3,j.z+F*.5),h.lookAt(j.x,j.y,j.z),p.target.copy(j),p.update(),o(!1),t?.(b)}),b.addEventListener("load-model",()=>{console.log("Mars terrain model loaded")}),b.addEventListener("tile-load-error",_=>{console.error("Tile load error:",_)}),d.add(b.group);const S=new wn,y=new ve,w=_=>{if(!l.current)return;const N=u.domElement.getBoundingClientRect();y.x=(_.clientX-N.left)/N.width*2-1,y.y=-((_.clientY-N.top)/N.height)*2+1,S.setFromCamera(y,h);const j=S.intersectObject(b.group,!0);if(j.length>0){const F=j[0],E=F.point,B=(F.face?.normal||new $(0,1,0)).clone();F.object.matrixWorld&&B.transformDirection(F.object.matrixWorld),console.log("Terrain clicked at:",E),e?.(E,B);const k=new Vr(.5,8,6),D=new qt({color:65280}),U=new ke(k,D);U.position.copy(E),d.add(U),setTimeout(()=>{d.remove(U)},2e3)}};u.domElement.addEventListener("click",w);let v;const C=()=>{v=requestAnimationFrame(C),h&&b&&(h.updateMatrixWorld(),b.update()),p.update(),u.render(d,h)};C(),l.current={scene:d,camera:h,renderer:u,controls:p,tiles:b,animationId:v};const T=()=>{if(!n.current||!l.current)return;const{camera:_,renderer:N}=l.current;_.aspect=n.current.clientWidth/n.current.clientHeight,_.updateProjectionMatrix(),N.setSize(n.current.clientWidth,n.current.clientHeight)};return window.addEventListener("resize",T),()=>{window.removeEventListener("resize",T),u.domElement.removeEventListener("click",w),v&&cancelAnimationFrame(v),n.current&&u.domElement.parentNode&&n.current.removeChild(u.domElement),b.dispose(),u.dispose(),d.traverse(_=>{_ instanceof ke&&(_.geometry?.dispose(),Array.isArray(_.material)?_.material.forEach(N=>N.dispose()):_.material?.dispose())})}}catch(d){console.error("Error initializing Mars terrain viewer:",d),c(d instanceof Error?d.message:"Unknown error occurred"),o(!1)}},[t,e]),a?i.jsx("div",{className:`flex items-center justify-center h-full bg-red-100 text-red-800 ${s}`,children:i.jsxs("div",{className:"text-center",children:[i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Mars Terrain Loading Error"}),i.jsx("p",{className:"text-sm",children:a}),i.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"})]})}):i.jsxs("div",{className:`relative w-full h-full ${s}`,children:[r&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 z-10",children:i.jsxs("div",{className:"text-center text-white",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Loading Mars Terrain"}),i.jsx("p",{className:"text-sm",children:"Downloading NASA Mars surface data..."})]})}),i.jsx("div",{ref:n,className:"w-full h-full",style:{cursor:r?"wait":"crosshair"}}),!r&&i.jsxs("div",{className:"absolute top-4 left-4 bg-black bg-opacity-70 text-white p-3 rounded-lg text-sm",children:[i.jsx("h4",{className:"font-semibold mb-1",children:"Mars Terrain Controls"}),i.jsxs("ul",{className:"space-y-1 text-xs",children:[i.jsx("li",{children:" Left click + drag: Rotate view"}),i.jsx("li",{children:" Right click + drag: Pan"}),i.jsx("li",{children:" Scroll: Zoom in/out"}),i.jsx("li",{children:" Click terrain: Place object"})]})]})]})};function $c(t,[e,s]){return Math.min(s,Math.max(e,t))}function Te(t,e,{checkForDefaultPrevented:s=!0}={}){return function(r){if(t?.(r),s===!1||!r.defaultPrevented)return e?.(r)}}function fa(t,e=[]){let s=[];function n(o,a){const c=g.createContext(a),l=s.length;s=[...s,a];const d=u=>{const{scope:f,children:m,...p}=u,x=f?.[t]?.[l]||c,b=g.useMemo(()=>p,Object.values(p));return i.jsx(x.Provider,{value:b,children:m})};d.displayName=o+"Provider";function h(u,f){const m=f?.[t]?.[l]||c,p=g.useContext(m);if(p)return p;if(a!==void 0)return a;throw new Error(`\`${u}\` must be used within \`${o}\``)}return[d,h]}const r=()=>{const o=s.map(a=>g.createContext(a));return function(c){const l=c?.[t]||o;return g.useMemo(()=>({[`__scope${t}`]:{...c,[t]:l}}),[c,l])}};return r.scopeName=t,[n,Pb(r,...e)]}function Pb(...t){const e=t[0];if(t.length===1)return e;const s=()=>{const n=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(o){const a=n.reduce((c,{useScope:l,scopeName:d})=>{const u=l(o)[`__scope${d}`];return{...c,...u}},{});return g.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return s.scopeName=e.scopeName,s}function Vc(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Xd(...t){return e=>{let s=!1;const n=t.map(r=>{const o=Vc(r,e);return!s&&typeof o=="function"&&(s=!0),o});if(s)return()=>{for(let r=0;r<n.length;r++){const o=n[r];typeof o=="function"?o():Vc(t[r],null)}}}}function Ae(...t){return g.useCallback(Xd(...t),t)}function Ar(t){const e=kb(t),s=g.forwardRef((n,r)=>{const{children:o,...a}=n,c=g.Children.toArray(o),l=c.find(Ab);if(l){const d=l.props.children,h=c.map(u=>u===l?g.Children.count(d)>1?g.Children.only(null):g.isValidElement(d)?d.props.children:null:u);return i.jsx(e,{...a,ref:r,children:g.isValidElement(d)?g.cloneElement(d,void 0,h):null})}return i.jsx(e,{...a,ref:r,children:o})});return s.displayName=`${t}.Slot`,s}function kb(t){const e=g.forwardRef((s,n)=>{const{children:r,...o}=s;if(g.isValidElement(r)){const a=Ob(r),c=Lb(o,r.props);return r.type!==g.Fragment&&(c.ref=n?Xd(n,a):a),g.cloneElement(r,c)}return g.Children.count(r)>1?g.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Mb=Symbol("radix.slottable");function Ab(t){return g.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Mb}function Lb(t,e){const s={...e};for(const n in e){const r=t[n],o=e[n];/^on[A-Z]/.test(n)?r&&o?s[n]=(...c)=>{const l=o(...c);return r(...c),l}:r&&(s[n]=r):n==="style"?s[n]={...r,...o}:n==="className"&&(s[n]=[r,o].filter(Boolean).join(" "))}return{...t,...s}}function Ob(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=e&&"isReactWarning"in e&&e.isReactWarning;return s?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=e&&"isReactWarning"in e&&e.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}function Db(t){const e=t+"CollectionProvider",[s,n]=fa(e),[r,o]=s(e,{collectionRef:{current:null},itemMap:new Map}),a=x=>{const{scope:b,children:S}=x,y=Ke.useRef(null),w=Ke.useRef(new Map).current;return i.jsx(r,{scope:b,itemMap:w,collectionRef:y,children:S})};a.displayName=e;const c=t+"CollectionSlot",l=Ar(c),d=Ke.forwardRef((x,b)=>{const{scope:S,children:y}=x,w=o(c,S),v=Ae(b,w.collectionRef);return i.jsx(l,{ref:v,children:y})});d.displayName=c;const h=t+"CollectionItemSlot",u="data-radix-collection-item",f=Ar(h),m=Ke.forwardRef((x,b)=>{const{scope:S,children:y,...w}=x,v=Ke.useRef(null),C=Ae(b,v),T=o(h,S);return Ke.useEffect(()=>(T.itemMap.set(v,{ref:v,...w}),()=>void T.itemMap.delete(v))),i.jsx(f,{[u]:"",ref:C,children:y})});m.displayName=h;function p(x){const b=o(t+"CollectionConsumer",x);return Ke.useCallback(()=>{const y=b.collectionRef.current;if(!y)return[];const w=Array.from(y.querySelectorAll(`[${u}]`));return Array.from(b.itemMap.values()).sort((T,_)=>w.indexOf(T.ref.current)-w.indexOf(_.ref.current))},[b.collectionRef,b.itemMap])}return[{Provider:a,Slot:d,ItemSlot:m},p,n]}var Ib=g.createContext(void 0);function Fb(t){const e=g.useContext(Ib);return t||e||"ltr"}var zb=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ce=zb.reduce((t,e)=>{const s=Ar(`Primitive.${e}`),n=g.forwardRef((r,o)=>{const{asChild:a,...c}=r,l=a?s:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(l,{...c,ref:o})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function Ub(t,e){t&&Xs.flushSync(()=>t.dispatchEvent(e))}function ws(t){const e=g.useRef(t);return g.useEffect(()=>{e.current=t}),g.useMemo(()=>(...s)=>e.current?.(...s),[])}function Bb(t,e=globalThis?.document){const s=ws(t);g.useEffect(()=>{const n=r=>{r.key==="Escape"&&s(r)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[s,e])}var Hb="DismissableLayer",_i="dismissableLayer.update",$b="dismissableLayer.pointerDownOutside",Vb="dismissableLayer.focusOutside",Wc,Qd=g.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Zd=g.forwardRef((t,e)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:n,onPointerDownOutside:r,onFocusOutside:o,onInteractOutside:a,onDismiss:c,...l}=t,d=g.useContext(Qd),[h,u]=g.useState(null),f=h?.ownerDocument??globalThis?.document,[,m]=g.useState({}),p=Ae(e,_=>u(_)),x=Array.from(d.layers),[b]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),S=x.indexOf(b),y=h?x.indexOf(h):-1,w=d.layersWithOutsidePointerEventsDisabled.size>0,v=y>=S,C=Kb(_=>{const N=_.target,j=[...d.branches].some(F=>F.contains(N));!v||j||(r?.(_),a?.(_),_.defaultPrevented||c?.())},f),T=qb(_=>{const N=_.target;[...d.branches].some(F=>F.contains(N))||(o?.(_),a?.(_),_.defaultPrevented||c?.())},f);return Bb(_=>{y===d.layers.size-1&&(n?.(_),!_.defaultPrevented&&c&&(_.preventDefault(),c()))},f),g.useEffect(()=>{if(h)return s&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(Wc=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(h)),d.layers.add(h),Gc(),()=>{s&&d.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=Wc)}},[h,f,s,d]),g.useEffect(()=>()=>{h&&(d.layers.delete(h),d.layersWithOutsidePointerEventsDisabled.delete(h),Gc())},[h,d]),g.useEffect(()=>{const _=()=>m({});return document.addEventListener(_i,_),()=>document.removeEventListener(_i,_)},[]),i.jsx(Ce.div,{...l,ref:p,style:{pointerEvents:w?v?"auto":"none":void 0,...t.style},onFocusCapture:Te(t.onFocusCapture,T.onFocusCapture),onBlurCapture:Te(t.onBlurCapture,T.onBlurCapture),onPointerDownCapture:Te(t.onPointerDownCapture,C.onPointerDownCapture)})});Zd.displayName=Hb;var Wb="DismissableLayerBranch",Gb=g.forwardRef((t,e)=>{const s=g.useContext(Qd),n=g.useRef(null),r=Ae(e,n);return g.useEffect(()=>{const o=n.current;if(o)return s.branches.add(o),()=>{s.branches.delete(o)}},[s.branches]),i.jsx(Ce.div,{...t,ref:r})});Gb.displayName=Wb;function Kb(t,e=globalThis?.document){const s=ws(t),n=g.useRef(!1),r=g.useRef(()=>{});return g.useEffect(()=>{const o=c=>{if(c.target&&!n.current){let l=function(){Jd($b,s,d,{discrete:!0})};const d={originalEvent:c};c.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=l,e.addEventListener("click",r.current,{once:!0})):l()}else e.removeEventListener("click",r.current);n.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",o),e.removeEventListener("click",r.current)}},[e,s]),{onPointerDownCapture:()=>n.current=!0}}function qb(t,e=globalThis?.document){const s=ws(t),n=g.useRef(!1);return g.useEffect(()=>{const r=o=>{o.target&&!n.current&&Jd(Vb,s,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,s]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function Gc(){const t=new CustomEvent(_i);document.dispatchEvent(t)}function Jd(t,e,s,{discrete:n}){const r=s.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:s});e&&r.addEventListener(t,e,{once:!0}),n?Ub(r,o):r.dispatchEvent(o)}var Ho=0;function Yb(){g.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??Kc()),document.body.insertAdjacentElement("beforeend",t[1]??Kc()),Ho++,()=>{Ho===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Ho--}},[])}function Kc(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var $o="focusScope.autoFocusOnMount",Vo="focusScope.autoFocusOnUnmount",qc={bubbles:!1,cancelable:!0},Xb="FocusScope",eu=g.forwardRef((t,e)=>{const{loop:s=!1,trapped:n=!1,onMountAutoFocus:r,onUnmountAutoFocus:o,...a}=t,[c,l]=g.useState(null),d=ws(r),h=ws(o),u=g.useRef(null),f=Ae(e,x=>l(x)),m=g.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;g.useEffect(()=>{if(n){let x=function(w){if(m.paused||!c)return;const v=w.target;c.contains(v)?u.current=v:Gt(u.current,{select:!0})},b=function(w){if(m.paused||!c)return;const v=w.relatedTarget;v!==null&&(c.contains(v)||Gt(u.current,{select:!0}))},S=function(w){if(document.activeElement===document.body)for(const C of w)C.removedNodes.length>0&&Gt(c)};document.addEventListener("focusin",x),document.addEventListener("focusout",b);const y=new MutationObserver(S);return c&&y.observe(c,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",x),document.removeEventListener("focusout",b),y.disconnect()}}},[n,c,m.paused]),g.useEffect(()=>{if(c){Xc.add(m);const x=document.activeElement;if(!c.contains(x)){const S=new CustomEvent($o,qc);c.addEventListener($o,d),c.dispatchEvent(S),S.defaultPrevented||(Qb(s0(tu(c)),{select:!0}),document.activeElement===x&&Gt(c))}return()=>{c.removeEventListener($o,d),setTimeout(()=>{const S=new CustomEvent(Vo,qc);c.addEventListener(Vo,h),c.dispatchEvent(S),S.defaultPrevented||Gt(x??document.body,{select:!0}),c.removeEventListener(Vo,h),Xc.remove(m)},0)}}},[c,d,h,m]);const p=g.useCallback(x=>{if(!s&&!n||m.paused)return;const b=x.key==="Tab"&&!x.altKey&&!x.ctrlKey&&!x.metaKey,S=document.activeElement;if(b&&S){const y=x.currentTarget,[w,v]=Zb(y);w&&v?!x.shiftKey&&S===v?(x.preventDefault(),s&&Gt(w,{select:!0})):x.shiftKey&&S===w&&(x.preventDefault(),s&&Gt(v,{select:!0})):S===y&&x.preventDefault()}},[s,n,m.paused]);return i.jsx(Ce.div,{tabIndex:-1,...a,ref:f,onKeyDown:p})});eu.displayName=Xb;function Qb(t,{select:e=!1}={}){const s=document.activeElement;for(const n of t)if(Gt(n,{select:e}),document.activeElement!==s)return}function Zb(t){const e=tu(t),s=Yc(e,t),n=Yc(e.reverse(),t);return[s,n]}function tu(t){const e=[],s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const r=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||r?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)e.push(s.currentNode);return e}function Yc(t,e){for(const s of t)if(!Jb(s,{upTo:e}))return s}function Jb(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function e0(t){return t instanceof HTMLInputElement&&"select"in t}function Gt(t,{select:e=!1}={}){if(t&&t.focus){const s=document.activeElement;t.focus({preventScroll:!0}),t!==s&&e0(t)&&e&&t.select()}}var Xc=t0();function t0(){let t=[];return{add(e){const s=t[0];e!==s&&s?.pause(),t=Qc(t,e),t.unshift(e)},remove(e){t=Qc(t,e),t[0]?.resume()}}}function Qc(t,e){const s=[...t],n=s.indexOf(e);return n!==-1&&s.splice(n,1),s}function s0(t){return t.filter(e=>e.tagName!=="A")}var Ye=globalThis?.document?g.useLayoutEffect:()=>{},n0=Cl[" useId ".trim().toString()]||(()=>{}),r0=0;function ma(t){const[e,s]=g.useState(n0());return Ye(()=>{s(n=>n??String(r0++))},[t]),e?`radix-${e}`:""}const o0=["top","right","bottom","left"],ts=Math.min,Xe=Math.max,Lr=Math.round,lr=Math.floor,_t=t=>({x:t,y:t}),i0={left:"right",right:"left",bottom:"top",top:"bottom"},a0={start:"end",end:"start"};function Ni(t,e,s){return Xe(t,ts(e,s))}function Ft(t,e){return typeof t=="function"?t(e):t}function zt(t){return t.split("-")[0]}function Js(t){return t.split("-")[1]}function pa(t){return t==="x"?"y":"x"}function ga(t){return t==="y"?"height":"width"}const c0=new Set(["top","bottom"]);function vt(t){return c0.has(zt(t))?"y":"x"}function xa(t){return pa(vt(t))}function l0(t,e,s){s===void 0&&(s=!1);const n=Js(t),r=xa(t),o=ga(r);let a=r==="x"?n===(s?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(a=Or(a)),[a,Or(a)]}function d0(t){const e=Or(t);return[Ci(t),e,Ci(e)]}function Ci(t){return t.replace(/start|end/g,e=>a0[e])}const Zc=["left","right"],Jc=["right","left"],u0=["top","bottom"],h0=["bottom","top"];function f0(t,e,s){switch(t){case"top":case"bottom":return s?e?Jc:Zc:e?Zc:Jc;case"left":case"right":return e?u0:h0;default:return[]}}function m0(t,e,s,n){const r=Js(t);let o=f0(zt(t),s==="start",n);return r&&(o=o.map(a=>a+"-"+r),e&&(o=o.concat(o.map(Ci)))),o}function Or(t){return t.replace(/left|right|bottom|top/g,e=>i0[e])}function p0(t){return{top:0,right:0,bottom:0,left:0,...t}}function su(t){return typeof t!="number"?p0(t):{top:t,right:t,bottom:t,left:t}}function Dr(t){const{x:e,y:s,width:n,height:r}=t;return{width:n,height:r,top:s,left:e,right:e+n,bottom:s+r,x:e,y:s}}function el(t,e,s){let{reference:n,floating:r}=t;const o=vt(e),a=xa(e),c=ga(a),l=zt(e),d=o==="y",h=n.x+n.width/2-r.width/2,u=n.y+n.height/2-r.height/2,f=n[c]/2-r[c]/2;let m;switch(l){case"top":m={x:h,y:n.y-r.height};break;case"bottom":m={x:h,y:n.y+n.height};break;case"right":m={x:n.x+n.width,y:u};break;case"left":m={x:n.x-r.width,y:u};break;default:m={x:n.x,y:n.y}}switch(Js(e)){case"start":m[a]-=f*(s&&d?-1:1);break;case"end":m[a]+=f*(s&&d?-1:1);break}return m}const g0=async(t,e,s)=>{const{placement:n="bottom",strategy:r="absolute",middleware:o=[],platform:a}=s,c=o.filter(Boolean),l=await(a.isRTL==null?void 0:a.isRTL(e));let d=await a.getElementRects({reference:t,floating:e,strategy:r}),{x:h,y:u}=el(d,n,l),f=n,m={},p=0;for(let x=0;x<c.length;x++){const{name:b,fn:S}=c[x],{x:y,y:w,data:v,reset:C}=await S({x:h,y:u,initialPlacement:n,placement:f,strategy:r,middlewareData:m,rects:d,platform:a,elements:{reference:t,floating:e}});h=y??h,u=w??u,m={...m,[b]:{...m[b],...v}},C&&p<=50&&(p++,typeof C=="object"&&(C.placement&&(f=C.placement),C.rects&&(d=C.rects===!0?await a.getElementRects({reference:t,floating:e,strategy:r}):C.rects),{x:h,y:u}=el(d,f,l)),x=-1)}return{x:h,y:u,placement:f,strategy:r,middlewareData:m}};async function Mn(t,e){var s;e===void 0&&(e={});const{x:n,y:r,platform:o,rects:a,elements:c,strategy:l}=t,{boundary:d="clippingAncestors",rootBoundary:h="viewport",elementContext:u="floating",altBoundary:f=!1,padding:m=0}=Ft(e,t),p=su(m),b=c[f?u==="floating"?"reference":"floating":u],S=Dr(await o.getClippingRect({element:(s=await(o.isElement==null?void 0:o.isElement(b)))==null||s?b:b.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(c.floating)),boundary:d,rootBoundary:h,strategy:l})),y=u==="floating"?{x:n,y:r,width:a.floating.width,height:a.floating.height}:a.reference,w=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c.floating)),v=await(o.isElement==null?void 0:o.isElement(w))?await(o.getScale==null?void 0:o.getScale(w))||{x:1,y:1}:{x:1,y:1},C=Dr(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:y,offsetParent:w,strategy:l}):y);return{top:(S.top-C.top+p.top)/v.y,bottom:(C.bottom-S.bottom+p.bottom)/v.y,left:(S.left-C.left+p.left)/v.x,right:(C.right-S.right+p.right)/v.x}}const x0=t=>({name:"arrow",options:t,async fn(e){const{x:s,y:n,placement:r,rects:o,platform:a,elements:c,middlewareData:l}=e,{element:d,padding:h=0}=Ft(t,e)||{};if(d==null)return{};const u=su(h),f={x:s,y:n},m=xa(r),p=ga(m),x=await a.getDimensions(d),b=m==="y",S=b?"top":"left",y=b?"bottom":"right",w=b?"clientHeight":"clientWidth",v=o.reference[p]+o.reference[m]-f[m]-o.floating[p],C=f[m]-o.reference[m],T=await(a.getOffsetParent==null?void 0:a.getOffsetParent(d));let _=T?T[w]:0;(!_||!await(a.isElement==null?void 0:a.isElement(T)))&&(_=c.floating[w]||o.floating[p]);const N=v/2-C/2,j=_/2-x[p]/2-1,F=ts(u[S],j),E=ts(u[y],j),P=F,B=_-x[p]-E,k=_/2-x[p]/2+N,D=Ni(P,k,B),U=!l.arrow&&Js(r)!=null&&k!==D&&o.reference[p]/2-(k<P?F:E)-x[p]/2<0,Y=U?k<P?k-P:k-B:0;return{[m]:f[m]+Y,data:{[m]:D,centerOffset:k-D-Y,...U&&{alignmentOffset:Y}},reset:U}}}),y0=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var s,n;const{placement:r,middlewareData:o,rects:a,initialPlacement:c,platform:l,elements:d}=e,{mainAxis:h=!0,crossAxis:u=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:x=!0,...b}=Ft(t,e);if((s=o.arrow)!=null&&s.alignmentOffset)return{};const S=zt(r),y=vt(c),w=zt(c)===c,v=await(l.isRTL==null?void 0:l.isRTL(d.floating)),C=f||(w||!x?[Or(c)]:d0(c)),T=p!=="none";!f&&T&&C.push(...m0(c,x,p,v));const _=[c,...C],N=await Mn(e,b),j=[];let F=((n=o.flip)==null?void 0:n.overflows)||[];if(h&&j.push(N[S]),u){const k=l0(r,a,v);j.push(N[k[0]],N[k[1]])}if(F=[...F,{placement:r,overflows:j}],!j.every(k=>k<=0)){var E,P;const k=(((E=o.flip)==null?void 0:E.index)||0)+1,D=_[k];if(D&&(!(u==="alignment"?y!==vt(D):!1)||F.every(O=>vt(O.placement)===y?O.overflows[0]>0:!0)))return{data:{index:k,overflows:F},reset:{placement:D}};let U=(P=F.filter(Y=>Y.overflows[0]<=0).sort((Y,O)=>Y.overflows[1]-O.overflows[1])[0])==null?void 0:P.placement;if(!U)switch(m){case"bestFit":{var B;const Y=(B=F.filter(O=>{if(T){const G=vt(O.placement);return G===y||G==="y"}return!0}).map(O=>[O.placement,O.overflows.filter(G=>G>0).reduce((G,ce)=>G+ce,0)]).sort((O,G)=>O[1]-G[1])[0])==null?void 0:B[0];Y&&(U=Y);break}case"initialPlacement":U=c;break}if(r!==U)return{reset:{placement:U}}}return{}}}};function tl(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function sl(t){return o0.some(e=>t[e]>=0)}const b0=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:s}=e,{strategy:n="referenceHidden",...r}=Ft(t,e);switch(n){case"referenceHidden":{const o=await Mn(e,{...r,elementContext:"reference"}),a=tl(o,s.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:sl(a)}}}case"escaped":{const o=await Mn(e,{...r,altBoundary:!0}),a=tl(o,s.floating);return{data:{escapedOffsets:a,escaped:sl(a)}}}default:return{}}}}},nu=new Set(["left","top"]);async function v0(t,e){const{placement:s,platform:n,elements:r}=t,o=await(n.isRTL==null?void 0:n.isRTL(r.floating)),a=zt(s),c=Js(s),l=vt(s)==="y",d=nu.has(a)?-1:1,h=o&&l?-1:1,u=Ft(e,t);let{mainAxis:f,crossAxis:m,alignmentAxis:p}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return c&&typeof p=="number"&&(m=c==="end"?p*-1:p),l?{x:m*h,y:f*d}:{x:f*d,y:m*h}}const w0=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var s,n;const{x:r,y:o,placement:a,middlewareData:c}=e,l=await v0(e,t);return a===((s=c.offset)==null?void 0:s.placement)&&(n=c.arrow)!=null&&n.alignmentOffset?{}:{x:r+l.x,y:o+l.y,data:{...l,placement:a}}}}},S0=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:s,y:n,placement:r}=e,{mainAxis:o=!0,crossAxis:a=!1,limiter:c={fn:b=>{let{x:S,y}=b;return{x:S,y}}},...l}=Ft(t,e),d={x:s,y:n},h=await Mn(e,l),u=vt(zt(r)),f=pa(u);let m=d[f],p=d[u];if(o){const b=f==="y"?"top":"left",S=f==="y"?"bottom":"right",y=m+h[b],w=m-h[S];m=Ni(y,m,w)}if(a){const b=u==="y"?"top":"left",S=u==="y"?"bottom":"right",y=p+h[b],w=p-h[S];p=Ni(y,p,w)}const x=c.fn({...e,[f]:m,[u]:p});return{...x,data:{x:x.x-s,y:x.y-n,enabled:{[f]:o,[u]:a}}}}}},_0=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:s,y:n,placement:r,rects:o,middlewareData:a}=e,{offset:c=0,mainAxis:l=!0,crossAxis:d=!0}=Ft(t,e),h={x:s,y:n},u=vt(r),f=pa(u);let m=h[f],p=h[u];const x=Ft(c,e),b=typeof x=="number"?{mainAxis:x,crossAxis:0}:{mainAxis:0,crossAxis:0,...x};if(l){const w=f==="y"?"height":"width",v=o.reference[f]-o.floating[w]+b.mainAxis,C=o.reference[f]+o.reference[w]-b.mainAxis;m<v?m=v:m>C&&(m=C)}if(d){var S,y;const w=f==="y"?"width":"height",v=nu.has(zt(r)),C=o.reference[u]-o.floating[w]+(v&&((S=a.offset)==null?void 0:S[u])||0)+(v?0:b.crossAxis),T=o.reference[u]+o.reference[w]+(v?0:((y=a.offset)==null?void 0:y[u])||0)-(v?b.crossAxis:0);p<C?p=C:p>T&&(p=T)}return{[f]:m,[u]:p}}}},N0=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var s,n;const{placement:r,rects:o,platform:a,elements:c}=e,{apply:l=()=>{},...d}=Ft(t,e),h=await Mn(e,d),u=zt(r),f=Js(r),m=vt(r)==="y",{width:p,height:x}=o.floating;let b,S;u==="top"||u==="bottom"?(b=u,S=f===(await(a.isRTL==null?void 0:a.isRTL(c.floating))?"start":"end")?"left":"right"):(S=u,b=f==="end"?"top":"bottom");const y=x-h.top-h.bottom,w=p-h.left-h.right,v=ts(x-h[b],y),C=ts(p-h[S],w),T=!e.middlewareData.shift;let _=v,N=C;if((s=e.middlewareData.shift)!=null&&s.enabled.x&&(N=w),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(_=y),T&&!f){const F=Xe(h.left,0),E=Xe(h.right,0),P=Xe(h.top,0),B=Xe(h.bottom,0);m?N=p-2*(F!==0||E!==0?F+E:Xe(h.left,h.right)):_=x-2*(P!==0||B!==0?P+B:Xe(h.top,h.bottom))}await l({...e,availableWidth:N,availableHeight:_});const j=await a.getDimensions(c.floating);return p!==j.width||x!==j.height?{reset:{rects:!0}}:{}}}};function oo(){return typeof window<"u"}function en(t){return ru(t)?(t.nodeName||"").toLowerCase():"#document"}function Je(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Tt(t){var e;return(e=(ru(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function ru(t){return oo()?t instanceof Node||t instanceof Je(t).Node:!1}function ht(t){return oo()?t instanceof Element||t instanceof Je(t).Element:!1}function Rt(t){return oo()?t instanceof HTMLElement||t instanceof Je(t).HTMLElement:!1}function nl(t){return!oo()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Je(t).ShadowRoot}const C0=new Set(["inline","contents"]);function Ln(t){const{overflow:e,overflowX:s,overflowY:n,display:r}=ft(t);return/auto|scroll|overlay|hidden|clip/.test(e+n+s)&&!C0.has(r)}const E0=new Set(["table","td","th"]);function R0(t){return E0.has(en(t))}const T0=[":popover-open",":modal"];function io(t){return T0.some(e=>{try{return t.matches(e)}catch{return!1}})}const j0=["transform","translate","scale","rotate","perspective"],P0=["transform","translate","scale","rotate","perspective","filter"],k0=["paint","layout","strict","content"];function ya(t){const e=ba(),s=ht(t)?ft(t):t;return j0.some(n=>s[n]?s[n]!=="none":!1)||(s.containerType?s.containerType!=="normal":!1)||!e&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!e&&(s.filter?s.filter!=="none":!1)||P0.some(n=>(s.willChange||"").includes(n))||k0.some(n=>(s.contain||"").includes(n))}function M0(t){let e=ss(t);for(;Rt(e)&&!Ys(e);){if(ya(e))return e;if(io(e))return null;e=ss(e)}return null}function ba(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const A0=new Set(["html","body","#document"]);function Ys(t){return A0.has(en(t))}function ft(t){return Je(t).getComputedStyle(t)}function ao(t){return ht(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function ss(t){if(en(t)==="html")return t;const e=t.assignedSlot||t.parentNode||nl(t)&&t.host||Tt(t);return nl(e)?e.host:e}function ou(t){const e=ss(t);return Ys(e)?t.ownerDocument?t.ownerDocument.body:t.body:Rt(e)&&Ln(e)?e:ou(e)}function An(t,e,s){var n;e===void 0&&(e=[]),s===void 0&&(s=!0);const r=ou(t),o=r===((n=t.ownerDocument)==null?void 0:n.body),a=Je(r);if(o){const c=Ei(a);return e.concat(a,a.visualViewport||[],Ln(r)?r:[],c&&s?An(c):[])}return e.concat(r,An(r,[],s))}function Ei(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function iu(t){const e=ft(t);let s=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const r=Rt(t),o=r?t.offsetWidth:s,a=r?t.offsetHeight:n,c=Lr(s)!==o||Lr(n)!==a;return c&&(s=o,n=a),{width:s,height:n,$:c}}function va(t){return ht(t)?t:t.contextElement}function Hs(t){const e=va(t);if(!Rt(e))return _t(1);const s=e.getBoundingClientRect(),{width:n,height:r,$:o}=iu(e);let a=(o?Lr(s.width):s.width)/n,c=(o?Lr(s.height):s.height)/r;return(!a||!Number.isFinite(a))&&(a=1),(!c||!Number.isFinite(c))&&(c=1),{x:a,y:c}}const L0=_t(0);function au(t){const e=Je(t);return!ba()||!e.visualViewport?L0:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function O0(t,e,s){return e===void 0&&(e=!1),!s||e&&s!==Je(t)?!1:e}function Ss(t,e,s,n){e===void 0&&(e=!1),s===void 0&&(s=!1);const r=t.getBoundingClientRect(),o=va(t);let a=_t(1);e&&(n?ht(n)&&(a=Hs(n)):a=Hs(t));const c=O0(o,s,n)?au(o):_t(0);let l=(r.left+c.x)/a.x,d=(r.top+c.y)/a.y,h=r.width/a.x,u=r.height/a.y;if(o){const f=Je(o),m=n&&ht(n)?Je(n):n;let p=f,x=Ei(p);for(;x&&n&&m!==p;){const b=Hs(x),S=x.getBoundingClientRect(),y=ft(x),w=S.left+(x.clientLeft+parseFloat(y.paddingLeft))*b.x,v=S.top+(x.clientTop+parseFloat(y.paddingTop))*b.y;l*=b.x,d*=b.y,h*=b.x,u*=b.y,l+=w,d+=v,p=Je(x),x=Ei(p)}}return Dr({width:h,height:u,x:l,y:d})}function co(t,e){const s=ao(t).scrollLeft;return e?e.left+s:Ss(Tt(t)).left+s}function cu(t,e){const s=t.getBoundingClientRect(),n=s.left+e.scrollLeft-co(t,s),r=s.top+e.scrollTop;return{x:n,y:r}}function D0(t){let{elements:e,rect:s,offsetParent:n,strategy:r}=t;const o=r==="fixed",a=Tt(n),c=e?io(e.floating):!1;if(n===a||c&&o)return s;let l={scrollLeft:0,scrollTop:0},d=_t(1);const h=_t(0),u=Rt(n);if((u||!u&&!o)&&((en(n)!=="body"||Ln(a))&&(l=ao(n)),Rt(n))){const m=Ss(n);d=Hs(n),h.x=m.x+n.clientLeft,h.y=m.y+n.clientTop}const f=a&&!u&&!o?cu(a,l):_t(0);return{width:s.width*d.x,height:s.height*d.y,x:s.x*d.x-l.scrollLeft*d.x+h.x+f.x,y:s.y*d.y-l.scrollTop*d.y+h.y+f.y}}function I0(t){return Array.from(t.getClientRects())}function F0(t){const e=Tt(t),s=ao(t),n=t.ownerDocument.body,r=Xe(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),o=Xe(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let a=-s.scrollLeft+co(t);const c=-s.scrollTop;return ft(n).direction==="rtl"&&(a+=Xe(e.clientWidth,n.clientWidth)-r),{width:r,height:o,x:a,y:c}}const rl=25;function z0(t,e){const s=Je(t),n=Tt(t),r=s.visualViewport;let o=n.clientWidth,a=n.clientHeight,c=0,l=0;if(r){o=r.width,a=r.height;const h=ba();(!h||h&&e==="fixed")&&(c=r.offsetLeft,l=r.offsetTop)}const d=co(n);if(d<=0){const h=n.ownerDocument,u=h.body,f=getComputedStyle(u),m=h.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,p=Math.abs(n.clientWidth-u.clientWidth-m);p<=rl&&(o-=p)}else d<=rl&&(o+=d);return{width:o,height:a,x:c,y:l}}const U0=new Set(["absolute","fixed"]);function B0(t,e){const s=Ss(t,!0,e==="fixed"),n=s.top+t.clientTop,r=s.left+t.clientLeft,o=Rt(t)?Hs(t):_t(1),a=t.clientWidth*o.x,c=t.clientHeight*o.y,l=r*o.x,d=n*o.y;return{width:a,height:c,x:l,y:d}}function ol(t,e,s){let n;if(e==="viewport")n=z0(t,s);else if(e==="document")n=F0(Tt(t));else if(ht(e))n=B0(e,s);else{const r=au(t);n={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return Dr(n)}function lu(t,e){const s=ss(t);return s===e||!ht(s)||Ys(s)?!1:ft(s).position==="fixed"||lu(s,e)}function H0(t,e){const s=e.get(t);if(s)return s;let n=An(t,[],!1).filter(c=>ht(c)&&en(c)!=="body"),r=null;const o=ft(t).position==="fixed";let a=o?ss(t):t;for(;ht(a)&&!Ys(a);){const c=ft(a),l=ya(a);!l&&c.position==="fixed"&&(r=null),(o?!l&&!r:!l&&c.position==="static"&&!!r&&U0.has(r.position)||Ln(a)&&!l&&lu(t,a))?n=n.filter(h=>h!==a):r=c,a=ss(a)}return e.set(t,n),n}function $0(t){let{element:e,boundary:s,rootBoundary:n,strategy:r}=t;const a=[...s==="clippingAncestors"?io(e)?[]:H0(e,this._c):[].concat(s),n],c=a[0],l=a.reduce((d,h)=>{const u=ol(e,h,r);return d.top=Xe(u.top,d.top),d.right=ts(u.right,d.right),d.bottom=ts(u.bottom,d.bottom),d.left=Xe(u.left,d.left),d},ol(e,c,r));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function V0(t){const{width:e,height:s}=iu(t);return{width:e,height:s}}function W0(t,e,s){const n=Rt(e),r=Tt(e),o=s==="fixed",a=Ss(t,!0,o,e);let c={scrollLeft:0,scrollTop:0};const l=_t(0);function d(){l.x=co(r)}if(n||!n&&!o)if((en(e)!=="body"||Ln(r))&&(c=ao(e)),n){const m=Ss(e,!0,o,e);l.x=m.x+e.clientLeft,l.y=m.y+e.clientTop}else r&&d();o&&!n&&r&&d();const h=r&&!n&&!o?cu(r,c):_t(0),u=a.left+c.scrollLeft-l.x-h.x,f=a.top+c.scrollTop-l.y-h.y;return{x:u,y:f,width:a.width,height:a.height}}function Wo(t){return ft(t).position==="static"}function il(t,e){if(!Rt(t)||ft(t).position==="fixed")return null;if(e)return e(t);let s=t.offsetParent;return Tt(t)===s&&(s=s.ownerDocument.body),s}function du(t,e){const s=Je(t);if(io(t))return s;if(!Rt(t)){let r=ss(t);for(;r&&!Ys(r);){if(ht(r)&&!Wo(r))return r;r=ss(r)}return s}let n=il(t,e);for(;n&&R0(n)&&Wo(n);)n=il(n,e);return n&&Ys(n)&&Wo(n)&&!ya(n)?s:n||M0(t)||s}const G0=async function(t){const e=this.getOffsetParent||du,s=this.getDimensions,n=await s(t.floating);return{reference:W0(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function K0(t){return ft(t).direction==="rtl"}const q0={convertOffsetParentRelativeRectToViewportRelativeRect:D0,getDocumentElement:Tt,getClippingRect:$0,getOffsetParent:du,getElementRects:G0,getClientRects:I0,getDimensions:V0,getScale:Hs,isElement:ht,isRTL:K0};function uu(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function Y0(t,e){let s=null,n;const r=Tt(t);function o(){var c;clearTimeout(n),(c=s)==null||c.disconnect(),s=null}function a(c,l){c===void 0&&(c=!1),l===void 0&&(l=1),o();const d=t.getBoundingClientRect(),{left:h,top:u,width:f,height:m}=d;if(c||e(),!f||!m)return;const p=lr(u),x=lr(r.clientWidth-(h+f)),b=lr(r.clientHeight-(u+m)),S=lr(h),w={rootMargin:-p+"px "+-x+"px "+-b+"px "+-S+"px",threshold:Xe(0,ts(1,l))||1};let v=!0;function C(T){const _=T[0].intersectionRatio;if(_!==l){if(!v)return a();_?a(!1,_):n=setTimeout(()=>{a(!1,1e-7)},1e3)}_===1&&!uu(d,t.getBoundingClientRect())&&a(),v=!1}try{s=new IntersectionObserver(C,{...w,root:r.ownerDocument})}catch{s=new IntersectionObserver(C,w)}s.observe(t)}return a(!0),o}function X0(t,e,s,n){n===void 0&&(n={});const{ancestorScroll:r=!0,ancestorResize:o=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:l=!1}=n,d=va(t),h=r||o?[...d?An(d):[],...An(e)]:[];h.forEach(S=>{r&&S.addEventListener("scroll",s,{passive:!0}),o&&S.addEventListener("resize",s)});const u=d&&c?Y0(d,s):null;let f=-1,m=null;a&&(m=new ResizeObserver(S=>{let[y]=S;y&&y.target===d&&m&&(m.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var w;(w=m)==null||w.observe(e)})),s()}),d&&!l&&m.observe(d),m.observe(e));let p,x=l?Ss(t):null;l&&b();function b(){const S=Ss(t);x&&!uu(x,S)&&s(),x=S,p=requestAnimationFrame(b)}return s(),()=>{var S;h.forEach(y=>{r&&y.removeEventListener("scroll",s),o&&y.removeEventListener("resize",s)}),u?.(),(S=m)==null||S.disconnect(),m=null,l&&cancelAnimationFrame(p)}}const Q0=w0,Z0=S0,J0=y0,ev=N0,tv=b0,al=x0,sv=_0,nv=(t,e,s)=>{const n=new Map,r={platform:q0,...s},o={...r.platform,_c:n};return g0(t,e,{...r,platform:o})};var rv=typeof document<"u",ov=function(){},xr=rv?g.useLayoutEffect:ov;function Ir(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let s,n,r;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(s=t.length,s!==e.length)return!1;for(n=s;n--!==0;)if(!Ir(t[n],e[n]))return!1;return!0}if(r=Object.keys(t),s=r.length,s!==Object.keys(e).length)return!1;for(n=s;n--!==0;)if(!{}.hasOwnProperty.call(e,r[n]))return!1;for(n=s;n--!==0;){const o=r[n];if(!(o==="_owner"&&t.$$typeof)&&!Ir(t[o],e[o]))return!1}return!0}return t!==t&&e!==e}function hu(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function cl(t,e){const s=hu(t);return Math.round(e*s)/s}function Go(t){const e=g.useRef(t);return xr(()=>{e.current=t}),e}function iv(t){t===void 0&&(t={});const{placement:e="bottom",strategy:s="absolute",middleware:n=[],platform:r,elements:{reference:o,floating:a}={},transform:c=!0,whileElementsMounted:l,open:d}=t,[h,u]=g.useState({x:0,y:0,strategy:s,placement:e,middlewareData:{},isPositioned:!1}),[f,m]=g.useState(n);Ir(f,n)||m(n);const[p,x]=g.useState(null),[b,S]=g.useState(null),y=g.useCallback(O=>{O!==T.current&&(T.current=O,x(O))},[]),w=g.useCallback(O=>{O!==_.current&&(_.current=O,S(O))},[]),v=o||p,C=a||b,T=g.useRef(null),_=g.useRef(null),N=g.useRef(h),j=l!=null,F=Go(l),E=Go(r),P=Go(d),B=g.useCallback(()=>{if(!T.current||!_.current)return;const O={placement:e,strategy:s,middleware:f};E.current&&(O.platform=E.current),nv(T.current,_.current,O).then(G=>{const ce={...G,isPositioned:P.current!==!1};k.current&&!Ir(N.current,ce)&&(N.current=ce,Xs.flushSync(()=>{u(ce)}))})},[f,e,s,E,P]);xr(()=>{d===!1&&N.current.isPositioned&&(N.current.isPositioned=!1,u(O=>({...O,isPositioned:!1})))},[d]);const k=g.useRef(!1);xr(()=>(k.current=!0,()=>{k.current=!1}),[]),xr(()=>{if(v&&(T.current=v),C&&(_.current=C),v&&C){if(F.current)return F.current(v,C,B);B()}},[v,C,B,F,j]);const D=g.useMemo(()=>({reference:T,floating:_,setReference:y,setFloating:w}),[y,w]),U=g.useMemo(()=>({reference:v,floating:C}),[v,C]),Y=g.useMemo(()=>{const O={position:s,left:0,top:0};if(!U.floating)return O;const G=cl(U.floating,h.x),ce=cl(U.floating,h.y);return c?{...O,transform:"translate("+G+"px, "+ce+"px)",...hu(U.floating)>=1.5&&{willChange:"transform"}}:{position:s,left:G,top:ce}},[s,c,U.floating,h.x,h.y]);return g.useMemo(()=>({...h,update:B,refs:D,elements:U,floatingStyles:Y}),[h,B,D,U,Y])}const av=t=>{function e(s){return{}.hasOwnProperty.call(s,"current")}return{name:"arrow",options:t,fn(s){const{element:n,padding:r}=typeof t=="function"?t(s):t;return n&&e(n)?n.current!=null?al({element:n.current,padding:r}).fn(s):{}:n?al({element:n,padding:r}).fn(s):{}}}},cv=(t,e)=>({...Q0(t),options:[t,e]}),lv=(t,e)=>({...Z0(t),options:[t,e]}),dv=(t,e)=>({...sv(t),options:[t,e]}),uv=(t,e)=>({...J0(t),options:[t,e]}),hv=(t,e)=>({...ev(t),options:[t,e]}),fv=(t,e)=>({...tv(t),options:[t,e]}),mv=(t,e)=>({...av(t),options:[t,e]});var pv="Arrow",fu=g.forwardRef((t,e)=>{const{children:s,width:n=10,height:r=5,...o}=t;return i.jsx(Ce.svg,{...o,ref:e,width:n,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?s:i.jsx("polygon",{points:"0,0 30,0 15,10"})})});fu.displayName=pv;var gv=fu;function xv(t){const[e,s]=g.useState(void 0);return Ye(()=>{if(t){s({width:t.offsetWidth,height:t.offsetHeight});const n=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const o=r[0];let a,c;if("borderBoxSize"in o){const l=o.borderBoxSize,d=Array.isArray(l)?l[0]:l;a=d.inlineSize,c=d.blockSize}else a=t.offsetWidth,c=t.offsetHeight;s({width:a,height:c})});return n.observe(t,{box:"border-box"}),()=>n.unobserve(t)}else s(void 0)},[t]),e}var wa="Popper",[mu,pu]=fa(wa),[yv,gu]=mu(wa),xu=t=>{const{__scopePopper:e,children:s}=t,[n,r]=g.useState(null);return i.jsx(yv,{scope:e,anchor:n,onAnchorChange:r,children:s})};xu.displayName=wa;var yu="PopperAnchor",bu=g.forwardRef((t,e)=>{const{__scopePopper:s,virtualRef:n,...r}=t,o=gu(yu,s),a=g.useRef(null),c=Ae(e,a),l=g.useRef(null);return g.useEffect(()=>{const d=l.current;l.current=n?.current||a.current,d!==l.current&&o.onAnchorChange(l.current)}),n?null:i.jsx(Ce.div,{...r,ref:c})});bu.displayName=yu;var Sa="PopperContent",[bv,vv]=mu(Sa),vu=g.forwardRef((t,e)=>{const{__scopePopper:s,side:n="bottom",sideOffset:r=0,align:o="center",alignOffset:a=0,arrowPadding:c=0,avoidCollisions:l=!0,collisionBoundary:d=[],collisionPadding:h=0,sticky:u="partial",hideWhenDetached:f=!1,updatePositionStrategy:m="optimized",onPlaced:p,...x}=t,b=gu(Sa,s),[S,y]=g.useState(null),w=Ae(e,R=>y(R)),[v,C]=g.useState(null),T=xv(v),_=T?.width??0,N=T?.height??0,j=n+(o!=="center"?"-"+o:""),F=typeof h=="number"?h:{top:0,right:0,bottom:0,left:0,...h},E=Array.isArray(d)?d:[d],P=E.length>0,B={padding:F,boundary:E.filter(Sv),altBoundary:P},{refs:k,floatingStyles:D,placement:U,isPositioned:Y,middlewareData:O}=iv({strategy:"fixed",placement:j,whileElementsMounted:(...R)=>X0(...R,{animationFrame:m==="always"}),elements:{reference:b.anchor},middleware:[cv({mainAxis:r+N,alignmentAxis:a}),l&&lv({mainAxis:!0,crossAxis:!1,limiter:u==="partial"?dv():void 0,...B}),l&&uv({...B}),hv({...B,apply:({elements:R,rects:A,availableWidth:L,availableHeight:M})=>{const{width:V,height:se}=A.reference,ee=R.floating.style;ee.setProperty("--radix-popper-available-width",`${L}px`),ee.setProperty("--radix-popper-available-height",`${M}px`),ee.setProperty("--radix-popper-anchor-width",`${V}px`),ee.setProperty("--radix-popper-anchor-height",`${se}px`)}}),v&&mv({element:v,padding:c}),_v({arrowWidth:_,arrowHeight:N}),f&&fv({strategy:"referenceHidden",...B})]}),[G,ce]=_u(U),X=ws(p);Ye(()=>{Y&&X?.()},[Y,X]);const ye=O.arrow?.x,ne=O.arrow?.y,ue=O.arrow?.centerOffset!==0,[pe,fe]=g.useState();return Ye(()=>{S&&fe(window.getComputedStyle(S).zIndex)},[S]),i.jsx("div",{ref:k.setFloating,"data-radix-popper-content-wrapper":"",style:{...D,transform:Y?D.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:pe,"--radix-popper-transform-origin":[O.transformOrigin?.x,O.transformOrigin?.y].join(" "),...O.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:i.jsx(bv,{scope:s,placedSide:G,onArrowChange:C,arrowX:ye,arrowY:ne,shouldHideArrow:ue,children:i.jsx(Ce.div,{"data-side":G,"data-align":ce,...x,ref:w,style:{...x.style,animation:Y?void 0:"none"}})})})});vu.displayName=Sa;var wu="PopperArrow",wv={top:"bottom",right:"left",bottom:"top",left:"right"},Su=g.forwardRef(function(e,s){const{__scopePopper:n,...r}=e,o=vv(wu,n),a=wv[o.placedSide];return i.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:i.jsx(gv,{...r,ref:s,style:{...r.style,display:"block"}})})});Su.displayName=wu;function Sv(t){return t!==null}var _v=t=>({name:"transformOrigin",options:t,fn(e){const{placement:s,rects:n,middlewareData:r}=e,a=r.arrow?.centerOffset!==0,c=a?0:t.arrowWidth,l=a?0:t.arrowHeight,[d,h]=_u(s),u={start:"0%",center:"50%",end:"100%"}[h],f=(r.arrow?.x??0)+c/2,m=(r.arrow?.y??0)+l/2;let p="",x="";return d==="bottom"?(p=a?u:`${f}px`,x=`${-l}px`):d==="top"?(p=a?u:`${f}px`,x=`${n.floating.height+l}px`):d==="right"?(p=`${-l}px`,x=a?u:`${m}px`):d==="left"&&(p=`${n.floating.width+l}px`,x=a?u:`${m}px`),{data:{x:p,y:x}}}});function _u(t){const[e,s="center"]=t.split("-");return[e,s]}var Nv=xu,Cv=bu,Ev=vu,Rv=Su,Tv="Portal",Nu=g.forwardRef((t,e)=>{const{container:s,...n}=t,[r,o]=g.useState(!1);Ye(()=>o(!0),[]);const a=s||r&&globalThis?.document?.body;return a?ym.createPortal(i.jsx(Ce.div,{...n,ref:e}),a):null});Nu.displayName=Tv;var jv=Cl[" useInsertionEffect ".trim().toString()]||Ye;function ll({prop:t,defaultProp:e,onChange:s=()=>{},caller:n}){const[r,o,a]=Pv({defaultProp:e,onChange:s}),c=t!==void 0,l=c?t:r;{const h=g.useRef(t!==void 0);g.useEffect(()=>{const u=h.current;u!==c&&console.warn(`${n} is changing from ${u?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=c},[c,n])}const d=g.useCallback(h=>{if(c){const u=kv(h)?h(t):h;u!==t&&a.current?.(u)}else o(h)},[c,t,o,a]);return[l,d]}function Pv({defaultProp:t,onChange:e}){const[s,n]=g.useState(t),r=g.useRef(s),o=g.useRef(e);return jv(()=>{o.current=e},[e]),g.useEffect(()=>{r.current!==s&&(o.current?.(s),r.current=s)},[s,r]),[s,n,o]}function kv(t){return typeof t=="function"}function Mv(t){const e=g.useRef({value:t,previous:t});return g.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var Cu=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Av="VisuallyHidden",Lv=g.forwardRef((t,e)=>i.jsx(Ce.span,{...t,ref:e,style:{...Cu,...t.style}}));Lv.displayName=Av;var Ov=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},ks=new WeakMap,dr=new WeakMap,ur={},Ko=0,Eu=function(t){return t&&(t.host||Eu(t.parentNode))},Dv=function(t,e){return e.map(function(s){if(t.contains(s))return s;var n=Eu(s);return n&&t.contains(n)?n:(console.error("aria-hidden",s,"in not contained inside",t,". Doing nothing"),null)}).filter(function(s){return!!s})},Iv=function(t,e,s,n){var r=Dv(e,Array.isArray(t)?t:[t]);ur[s]||(ur[s]=new WeakMap);var o=ur[s],a=[],c=new Set,l=new Set(r),d=function(u){!u||c.has(u)||(c.add(u),d(u.parentNode))};r.forEach(d);var h=function(u){!u||l.has(u)||Array.prototype.forEach.call(u.children,function(f){if(c.has(f))h(f);else try{var m=f.getAttribute(n),p=m!==null&&m!=="false",x=(ks.get(f)||0)+1,b=(o.get(f)||0)+1;ks.set(f,x),o.set(f,b),a.push(f),x===1&&p&&dr.set(f,!0),b===1&&f.setAttribute(s,"true"),p||f.setAttribute(n,"true")}catch(S){console.error("aria-hidden: cannot operate on ",f,S)}})};return h(e),c.clear(),Ko++,function(){a.forEach(function(u){var f=ks.get(u)-1,m=o.get(u)-1;ks.set(u,f),o.set(u,m),f||(dr.has(u)||u.removeAttribute(n),dr.delete(u)),m||u.removeAttribute(s)}),Ko--,Ko||(ks=new WeakMap,ks=new WeakMap,dr=new WeakMap,ur={})}},Fv=function(t,e,s){s===void 0&&(s="data-aria-hidden");var n=Array.from(Array.isArray(t)?t:[t]),r=Ov(t);return r?(n.push.apply(n,Array.from(r.querySelectorAll("[aria-live], script"))),Iv(n,r,s,"aria-hidden")):function(){return null}},yt=function(){return yt=Object.assign||function(e){for(var s,n=1,r=arguments.length;n<r;n++){s=arguments[n];for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o])}return e},yt.apply(this,arguments)};function Ru(t,e){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(s[n[r]]=t[n[r]]);return s}function zv(t,e,s){if(s||arguments.length===2)for(var n=0,r=e.length,o;n<r;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}var yr="right-scroll-bar-position",br="width-before-scroll-bar",Uv="with-scroll-bars-hidden",Bv="--removed-body-scroll-bar-size";function qo(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function Hv(t,e){var s=g.useState(function(){return{value:t,callback:e,facade:{get current(){return s.value},set current(n){var r=s.value;r!==n&&(s.value=n,s.callback(n,r))}}}})[0];return s.callback=e,s.facade}var $v=typeof window<"u"?g.useLayoutEffect:g.useEffect,dl=new WeakMap;function Vv(t,e){var s=Hv(null,function(n){return t.forEach(function(r){return qo(r,n)})});return $v(function(){var n=dl.get(s);if(n){var r=new Set(n),o=new Set(t),a=s.current;r.forEach(function(c){o.has(c)||qo(c,null)}),o.forEach(function(c){r.has(c)||qo(c,a)})}dl.set(s,t)},[t]),s}function Wv(t){return t}function Gv(t,e){e===void 0&&(e=Wv);var s=[],n=!1,r={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:t},useMedium:function(o){var a=e(o,n);return s.push(a),function(){s=s.filter(function(c){return c!==a})}},assignSyncMedium:function(o){for(n=!0;s.length;){var a=s;s=[],a.forEach(o)}s={push:function(c){return o(c)},filter:function(){return s}}},assignMedium:function(o){n=!0;var a=[];if(s.length){var c=s;s=[],c.forEach(o),a=s}var l=function(){var h=a;a=[],h.forEach(o)},d=function(){return Promise.resolve().then(l)};d(),s={push:function(h){a.push(h),d()},filter:function(h){return a=a.filter(h),s}}}};return r}function Kv(t){t===void 0&&(t={});var e=Gv(null);return e.options=yt({async:!0,ssr:!1},t),e}var Tu=function(t){var e=t.sideCar,s=Ru(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return g.createElement(n,yt({},s))};Tu.isSideCarExport=!0;function qv(t,e){return t.useMedium(e),Tu}var ju=Kv(),Yo=function(){},lo=g.forwardRef(function(t,e){var s=g.useRef(null),n=g.useState({onScrollCapture:Yo,onWheelCapture:Yo,onTouchMoveCapture:Yo}),r=n[0],o=n[1],a=t.forwardProps,c=t.children,l=t.className,d=t.removeScrollBar,h=t.enabled,u=t.shards,f=t.sideCar,m=t.noRelative,p=t.noIsolation,x=t.inert,b=t.allowPinchZoom,S=t.as,y=S===void 0?"div":S,w=t.gapMode,v=Ru(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),C=f,T=Vv([s,e]),_=yt(yt({},v),r);return g.createElement(g.Fragment,null,h&&g.createElement(C,{sideCar:ju,removeScrollBar:d,shards:u,noRelative:m,noIsolation:p,inert:x,setCallbacks:o,allowPinchZoom:!!b,lockRef:s,gapMode:w}),a?g.cloneElement(g.Children.only(c),yt(yt({},_),{ref:T})):g.createElement(y,yt({},_,{className:l,ref:T}),c))});lo.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};lo.classNames={fullWidth:br,zeroRight:yr};var Yv=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Xv(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Yv();return e&&t.setAttribute("nonce",e),t}function Qv(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function Zv(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Jv=function(){var t=0,e=null;return{add:function(s){t==0&&(e=Xv())&&(Qv(e,s),Zv(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},ew=function(){var t=Jv();return function(e,s){g.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&s])}},Pu=function(){var t=ew(),e=function(s){var n=s.styles,r=s.dynamic;return t(n,r),null};return e},tw={left:0,top:0,right:0,gap:0},Xo=function(t){return parseInt(t||"",10)||0},sw=function(t){var e=window.getComputedStyle(document.body),s=e[t==="padding"?"paddingLeft":"marginLeft"],n=e[t==="padding"?"paddingTop":"marginTop"],r=e[t==="padding"?"paddingRight":"marginRight"];return[Xo(s),Xo(n),Xo(r)]},nw=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return tw;var e=sw(t),s=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-s+e[2]-e[0])}},rw=Pu(),$s="data-scroll-locked",ow=function(t,e,s,n){var r=t.left,o=t.top,a=t.right,c=t.gap;return s===void 0&&(s="margin"),`
  .`.concat(Uv,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(c,"px ").concat(n,`;
  }
  body[`).concat($s,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),s==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(c,"px ").concat(n,`;
    `),s==="padding"&&"padding-right: ".concat(c,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(yr,` {
    right: `).concat(c,"px ").concat(n,`;
  }
  
  .`).concat(br,` {
    margin-right: `).concat(c,"px ").concat(n,`;
  }
  
  .`).concat(yr," .").concat(yr,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(br," .").concat(br,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat($s,`] {
    `).concat(Bv,": ").concat(c,`px;
  }
`)},ul=function(){var t=parseInt(document.body.getAttribute($s)||"0",10);return isFinite(t)?t:0},iw=function(){g.useEffect(function(){return document.body.setAttribute($s,(ul()+1).toString()),function(){var t=ul()-1;t<=0?document.body.removeAttribute($s):document.body.setAttribute($s,t.toString())}},[])},aw=function(t){var e=t.noRelative,s=t.noImportant,n=t.gapMode,r=n===void 0?"margin":n;iw();var o=g.useMemo(function(){return nw(r)},[r]);return g.createElement(rw,{styles:ow(o,!e,r,s?"":"!important")})},Ri=!1;if(typeof window<"u")try{var hr=Object.defineProperty({},"passive",{get:function(){return Ri=!0,!0}});window.addEventListener("test",hr,hr),window.removeEventListener("test",hr,hr)}catch{Ri=!1}var Ms=Ri?{passive:!1}:!1,cw=function(t){return t.tagName==="TEXTAREA"},ku=function(t,e){if(!(t instanceof Element))return!1;var s=window.getComputedStyle(t);return s[e]!=="hidden"&&!(s.overflowY===s.overflowX&&!cw(t)&&s[e]==="visible")},lw=function(t){return ku(t,"overflowY")},dw=function(t){return ku(t,"overflowX")},hl=function(t,e){var s=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var r=Mu(t,n);if(r){var o=Au(t,n),a=o[1],c=o[2];if(a>c)return!0}n=n.parentNode}while(n&&n!==s.body);return!1},uw=function(t){var e=t.scrollTop,s=t.scrollHeight,n=t.clientHeight;return[e,s,n]},hw=function(t){var e=t.scrollLeft,s=t.scrollWidth,n=t.clientWidth;return[e,s,n]},Mu=function(t,e){return t==="v"?lw(e):dw(e)},Au=function(t,e){return t==="v"?uw(e):hw(e)},fw=function(t,e){return t==="h"&&e==="rtl"?-1:1},mw=function(t,e,s,n,r){var o=fw(t,window.getComputedStyle(e).direction),a=o*n,c=s.target,l=e.contains(c),d=!1,h=a>0,u=0,f=0;do{if(!c)break;var m=Au(t,c),p=m[0],x=m[1],b=m[2],S=x-b-o*p;(p||S)&&Mu(t,c)&&(u+=S,f+=p);var y=c.parentNode;c=y&&y.nodeType===Node.DOCUMENT_FRAGMENT_NODE?y.host:y}while(!l&&c!==document.body||l&&(e.contains(c)||e===c));return(h&&Math.abs(u)<1||!h&&Math.abs(f)<1)&&(d=!0),d},fr=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},fl=function(t){return[t.deltaX,t.deltaY]},ml=function(t){return t&&"current"in t?t.current:t},pw=function(t,e){return t[0]===e[0]&&t[1]===e[1]},gw=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},xw=0,As=[];function yw(t){var e=g.useRef([]),s=g.useRef([0,0]),n=g.useRef(),r=g.useState(xw++)[0],o=g.useState(Pu)[0],a=g.useRef(t);g.useEffect(function(){a.current=t},[t]),g.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(r));var x=zv([t.lockRef.current],(t.shards||[]).map(ml),!0).filter(Boolean);return x.forEach(function(b){return b.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),x.forEach(function(b){return b.classList.remove("allow-interactivity-".concat(r))})}}},[t.inert,t.lockRef.current,t.shards]);var c=g.useCallback(function(x,b){if("touches"in x&&x.touches.length===2||x.type==="wheel"&&x.ctrlKey)return!a.current.allowPinchZoom;var S=fr(x),y=s.current,w="deltaX"in x?x.deltaX:y[0]-S[0],v="deltaY"in x?x.deltaY:y[1]-S[1],C,T=x.target,_=Math.abs(w)>Math.abs(v)?"h":"v";if("touches"in x&&_==="h"&&T.type==="range")return!1;var N=hl(_,T);if(!N)return!0;if(N?C=_:(C=_==="v"?"h":"v",N=hl(_,T)),!N)return!1;if(!n.current&&"changedTouches"in x&&(w||v)&&(n.current=C),!C)return!0;var j=n.current||C;return mw(j,b,x,j==="h"?w:v)},[]),l=g.useCallback(function(x){var b=x;if(!(!As.length||As[As.length-1]!==o)){var S="deltaY"in b?fl(b):fr(b),y=e.current.filter(function(C){return C.name===b.type&&(C.target===b.target||b.target===C.shadowParent)&&pw(C.delta,S)})[0];if(y&&y.should){b.cancelable&&b.preventDefault();return}if(!y){var w=(a.current.shards||[]).map(ml).filter(Boolean).filter(function(C){return C.contains(b.target)}),v=w.length>0?c(b,w[0]):!a.current.noIsolation;v&&b.cancelable&&b.preventDefault()}}},[]),d=g.useCallback(function(x,b,S,y){var w={name:x,delta:b,target:S,should:y,shadowParent:bw(S)};e.current.push(w),setTimeout(function(){e.current=e.current.filter(function(v){return v!==w})},1)},[]),h=g.useCallback(function(x){s.current=fr(x),n.current=void 0},[]),u=g.useCallback(function(x){d(x.type,fl(x),x.target,c(x,t.lockRef.current))},[]),f=g.useCallback(function(x){d(x.type,fr(x),x.target,c(x,t.lockRef.current))},[]);g.useEffect(function(){return As.push(o),t.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:f}),document.addEventListener("wheel",l,Ms),document.addEventListener("touchmove",l,Ms),document.addEventListener("touchstart",h,Ms),function(){As=As.filter(function(x){return x!==o}),document.removeEventListener("wheel",l,Ms),document.removeEventListener("touchmove",l,Ms),document.removeEventListener("touchstart",h,Ms)}},[]);var m=t.removeScrollBar,p=t.inert;return g.createElement(g.Fragment,null,p?g.createElement(o,{styles:gw(r)}):null,m?g.createElement(aw,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function bw(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const vw=qv(ju,yw);var Lu=g.forwardRef(function(t,e){return g.createElement(lo,yt({},t,{ref:e,sideCar:vw}))});Lu.classNames=lo.classNames;var ww=[" ","Enter","ArrowUp","ArrowDown"],Sw=[" ","Enter"],_s="Select",[uo,ho,_w]=Db(_s),[tn]=fa(_s,[_w,pu]),fo=pu(),[Nw,rs]=tn(_s),[Cw,Ew]=tn(_s),Ou=t=>{const{__scopeSelect:e,children:s,open:n,defaultOpen:r,onOpenChange:o,value:a,defaultValue:c,onValueChange:l,dir:d,name:h,autoComplete:u,disabled:f,required:m,form:p}=t,x=fo(e),[b,S]=g.useState(null),[y,w]=g.useState(null),[v,C]=g.useState(!1),T=Fb(d),[_,N]=ll({prop:n,defaultProp:r??!1,onChange:o,caller:_s}),[j,F]=ll({prop:a,defaultProp:c,onChange:l,caller:_s}),E=g.useRef(null),P=b?p||!!b.closest("form"):!0,[B,k]=g.useState(new Set),D=Array.from(B).map(U=>U.props.value).join(";");return i.jsx(Nv,{...x,children:i.jsxs(Nw,{required:m,scope:e,trigger:b,onTriggerChange:S,valueNode:y,onValueNodeChange:w,valueNodeHasChildren:v,onValueNodeHasChildrenChange:C,contentId:ma(),value:j,onValueChange:F,open:_,onOpenChange:N,dir:T,triggerPointerDownPosRef:E,disabled:f,children:[i.jsx(uo.Provider,{scope:e,children:i.jsx(Cw,{scope:t.__scopeSelect,onNativeOptionAdd:g.useCallback(U=>{k(Y=>new Set(Y).add(U))},[]),onNativeOptionRemove:g.useCallback(U=>{k(Y=>{const O=new Set(Y);return O.delete(U),O})},[]),children:s})}),P?i.jsxs(oh,{"aria-hidden":!0,required:m,tabIndex:-1,name:h,autoComplete:u,value:j,onChange:U=>F(U.target.value),disabled:f,form:p,children:[j===void 0?i.jsx("option",{value:""}):null,Array.from(B)]},D):null]})})};Ou.displayName=_s;var Du="SelectTrigger",Iu=g.forwardRef((t,e)=>{const{__scopeSelect:s,disabled:n=!1,...r}=t,o=fo(s),a=rs(Du,s),c=a.disabled||n,l=Ae(e,a.onTriggerChange),d=ho(s),h=g.useRef("touch"),[u,f,m]=ah(x=>{const b=d().filter(w=>!w.disabled),S=b.find(w=>w.value===a.value),y=ch(b,x,S);y!==void 0&&a.onValueChange(y.value)}),p=x=>{c||(a.onOpenChange(!0),m()),x&&(a.triggerPointerDownPosRef.current={x:Math.round(x.pageX),y:Math.round(x.pageY)})};return i.jsx(Cv,{asChild:!0,...o,children:i.jsx(Ce.button,{type:"button",role:"combobox","aria-controls":a.contentId,"aria-expanded":a.open,"aria-required":a.required,"aria-autocomplete":"none",dir:a.dir,"data-state":a.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":ih(a.value)?"":void 0,...r,ref:l,onClick:Te(r.onClick,x=>{x.currentTarget.focus(),h.current!=="mouse"&&p(x)}),onPointerDown:Te(r.onPointerDown,x=>{h.current=x.pointerType;const b=x.target;b.hasPointerCapture(x.pointerId)&&b.releasePointerCapture(x.pointerId),x.button===0&&x.ctrlKey===!1&&x.pointerType==="mouse"&&(p(x),x.preventDefault())}),onKeyDown:Te(r.onKeyDown,x=>{const b=u.current!=="";!(x.ctrlKey||x.altKey||x.metaKey)&&x.key.length===1&&f(x.key),!(b&&x.key===" ")&&ww.includes(x.key)&&(p(),x.preventDefault())})})})});Iu.displayName=Du;var Fu="SelectValue",zu=g.forwardRef((t,e)=>{const{__scopeSelect:s,className:n,style:r,children:o,placeholder:a="",...c}=t,l=rs(Fu,s),{onValueNodeHasChildrenChange:d}=l,h=o!==void 0,u=Ae(e,l.onValueNodeChange);return Ye(()=>{d(h)},[d,h]),i.jsx(Ce.span,{...c,ref:u,style:{pointerEvents:"none"},children:ih(l.value)?i.jsx(i.Fragment,{children:a}):o})});zu.displayName=Fu;var Rw="SelectIcon",Uu=g.forwardRef((t,e)=>{const{__scopeSelect:s,children:n,...r}=t;return i.jsx(Ce.span,{"aria-hidden":!0,...r,ref:e,children:n||""})});Uu.displayName=Rw;var Tw="SelectPortal",Bu=t=>i.jsx(Nu,{asChild:!0,...t});Bu.displayName=Tw;var Ns="SelectContent",Hu=g.forwardRef((t,e)=>{const s=rs(Ns,t.__scopeSelect),[n,r]=g.useState();if(Ye(()=>{r(new DocumentFragment)},[]),!s.open){const o=n;return o?Xs.createPortal(i.jsx($u,{scope:t.__scopeSelect,children:i.jsx(uo.Slot,{scope:t.__scopeSelect,children:i.jsx("div",{children:t.children})})}),o):null}return i.jsx(Vu,{...t,ref:e})});Hu.displayName=Ns;var lt=10,[$u,os]=tn(Ns),jw="SelectContentImpl",Pw=Ar("SelectContent.RemoveScroll"),Vu=g.forwardRef((t,e)=>{const{__scopeSelect:s,position:n="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:o,onPointerDownOutside:a,side:c,sideOffset:l,align:d,alignOffset:h,arrowPadding:u,collisionBoundary:f,collisionPadding:m,sticky:p,hideWhenDetached:x,avoidCollisions:b,...S}=t,y=rs(Ns,s),[w,v]=g.useState(null),[C,T]=g.useState(null),_=Ae(e,R=>v(R)),[N,j]=g.useState(null),[F,E]=g.useState(null),P=ho(s),[B,k]=g.useState(!1),D=g.useRef(!1);g.useEffect(()=>{if(w)return Fv(w)},[w]),Yb();const U=g.useCallback(R=>{const[A,...L]=P().map(se=>se.ref.current),[M]=L.slice(-1),V=document.activeElement;for(const se of R)if(se===V||(se?.scrollIntoView({block:"nearest"}),se===A&&C&&(C.scrollTop=0),se===M&&C&&(C.scrollTop=C.scrollHeight),se?.focus(),document.activeElement!==V))return},[P,C]),Y=g.useCallback(()=>U([N,w]),[U,N,w]);g.useEffect(()=>{B&&Y()},[B,Y]);const{onOpenChange:O,triggerPointerDownPosRef:G}=y;g.useEffect(()=>{if(w){let R={x:0,y:0};const A=M=>{R={x:Math.abs(Math.round(M.pageX)-(G.current?.x??0)),y:Math.abs(Math.round(M.pageY)-(G.current?.y??0))}},L=M=>{R.x<=10&&R.y<=10?M.preventDefault():w.contains(M.target)||O(!1),document.removeEventListener("pointermove",A),G.current=null};return G.current!==null&&(document.addEventListener("pointermove",A),document.addEventListener("pointerup",L,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",A),document.removeEventListener("pointerup",L,{capture:!0})}}},[w,O,G]),g.useEffect(()=>{const R=()=>O(!1);return window.addEventListener("blur",R),window.addEventListener("resize",R),()=>{window.removeEventListener("blur",R),window.removeEventListener("resize",R)}},[O]);const[ce,X]=ah(R=>{const A=P().filter(V=>!V.disabled),L=A.find(V=>V.ref.current===document.activeElement),M=ch(A,R,L);M&&setTimeout(()=>M.ref.current.focus())}),ye=g.useCallback((R,A,L)=>{const M=!D.current&&!L;(y.value!==void 0&&y.value===A||M)&&(j(R),M&&(D.current=!0))},[y.value]),ne=g.useCallback(()=>w?.focus(),[w]),ue=g.useCallback((R,A,L)=>{const M=!D.current&&!L;(y.value!==void 0&&y.value===A||M)&&E(R)},[y.value]),pe=n==="popper"?Ti:Wu,fe=pe===Ti?{side:c,sideOffset:l,align:d,alignOffset:h,arrowPadding:u,collisionBoundary:f,collisionPadding:m,sticky:p,hideWhenDetached:x,avoidCollisions:b}:{};return i.jsx($u,{scope:s,content:w,viewport:C,onViewportChange:T,itemRefCallback:ye,selectedItem:N,onItemLeave:ne,itemTextRefCallback:ue,focusSelectedItem:Y,selectedItemText:F,position:n,isPositioned:B,searchRef:ce,children:i.jsx(Lu,{as:Pw,allowPinchZoom:!0,children:i.jsx(eu,{asChild:!0,trapped:y.open,onMountAutoFocus:R=>{R.preventDefault()},onUnmountAutoFocus:Te(r,R=>{y.trigger?.focus({preventScroll:!0}),R.preventDefault()}),children:i.jsx(Zd,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:a,onFocusOutside:R=>R.preventDefault(),onDismiss:()=>y.onOpenChange(!1),children:i.jsx(pe,{role:"listbox",id:y.contentId,"data-state":y.open?"open":"closed",dir:y.dir,onContextMenu:R=>R.preventDefault(),...S,...fe,onPlaced:()=>k(!0),ref:_,style:{display:"flex",flexDirection:"column",outline:"none",...S.style},onKeyDown:Te(S.onKeyDown,R=>{const A=R.ctrlKey||R.altKey||R.metaKey;if(R.key==="Tab"&&R.preventDefault(),!A&&R.key.length===1&&X(R.key),["ArrowUp","ArrowDown","Home","End"].includes(R.key)){let M=P().filter(V=>!V.disabled).map(V=>V.ref.current);if(["ArrowUp","End"].includes(R.key)&&(M=M.slice().reverse()),["ArrowUp","ArrowDown"].includes(R.key)){const V=R.target,se=M.indexOf(V);M=M.slice(se+1)}setTimeout(()=>U(M)),R.preventDefault()}})})})})})})});Vu.displayName=jw;var kw="SelectItemAlignedPosition",Wu=g.forwardRef((t,e)=>{const{__scopeSelect:s,onPlaced:n,...r}=t,o=rs(Ns,s),a=os(Ns,s),[c,l]=g.useState(null),[d,h]=g.useState(null),u=Ae(e,_=>h(_)),f=ho(s),m=g.useRef(!1),p=g.useRef(!0),{viewport:x,selectedItem:b,selectedItemText:S,focusSelectedItem:y}=a,w=g.useCallback(()=>{if(o.trigger&&o.valueNode&&c&&d&&x&&b&&S){const _=o.trigger.getBoundingClientRect(),N=d.getBoundingClientRect(),j=o.valueNode.getBoundingClientRect(),F=S.getBoundingClientRect();if(o.dir!=="rtl"){const V=F.left-N.left,se=j.left-V,ee=_.left-se,J=_.width+ee,he=Math.max(J,N.width),me=window.innerWidth-lt,_e=$c(se,[lt,Math.max(lt,me-he)]);c.style.minWidth=J+"px",c.style.left=_e+"px"}else{const V=N.right-F.right,se=window.innerWidth-j.right-V,ee=window.innerWidth-_.right-se,J=_.width+ee,he=Math.max(J,N.width),me=window.innerWidth-lt,_e=$c(se,[lt,Math.max(lt,me-he)]);c.style.minWidth=J+"px",c.style.right=_e+"px"}const E=f(),P=window.innerHeight-lt*2,B=x.scrollHeight,k=window.getComputedStyle(d),D=parseInt(k.borderTopWidth,10),U=parseInt(k.paddingTop,10),Y=parseInt(k.borderBottomWidth,10),O=parseInt(k.paddingBottom,10),G=D+U+B+O+Y,ce=Math.min(b.offsetHeight*5,G),X=window.getComputedStyle(x),ye=parseInt(X.paddingTop,10),ne=parseInt(X.paddingBottom,10),ue=_.top+_.height/2-lt,pe=P-ue,fe=b.offsetHeight/2,R=b.offsetTop+fe,A=D+U+R,L=G-A;if(A<=ue){const V=E.length>0&&b===E[E.length-1].ref.current;c.style.bottom="0px";const se=d.clientHeight-x.offsetTop-x.offsetHeight,ee=Math.max(pe,fe+(V?ne:0)+se+Y),J=A+ee;c.style.height=J+"px"}else{const V=E.length>0&&b===E[0].ref.current;c.style.top="0px";const ee=Math.max(ue,D+x.offsetTop+(V?ye:0)+fe)+L;c.style.height=ee+"px",x.scrollTop=A-ue+x.offsetTop}c.style.margin=`${lt}px 0`,c.style.minHeight=ce+"px",c.style.maxHeight=P+"px",n?.(),requestAnimationFrame(()=>m.current=!0)}},[f,o.trigger,o.valueNode,c,d,x,b,S,o.dir,n]);Ye(()=>w(),[w]);const[v,C]=g.useState();Ye(()=>{d&&C(window.getComputedStyle(d).zIndex)},[d]);const T=g.useCallback(_=>{_&&p.current===!0&&(w(),y?.(),p.current=!1)},[w,y]);return i.jsx(Aw,{scope:s,contentWrapper:c,shouldExpandOnScrollRef:m,onScrollButtonChange:T,children:i.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:v},children:i.jsx(Ce.div,{...r,ref:u,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});Wu.displayName=kw;var Mw="SelectPopperPosition",Ti=g.forwardRef((t,e)=>{const{__scopeSelect:s,align:n="start",collisionPadding:r=lt,...o}=t,a=fo(s);return i.jsx(Ev,{...a,...o,ref:e,align:n,collisionPadding:r,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Ti.displayName=Mw;var[Aw,_a]=tn(Ns,{}),ji="SelectViewport",Gu=g.forwardRef((t,e)=>{const{__scopeSelect:s,nonce:n,...r}=t,o=os(ji,s),a=_a(ji,s),c=Ae(e,o.onViewportChange),l=g.useRef(0);return i.jsxs(i.Fragment,{children:[i.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),i.jsx(uo.Slot,{scope:s,children:i.jsx(Ce.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:Te(r.onScroll,d=>{const h=d.currentTarget,{contentWrapper:u,shouldExpandOnScrollRef:f}=a;if(f?.current&&u){const m=Math.abs(l.current-h.scrollTop);if(m>0){const p=window.innerHeight-lt*2,x=parseFloat(u.style.minHeight),b=parseFloat(u.style.height),S=Math.max(x,b);if(S<p){const y=S+m,w=Math.min(p,y),v=y-w;u.style.height=w+"px",u.style.bottom==="0px"&&(h.scrollTop=v>0?v:0,u.style.justifyContent="flex-end")}}}l.current=h.scrollTop})})})]})});Gu.displayName=ji;var Ku="SelectGroup",[Lw,Ow]=tn(Ku),Dw=g.forwardRef((t,e)=>{const{__scopeSelect:s,...n}=t,r=ma();return i.jsx(Lw,{scope:s,id:r,children:i.jsx(Ce.div,{role:"group","aria-labelledby":r,...n,ref:e})})});Dw.displayName=Ku;var qu="SelectLabel",Yu=g.forwardRef((t,e)=>{const{__scopeSelect:s,...n}=t,r=Ow(qu,s);return i.jsx(Ce.div,{id:r.id,...n,ref:e})});Yu.displayName=qu;var Fr="SelectItem",[Iw,Xu]=tn(Fr),Qu=g.forwardRef((t,e)=>{const{__scopeSelect:s,value:n,disabled:r=!1,textValue:o,...a}=t,c=rs(Fr,s),l=os(Fr,s),d=c.value===n,[h,u]=g.useState(o??""),[f,m]=g.useState(!1),p=Ae(e,y=>l.itemRefCallback?.(y,n,r)),x=ma(),b=g.useRef("touch"),S=()=>{r||(c.onValueChange(n),c.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return i.jsx(Iw,{scope:s,value:n,disabled:r,textId:x,isSelected:d,onItemTextChange:g.useCallback(y=>{u(w=>w||(y?.textContent??"").trim())},[]),children:i.jsx(uo.ItemSlot,{scope:s,value:n,disabled:r,textValue:h,children:i.jsx(Ce.div,{role:"option","aria-labelledby":x,"data-highlighted":f?"":void 0,"aria-selected":d&&f,"data-state":d?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...a,ref:p,onFocus:Te(a.onFocus,()=>m(!0)),onBlur:Te(a.onBlur,()=>m(!1)),onClick:Te(a.onClick,()=>{b.current!=="mouse"&&S()}),onPointerUp:Te(a.onPointerUp,()=>{b.current==="mouse"&&S()}),onPointerDown:Te(a.onPointerDown,y=>{b.current=y.pointerType}),onPointerMove:Te(a.onPointerMove,y=>{b.current=y.pointerType,r?l.onItemLeave?.():b.current==="mouse"&&y.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Te(a.onPointerLeave,y=>{y.currentTarget===document.activeElement&&l.onItemLeave?.()}),onKeyDown:Te(a.onKeyDown,y=>{l.searchRef?.current!==""&&y.key===" "||(Sw.includes(y.key)&&S(),y.key===" "&&y.preventDefault())})})})})});Qu.displayName=Fr;var vn="SelectItemText",Zu=g.forwardRef((t,e)=>{const{__scopeSelect:s,className:n,style:r,...o}=t,a=rs(vn,s),c=os(vn,s),l=Xu(vn,s),d=Ew(vn,s),[h,u]=g.useState(null),f=Ae(e,S=>u(S),l.onItemTextChange,S=>c.itemTextRefCallback?.(S,l.value,l.disabled)),m=h?.textContent,p=g.useMemo(()=>i.jsx("option",{value:l.value,disabled:l.disabled,children:m},l.value),[l.disabled,l.value,m]),{onNativeOptionAdd:x,onNativeOptionRemove:b}=d;return Ye(()=>(x(p),()=>b(p)),[x,b,p]),i.jsxs(i.Fragment,{children:[i.jsx(Ce.span,{id:l.textId,...o,ref:f}),l.isSelected&&a.valueNode&&!a.valueNodeHasChildren?Xs.createPortal(o.children,a.valueNode):null]})});Zu.displayName=vn;var Ju="SelectItemIndicator",eh=g.forwardRef((t,e)=>{const{__scopeSelect:s,...n}=t;return Xu(Ju,s).isSelected?i.jsx(Ce.span,{"aria-hidden":!0,...n,ref:e}):null});eh.displayName=Ju;var Pi="SelectScrollUpButton",th=g.forwardRef((t,e)=>{const s=os(Pi,t.__scopeSelect),n=_a(Pi,t.__scopeSelect),[r,o]=g.useState(!1),a=Ae(e,n.onScrollButtonChange);return Ye(()=>{if(s.viewport&&s.isPositioned){let c=function(){const d=l.scrollTop>0;o(d)};const l=s.viewport;return c(),l.addEventListener("scroll",c),()=>l.removeEventListener("scroll",c)}},[s.viewport,s.isPositioned]),r?i.jsx(nh,{...t,ref:a,onAutoScroll:()=>{const{viewport:c,selectedItem:l}=s;c&&l&&(c.scrollTop=c.scrollTop-l.offsetHeight)}}):null});th.displayName=Pi;var ki="SelectScrollDownButton",sh=g.forwardRef((t,e)=>{const s=os(ki,t.__scopeSelect),n=_a(ki,t.__scopeSelect),[r,o]=g.useState(!1),a=Ae(e,n.onScrollButtonChange);return Ye(()=>{if(s.viewport&&s.isPositioned){let c=function(){const d=l.scrollHeight-l.clientHeight,h=Math.ceil(l.scrollTop)<d;o(h)};const l=s.viewport;return c(),l.addEventListener("scroll",c),()=>l.removeEventListener("scroll",c)}},[s.viewport,s.isPositioned]),r?i.jsx(nh,{...t,ref:a,onAutoScroll:()=>{const{viewport:c,selectedItem:l}=s;c&&l&&(c.scrollTop=c.scrollTop+l.offsetHeight)}}):null});sh.displayName=ki;var nh=g.forwardRef((t,e)=>{const{__scopeSelect:s,onAutoScroll:n,...r}=t,o=os("SelectScrollButton",s),a=g.useRef(null),c=ho(s),l=g.useCallback(()=>{a.current!==null&&(window.clearInterval(a.current),a.current=null)},[]);return g.useEffect(()=>()=>l(),[l]),Ye(()=>{c().find(h=>h.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[c]),i.jsx(Ce.div,{"aria-hidden":!0,...r,ref:e,style:{flexShrink:0,...r.style},onPointerDown:Te(r.onPointerDown,()=>{a.current===null&&(a.current=window.setInterval(n,50))}),onPointerMove:Te(r.onPointerMove,()=>{o.onItemLeave?.(),a.current===null&&(a.current=window.setInterval(n,50))}),onPointerLeave:Te(r.onPointerLeave,()=>{l()})})}),Fw="SelectSeparator",rh=g.forwardRef((t,e)=>{const{__scopeSelect:s,...n}=t;return i.jsx(Ce.div,{"aria-hidden":!0,...n,ref:e})});rh.displayName=Fw;var Mi="SelectArrow",zw=g.forwardRef((t,e)=>{const{__scopeSelect:s,...n}=t,r=fo(s),o=rs(Mi,s),a=os(Mi,s);return o.open&&a.position==="popper"?i.jsx(Rv,{...r,...n,ref:e}):null});zw.displayName=Mi;var Uw="SelectBubbleInput",oh=g.forwardRef(({__scopeSelect:t,value:e,...s},n)=>{const r=g.useRef(null),o=Ae(n,r),a=Mv(e);return g.useEffect(()=>{const c=r.current;if(!c)return;const l=window.HTMLSelectElement.prototype,h=Object.getOwnPropertyDescriptor(l,"value").set;if(a!==e&&h){const u=new Event("change",{bubbles:!0});h.call(c,e),c.dispatchEvent(u)}},[a,e]),i.jsx(Ce.select,{...s,style:{...Cu,...s.style},ref:o,defaultValue:e})});oh.displayName=Uw;function ih(t){return t===""||t===void 0}function ah(t){const e=ws(t),s=g.useRef(""),n=g.useRef(0),r=g.useCallback(a=>{const c=s.current+a;e(c),(function l(d){s.current=d,window.clearTimeout(n.current),d!==""&&(n.current=window.setTimeout(()=>l(""),1e3))})(c)},[e]),o=g.useCallback(()=>{s.current="",window.clearTimeout(n.current)},[]);return g.useEffect(()=>()=>window.clearTimeout(n.current),[]),[s,r,o]}function ch(t,e,s){const r=e.length>1&&Array.from(e).every(d=>d===e[0])?e[0]:e,o=s?t.indexOf(s):-1;let a=Bw(t,Math.max(o,0));r.length===1&&(a=a.filter(d=>d!==s));const l=a.find(d=>d.textValue.toLowerCase().startsWith(r.toLowerCase()));return l!==s?l:void 0}function Bw(t,e){return t.map((s,n)=>t[(e+n)%t.length])}var Hw=Ou,lh=Iu,$w=zu,Vw=Uu,Ww=Bu,dh=Hu,Gw=Gu,uh=Yu,hh=Qu,Kw=Zu,qw=eh,fh=th,mh=sh,ph=rh;const Yw=Hw,Xw=$w,gh=g.forwardRef(({className:t,children:e,...s},n)=>i.jsxs(lh,{ref:n,className:Ne("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...s,children:[e,i.jsx(Vw,{asChild:!0,children:i.jsx(ta,{className:"h-4 w-4 opacity-50"})})]}));gh.displayName=lh.displayName;const xh=g.forwardRef(({className:t,...e},s)=>i.jsx(fh,{ref:s,className:Ne("flex cursor-default items-center justify-center py-1",t),...e,children:i.jsx(ld,{className:"h-4 w-4"})}));xh.displayName=fh.displayName;const yh=g.forwardRef(({className:t,...e},s)=>i.jsx(mh,{ref:s,className:Ne("flex cursor-default items-center justify-center py-1",t),...e,children:i.jsx(ta,{className:"h-4 w-4"})}));yh.displayName=mh.displayName;const bh=g.forwardRef(({className:t,children:e,position:s="popper",...n},r)=>i.jsx(Ww,{children:i.jsxs(dh,{ref:r,className:Ne("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...n,children:[i.jsx(xh,{}),i.jsx(Gw,{className:Ne("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),i.jsx(yh,{})]})}));bh.displayName=dh.displayName;const Qw=g.forwardRef(({className:t,...e},s)=>i.jsx(uh,{ref:s,className:Ne("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...e}));Qw.displayName=uh.displayName;const vh=g.forwardRef(({className:t,children:e,...s},n)=>i.jsxs(hh,{ref:n,className:Ne("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...s,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(qw,{children:i.jsx(fg,{className:"h-4 w-4"})})}),i.jsx(Kw,{children:e})]}));vh.displayName=hh.displayName;const Zw=g.forwardRef(({className:t,...e},s)=>i.jsx(ph,{ref:s,className:Ne("-mx-1 my-1 h-px bg-muted",t),...e}));Zw.displayName=ph.displayName;const mr=[{type:"habitat-module",name:"Habitat Module",color:"#4a90e2",defaultScale:new $(2,2,2),description:"Main living quarters for astronauts"},{type:"solar-panel",name:"Solar Panel Array",color:"#2ecc71",defaultScale:new $(3,.1,1.5),description:"Power generation system"},{type:"communication-dish",name:"Communication Dish",color:"#e74c3c",defaultScale:new $(1.5,2,1.5),description:"Earth communication system"},{type:"rover-garage",name:"Rover Garage",color:"#f39c12",defaultScale:new $(2.5,1.5,3),description:"Vehicle storage and maintenance"},{type:"greenhouse",name:"Greenhouse Module",color:"#27ae60",defaultScale:new $(2,2,4),description:"Food production facility"},{type:"landing-pad",name:"Landing Pad",color:"#95a5a6",defaultScale:new $(4,.2,4),description:"Spacecraft landing area"}],Jw=()=>{const[t,e]=g.useState([]),[s,n]=g.useState(mr[0].type),[r,o]=g.useState(null),[a,c]=g.useState(null),[l,d]=g.useState("Untitled Mars Base"),h=g.useRef(new Map),u=g.useCallback(y=>{c(y),console.log("Mars terrain loaded successfully!")},[]),f=g.useCallback(y=>{const w=new wt;let v;switch(y.type){case"habitat-module":v=new Lt(1,1,1,8);break;case"solar-panel":v=new ge(1,1,1);break;case"communication-dish":v=new xl(1,1,8);break;case"rover-garage":v=new ge(1,1,1);break;case"greenhouse":v=new Lt(1,1,1,6);break;case"landing-pad":v=new Lt(1,1,1,16);break;default:v=new ge(1,1,1)}const C=new xt({color:y.color,transparent:!0,opacity:.8}),T=new ke(v,C);w.add(T);const _=new tf(v),N=new Di(_,new Oi({color:0,opacity:.3,transparent:!0}));return w.add(N),w},[]),m=g.useCallback((y,w)=>{const v=mr.find(j=>j.type===s);if(!v||!a)return;const C={id:`obj_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,position:y.clone(),rotation:new Hi(0,0,0),type:v.type,name:`${v.name} ${t.filter(j=>j.type===v.type).length+1}`,scale:v.defaultScale.clone(),color:v.color},T=f(v);T.position.copy(y),T.scale.copy(v.defaultScale);const _=new $(0,1,0),N=new ys().setFromUnitVectors(_,w);T.setRotationFromQuaternion(N),a.group.add(T),h.current.set(C.id,T),e(j=>[...j,C]),console.log("Object placed:",C)},[s,t,a,f]),p=g.useCallback(y=>{const w=h.current.get(y);w&&a&&(a.group.remove(w),h.current.delete(y)),e(v=>v.filter(C=>C.id!==y)),o(null)},[a]),x=g.useCallback(()=>{a&&(h.current.forEach(y=>{a.group.remove(y)}),h.current.clear()),e([]),o(null)},[a]),b=g.useCallback(()=>{const y={name:l,timestamp:new Date().toISOString(),objects:t.map(_=>({..._,position:_.position.toArray(),rotation:[_.rotation.x,_.rotation.y,_.rotation.z],scale:_.scale.toArray()}))},w=JSON.stringify(y,null,2),v=new Blob([w],{type:"application/json"}),C=URL.createObjectURL(v),T=document.createElement("a");T.href=C,T.download=`${l.replace(/\s+/g,"_")}_mars_base.json`,T.click(),URL.revokeObjectURL(C)},[l,t]),S=mr.find(y=>y.type===s);return i.jsxs("div",{className:"flex h-screen bg-gray-900",children:[i.jsxs("div",{className:"w-80 bg-gray-800 text-white p-4 overflow-y-auto",children:[i.jsx(Fe,{className:"bg-gray-700 border-gray-600 mb-4",children:i.jsxs(Qe,{className:"pb-3",children:[i.jsx(Ze,{className:"text-white text-lg",children:"Mars Base Designer"}),i.jsx("input",{type:"text",value:l,onChange:y=>d(y.target.value),className:"bg-gray-600 text-white px-2 py-1 rounded text-sm mt-2",placeholder:"Design name..."})]})}),i.jsxs(Fe,{className:"bg-gray-700 border-gray-600 mb-4",children:[i.jsx(Qe,{className:"pb-3",children:i.jsx(Ze,{className:"text-white text-sm",children:"Object Library"})}),i.jsxs(qe,{children:[i.jsxs(Yw,{value:s,onValueChange:n,children:[i.jsx(gh,{className:"bg-gray-600 border-gray-500 text-white",children:i.jsx(Xw,{placeholder:"Select object type"})}),i.jsx(bh,{className:"bg-gray-600 border-gray-500",children:mr.map(y=>i.jsx(vh,{value:y.type,className:"text-white hover:bg-gray-500",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:y.color}}),i.jsx("span",{children:y.name})]})},y.type))})]}),S&&i.jsxs("div",{className:"mt-3 p-3 bg-gray-600 rounded text-sm",children:[i.jsx("h4",{className:"font-semibold text-white",children:S.name}),i.jsx("p",{className:"text-gray-300 text-xs mt-1",children:S.description}),i.jsx(we,{className:"mt-2",style:{backgroundColor:S.color},children:"Click terrain to place"})]})]})]}),i.jsxs(Fe,{className:"bg-gray-700 border-gray-600 mb-4",children:[i.jsx(Qe,{className:"pb-3",children:i.jsxs(Ze,{className:"text-white text-sm",children:["Placed Objects (",t.length,")"]})}),i.jsx(qe,{children:i.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[t.map(y=>i.jsx("div",{className:`p-2 rounded cursor-pointer transition-colors ${r===y.id?"bg-blue-600":"bg-gray-600 hover:bg-gray-500"}`,onClick:()=>o(y.id),children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:y.color}}),i.jsx("span",{className:"text-sm text-white truncate",children:y.name})]}),i.jsx(re,{size:"sm",variant:"ghost",onClick:w=>{w.stopPropagation(),p(y.id)},className:"h-6 w-6 p-0 text-red-400 hover:text-red-300",children:i.jsx(vs,{className:"w-3 h-3"})})]})},y.id)),t.length===0&&i.jsxs("p",{className:"text-gray-400 text-sm text-center py-4",children:["No objects placed yet.",i.jsx("br",{}),"Click on Mars terrain to place objects."]})]})})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs(re,{onClick:b,className:"w-full",disabled:t.length===0,children:[i.jsx(eo,{className:"w-4 h-4 mr-2"}),"Save Design"]}),i.jsxs(re,{onClick:x,variant:"destructive",className:"w-full",disabled:t.length===0,children:[i.jsx(vs,{className:"w-4 h-4 mr-2"}),"Clear All"]})]})]}),i.jsxs("div",{className:"flex-1 relative",children:[i.jsx(jb,{onTerrainLoad:u,onObjectDrop:m,className:"w-full h-full"}),i.jsxs("div",{className:"absolute bottom-4 right-4 bg-black bg-opacity-70 text-white p-3 rounded-lg text-sm",children:[i.jsx("h4",{className:"font-semibold mb-2",children:"Base Statistics"}),i.jsxs("div",{className:"space-y-1 text-xs",children:[i.jsxs("div",{children:["Total Objects: ",t.length]}),i.jsxs("div",{children:["Habitat Modules: ",t.filter(y=>y.type==="habitat-module").length]}),i.jsxs("div",{children:["Power Systems: ",t.filter(y=>y.type==="solar-panel").length]}),i.jsxs("div",{children:["Communication: ",t.filter(y=>y.type==="communication-dish").length]})]})]})]})]})},is=Pm({component:jx}),eS=ns({getParentRoute:()=>is,path:"/",component:Cd}),tS=ns({getParentRoute:()=>is,path:"/design",component:Cd}),sS=ns({getParentRoute:()=>is,path:"/analysis",component:ey}),nS=ns({getParentRoute:()=>is,path:"/collections",component:()=>i.jsx("div",{className:"flex items-center justify-center h-full bg-background text-foreground",children:i.jsxs("div",{className:"text-center",children:[i.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:"Habitat Collections"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Manage saved habitat layouts and NASA mission templates"}),i.jsxs("div",{className:"bg-card border border-border rounded-lg p-6",children:[i.jsx("p",{className:"text-card-foreground",children:"Coming Soon: Collection features including:"}),i.jsxs("ul",{className:"text-left text-muted-foreground mt-4 space-y-1",children:[i.jsx("li",{children:" Save and load habitat designs"}),i.jsx("li",{children:" NASA mission template library"}),i.jsx("li",{children:" Version history and comparison"}),i.jsx("li",{children:" Export to CAD formats"}),i.jsx("li",{children:" Team collaboration tools"})]})]})]})})}),rS=ns({getParentRoute:()=>is,path:"/demo",component:qx}),oS=ns({getParentRoute:()=>is,path:"/cad",component:()=>i.jsx("div",{className:"h-screen bg-background",children:i.jsx(Qx,{onSaveModule:t=>{console.log("CAD module saved:",t)}})})}),iS=ns({getParentRoute:()=>is,path:"/mars-design",component:Jw}),aS=is.addChildren([eS,tS,sS,nS,rS,oS,iS]),cS=zm({routeTree:aS}),lS=new pp({defaultOptions:{queries:{staleTime:300*1e3,retry:1}}});function dS(){return i.jsx(xp,{client:lS,children:i.jsx(Hm,{router:cS})})}sf.createRoot(document.getElementById("root")).render(i.jsx(Ke.StrictMode,{children:i.jsx(dS,{})}));
